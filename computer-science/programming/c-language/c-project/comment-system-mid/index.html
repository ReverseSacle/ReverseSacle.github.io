<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#222><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/ico sizes=48x48 href=/images/favicon.ico><link rel=alternate type=application/rss+xml title=逆转天平 href=https://www.reversesacle.com/rss.xml><link rel=alternate type=application/atom+xml title=逆转天平 href=https://www.reversesacle.com/atom.xml><link rel=alternate type=application/json title=逆转天平 href=https://www.reversesacle.com/feed.json><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=/css/app.css><meta name=description content=开源项目><link rel=canonical href=https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-mid/ ><title>网站留言评论系统的设计与手动实现-中稿 - C语言项目 - C语言 - 编程 - 计算机科学 | ReverseSacle-Blog</title><meta name=generator content="Hexo 6.3.0"></head><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=dotloader><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">网站留言评论系统的设计与手动实现-中稿</h1><div class=meta><span class=item title="创建时间：2023-09-08 14:58:44"><span class=icon><i class="ic i-calendar"></i></span> <span class=text>发表于</span> <time itemprop="dateCreated datePublished" datetime=2023-09-08T14:58:44+08:00>2023-09-08</time></span><span class=item title=本文字数><span class=icon><i class="ic i-pen"></i></span> <span class=text>本文字数</span> <span>236k</span> <span class=text>字</span></span><span class=item title=阅读时长><span class=icon><i class="ic i-clock"></i></span> <span class=text>阅读时长</span> <span>4:34</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div class=lines role=navigation aria-label=切换导航栏><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>ReverseSacle-Blog</a></li></ul><ul class=right><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id=imgs class=pjax><ul><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg11.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg12.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg13.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg10.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg6.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg9.webp></li></ul></div></header><div id=waves><svg class=waves xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewBox="0 24 150 28" preserveAspectRatio=none shape-rendering=auto><defs><path id=gentle-wave d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352z"/></defs><g class=parallax><use xlink:href=#gentle-wave x=48 y=0 /><use xlink:href=#gentle-wave x=48 y=3 /><use xlink:href=#gentle-wave x=48 y=5 /><use xlink:href=#gentle-wave x=48 y=7 /></g></svg></div><main><div class=inner><div id=main class=pjax><div class="article wrap"><div class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i> <span><a href=/ >首页</a></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/ itemprop=item rel=index title="分类于 计算机科学"><span itemprop=name>计算机科学</span></a><meta itemprop=position content=1></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/ itemprop=item rel=index title="分类于 编程"><span itemprop=name>编程</span></a><meta itemprop=position content=2></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/c-language/ itemprop=item rel=index title="分类于 C语言"><span itemprop=name>C语言</span></a><meta itemprop=position content=3></span><i class="ic i-angle-right"></i> <span class=current itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/c-language/c-project/ itemprop=item rel=index title="分类于 C语言项目"><span itemprop=name>C语言项目</span></a><meta itemprop=position content=4></span></div><article itemscope itemtype=http://schema.org/Article class="post block" lang=zh-CN><link itemprop=mainEntityOfPage href=https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-mid/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.webp><meta itemprop=name content=ReverseSacle><meta itemprop=description content="所见即所得，所思即所行, 知识书库 & 学习点滴"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=逆转天平></span><div class="body md" itemprop=articleBody><h1 id=从0到1的源代码编写的网站留言评论系统-中稿><a class=anchor href=#从0到1的源代码编写的网站留言评论系统-中稿>#</a> 从0到1的源代码编写的网站留言评论系统-中稿</h1><h2 id=增加的计算机知识范围><a class=anchor href=#增加的计算机知识范围>#</a> 增加的计算机知识范围</h2><ul><li><a href=https://www.reversesacle.com/computer-science/programming/c-language/basis/c++/cpppart1/ >C++基础知识</a></li><li><a href=https://www.reversesacle.com/computer-science/programming/web/json/ >JSON格式基础知识</a></li></ul><h2 id=单进程后端源码的结构处理与分层><a class=anchor href=#单进程后端源码的结构处理与分层>#</a> (单进程)后端源码的结构处理与分层</h2><p>在初稿的成品源码的基础上，剔除多进程以及部分内容，再将源码各部分拆分并将同一所属的代码部分整合到一起。</p><figure class="highlight tex"><figcaption data-lang=TeX><span>目录结构</span></figcaption><table><tr><td data-num=1></td><td><pre>httpserver</pre></td></tr><tr><td data-num=2></td><td><pre>├── _database</pre></td></tr><tr><td data-num=3></td><td><pre>│   ├── db.c</pre></td></tr><tr><td data-num=4></td><td><pre>│   └── db.h</pre></td></tr><tr><td data-num=5></td><td><pre>├── _http</pre></td></tr><tr><td data-num=6></td><td><pre>│   ├── http.c</pre></td></tr><tr><td data-num=7></td><td><pre>│   ├── http.h</pre></td></tr><tr><td data-num=8></td><td><pre>│   ├── _response.c</pre></td></tr><tr><td data-num=9></td><td><pre>│   └── _response.h</pre></td></tr><tr><td data-num=10></td><td><pre>├── httpserver.c</pre></td></tr><tr><td data-num=11></td><td><pre>├── makefile</pre></td></tr><tr><td data-num=12></td><td><pre>├── mylibs.c</pre></td></tr><tr><td data-num=13></td><td><pre>├── mylibs.h</pre></td></tr><tr><td data-num=14></td><td><pre>└── _tcp</pre></td></tr><tr><td data-num=15></td><td><pre>    ├── tcp.c</pre></td></tr><tr><td data-num=16></td><td><pre>    └── tcp.h</pre></td></tr></table></figure><details class=info><summary>./_database</summary><div><figure class="highlight c"><figcaption data-lang=c><span>db.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql/mysql.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_HOST</span> <span class="token string">"127.0.0.1"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_USER</span> <span class="token string">"root"</span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_PASSWORD</span> <span class="token string">"@Killl611"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_DBNAME</span> <span class="token string">"CommentSystem"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_TABLENAME</span> <span class="token string">"CommentBlock"</span></span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Record</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">char</span> tablename<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Record</span><span class="token operator">*</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=23></td><td><pre>MYSQL_RES<span class="token operator">*</span> <span class="token function">GetTableRecordStart</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> tablename<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableRecordEnd</span><span class="token punctuation">(</span>MYSQL_RES<span class="token operator">*</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql/mysql.h></span></span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_HOST</span> <span class="token string">"127.0.0.1"</span></span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_USER</span> <span class="token string">"root"</span></span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_PASSWORD</span> <span class="token string">"@Killl611"</span></span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_DBNAME</span> <span class="token string">"CommentSystem"</span></span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_TABLENAME</span> <span class="token string">"CommentBlock"</span></span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Record</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token keyword">char</span> tablename<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Record</span><span class="token operator">*</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=47></td><td><pre>MYSQL_RES<span class="token operator">*</span> <span class="token function">GetTableRecordStart</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> tablename<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableRecordEnd</span><span class="token punctuation">(</span>MYSQL_RES<span class="token operator">*</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang=c><span>db.c</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"db.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">mysql_init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect() => mysql_init() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_DatabaseConnect() => mysql_init() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>	mysql <span class="token operator">=</span> <span class="token function">mysql_real_connect</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>_HOST<span class="token punctuation">,</span>_USER<span class="token punctuation">,</span>_PASSWORD<span class="token punctuation">,</span>_DBNAME<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect() => mysql_real_connect() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_DatabaseConnect() => mysql_real_connect() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_DatabaseConnect() => Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_DatabaseConnect() => Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">return</span> mysql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token function">mysql_close</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_DatabaseConnect() => Close\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_DatabaseConnect() => Close\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Record</span><span class="token operator">*</span> el<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=38></td><td><pre>		buf<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token string">"INSERT INTO %s(NickName,Email,Content,CreateAt)\nVALUES('%s','%s','%s','%s')"</span><span class="token punctuation">,</span>el<span class="token operator">-></span>tablename<span class="token punctuation">,</span>el<span class="token operator">-></span>nickname<span class="token punctuation">,</span>el<span class="token operator">-></span>email<span class="token punctuation">,</span>el<span class="token operator">-></span>content<span class="token punctuation">,</span>el<span class="token operator">-></span>createat</pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database_TableInsert() => \nQuery:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database_TableInsert() => \nQuery:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=46></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=47></td><td><pre>			_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database_TableInsert() => mysql_query() fail.\nreason: \n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=48></td><td><pre>			<span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=49></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=51></td><td><pre>			<span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database_TableInsert() => mysql_query() fail.\nreason: \n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=52></td><td><pre>			<span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_TableInsert() => Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_TableInsert() => Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		</pre></td></tr><tr><td data-num=58></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=59></td><td><pre></pre></td></tr><tr><td data-num=60></td><td><pre>MYSQL_RES<span class="token operator">*</span> <span class="token function">GetTableRecordStart</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> tableName<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=61></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"SELECT * FROM %s ORDER BY CreateAT ASC"</span><span class="token punctuation">,</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=67></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=68></td><td><pre>			_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database_GetTableRecordStart() => mysql_query() fail\n.reason:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=69></td><td><pre>			<span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=70></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database_GetTableRecordStart() => mysql_query() fail\n.reason:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=73></td><td><pre>			<span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=74></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre></pre></td></tr><tr><td data-num=78></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_GetTableRecordStart() => Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_GetTableRecordStart() => Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token keyword">return</span> <span class="token function">mysql_store_result</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableRecordEnd</span><span class="token punctuation">(</span>MYSQL_RES<span class="token operator">*</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=84></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=85></td><td><pre>	<span class="token function">mysql_free_result</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_GetTableRecordEnd()\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Database_GetTableRecordEnd()\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./_tcp</summary><div><figure class="highlight c"><figcaption data-lang=c><span>tcp.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_IPUSER</span> <span class="token expression">INADDR_ANY</span></span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">int</span> <span class="token function">TcpStream_Construct</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">usize_t</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>bool <span class="token function">TcpStream_ToListen</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token class-name">size_t</span> <span class="token function">TcpStream_StreamParseLine</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token class-name">size_t</span> buf_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang=c><span>tcp.c</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"tcp.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/* Tcp流创建及通信地址绑定 */</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">int</span> <span class="token function">TcpStream_Construct</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">usize_t</span> port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">int</span> sock_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>sock_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_Construct() => socket() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_Construct() => socket() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token comment">/* 设置通信地址 */</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sock_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token class-name">size_t</span> sock_addr_size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>sock_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sock_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>sock_addr_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	sock_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	sock_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>_IPUSER<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	sock_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	</pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token comment">/* 初始化通信端口 */</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token keyword">int</span> opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token function">setsockopt</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token comment">/* 绑定通信地址 */</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sock_addr<span class="token punctuation">,</span>sock_addr_size<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_Construct() => bind() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_Construct() => bind() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token keyword">return</span> sock_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=40></td><td><pre></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token comment">/* 设置监听模式 */</span></pre></td></tr><tr><td data-num=42></td><td><pre>bool <span class="token function">TcpStream_ToListen</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=46></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_Construct() => listen() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_Construct() => listen() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		<span class="token keyword">return</span> false<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">return</span> true<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token comment">/* 从Tcp流中读取一行,不适用body部分的读取 */</span></pre></td></tr><tr><td data-num=56></td><td><pre><span class="token class-name">size_t</span> <span class="token function">TcpStream_StreamParseLine</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token class-name">size_t</span> buf_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=59></td><td><pre></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token class-name">size_t</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> buf_size<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=65></td><td><pre>		<span class="token class-name">ssize_t</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=67></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=68></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=69></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=70></td><td><pre>			buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token punctuation">&#123;</span>	</pre></td></tr><tr><td data-num=74></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=75></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=76></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_StreamParseLine() => recv() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_StreamParseLine() => recv() fail\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>				index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=80></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=81></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=82></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_StreamParseLine() => recv() end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TcpStream_StreamParseLine() => recv() end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=85></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=88></td><td><pre>	buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./_http</summary><div><figure class="highlight c"><figcaption data-lang=c><span>_response.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_tcp/tcp.h"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_database/db.h"</span></span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ROOTDIR</span> <span class="token string">"docs"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_HTTPVERSION</span> <span class="token string">"1.0"</span></span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestMethod</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    _GET <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>    _POST <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>    _PUT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>    _DELETE <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>    _HEAD <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=18></td><td><pre>    _OPTIONS <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>    _PATCH <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=20></td><td><pre>    _CONNECT <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=21></td><td><pre>    _TRACE <span class="token operator">=</span> <span class="token number">9</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">FileType</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    _HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=27></td><td><pre>    _CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=28></td><td><pre>    _JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=29></td><td><pre>    _PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestPathType</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    _DATABASE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=35></td><td><pre>    _API <span class="token operator">=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token keyword">int</span> <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> method_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token keyword">int</span> <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> filename_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre><span class="token keyword">int</span> <span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token keyword">void</span> <span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang=c><span>_response.c</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_response.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/* 获取HTTP请求方法 */</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">int</span> <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> method_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">const</span> <span class="token class-name">size_t</span> buf_len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>method_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _get <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _post <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _put <span class="token operator">=</span> <span class="token string">"PUT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _delete <span class="token operator">=</span> <span class="token string">"DELETE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _head <span class="token operator">=</span> <span class="token string">"HEAD"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _options <span class="token operator">=</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _patch <span class="token operator">=</span> <span class="token string">"PATCH"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _connect <span class="token operator">=</span> <span class="token string">"CONNECT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _trace <span class="token operator">=</span> <span class="token string">"TRACE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>method_buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_get <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_get<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_post <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_post<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_put <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_put<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_delete <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_delete<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_head <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_head<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_options <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_options<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_patch <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_patch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_connect <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_connect<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_trace <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_trace<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span>buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=39></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>				<span class="token keyword">return</span> _GET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=44></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=45></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=46></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => PUT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => PUT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>				<span class="token keyword">return</span> _PUT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=50></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=52></td><td><pre>		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=55></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => POST\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => POST\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=58></td><td><pre>				<span class="token keyword">return</span> _POST<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=61></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => HEAD\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => HEAD\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=64></td><td><pre>				<span class="token keyword">return</span> _HEAD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=68></td><td><pre>		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=69></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=70></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=71></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => PATCH\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => PATCH\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=74></td><td><pre>				<span class="token keyword">return</span> _PATCH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=76></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=77></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=78></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => TRACE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => TRACE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=80></td><td><pre>				<span class="token keyword">return</span> _TRACE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>		<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=85></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=86></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=87></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=88></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => DELETE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => DELETE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=90></td><td><pre>				<span class="token keyword">return</span> _DELETE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=92></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=94></td><td><pre>		<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=95></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=96></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=97></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=98></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => OPTIONS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => OPTIONS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=100></td><td><pre>				<span class="token keyword">return</span> _OPTIONS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=102></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=103></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=104></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => CONNECT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => CONNECT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=106></td><td><pre>				<span class="token keyword">return</span> _CONNECT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=108></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethodType() => UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=115></td><td><pre></pre></td></tr><tr><td data-num=116></td><td><pre><span class="token comment">/* 获取请求路径文件格式 */</span></pre></td></tr><tr><td data-num=117></td><td><pre><span class="token keyword">int</span> <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> filename_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=118></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token keyword">const</span> <span class="token class-name">size_t</span> buf_len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>filename_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=121></td><td><pre></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token keyword">char</span> type<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>	<span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=126></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> filename_buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'.'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=129></td><td><pre>		<span class="token keyword">else</span><span class="token punctuation">&#123;</span> type<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=130></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=131></td><td><pre>	type<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre></pre></td></tr><tr><td data-num=133></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> index<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=135></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _html <span class="token operator">=</span> <span class="token string">"HTML"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _js <span class="token operator">=</span> <span class="token string">"JS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _css <span class="token operator">=</span> <span class="token string">"CSS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=138></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _png <span class="token operator">=</span> <span class="token string">"PNG"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>		<span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>type_len <span class="token operator">=</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre></pre></td></tr><tr><td data-num=141></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> type_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=142></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=143></td><td><pre>			<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>type<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_html <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_html <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_html<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=145></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_js <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_js <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_js<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=146></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_css <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_css <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_css<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=147></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_png <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_png <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_png<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=148></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=149></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_html<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=150></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=151></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => HTML\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => HTML\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=153></td><td><pre>			<span class="token keyword">return</span> _HTML<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=155></td><td><pre></pre></td></tr><tr><td data-num=156></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_js<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=157></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=158></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => CSS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => CSS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=160></td><td><pre>			<span class="token keyword">return</span> _JS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=162></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> type_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=163></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=164></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_css<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=165></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=166></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => JS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => JS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=168></td><td><pre>				<span class="token keyword">return</span> _CSS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=170></td><td><pre></pre></td></tr><tr><td data-num=171></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_png<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=172></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=173></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => PNG\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => PNG\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre>				<span class="token keyword">return</span> _PNG<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=177></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=178></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=179></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetFileType() => UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=183></td><td><pre></pre></td></tr><tr><td data-num=184></td><td><pre><span class="token comment">/* 获取请求路径应用类型 */</span></pre></td></tr><tr><td data-num=185></td><td><pre><span class="token keyword">int</span> <span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=186></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token class-name">size_t</span> buf_len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>path_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre></pre></td></tr><tr><td data-num=190></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> db <span class="token operator">=</span> <span class="token string">"DATABASE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=191></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> api <span class="token operator">=</span> <span class="token string">"API"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=195></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=196></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>path_buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=197></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>db <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>db <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>db<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=198></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>api <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>api <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>api<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>db<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=203></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetPathType() => DATABASE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetPathType() => DATABASE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>		<span class="token keyword">return</span> _DATABASE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=207></td><td><pre></pre></td></tr><tr><td data-num=208></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>api<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=209></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=210></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetPathType() => API\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetPathType() => API\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre>		<span class="token keyword">return</span> _API<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=214></td><td><pre></pre></td></tr><tr><td data-num=215></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetPathType() => NORMAL\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=216></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetPathType() => NORMAL\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=217></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=218></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=219></td><td><pre></pre></td></tr><tr><td data-num=220></td><td><pre><span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=221></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=222></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre></pre></td></tr><tr><td data-num=224></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>_HTTPVERSION<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=226></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">" 400 BAD REQUEST\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre></pre></td></tr><tr><td data-num=228></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=229></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=230></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=231></td><td><pre>			_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=232></td><td><pre>			<span class="token string">"HttpServer_Response400() => send() fail.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=233></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=234></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=235></td><td><pre>			<span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=236></td><td><pre>			<span class="token string">"HttpServer_Response400() => send() fail.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=237></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=239></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=240></td><td><pre></pre></td></tr><tr><td data-num=241></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=242></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>_HTTPVERSION<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">" 404 NOT FOUND\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=248></td><td><pre></pre></td></tr><tr><td data-num=249></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=250></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=251></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=252></td><td><pre>			_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=253></td><td><pre>			<span class="token string">"HttpServer_Response404() => send() fail.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=254></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=256></td><td><pre>			<span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=257></td><td><pre>			<span class="token string">"HttpServer_Response404() => send() fail.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=258></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=260></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=261></td><td><pre></pre></td></tr><tr><td data-num=262></td><td><pre><span class="token comment">/* 非GET方法的200响应 */</span></pre></td></tr><tr><td data-num=263></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=264></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=265></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=266></td><td><pre></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=268></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>_HTTPVERSION<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=269></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">" 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=270></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=272></td><td><pre>	</pre></td></tr><tr><td data-num=273></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=274></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=275></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=276></td><td><pre>			_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=277></td><td><pre>			<span class="token string">"HttpServer_Response200_NF() => send() fail.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=278></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=279></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=280></td><td><pre>			<span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=281></td><td><pre>			<span class="token string">"HttpServer_Response200_NF() => send() fail.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=282></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=283></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=284></td><td><pre>	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"HttpServer_Response200_NF() => \nResponse Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=285></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=286></td><td><pre></pre></td></tr><tr><td data-num=287></td><td><pre><span class="token comment">/* 数据库处理的200响应 */</span></pre></td></tr><tr><td data-num=288></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=289></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=290></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=291></td><td><pre>	<span class="token keyword">char</span> body<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=292></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=293></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=294></td><td><pre></pre></td></tr><tr><td data-num=295></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> <span class="token punctuation">(</span>mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=296></td><td><pre></pre></td></tr><tr><td data-num=297></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=298></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=299></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=300></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=301></td><td><pre></pre></td></tr><tr><td data-num=302></td><td><pre>	MYSQL_RES<span class="token operator">*</span> res <span class="token operator">=</span> <span class="token function">GetTableRecordStart</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>_TABLENAME<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=303></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=304></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=305></td><td><pre>		MYSQL_ROW row<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=306></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>row <span class="token operator">=</span> <span class="token function">mysql_fetch_row</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=307></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=308></td><td><pre>			<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"%s:%s:%s:%s,"</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=309></td><td><pre>			<span class="token function">strcat</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=310></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=311></td><td><pre>		<span class="token function">GetTableRecordEnd</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=312></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=313></td><td><pre>	<span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=314></td><td><pre></pre></td></tr><tr><td data-num=315></td><td><pre>	<span class="token keyword">int</span> bodyLen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=316></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"Content-Length: %d\r\n\r\n"</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=317></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=318></td><td><pre></pre></td></tr><tr><td data-num=319></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"HttpServer_HTTP200_DB() => \nResponse Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=320></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"HttpServer_HTTP200_DB() => \nResponse Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=321></td><td><pre></pre></td></tr><tr><td data-num=322></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=323></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=324></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=325></td><td><pre>			_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=326></td><td><pre>			<span class="token string">"HttpServer_Response200_DB() => send() fail.\nreason: \n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=327></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=328></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=329></td><td><pre>			<span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=330></td><td><pre>			<span class="token string">"HttpServer_Response200_DB() => send() fail.\nreason: \n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=331></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=332></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=333></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=334></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=335></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>body<span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=336></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=337></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=338></td><td><pre>				_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=339></td><td><pre>				<span class="token string">"HttpServer_Response200_DB() => send() fail.\nreason: \n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=340></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=341></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=342></td><td><pre>				<span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=343></td><td><pre>				<span class="token string">"HttpServer_Response200_DB() => send() fail.\nreason: \n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=344></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=345></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=346></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=347></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=348></td><td><pre></pre></td></tr><tr><td data-num=349></td><td><pre></pre></td></tr><tr><td data-num=350></td><td><pre><span class="token comment">/* GET方法的200响应 */</span></pre></td></tr><tr><td data-num=351></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token class-name">off_t</span> f_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=352></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=353></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=354></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=355></td><td><pre></pre></td></tr><tr><td data-num=356></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=357></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>_HTTPVERSION<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=358></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">" 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=359></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=360></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=361></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=362></td><td><pre>		<span class="token keyword">case</span> _HTML<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=363></td><td><pre>		<span class="token keyword">case</span> _CSS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=364></td><td><pre>		<span class="token keyword">case</span> _JS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=365></td><td><pre>		<span class="token keyword">case</span> _PNG<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=366></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=367></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=368></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=369></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=370></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=371></td><td><pre></pre></td></tr><tr><td data-num=372></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"HttpServer_Response200() => \nResponse Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=373></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=374></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=375></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=376></td><td><pre>			_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=377></td><td><pre>			<span class="token string">"HttpServer_Response200() => send() fail.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=378></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=379></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=380></td><td><pre>			<span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=381></td><td><pre>			<span class="token string">"HttpServer_Response200() => send() fail.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=382></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=383></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=384></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=385></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=386></td><td><pre>		FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=387></td><td><pre>		<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=388></td><td><pre></pre></td></tr><tr><td data-num=389></td><td><pre>		resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=390></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=391></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=392></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=393></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=394></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=395></td><td><pre>					_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=396></td><td><pre>					<span class="token string">"HttpServer_Response200() => send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=397></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=398></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=399></td><td><pre>					<span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=400></td><td><pre>					<span class="token string">"HttpServer_Response200() => send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=401></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=402></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=403></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=404></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=405></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=406></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=407></td><td><pre>				_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=408></td><td><pre>				<span class="token string">"HttpServer_Response200() => I/O error when reading\n"</span></pre></td></tr><tr><td data-num=409></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=410></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=411></td><td><pre>				<span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=412></td><td><pre>				<span class="token string">"HttpServer_Response200() => I/O error when reading\n"</span></pre></td></tr><tr><td data-num=413></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=414></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=415></td><td><pre>		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=416></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=417></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=418></td><td><pre>				_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=419></td><td><pre>				<span class="token string">"HttpServer_Response200() => End of file reached successfully\n"</span></pre></td></tr><tr><td data-num=420></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=421></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=422></td><td><pre>				<span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=423></td><td><pre>				<span class="token string">"HttpServer_Response200() => End of file reached successfully\n"</span></pre></td></tr><tr><td data-num=424></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=425></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=426></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=427></td><td><pre>	<span class="token punctuation">&#125;</span> 	</pre></td></tr><tr><td data-num=428></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=429></td><td><pre></pre></td></tr><tr><td data-num=430></td><td><pre><span class="token comment">/* 报文响应选择器 */</span></pre></td></tr><tr><td data-num=431></td><td><pre><span class="token keyword">void</span> <span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=432></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=433></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetPathType</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=434></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=435></td><td><pre>		<span class="token keyword">case</span> _DATABASE<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=436></td><td><pre>		<span class="token keyword">case</span> _API<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=437></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num=438></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=439></td><td><pre>			<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=440></td><td><pre>			<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"./"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=441></td><td><pre>			<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>_ROOTDIR<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=442></td><td><pre>			<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=443></td><td><pre></pre></td></tr><tr><td data-num=444></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=445></td><td><pre>				_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=446></td><td><pre>				<span class="token string">"HttpServer_ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=447></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=448></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=449></td><td><pre>				<span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=450></td><td><pre>				<span class="token string">"HttpServer_ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=451></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=452></td><td><pre></pre></td></tr><tr><td data-num=453></td><td><pre>			<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=454></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=455></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response200</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=456></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=457></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=458></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang=c><span>http.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_response.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">ReqContent</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">char</span> req_method<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">char</span> req_url<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">char</span> req_body<span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token class-name">size_t</span> url_len<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpServer_Accept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang=c><span>http.c</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/* URL路径格式化 */</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">UrlFormat</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token class-name">size_t</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">!=</span> buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token char">'/'</span> <span class="token operator">!=</span> buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> url<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'/'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'/'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> i <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token char">'\\'</span> <span class="token operator">==</span> buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>			url<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'/'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		url<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	</pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> j<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> url<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"HttpServer_UrlFormat() => Format URL: "</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"HttpServer_UrlFormat() => Format URL: "</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token comment">/* 接收请求并将内容分类 */</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token keyword">static</span> bool <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">ReqContent</span><span class="token operator">*</span> req_content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">4096</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token keyword">const</span> <span class="token class-name">size_t</span> buf_size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token class-name">size_t</span> buf_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span>buf_len <span class="token operator">=</span> <span class="token function">TcpStream_StreamParseLine</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>buf_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=39></td><td><pre>			_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=40></td><td><pre>			<span class="token string">"HttpServer_ReqContentReceive() => TcpStream_StreamParseLine() fail\n"</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>			<span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=44></td><td><pre>			<span class="token string">"HttpServer_ReqContentReceive() => TcpStream_StreamParseLine() fail\n"</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>		<span class="token keyword">return</span> false<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token punctuation">&#125;</span>	</pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token keyword">char</span> bodyLen<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=52></td><td><pre>		req_content<span class="token operator">-></span>req_method<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>		req_content<span class="token operator">-></span>req_url<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre>	req_content<span class="token operator">-></span>url_len <span class="token operator">=</span> j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_ReqContentReceive() => \nRequest Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_ReqContentReceive() => \nRequest Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>		<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>buf_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>		buf_len <span class="token operator">=</span> <span class="token function">TcpStream_StreamParseLine</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>buf_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token function">strcpy</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">strchr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token char">':'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>buf_len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=75></td><td><pre></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=77></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=78></td><td><pre>		<span class="token comment">/* 读取body内容 */</span></pre></td></tr><tr><td data-num=79></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span>buf_len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token operator">-></span>req_body<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">size_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">_stoi</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=80></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=81></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=82></td><td><pre>				_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=83></td><td><pre>				<span class="token string">"HttpServer_ReqContentReceive() => Receive Nothing body\n"</span></pre></td></tr><tr><td data-num=84></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=86></td><td><pre>				<span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=87></td><td><pre>				<span class="token string">"HttpServer_ReqContentReceive() => Receive Nothing body\n"</span></pre></td></tr><tr><td data-num=88></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=90></td><td><pre>		<span class="token keyword">else</span></pre></td></tr><tr><td data-num=91></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=92></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>req_content<span class="token operator">-></span>req_body<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>req_content<span class="token operator">-></span>req_body<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=95></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=97></td><td><pre>		_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=98></td><td><pre>		<span class="token string">"HttpServer_ReqContentReceive() => Succeed\n"</span></pre></td></tr><tr><td data-num=99></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=101></td><td><pre>		<span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=102></td><td><pre>		<span class="token string">"HttpServer_ReqContentReceive() => Succeed\n"</span></pre></td></tr><tr><td data-num=103></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>	<span class="token keyword">return</span> true<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=105></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre></pre></td></tr><tr><td data-num=107></td><td><pre><span class="token comment">/* 处理HTTP的自定义格式的Body内容 */</span></pre></td></tr><tr><td data-num=108></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">BodyTackle</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> body_buf<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">Record</span><span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=109></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_nickname <span class="token operator">=</span> record<span class="token operator">-></span>nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_email <span class="token operator">=</span> record<span class="token operator">-></span>email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_content <span class="token operator">=</span> record<span class="token operator">-></span>content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_createat <span class="token operator">=</span> record<span class="token operator">-></span>createat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	</pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>body_buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>body_buf<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=116></td><td><pre>		<span class="token operator">*</span><span class="token punctuation">(</span>p_nickname<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>body_buf<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>	<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token operator">*</span>p_nickname <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre></pre></td></tr><tr><td data-num=120></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>body_buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>body_buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>body_buf<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=121></td><td><pre>		<span class="token operator">*</span><span class="token punctuation">(</span>p_email<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>body_buf<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=123></td><td><pre>	<span class="token operator">*</span>p_email <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>body_buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>body_buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>body_buf<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=126></td><td><pre>		<span class="token operator">*</span><span class="token punctuation">(</span>p_content<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>body_buf<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token operator">*</span>p_content <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre></pre></td></tr><tr><td data-num=130></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>body_buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>body_buf<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=131></td><td><pre>		<span class="token operator">*</span><span class="token punctuation">(</span>p_createat<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>body_buf<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=133></td><td><pre>	<span class="token operator">*</span>p_createat <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre></pre></td></tr><tr><td data-num=135></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>record<span class="token operator">-></span>tablename<span class="token punctuation">,</span>_TABLENAME<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre></pre></td></tr><tr><td data-num=137></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=138></td><td><pre>		_LOGPATH<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=139></td><td><pre>		<span class="token string">"HttpServer_BodyTackle() => \nReceive Body: \n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=140></td><td><pre>		record<span class="token operator">-></span>nickname<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>record<span class="token operator">-></span>email<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>record<span class="token operator">-></span>content<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>record<span class="token operator">-></span>createat<span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=141></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=143></td><td><pre>		<span class="token number">9</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=144></td><td><pre>		<span class="token string">"HttpServer_BodyTackle() => \nReceive Body: \n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=145></td><td><pre>		record<span class="token operator">-></span>nickname<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>record<span class="token operator">-></span>email<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>record<span class="token operator">-></span>content<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>record<span class="token operator">-></span>createat<span class="token punctuation">,</span><span class="token string">"\n"</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=148></td><td><pre></pre></td></tr><tr><td data-num=149></td><td><pre><span class="token comment">/* 处理GET方法 */</span></pre></td></tr><tr><td data-num=150></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> url_buf<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token class-name">size_t</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=151></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=152></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=153></td><td><pre></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>url_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=159></td><td><pre>		url<span class="token punctuation">[</span>url_len<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> url_buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre></pre></td></tr><tr><td data-num=162></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethod() => Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethod() => Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=164></td><td><pre></pre></td></tr><tr><td data-num=165></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethod() => Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_GetMethod() => Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token function">UrlFormat</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>url_len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre>	<span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=170></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=171></td><td><pre></pre></td></tr><tr><td data-num=172></td><td><pre><span class="token comment">/* 处理POST方法 */</span></pre></td></tr><tr><td data-num=173></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> body_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=174></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=175></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_PostMethod() => Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_PostMethod() => Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre></pre></td></tr><tr><td data-num=178></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">Record</span> record<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>record<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Record</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>	<span class="token function">BodyTackle</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">,</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre></pre></td></tr><tr><td data-num=184></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> <span class="token punctuation">(</span>mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=185></td><td><pre>	<span class="token function">TableInsert</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre></pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token string">"api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre><span class="token comment">/* 接收HTTP请求 */</span></pre></td></tr><tr><td data-num=192></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpServer_Accept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=193></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=195></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=196></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_Accept() => None apply socket\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=197></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpServer_Accept() => None apply socket\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=198></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre>		</pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">ReqContent</span> req_content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token class-name">size_t</span> req_content_size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">ReqContent</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>req_content<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>req_content_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>false <span class="token operator">==</span> <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>req_content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=206></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=208></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=209></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=210></td><td><pre>		<span class="token keyword">case</span> _GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_url<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>url_len<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=211></td><td><pre>		<span class="token keyword">case</span> _POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=212></td><td><pre>		<span class="token keyword">case</span> _PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=213></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=214></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=215></td><td><pre>			<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=216></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=217></td><td><pre>				_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=218></td><td><pre>				<span class="token string">"HttpServer_Accept() => warning! could not accept "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=219></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span><span class="token string">" method\n"</span></pre></td></tr><tr><td data-num=220></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=222></td><td><pre>				<span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=223></td><td><pre>				<span class="token string">"HttpServer_Accept() => warning! could not accept "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=224></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span><span class="token string">" method\n"</span></pre></td></tr><tr><td data-num=225></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=226></td><td><pre>			<span class="token function">Response400</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=228></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=229></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./</summary><div><figure class="highlight c"><figcaption data-lang=c><span>mylibs.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdarg.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_LOGPATH</span> <span class="token string">"./_httpserver.log"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token class-name">usize_t</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">int</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token keyword">int</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">int</span> <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">void</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">size_t</span> num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">void</span> <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> filename<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token class-name">size_t</span> num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang=c><span>mylibs.c</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"mylibs.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">int</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token keyword">int</span> m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> n <span class="token operator">*=</span> n<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token keyword">return</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">int</span> <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>left<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>	right <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>right <span class="token operator">>=</span> left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token punctuation">(</span>strs<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		ans <span class="token operator">=</span> <span class="token punctuation">(</span>temp <span class="token operator">*</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token operator">--</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">return</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">void</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">size_t</span> num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		va_list args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token keyword">char</span><span class="token operator">*</span> strs <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=38></td><td><pre>			<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>strs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token keyword">void</span> <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> filename<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token class-name">size_t</span> num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_LOG</span></span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=52></td><td><pre>		FILE<span class="token operator">*</span> source <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">"a+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> source<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre>		va_list args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>		<span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token constant">__TIME__</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">":\n"</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=62></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=63></td><td><pre>			<span class="token keyword">char</span><span class="token operator">*</span> strs <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>			<span class="token function">fputs</span><span class="token punctuation">(</span>strs<span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=67></td><td><pre>		<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=71></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang=c><span>httpserver.c</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;signal.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_http/http.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_tcp/tcp.h"</span></span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">void</span> <span class="token function">ExitAction</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">signal</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">,</span>SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ExitAction<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>ExitAction<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">int</span> sock_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>sock_fd <span class="token operator">=</span> <span class="token function">TcpStream_Construct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">TcpStream_ToListen</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">int</span> accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sock_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token class-name">size_t</span> sock_addr_size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main() => Waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main() => Waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre>		accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sock_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sock_addr_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main() => Client connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main() => Client connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token function">HttpServer_Accept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight makefile"><figcaption data-lang=makefile><span>makefile</span></figcaption><table><tr><td data-num=1></td><td><pre>OP<span class="token operator">=</span>gcc</pre></td></tr><tr><td data-num=2></td><td><pre>AP1<span class="token operator">=</span>-Wall</pre></td></tr><tr><td data-num=3></td><td><pre>AP2<span class="token operator">=</span>-g</pre></td></tr><tr><td data-num=4></td><td><pre>LOG<span class="token operator">=</span>-D _LOG</pre></td></tr><tr><td data-num=5></td><td><pre>DEBUG<span class="token operator">=</span>-D _DEBUG</pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>MYSQL<span class="token operator">=</span><span class="token variable">$$</span><span class="token punctuation">(</span>mysql_config --cflags --libs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre>MSPATH<span class="token operator">=</span>-L/usr/lib64/mysql -lmysqlclient </pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token target symbol">tcp</span><span class="token punctuation">:</span> ./_tcp/tcp.*</pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> ./_tcp/tcp.c </pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token target symbol">http_response</span><span class="token punctuation">:</span> ./_tcp/tcp.* ./_http/_response.* ./mylibs.*</pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> ./_tcp/tcp.c ./_http/_response.c</pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token target symbol">http_response_db</span><span class="token punctuation">:</span> ./_tcp/tcp.* ./_http/_response.* ./mylibs.* ./_database/db.*</pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> ./_tcp/tcp.c ./_http/_response.c ./_database/db.c</pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token target symbol">http</span><span class="token punctuation">:</span> ./_tcp/tcp.* ./_http/http.* ./mylibs.*</pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> ./_tcp/tcp.c ./_http/http.c ./mylibs.c</pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token target symbol">database</span><span class="token punctuation">:</span> ./_database/db.* ./mylibs.*</pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> ./_database/db.c ./mylibs.c </pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token target symbol">httptest</span><span class="token punctuation">:</span> ./_tcp/tcp.* ./_http/http.* ./_http/_response.* ./mylibs.* ./httpserver.c</pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span> ./_tcp/tcp.c ./_http/http.c ./_http/_response.c \</pre></td></tr><tr><td data-num=27></td><td><pre>	./mylibs.c httpserver.c -o httpserver </pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token target symbol">httptest_db</span><span class="token punctuation">:</span> ./_tcp/tcp.* ./_http/http.* ./_http/_response.* \</pre></td></tr><tr><td data-num=30></td><td><pre>			./mylibs.* ./httpserver.c ./_database/db.*</pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>MSPATH<span class="token punctuation">)</span> ./_tcp/tcp.c ./_http/http.c ./_http/_response.c \</pre></td></tr><tr><td data-num=32></td><td><pre>	./mylibs.c ./_database/db.c httpserver.c -o httpserver </pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token target symbol">httptest_db_log</span><span class="token punctuation">:</span> ./_tcp/tcp.* ./_http/http.* ./_http/_response.* \</pre></td></tr><tr><td data-num=35></td><td><pre>			./mylibs.* ./httpserver.c ./_database/db.*</pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>LOG<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>MSPATH<span class="token punctuation">)</span> ./_tcp/tcp.c ./_http/http.c ./_http/_response.c \</pre></td></tr><tr><td data-num=37></td><td><pre>	./mylibs.c ./_database/db.c httpserver.c -o httpserver </pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token target symbol">openport</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=40></td><td><pre>	firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>80/tcp --permanent</pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token target symbol">clean</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=43></td><td><pre>	rm -rf httpserver *.a *.log *.so</pre></td></tr></table></figure></div></details><h2 id=使用mysql的c-api-mysql><a class=anchor href=#使用mysql的c-api-mysql>#</a> 使用MySQL的C++ API - MySQL++</h2><p><code>MySQL++</code>是对<code>MySQL C API</code>的一个封装，通过简化和抽象，使得与MySQL数据库的交互更为直观和易用。</p><ul><li><p><span class=exturl data-url="aHR0cHM6Ly90YW5nZW50c29mdC5jb20vbXlzcWxwcC9kb2MvaHRtbC91c2VybWFuL2luY29ycG9yYXRpbmcuaHRtbA==">MySQL++官方文档-编译操作部分</span></p></li><li><p><span class=exturl data-url="aHR0cHM6Ly90YW5nZW50c29mdC5jb20vbXlzcWxwcC9kb2MvaHRtbC9yZWZtYW4vaW5kZXguaHRtbA==">MySQL++官方文档-命名空间手册</span></p></li><li><p><span class=exturl data-url="aHR0cHM6Ly90YW5nZW50c29mdC5jb20vbXlzcWxwcC9kb2MvaHRtbC91c2VybWFuLw==">MySQL++官方文档-教程</span></p></li></ul><p>由于<code>MySQL++</code>的教程对有关函数的细节部分的介绍很小，上手写时有点困难。</p><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment"># 下载mysql++包</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token function">wget</span> https://tangentsoft.com/mysqlpp/releases/mysql++-3.3.0.tar.gz --no-check-certificate</pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"># 解压</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> mysql++-3.3.0.tar.gz</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token builtin class-name">cd</span> mysql++-3.3.0</pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"># 执行./configure生成makefile文件</span></pre></td></tr><tr><td data-num=9></td><td><pre>./configure --enable-thread-check --enable-disasm <span class="token assign-left variable">LDFLAGS</span><span class="token operator">=</span><span class="token string">'-pthread'</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment"># (可选)假如上述操作报错</span></pre></td></tr><tr><td data-num=12></td><td><pre>./configure --enable-disasm <span class="token assign-left variable">LDFLAGS</span><span class="token operator">=</span><span class="token string">'-pthread'</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment"># 编译处libmysqlpp.so</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token function">make</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token function">make</span> <span class="token function">install</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment"># 创建so的连接</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/lib/libmysqlpp.so /usr/lib/libmysqlpp.so</pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token comment"># 安装开发环境</span></pre></td></tr><tr><td data-num=22></td><td><pre>yum <span class="token function">install</span> mysql++-devel</pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment"># 配置库连接位置</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token function">vi</span> /etc/ld.so.conf</pre></td></tr><tr><td data-num=26></td><td><pre><span class="token comment">## 新的一行添加 /usr/local/lib</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token comment">## 输入 :x</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token comment">## 退出后输入命令 ldconfig</span></pre></td></tr></table></figure><p>包含头文件 - <code>#include&lt;mysql++/mysql++.h&gt;</code></p><h2 id=后端编程语言转移至cpp><a class=anchor href=#后端编程语言转移至cpp>#</a> 后端编程语言转移至cpp</h2><p>由于cpp有大量的库可用，以此代替C语言，避免不必要的造轮子操作。</p><p>根据C语言的代码，用cpp的特性和代码风格来重写。</p><details class=info><summary>./_database</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>db.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql++/mysql++.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_HOST</span> <span class="token string">"127.0.0.1"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_USER</span> <span class="token string">"root"</span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_PASSWORD</span> <span class="token string">"@Killl611"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_DBNAME</span> <span class="token string">"CommentSystem"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_TABLENAME</span> <span class="token string">"CommentBlock"</span></span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">// 表记录中一行的数据，处理表名</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Record</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	std<span class="token double-colon punctuation">::</span>string tablename<span class="token punctuation">;</span><span class="token comment">// 表名</span></pre></td></tr><tr><td data-num=15></td><td><pre>	std<span class="token double-colon punctuation">::</span>string nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	std<span class="token double-colon punctuation">::</span>string email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	std<span class="token double-colon punctuation">::</span>string content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	std<span class="token double-colon punctuation">::</span>string createat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DataBase</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=24></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Connection conn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 链接数据库</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录插入</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录读取</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>db.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"db.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>_DBNAME<span class="token punctuation">,</span>_HOST<span class="token punctuation">,</span>_USER<span class="token punctuation">,</span>_PASSWORD<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=8></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=9></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		std<span class="token double-colon punctuation">::</span>string _sql <span class="token operator">=</span> <span class="token string">"INSERT INTO "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>tablename<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"(NickName,Email,Content,CreateAt)\nVALUES("</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		_sql <span class="token operator">+=</span>	mysqlpp<span class="token double-colon punctuation">::</span>quote <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>nickname <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		_sql <span class="token operator">+=</span>	mysqlpp<span class="token double-colon punctuation">::</span>quote <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>email <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		_sql <span class="token operator">+=</span>	mysqlpp<span class="token double-colon punctuation">::</span>quote <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>content <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>		_sql <span class="token operator">+=</span>	mysqlpp<span class="token double-colon punctuation">::</span>quote <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>createat <span class="token operator">+</span><span class="token string">"'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">");"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=40></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=41></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> record<span class="token operator">-></span>tablename <span class="token operator">+</span> \</pre></td></tr><tr><td data-num=42></td><td><pre>			<span class="token string">"(NickName,Email,Content,CreateAt)\nVALUES('"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=43></td><td><pre>			record<span class="token operator">-></span>nickname <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> record<span class="token operator">-></span>email <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=44></td><td><pre>			record<span class="token operator">-></span>content <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> record<span class="token operator">-></span>createat <span class="token operator">+</span> <span class="token string">"');"</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>		query <span class="token operator">&lt;&lt;</span> _sql <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>		query<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">const</span> mysqlpp<span class="token double-colon punctuation">::</span>Exception<span class="token operator">&amp;</span> er<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=50></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=51></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=52></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=64></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM "</span> <span class="token operator">+</span> mysqlpp<span class="token double-colon punctuation">::</span>quote<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>	_sql <span class="token operator">+=</span> _TABLENAME<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token string">"DataBase::TableInsert() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token string">"SELECT * FROM "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=74></td><td><pre>		_TABLENAME<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=75></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>    query <span class="token operator">&lt;&lt;</span> _sql <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>StoreQueryResult res <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=80></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> row<span class="token operator">:</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=81></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=82></td><td><pre>			std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> row <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>			Record record<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre>			record<span class="token punctuation">.</span>nickname <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span></span></span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>			record<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span></span></span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>			record<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span></span></span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>			record<span class="token punctuation">.</span>createat <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span></span></span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre>			buf<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=91></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=92></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=93></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=94></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=95></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=96></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=97></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=100></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=102></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=103></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./_tcp</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>tcp.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">// 允许所有IP连接</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_IPUSER</span> <span class="token expression">AF_INET</span></span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TcpStream</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sock_addr<span class="token punctuation">;</span><span class="token comment">// socket通信地址结构体</span></pre></td></tr><tr><td data-num=14></td><td><pre>    size_t sock_addr_size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>sock_addr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 通信地址结构体字节大小</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token keyword">int</span> tcp_sock_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 申请的socket资源</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token function">TcpStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 配置socket通信地址结构体(协议族，通信目标地址)</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token operator">~</span><span class="token function">TcpStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// socket断开时自动退出</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment">     * Construct()，用于</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token comment">     * socket通道建立，包含socket资源申请(socket())，</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token comment">     * 通信地址结构体的通信端口绑定(sin_port)，</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token comment">     * 通道地址绑定到socket(bind())。</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment">    **/</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token keyword">bool</span> <span class="token function">Construct</span><span class="token punctuation">(</span><span class="token keyword">const</span> size_t port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">bool</span> <span class="token function">ToListen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将socket设置为监听状态</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">StreamParse_Line</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 读取stream流中的一行</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>tcp.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"tcp.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">TcpStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sock_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>sock_addr_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	sock_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> _IPUSER<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	sock_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">TcpStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">Construct</span><span class="token punctuation">(</span><span class="token keyword">const</span> size_t port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">!=</span> tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>	tcp_sock_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>tcp_sock_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::Construct() => tcp_sock_fd fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	sock_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token comment">// 立即初始化端口的占用</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token keyword">int</span> opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token function">setsockopt</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sock_addr<span class="token punctuation">)</span><span class="token punctuation">,</span>sock_addr_size<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::Construct() => bind fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::Construct() => Succeed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">ToListen</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=49></td><td><pre></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=52></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::ToListen() => listen() fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::ToListen() => Succeed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buffer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=63></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>	</pre></td></tr><tr><td data-num=65></td><td><pre></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=68></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=69></td><td><pre>		<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=71></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=73></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=74></td><td><pre>			buffer <span class="token operator">+=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=76></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=78></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=79></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=80></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=81></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::StreamParse_Line() => recv() fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>				buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=85></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=86></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=87></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=88></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::StreamParse_Line() => end of recv()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>				<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=91></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=92></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=93></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./_http</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>_response.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;fstream></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_tcp/tcp.h"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_database/db.h"</span></span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ROOTDIR</span> <span class="token string">"docs"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_HTTPVERSION</span> <span class="token string">"1.0"</span></span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">// HTTP请求方法</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestMethod</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    _GET <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>    _POST <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>    _PUT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>    _DELETE <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=18></td><td><pre>    _HEAD <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>    _OPTIONS <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=20></td><td><pre>    _PATCH <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=21></td><td><pre>    _CONNECT <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=22></td><td><pre>    _TRACE <span class="token operator">=</span> <span class="token number">9</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment">// HTTP请求文件格式</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">FileType</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    _HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=29></td><td><pre>    _CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=30></td><td><pre>    _JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=31></td><td><pre>    _PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token comment">// 请求路径功能所属</span></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestPathType</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    _DATABASE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=38></td><td><pre>    _API <span class="token operator">=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TcpResponse</span></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的普通响应</span></pre></td></tr><tr><td data-num=46></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的数据库响应</span></pre></td></tr><tr><td data-num=47></td><td><pre>    <span class="token comment">// 200状态的文件请求响应</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> off_t f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> method_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTTP请求方法</span></pre></td></tr><tr><td data-num=52></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTPP请求文件类型</span></pre></td></tr><tr><td data-num=53></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTTP请求路径类型</span></pre></td></tr><tr><td data-num=54></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 状态响应选择器</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>_response.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_response.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">int</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> method_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> method_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _get <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _post <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _put <span class="token operator">=</span> <span class="token string">"PUT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _delete <span class="token operator">=</span> <span class="token string">"DELETE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _head <span class="token operator">=</span> <span class="token string">"HEAD"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _options <span class="token operator">=</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _patch <span class="token operator">=</span> <span class="token string">"PATCH"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _connect <span class="token operator">=</span> <span class="token string">"CONNECT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _trace <span class="token operator">=</span> <span class="token string">"TRACE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>method_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_get <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_get<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_post <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_post<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_put <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_put<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_delete <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_delete<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_head <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_head<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_options <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_options<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_patch <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_patch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_connect <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_connect<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_trace <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_trace<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span>buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=39></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=40></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => GET"</span></pre></td></tr><tr><td data-num=41></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>				<span class="token keyword">return</span> _GET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=44></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=45></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=46></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=47></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=48></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PUT"</span></pre></td></tr><tr><td data-num=49></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>				<span class="token keyword">return</span> _PUT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=52></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=55></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=57></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=58></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=59></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=60></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => POST"</span></pre></td></tr><tr><td data-num=61></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=62></td><td><pre>				<span class="token keyword">return</span> _POST<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=64></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=65></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=66></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=67></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=68></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => HEAD"</span></pre></td></tr><tr><td data-num=69></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=70></td><td><pre>				<span class="token keyword">return</span> _HEAD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=74></td><td><pre>		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=75></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=76></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=77></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=78></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=79></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=80></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PATCH"</span></pre></td></tr><tr><td data-num=81></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=82></td><td><pre>				<span class="token keyword">return</span> _PATCH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=85></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=86></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=87></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=88></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => TRACE"</span></pre></td></tr><tr><td data-num=89></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=90></td><td><pre>				<span class="token keyword">return</span> _TRACE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=92></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=94></td><td><pre>		<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=95></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=96></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=97></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=98></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=99></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=100></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => DELETE"</span></pre></td></tr><tr><td data-num=101></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=102></td><td><pre>				<span class="token keyword">return</span> _DELETE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=104></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=107></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=108></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=109></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=110></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=111></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=112></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => OPTIONS"</span></pre></td></tr><tr><td data-num=113></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=114></td><td><pre>				<span class="token keyword">return</span> _OPTIONS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=116></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=117></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=118></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=119></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=120></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => CONNECT"</span></pre></td></tr><tr><td data-num=121></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=122></td><td><pre>				<span class="token keyword">return</span> _CONNECT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=124></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=126></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetMethodType() => UNKNOW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=131></td><td><pre></pre></td></tr><tr><td data-num=132></td><td><pre><span class="token keyword">int</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=133></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> filename_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=136></td><td><pre></pre></td></tr><tr><td data-num=137></td><td><pre>	std<span class="token double-colon punctuation">::</span>string type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=138></td><td><pre></pre></td></tr><tr><td data-num=139></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=141></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> filename_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'.'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> type<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=143></td><td><pre>		<span class="token keyword">else</span><span class="token punctuation">&#123;</span> type <span class="token operator">+=</span> ch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=145></td><td><pre></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=148></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _html <span class="token operator">=</span> <span class="token string">"HTML"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _js <span class="token operator">=</span> <span class="token string">"JS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _css <span class="token operator">=</span> <span class="token string">"CSS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _png <span class="token operator">=</span> <span class="token string">"PNG"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token keyword">const</span> size_t type_len <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre></pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> type_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=155></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=156></td><td><pre>			<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>type<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_html <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_html <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_html<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=158></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_js <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_js <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_js<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_css <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_css <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_css<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=160></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_png <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_png <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_png<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=162></td><td><pre></pre></td></tr><tr><td data-num=163></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_html<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=164></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=165></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=166></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=167></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => HTML"</span></pre></td></tr><tr><td data-num=168></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=169></td><td><pre>			<span class="token keyword">return</span> _HTML<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=171></td><td><pre></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_js<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=173></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=174></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=175></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=176></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => CSS"</span></pre></td></tr><tr><td data-num=177></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=178></td><td><pre>			<span class="token keyword">return</span> _JS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=180></td><td><pre></pre></td></tr><tr><td data-num=181></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> type_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=183></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_css<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=184></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=185></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=186></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=187></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => JS"</span></pre></td></tr><tr><td data-num=188></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=189></td><td><pre>				<span class="token keyword">return</span> _CSS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=191></td><td><pre></pre></td></tr><tr><td data-num=192></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_png<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=193></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=194></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=195></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=196></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => PNG"</span></pre></td></tr><tr><td data-num=197></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=198></td><td><pre>				<span class="token keyword">return</span> _PNG<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token string">"TcpResponse::GetFileType() => UNKNOW"</span></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=208></td><td><pre></pre></td></tr><tr><td data-num=209></td><td><pre><span class="token keyword">int</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=210></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=211></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> path_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=213></td><td><pre></pre></td></tr><tr><td data-num=214></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> db <span class="token operator">=</span> <span class="token string">"DATABASE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> api <span class="token operator">=</span> <span class="token string">"API"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=216></td><td><pre></pre></td></tr><tr><td data-num=217></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=218></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=219></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>path_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>db <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>db <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>db<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=221></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>api <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>api <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>api<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=222></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=223></td><td><pre></pre></td></tr><tr><td data-num=224></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>db<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=225></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=226></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=227></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=228></td><td><pre>		<span class="token keyword">return</span> _DATABASE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=229></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=230></td><td><pre></pre></td></tr><tr><td data-num=231></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>api<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=232></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=233></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=234></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=235></td><td><pre>			<span class="token string">"TcpResponse::GetPathType() => API"</span></pre></td></tr><tr><td data-num=236></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre>		<span class="token keyword">return</span> _API<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=239></td><td><pre></pre></td></tr><tr><td data-num=240></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=242></td><td><pre>		<span class="token string">"TcpResponse::GetPathType() => NORMAL"</span></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=245></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=246></td><td><pre></pre></td></tr><tr><td data-num=247></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=248></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=249></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre></pre></td></tr><tr><td data-num=251></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 400 BAD REQUEST\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=254></td><td><pre></pre></td></tr><tr><td data-num=255></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=256></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=257></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=258></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=259></td><td><pre>			<span class="token string">"TcpResponse::Response400() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=260></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=261></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=262></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=263></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=264></td><td><pre></pre></td></tr><tr><td data-num=265></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=266></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=267></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=268></td><td><pre></pre></td></tr><tr><td data-num=269></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=270></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 404 NOT FOUND\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=272></td><td><pre></pre></td></tr><tr><td data-num=273></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=274></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=275></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=276></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=277></td><td><pre>			<span class="token string">"TcpResponse::Response404() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=278></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=279></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=280></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=281></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=282></td><td><pre></pre></td></tr><tr><td data-num=283></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=284></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=285></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=286></td><td><pre></pre></td></tr><tr><td data-num=287></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=288></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=289></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=290></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=291></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=292></td><td><pre>	</pre></td></tr><tr><td data-num=293></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=294></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=295></td><td><pre>		<span class="token comment">// log....</span></pre></td></tr><tr><td data-num=296></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=297></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=298></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=299></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=300></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=301></td><td><pre>	<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=302></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=303></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=304></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=305></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => \nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=306></td><td><pre>			buf</pre></td></tr><tr><td data-num=307></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=308></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=309></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=310></td><td><pre></pre></td></tr><tr><td data-num=311></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=312></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=313></td><td><pre>	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">></span> records<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=314></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=315></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=316></td><td><pre>	std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=317></td><td><pre>	</pre></td></tr><tr><td data-num=318></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=319></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=320></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=321></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=322></td><td><pre>	</pre></td></tr><tr><td data-num=323></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=324></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">GetTableRecord</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=325></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> r<span class="token operator">:</span> records<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=326></td><td><pre>		body <span class="token operator">+=</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>nickname <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>email <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>content <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>createat <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=327></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=328></td><td><pre></pre></td></tr><tr><td data-num=329></td><td><pre>	<span class="token keyword">const</span> size_t bodyLen <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=330></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=331></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=332></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=333></td><td><pre>	</pre></td></tr><tr><td data-num=334></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=335></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=336></td><td><pre>		<span class="token string">"TcpResponse::Response200_DB() => \nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=337></td><td><pre>		buf</pre></td></tr><tr><td data-num=338></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=339></td><td><pre>	</pre></td></tr><tr><td data-num=340></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=341></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=342></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=343></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=344></td><td><pre>			<span class="token string">"TcpResponse::Response200_DB() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=345></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=346></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=347></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=348></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=349></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=350></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=351></td><td><pre>		<span class="token punctuation">&#123;</span>	</pre></td></tr><tr><td data-num=352></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=353></td><td><pre>				<span class="token string">"TcpResponse::Response200_DB() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=354></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=355></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=356></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=357></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=358></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=359></td><td><pre></pre></td></tr><tr><td data-num=360></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> off_t f_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=361></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=362></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=363></td><td><pre></pre></td></tr><tr><td data-num=364></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=365></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=366></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=367></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=368></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=369></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=370></td><td><pre>		<span class="token keyword">case</span> _HTML<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=371></td><td><pre>		<span class="token keyword">case</span> _CSS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=372></td><td><pre>		<span class="token keyword">case</span> _JS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=373></td><td><pre>		<span class="token keyword">case</span> _PNG<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=374></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=375></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=376></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=377></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=378></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=379></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=380></td><td><pre></pre></td></tr><tr><td data-num=381></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=382></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=383></td><td><pre>		<span class="token string">"TcpResponse::Response200() => \nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=384></td><td><pre>		buf</pre></td></tr><tr><td data-num=385></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=386></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=387></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=388></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=389></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=390></td><td><pre>			<span class="token string">"TcpResponse::Response200() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=391></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=392></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=393></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=394></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=395></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=396></td><td><pre>		std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">resource</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=397></td><td><pre></pre></td></tr><tr><td data-num=398></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resource<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=399></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=400></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=401></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=402></td><td><pre>				<span class="token string">"HttpServer::Response200() => file open fail"</span></pre></td></tr><tr><td data-num=403></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=404></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=405></td><td><pre></pre></td></tr><tr><td data-num=406></td><td><pre>		<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=407></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=408></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=409></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=410></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=411></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=412></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=413></td><td><pre>					<span class="token string">"HttpServer::Response200() => file read fail"</span></pre></td></tr><tr><td data-num=414></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=415></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=416></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=417></td><td><pre>		</pre></td></tr><tr><td data-num=418></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=419></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=420></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=421></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=422></td><td><pre>				<span class="token string">"HttpServer::Response200() => End of reading file"</span></pre></td></tr><tr><td data-num=423></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=424></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=425></td><td><pre>		<span class="token keyword">else</span></pre></td></tr><tr><td data-num=426></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=427></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=428></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=429></td><td><pre>				<span class="token string">"HttpServer::Response200() => I/O error when reading"</span></pre></td></tr><tr><td data-num=430></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=431></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=432></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=433></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=434></td><td><pre></pre></td></tr><tr><td data-num=435></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=436></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=437></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetPathType</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=438></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=439></td><td><pre>		<span class="token keyword">case</span> _DATABASE<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=440></td><td><pre>		<span class="token keyword">case</span> _API<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=441></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num=442></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=443></td><td><pre>			std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=444></td><td><pre>			buf <span class="token operator">+=</span> <span class="token string">"./"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=445></td><td><pre>			buf <span class="token operator">+=</span> _ROOTDIR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=446></td><td><pre>			buf <span class="token operator">+=</span> url_buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=447></td><td><pre></pre></td></tr><tr><td data-num=448></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=449></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=450></td><td><pre>				<span class="token string">"TcpResponse::ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=451></td><td><pre>				buf</pre></td></tr><tr><td data-num=452></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=453></td><td><pre></pre></td></tr><tr><td data-num=454></td><td><pre>			<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=455></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=456></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response200</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=457></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=458></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=459></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>http.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_response.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">ReqContent</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	std<span class="token double-colon punctuation">::</span>string req_method<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	std<span class="token double-colon punctuation">::</span>string req_url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string req_body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">class</span> <span class="token class-name">HttpServer</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">UrlFormat</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将url的格式标准化</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>ReqContent<span class="token operator">*</span> req_content<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// HTTP请求内容解析</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">BodyTackle</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">,</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// HTTP请求Body部分解析</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 处理HTTP的GET方法</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 处理HTTP的POST方法</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 接收HTTP请求报文，并处理相关操作</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>http.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>std<span class="token double-colon punctuation">::</span>string <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token char">'/'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=11></td><td><pre>		url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'/'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> i <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token char">'\\'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>			url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		url <span class="token operator">+=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	</pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token string">"HttpServer::UrlFormat() => Format URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>		url</pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">return</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">ReqContentReceive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>ReqContent<span class="token operator">*</span> req_content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=39></td><td><pre>			<span class="token string">"HttpServer::ReqContentReceive() => TcpStream::StreamParse_Line() fail"</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token punctuation">&#125;</span>	</pre></td></tr><tr><td data-num=43></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>buf_len <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token keyword">char</span> bodyLen<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=47></td><td><pre>		req_content<span class="token operator">-></span>req_method <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=49></td><td><pre></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=51></td><td><pre>		req_content<span class="token operator">-></span>req_url <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=56></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => \nRequest Header:"</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre></pre></td></tr><tr><td data-num=65></td><td><pre>		buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">StartWith</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length:"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=68></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=69></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">,</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=70></td><td><pre>				bodyLen<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=73></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>buf<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=77></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=78></td><td><pre>		<span class="token keyword">char</span> body_buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>		<span class="token comment">/* 读取body内容 */</span></pre></td></tr><tr><td data-num=80></td><td><pre>		buf_len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=81></td><td><pre>			sock_fd<span class="token punctuation">,</span>body_buf<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=82></td><td><pre>			<span class="token punctuation">(</span>size_t<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_stoi</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=83></td><td><pre>			<span class="token number">0</span></pre></td></tr><tr><td data-num=84></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=87></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=88></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=89></td><td><pre>				<span class="token string">"HttpServer::ReqContentReceive() => Receive Nothing body"</span></pre></td></tr><tr><td data-num=90></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=92></td><td><pre>		<span class="token keyword">else</span></pre></td></tr><tr><td data-num=93></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=94></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=95></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=96></td><td><pre>				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=97></td><td><pre>				req_content<span class="token operator">-></span>req_body <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=99></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=100></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=102></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=103></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => Succeed"</span></pre></td></tr><tr><td data-num=104></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=106></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=107></td><td><pre></pre></td></tr><tr><td data-num=108></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">BodyTackle</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">,</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=109></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token keyword">const</span> size_t n <span class="token operator">=</span> body_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=114></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=115></td><td><pre>			<span class="token string">"HttpServer::BodyTackle() => Receive Nothing Body"</span></pre></td></tr><tr><td data-num=116></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=119></td><td><pre></pre></td></tr><tr><td data-num=120></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>nickname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>email<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>createat<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=127></td><td><pre>		record<span class="token operator">-></span>nickname <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=129></td><td><pre></pre></td></tr><tr><td data-num=130></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=131></td><td><pre>		record<span class="token operator">-></span>email <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=133></td><td><pre></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=135></td><td><pre>		record<span class="token operator">-></span>content <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=137></td><td><pre></pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=139></td><td><pre>		record<span class="token operator">-></span>createat <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=141></td><td><pre></pre></td></tr><tr><td data-num=142></td><td><pre>	record<span class="token operator">-></span>tablename <span class="token operator">=</span> _TABLENAME<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre></pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=146></td><td><pre>		<span class="token string">"HttpServer::BodyTackle() => Succeed"</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=149></td><td><pre></pre></td></tr><tr><td data-num=150></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=151></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=152></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=154></td><td><pre></pre></td></tr><tr><td data-num=155></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=159></td><td><pre>		url <span class="token operator">+=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre></pre></td></tr><tr><td data-num=162></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=163></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=164></td><td><pre>		<span class="token string">"HttpServer::GetMethod() => Request URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=165></td><td><pre>		url</pre></td></tr><tr><td data-num=166></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::GetMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre></pre></td></tr><tr><td data-num=169></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=170></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=171></td><td><pre></pre></td></tr><tr><td data-num=172></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=173></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=174></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre>	Record record<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>	<span class="token function">BodyTackle</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">,</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre></pre></td></tr><tr><td data-num=178></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=179></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=180></td><td><pre>		<span class="token string">"HttpServer::PostMethod() => record:\n"</span></pre></td></tr><tr><td data-num=181></td><td><pre>		<span class="token string">"nickname: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>nickname <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token string">"email: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>email <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token string">"content: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>content <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=184></td><td><pre>		<span class="token string">"createat: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>createat</pre></td></tr><tr><td data-num=185></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre></pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=188></td><td><pre>	database<span class="token punctuation">.</span><span class="token function">TableInsert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre></pre></td></tr><tr><td data-num=190></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=191></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::PostMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token string">"api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=195></td><td><pre></pre></td></tr><tr><td data-num=196></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=197></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=198></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=200></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=201></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=202></td><td><pre>			<span class="token string">"HttpServer::Accept() => None apply socket"</span></pre></td></tr><tr><td data-num=203></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=206></td><td><pre>		</pre></td></tr><tr><td data-num=207></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">ReqContent</span> req_content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=208></td><td><pre></pre></td></tr><tr><td data-num=209></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>req_content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=210></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=212></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=214></td><td><pre>		<span class="token keyword">case</span> _GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=215></td><td><pre>		<span class="token keyword">case</span> _POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token keyword">case</span> _PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=217></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=218></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=219></td><td><pre>			<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=220></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=221></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=222></td><td><pre>				<span class="token string">"HttpServer::Accept() => Not support for current "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=223></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=224></td><td><pre>				<span class="token string">" request method"</span></pre></td></tr><tr><td data-num=225></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=226></td><td><pre>			<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=228></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=229></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>mylibs.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;vector></span></span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyLibs</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str5<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token comment">// 前缀匹配</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">StartWith</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buf<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> prefix<span class="token punctuation">,</span>size_t<span class="token operator">&amp;</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token keyword">int</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 平方</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// string to int </span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>mylibs.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"mylibs.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=6></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=13></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=20></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> str3 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=27></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> str3 <span class="token operator">&lt;&lt;</span> str4 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str5<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=34></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> str3 <span class="token operator">&lt;&lt;</span> str4 <span class="token operator">&lt;&lt;</span> str5 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">StartWith</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buf<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> prefix<span class="token punctuation">,</span>size_t<span class="token operator">&amp;</span> index<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> prefix<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> prefix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	index <span class="token operator">=</span> i<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=50></td><td><pre></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre><span class="token keyword">int</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token keyword">int</span> m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> n <span class="token operator">*=</span> n<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token keyword">return</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=60></td><td><pre></pre></td></tr><tr><td data-num=61></td><td><pre><span class="token keyword">int</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>left<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre></pre></td></tr><tr><td data-num=67></td><td><pre>	right <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>right <span class="token operator">>=</span> left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=70></td><td><pre>		<span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token punctuation">(</span>strs<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>		ans <span class="token operator">=</span> <span class="token punctuation">(</span>temp <span class="token operator">*</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token operator">--</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token keyword">return</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>httpserver.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_http/http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_tcp/tcp.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;signal.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>TcpStream server_tcp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">void</span> <span class="token function">ExitAction</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#123;</span>	</pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token comment">// 屏蔽所有Linux信号</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">signal</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ExitAction<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 捕获Ctrl c中断 信号</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>ExitAction<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 捕获Kill命令 信号</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> server_tcp<span class="token punctuation">.</span><span class="token function">Construct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> server_tcp<span class="token punctuation">.</span><span class="token function">ToListen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	</pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">int</span> sock_fd <span class="token operator">=</span> server_tcp<span class="token punctuation">.</span>tcp_sock_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	size_t sock_addr_len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">int</span> accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sock_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=31></td><td><pre>		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main() => Waiting server connect..."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sock_addr<span class="token punctuation">,</span><span class="token punctuation">(</span>socklen_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sock_addr_len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=34></td><td><pre>		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main() => Server connected"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">HttpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight makefile"><figcaption data-lang=makefile><span>makefile</span></figcaption><table><tr><td data-num=1></td><td><pre>CP <span class="token operator">:=</span>g++</pre></td></tr><tr><td data-num=2></td><td><pre>AP1 <span class="token operator">:=</span>-Wall</pre></td></tr><tr><td data-num=3></td><td><pre>AP2 <span class="token operator">:=</span>-Wall -g</pre></td></tr><tr><td data-num=4></td><td><pre>STD <span class="token operator">:=</span>-std<span class="token operator">=</span>c++11</pre></td></tr><tr><td data-num=5></td><td><pre>DEBUG <span class="token operator">:=</span>-D _DEBUG</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment"># 头文件</span></pre></td></tr><tr><td data-num=7></td><td><pre>CPPFLAGS <span class="token operator">:=</span> -I/usr/<span class="token keyword">include</span>/mysql \</pre></td></tr><tr><td data-num=8></td><td><pre>			-I/usr/local/<span class="token keyword">include</span>/mysql++</pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment"># 库目录</span></pre></td></tr><tr><td data-num=10></td><td><pre>LDFLAGS <span class="token operator">:=</span> -L/usr/local/lib \</pre></td></tr><tr><td data-num=11></td><td><pre>			-L/usr/lib64/mysql </pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment"># 动态库文件</span></pre></td></tr><tr><td data-num=13></td><td><pre>LDLIBS <span class="token operator">:=</span> -lmysqlpp \</pre></td></tr><tr><td data-num=14></td><td><pre>			-lmysqlclient </pre></td></tr><tr><td data-num=15></td><td><pre>CPPMYSQL <span class="token operator">:=</span><span class="token variable">$</span><span class="token punctuation">(</span>CPPFLAGS<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>LDFAGS<span class="token punctuation">)</span> -lmysqlpp </pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token target symbol">all</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token target symbol">mylibs</span><span class="token punctuation">:</span> ./mylibs.*</pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> ./mylibs.cc </pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token target symbol">tcp</span><span class="token punctuation">:</span> ./mylibs.* ./_tcp/tcp.* </pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> ./mylibs.cc ./_tcp/tcp.cc </pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token target symbol">database</span><span class="token punctuation">:</span> ./mylibs.* ./_database/db.*</pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPPMYSQL<span class="token punctuation">)</span> ./mylibs.cc ./_database/db.cc</pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token target symbol">response</span><span class="token punctuation">:</span> ./mylibs.* ./_tcp/tcp.* ./_database/db.* ./_http/_response.*</pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPPMYSQL<span class="token punctuation">)</span> ./mylibs.cc ./_tcp/tcp.cc \</pre></td></tr><tr><td data-num=30></td><td><pre>	./_database/db.cc ./_http/_response.cc</pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token target symbol">http</span><span class="token punctuation">:</span> ./mylibs.* ./_tcp/tcp.* ./_database/db.* ./_http/_response.* ./_http/http.*  </pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPPMYSQL<span class="token punctuation">)</span> ./mylibs.cc ./_tcp/tcp.cc \</pre></td></tr><tr><td data-num=34></td><td><pre>	./_database/db.cc ./_http/_response.cc ./_http/http.cc</pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token target symbol">httpserver</span><span class="token punctuation">:</span> ./mylibs.* ./_tcp/tcp.* ./_http/_response.* ./_http/http.* \</pre></td></tr><tr><td data-num=37></td><td><pre>			./_database/db.* ./_http/http.* ./httpserver.cc</pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPPMYSQL<span class="token punctuation">)</span> ./mylibs.cc ./_tcp/tcp.cc \</pre></td></tr><tr><td data-num=39></td><td><pre>	./_database/db.cc ./_http/_response.cc ./_http/http.cc \</pre></td></tr><tr><td data-num=40></td><td><pre>	./httpserver.cc -o httpserver</pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token keyword">export</span> LD_LIBRARY_PATH<span class="token operator">=</span>/usr/local/lib<span class="token punctuation">:</span><span class="token variable">$LD_LIBRARY_PATH</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token target symbol">openport</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=44></td><td><pre>	firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>80/tcp --permanent</pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token target symbol">httptest</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=47></td><td><pre>	make openport &amp;&amp; make clean &amp;&amp; make httpserver &amp;&amp; ./httpserver</pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token target symbol">clean</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=50></td><td><pre>	rm -rf ./mylibs.h.gch ./_tcp/tcp.h.gch ./_http/http.h.gch \</pre></td></tr><tr><td data-num=51></td><td><pre>	./_http/_response.h.gch ./_database/db.h.gch</pre></td></tr><tr><td data-num=52></td><td><pre>	rm -rf httpserver</pre></td></tr></table></figure></div></details><h2 id=使用第三方日志库spdlog><a class=anchor href=#使用第三方日志库spdlog>#</a> 使用第三方日志库spdlog</h2><p><span class=exturl data-url="aHR0cHM6Ly9naXRodWIuY29tL2dhYmltZS9zcGRsb2c=">spdlog-github仓库</span></p><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">### 普通方式安装 ###</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token function">git</span> clone https://github.com/gabime/spdlog.git</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token function">cp</span> <span class="token parameter variable">-r</span> ~/spdlog/include/spdlog  /usr/include/spdlog</pre></td></tr></table></figure><p><strong>在项目中使用</strong></p><p>通过<code>static</code>关键字的特性，生成了全局唯一的<code>file_logger</code>日志器，避免重复创建日志器。</p><figure class="highlight cpp"><figcaption data-lang=C++><span>./mylibs.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;vector></span></span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;spdlog/spdlog.h></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;spdlog/sinks/basic_file_sink.h></span></span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_LOGFILENAME</span> <span class="token string">"httpserver_log.log"</span></span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">extern</span> <span class="token keyword">bool</span> log_option<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyLibs</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token function">MyLibs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>    std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>spdlog<span class="token double-colon punctuation">::</span>logger<span class="token operator">></span> file_logger<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token keyword">static</span> MyLibs<span class="token operator">&amp;</span> <span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取logger</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token comment">// CallDebug..............</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token comment">/****************************/</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token comment">// CallLogInfo...............</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token comment">// CallLogError.............</span></pre></td></tr><tr><td data-num=36></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token comment">/**********************/</span></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token keyword">int</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 求平方</span></pre></td></tr><tr><td data-num=42></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// char [] to int </span></pre></td></tr><tr><td data-num=43></td><td><pre>    <span class="token comment">// 前缀匹配</span></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">StartWith</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buf<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> prefix<span class="token punctuation">,</span>size_t<span class="token operator">&amp;</span> index<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./mylibs.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"mylibs.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">MyLibs</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	file_logger <span class="token operator">=</span> spdlog<span class="token double-colon punctuation">::</span><span class="token function">basic_logger_mt</span><span class="token punctuation">(</span><span class="token string">"my_logger"</span><span class="token punctuation">,</span> _LOGFILENAME<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	file_logger<span class="token operator">-></span><span class="token function">set_pattern</span><span class="token punctuation">(</span><span class="token string">"[%Y-%m-%d %H:%M:%S] [%l] %v"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre>MyLibs<span class="token operator">&amp;</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">static</span> MyLibs logger<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">return</span> logger<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span> <span class="token keyword">noexcept</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=18></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span> <span class="token keyword">noexcept</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=25></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span> <span class="token keyword">noexcept</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=32></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> str3 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span> <span class="token keyword">noexcept</span></pre></td></tr><tr><td data-num=37></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=39></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> str3 <span class="token operator">&lt;&lt;</span> str4 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> log_option<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=49></td><td><pre></pre></td></tr><tr><td data-num=50></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=51></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> log_option<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> log_option<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2 <span class="token operator">+</span> str3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre></pre></td></tr><tr><td data-num=64></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=65></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> log_option<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2 <span class="token operator">+</span> str3 <span class="token operator">+</span> str4<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=70></td><td><pre></pre></td></tr><tr><td data-num=71></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=72></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=73></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> log_option<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre></pre></td></tr><tr><td data-num=78></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=79></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> log_option<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre></pre></td></tr><tr><td data-num=85></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=86></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> log_option<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=88></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2 <span class="token operator">+</span> str3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=91></td><td><pre></pre></td></tr><tr><td data-num=92></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=93></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=94></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> log_option<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=95></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	<span class="token function">GetLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2 <span class="token operator">+</span> str3 <span class="token operator">+</span> str4<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=98></td><td><pre></pre></td></tr><tr><td data-num=99></td><td><pre><span class="token keyword">int</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token keyword">int</span> m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=100></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=102></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> n <span class="token operator">*=</span> n<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=103></td><td><pre>	<span class="token keyword">return</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=105></td><td><pre></pre></td></tr><tr><td data-num=106></td><td><pre><span class="token keyword">int</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=107></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=108></td><td><pre>	<span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	<span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>left<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre></pre></td></tr><tr><td data-num=112></td><td><pre>	right <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>right <span class="token operator">>=</span> left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=115></td><td><pre>		<span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token punctuation">(</span>strs<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>		ans <span class="token operator">=</span> <span class="token punctuation">(</span>temp <span class="token operator">*</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>		<span class="token operator">--</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token keyword">return</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=121></td><td><pre></pre></td></tr><tr><td data-num=122></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">StartWith</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buf<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> prefix<span class="token punctuation">,</span>size_t<span class="token operator">&amp;</span> index<span class="token punctuation">)</span> <span class="token keyword">noexcept</span></pre></td></tr><tr><td data-num=123></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> prefix<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=126></td><td><pre>		index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=129></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre></pre></td></tr><tr><td data-num=131></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> prefix<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=132></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=133></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> prefix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=134></td><td><pre>			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=138></td><td><pre>	index <span class="token operator">=</span> i<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=139></td><td><pre></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=利用动态解析json文件实现运行时配置变更操作><a class=anchor href=#利用动态解析json文件实现运行时配置变更操作>#</a> 利用动态解析JSON文件，实现运行时配置变更操作</h2><p>由于写在程序的代码中的配置是固定的，当要改变配置时就需要重新编译一次，非常费时。这里通过将配置存入json文件，程序运行时从json文件中读取配置来改变相关函数运行方式。这里用json文件，是由于json格式比较流行。</p><figure class="highlight tex"><figcaption data-lang=TeX><span>目录结构</span></figcaption><table><tr><td data-num=1></td><td><pre>httpserver</pre></td></tr><tr><td data-num=2></td><td><pre>├── _config</pre></td></tr><tr><td data-num=3></td><td><pre>│   ├── _config.cc</pre></td></tr><tr><td data-num=4></td><td><pre>│   ├── _config.h</pre></td></tr><tr><td data-num=5></td><td><pre>│   ├── _config.json</pre></td></tr><tr><td data-num=6></td><td><pre>│   └── json.hpp</pre></td></tr><tr><td data-num=7></td><td><pre>├── _database</pre></td></tr><tr><td data-num=8></td><td><pre>│   ├── db.cc</pre></td></tr><tr><td data-num=9></td><td><pre>│   └── db.h</pre></td></tr><tr><td data-num=10></td><td><pre>├── docs</pre></td></tr><tr><td data-num=11></td><td><pre>│   ├── css</pre></td></tr><tr><td data-num=12></td><td><pre>│   │   └── comments.css</pre></td></tr><tr><td data-num=13></td><td><pre>│   ├── img</pre></td></tr><tr><td data-num=14></td><td><pre>│   │   └── img.png</pre></td></tr><tr><td data-num=15></td><td><pre>│   ├── index.html</pre></td></tr><tr><td data-num=16></td><td><pre>│   └── js</pre></td></tr><tr><td data-num=17></td><td><pre>│       └── comments.js</pre></td></tr><tr><td data-num=18></td><td><pre>├── _http</pre></td></tr><tr><td data-num=19></td><td><pre>│   ├── http.cc</pre></td></tr><tr><td data-num=20></td><td><pre>│   ├── http.h</pre></td></tr><tr><td data-num=21></td><td><pre>│   ├── _response.cc</pre></td></tr><tr><td data-num=22></td><td><pre>│   └── _response.h</pre></td></tr><tr><td data-num=23></td><td><pre>├── httpserver.cc</pre></td></tr><tr><td data-num=24></td><td><pre>├── makefile</pre></td></tr><tr><td data-num=25></td><td><pre>├── mylibs.cc</pre></td></tr><tr><td data-num=26></td><td><pre>├── mylibs.h</pre></td></tr><tr><td data-num=27></td><td><pre>└── _tcp</pre></td></tr><tr><td data-num=28></td><td><pre>    ├── tcp.cc</pre></td></tr><tr><td data-num=29></td><td><pre>    └── tcp.h</pre></td></tr></table></figure><p><strong>使用第三方JSON解析库<code>nlohmann/json</code></strong></p><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre><span class="token function">wget</span> https://github.com/nlohmann/json/releases/download/v3.11.3/json.hpp</pre></td></tr></table></figure><details class=info><summary>./_config</summary><div><figure class="highlight json"><figcaption data-lang=JSON><span>_config.json</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>	<span class="token property">"server_host"</span><span class="token operator">:</span> <span class="token string">"192.168.80.142"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>	<span class="token property">"root_dir"</span><span class="token operator">:</span> <span class="token string">"docs"</span><span class="token punctuation">,</span>	</pre></td></tr><tr><td data-num=4></td><td><pre>	<span class="token property">"log"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>		<span class="token property">"enable"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>		<span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"./httpserver_log.log"</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token property">"database"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>		<span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">"@Killl611"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=12></td><td><pre>		<span class="token property">"database_name"</span><span class="token operator">:</span> <span class="token string">"CommentSystem"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>		<span class="token property">"table_name"</span><span class="token operator">:</span> <span class="token string">"CommentBlock"</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>_config.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;fstream></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"json.hpp"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_CONFIGFILEPATH</span> <span class="token string">"./_config/_config.json"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyConfig</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">struct</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>		std<span class="token double-colon punctuation">::</span>string host<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>		std<span class="token double-colon punctuation">::</span>string user<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>		std<span class="token double-colon punctuation">::</span>string password<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		std<span class="token double-colon punctuation">::</span>string database_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		std<span class="token double-colon punctuation">::</span>string table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token punctuation">&#125;</span>DatabaseConfig<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">struct</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token keyword">bool</span> enable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		std<span class="token double-colon punctuation">::</span>string path <span class="token operator">=</span> <span class="token string">"./httpserver_log.log"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token punctuation">&#125;</span>LogConfig<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	std<span class="token double-colon punctuation">::</span>string root_dir <span class="token operator">=</span> <span class="token string">"docs"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token function">MyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token keyword">static</span> MyConfig<span class="token operator">&amp;</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">GetRootDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">decltype</span><span class="token punctuation">(</span>DatabaseConfig<span class="token punctuation">)</span><span class="token operator">&amp;</span> <span class="token function">GetDatabaseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">decltype</span><span class="token punctuation">(</span>LogConfig<span class="token punctuation">)</span><span class="token operator">&amp;</span> <span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>_config.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_config.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">MyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">json_file</span><span class="token punctuation">(</span>_CONFIGFILEPATH<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>json_file<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">using</span> json <span class="token operator">=</span> nlohmann<span class="token double-colon punctuation">::</span>json<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	json json_data <span class="token operator">=</span> json<span class="token double-colon punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span>json_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>json_data<span class="token punctuation">[</span><span class="token string">"root_dir"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>		root_dir <span class="token operator">=</span> json_data<span class="token punctuation">[</span><span class="token string">"root_dir"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>json_data<span class="token punctuation">[</span><span class="token string">"log"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token keyword">auto</span><span class="token operator">&amp;</span> log_config <span class="token operator">=</span> json_data<span class="token punctuation">[</span><span class="token string">"log"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>log_config<span class="token punctuation">[</span><span class="token string">"enable"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>			LogConfig<span class="token punctuation">.</span>enable <span class="token operator">=</span> log_config<span class="token punctuation">[</span><span class="token string">"enable"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span>LogConfig<span class="token punctuation">.</span>enable <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>log_config<span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>				LogConfig<span class="token punctuation">.</span>path <span class="token operator">=</span> json_data<span class="token punctuation">[</span><span class="token string">"log"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>			<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>				LogConfig<span class="token punctuation">.</span>enable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>json_data<span class="token punctuation">[</span><span class="token string">"database"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token keyword">auto</span><span class="token operator">&amp;</span> db_config <span class="token operator">=</span> json_data<span class="token punctuation">[</span><span class="token string">"database"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=34></td><td><pre>			db_config<span class="token punctuation">[</span><span class="token string">"host"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> </pre></td></tr><tr><td data-num=35></td><td><pre>			db_config<span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> </pre></td></tr><tr><td data-num=36></td><td><pre>			db_config<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span></pre></td></tr><tr><td data-num=37></td><td><pre>			db_config<span class="token punctuation">[</span><span class="token string">"database_name"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span></pre></td></tr><tr><td data-num=38></td><td><pre>			db_config<span class="token punctuation">[</span><span class="token string">"table_name"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=40></td><td><pre>			DatabaseConfig<span class="token punctuation">.</span>host <span class="token operator">=</span> db_config<span class="token punctuation">[</span><span class="token string">"host"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>			DatabaseConfig<span class="token punctuation">.</span>user <span class="token operator">=</span> db_config<span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>			DatabaseConfig<span class="token punctuation">.</span>password <span class="token operator">=</span> db_config<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>			DatabaseConfig<span class="token punctuation">.</span>database_name <span class="token operator">=</span> db_config<span class="token punctuation">[</span><span class="token string">"database_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>			DatabaseConfig<span class="token punctuation">.</span>table_name <span class="token operator">=</span> db_config<span class="token punctuation">[</span><span class="token string">"table_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre>MyConfig<span class="token operator">&amp;</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=50></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">static</span> MyConfig config<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">return</span> config<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre>std<span class="token double-colon punctuation">::</span>string <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetRootDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token keyword">return</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>root_dir<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token keyword">decltype</span><span class="token punctuation">(</span>MyConfig<span class="token double-colon punctuation">::</span>DatabaseConfig<span class="token punctuation">)</span><span class="token operator">&amp;</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetDatabaseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">return</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>DatabaseConfig<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre><span class="token keyword">decltype</span><span class="token punctuation">(</span>MyConfig<span class="token double-colon punctuation">::</span>LogConfig<span class="token punctuation">)</span><span class="token operator">&amp;</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token keyword">return</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LogConfig<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./_database</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>db.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql++/mysql++.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">// 表记录中一行的数据，处理表名</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Record</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	std<span class="token double-colon punctuation">::</span>string email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	std<span class="token double-colon punctuation">::</span>string content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	std<span class="token double-colon punctuation">::</span>string createat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DataBase</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=17></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Connection conn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	std<span class="token double-colon punctuation">::</span>string table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 链接数据库</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录插入</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录读取</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>db.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"db.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> db_config <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetDatabaseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">bool</span> db_connect <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=7></td><td><pre>		db_config<span class="token punctuation">.</span>database_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>		db_config<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>		db_config<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>		db_config<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>	table_name <span class="token operator">=</span> db_config<span class="token punctuation">.</span>table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> db_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=18></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=21></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>		mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>		std<span class="token double-colon punctuation">::</span>string _sql <span class="token operator">=</span> <span class="token string">"INSERT INTO "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre></pre></td></tr><tr><td data-num=41></td><td><pre>		_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"(NickName,Email,Content,CreateAt)\nVALUES("</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>		_sql <span class="token operator">+=</span>	mysqlpp<span class="token double-colon punctuation">::</span>quote <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>nickname <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		_sql <span class="token operator">+=</span>	mysqlpp<span class="token double-colon punctuation">::</span>quote <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>email <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>		_sql <span class="token operator">+=</span>	mysqlpp<span class="token double-colon punctuation">::</span>quote <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>content <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>		_sql <span class="token operator">+=</span>	mysqlpp<span class="token double-colon punctuation">::</span>quote <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>createat <span class="token operator">+</span><span class="token string">"'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">");"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=54></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=55></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=56></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=57></td><td><pre>			<span class="token string">"(NickName,Email,Content,CreateAt)\nVALUES('"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=58></td><td><pre>			record<span class="token operator">-></span>nickname <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> record<span class="token operator">-></span>email <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=59></td><td><pre>			record<span class="token operator">-></span>content <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> record<span class="token operator">-></span>createat <span class="token operator">+</span> <span class="token string">"');"</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=63></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=64></td><td><pre>			<span class="token string">"(NickName,Email,Content,CreateAt)\nVALUES('"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=65></td><td><pre>			record<span class="token operator">-></span>nickname <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> record<span class="token operator">-></span>email <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=66></td><td><pre>			record<span class="token operator">-></span>content <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> record<span class="token operator">-></span>createat <span class="token operator">+</span> <span class="token string">"');"</span></pre></td></tr><tr><td data-num=67></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>		query <span class="token operator">&lt;&lt;</span> _sql <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>		query<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">const</span> mysqlpp<span class="token double-colon punctuation">::</span>Exception<span class="token operator">&amp;</span> er<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=74></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=75></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=76></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=78></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=79></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=80></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre></pre></td></tr><tr><td data-num=84></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=85></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=89></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=93></td><td><pre></pre></td></tr><tr><td data-num=94></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=95></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM "</span> <span class="token operator">+</span> mysqlpp<span class="token double-colon punctuation">::</span>quote<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre></pre></td></tr><tr><td data-num=99></td><td><pre>	_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre></pre></td></tr><tr><td data-num=102></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=103></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=104></td><td><pre>		<span class="token string">"DataBase::TableInsert() => query\nSELECT * FROM "</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=105></td><td><pre>		table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=107></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=109></td><td><pre>		<span class="token string">"DataBase::TableInsert() => query\nSELECT * FROM "</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=110></td><td><pre>		table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre></pre></td></tr><tr><td data-num=114></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>StoreQueryResult res <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=117></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> row<span class="token operator">:</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=118></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=119></td><td><pre>			Record record<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>			record<span class="token punctuation">.</span>nickname <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span></span></span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>			record<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span></span></span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>			record<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span></span></span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>			record<span class="token punctuation">.</span>createat <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span></span></span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>			buf<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=126></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=129></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=131></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=132></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=133></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=135></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=136></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=138></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=140></td><td><pre></pre></td></tr><tr><td data-num=141></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=142></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=143></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=146></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./_tcp</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>tcp.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">// 允许所有IP连接</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_IPUSER</span> <span class="token expression">INADDR_ANY</span></span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TcpStream</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sock_addr<span class="token punctuation">;</span><span class="token comment">// socket通信地址结构体</span></pre></td></tr><tr><td data-num=16></td><td><pre>    size_t sock_addr_size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>sock_addr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 通信地址结构体字节大小</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token keyword">int</span> tcp_sock_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 申请的socket资源</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token function">TcpStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 配置socket通信地址结构体(协议族，通信目标地址)</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token operator">~</span><span class="token function">TcpStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// socket断开时自动退出</span></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token comment">     * Construct()，用于</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token comment">     * socket通道建立，包含socket资源申请，</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment">     * 通信地址结构体的通信端口绑定，</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment">     * 通道地址绑定到。</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token comment">    **/</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token keyword">bool</span> <span class="token function">Construct</span><span class="token punctuation">(</span><span class="token keyword">const</span> size_t port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token keyword">bool</span> <span class="token function">ToListen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将socket设置为监听状态</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">StreamParse_Line</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 读取stream流中的一行</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>tcp.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"tcp.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">TcpStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sock_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>sock_addr_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	sock_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span><span class="token comment">// 接入的地址类型</span></pre></td></tr><tr><td data-num=7></td><td><pre>	sock_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>_IPUSER<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 允许接入的IP用户</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">TcpStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">Construct</span><span class="token punctuation">(</span><span class="token keyword">const</span> size_t port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">!=</span> tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>	tcp_sock_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>tcp_sock_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token string">"TcpStream::Construct() => tcp_sock_fd fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::Construct() => tcp_sock_fd fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	sock_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token comment">// 立即初始化端口的占用</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">int</span> opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token function">setsockopt</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sock_addr<span class="token punctuation">)</span><span class="token punctuation">,</span>sock_addr_size<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token string">"TcpStream::Construct() => bind fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::Construct() => bind fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpStream::Construct() => Succeed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::Construct() => Succeed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">ToListen</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=50></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=55></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=56></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token string">"TcpStream::ToListen() => listen() fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::ToListen() => listen() fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>tcp_sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpStream::ToListen() => Succeed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::ToListen() => Succeed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre></pre></td></tr><tr><td data-num=67></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buffer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=68></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>	</pre></td></tr><tr><td data-num=70></td><td><pre></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=73></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=74></td><td><pre>		<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=76></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=77></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=78></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=79></td><td><pre>			buffer <span class="token operator">+=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=82></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=83></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=84></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=85></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=86></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token string">"TcpStream::StreamParse_Line() => recv() fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::StreamParse_Line() => recv() fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre>				buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=91></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=92></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=93></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=94></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpStream::StreamParse_Line() => end of recv()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpStream::StreamParse_Line() => end of recv()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>				<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=98></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=99></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=100></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./_http</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>_response.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_database/db.h"</span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_tcp/tcp.h"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_HTTPVERSION</span> <span class="token string">"1.0"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">// HTTP请求方法</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">RequestMethodType</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    _UNKNOW<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>    _GET<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>    _POST<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>    _PUT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>    _DELETE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>    _HEAD<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=18></td><td><pre>    _OPTIONS<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>    _PATCH<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=20></td><td><pre>    _CONNECT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=21></td><td><pre>    _TRACE</pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment">// HTTP请求文件格式</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">RequestFileType</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    _UNKNOW<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=28></td><td><pre>    _HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=29></td><td><pre>    _CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=30></td><td><pre>    _JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=31></td><td><pre>    _PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token comment">// 请求路径功能所属</span></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">RequestPathType</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    _NORMAL<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=38></td><td><pre>    _DATABASE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=39></td><td><pre>    _API</pre></td></tr><tr><td data-num=40></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TcpResponse</span></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=45></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的普通响应</span></pre></td></tr><tr><td data-num=47></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的数据库响应</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token comment">// 200状态的文件请求响应</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> off_t f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>    <span class="token keyword">static</span> RequestMethodType <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> method_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTTP请求方法</span></pre></td></tr><tr><td data-num=53></td><td><pre>    <span class="token keyword">static</span> RequestFileType <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTPP请求文件类型</span></pre></td></tr><tr><td data-num=54></td><td><pre>    <span class="token keyword">static</span> RequestPathType <span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTTP请求路径类型</span></pre></td></tr><tr><td data-num=55></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 状态响应选择器</span></pre></td></tr><tr><td data-num=56></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>_response.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_response.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>RequestMethodType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> method_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> method_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _get <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _post <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _put <span class="token operator">=</span> <span class="token string">"PUT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _delete <span class="token operator">=</span> <span class="token string">"DELETE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _head <span class="token operator">=</span> <span class="token string">"HEAD"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _options <span class="token operator">=</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _patch <span class="token operator">=</span> <span class="token string">"PATCH"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _connect <span class="token operator">=</span> <span class="token string">"CONNECT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _trace <span class="token operator">=</span> <span class="token string">"TRACE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>method_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_get <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_get<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_post <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_post<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_put <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_put<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_delete <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_delete<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_head <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_head<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_options <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_options<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_patch <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_patch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_connect <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_connect<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_trace <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_trace<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span>buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=39></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=40></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => GET"</span></pre></td></tr><tr><td data-num=41></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => GET"</span></pre></td></tr><tr><td data-num=44></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_GET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=50></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=51></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PUT"</span></pre></td></tr><tr><td data-num=52></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=54></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PUT"</span></pre></td></tr><tr><td data-num=55></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PUT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=63></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=64></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=65></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=66></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => POST"</span></pre></td></tr><tr><td data-num=67></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=68></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=69></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => POST"</span></pre></td></tr><tr><td data-num=70></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=71></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_POST<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=73></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=74></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=75></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=76></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=77></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => HEAD"</span></pre></td></tr><tr><td data-num=78></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=79></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=80></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => HEAD"</span></pre></td></tr><tr><td data-num=81></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=82></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_HEAD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=87></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=88></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=89></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=90></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=91></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=92></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PATCH"</span></pre></td></tr><tr><td data-num=93></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=94></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=95></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PATCH"</span></pre></td></tr><tr><td data-num=96></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=97></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PATCH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=99></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=100></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=101></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=102></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=103></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => TRACE"</span></pre></td></tr><tr><td data-num=104></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=105></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=106></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => TRACE"</span></pre></td></tr><tr><td data-num=107></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=108></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_TRACE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=112></td><td><pre>		<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=114></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=115></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=116></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=117></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=118></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => DELETE"</span></pre></td></tr><tr><td data-num=119></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=120></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=121></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => DELETE"</span></pre></td></tr><tr><td data-num=122></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=123></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_DELETE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=125></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=128></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=129></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=130></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=131></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=132></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=133></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => OPTIONS"</span></pre></td></tr><tr><td data-num=134></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=135></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=136></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => OPTIONS"</span></pre></td></tr><tr><td data-num=137></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_OPTIONS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=140></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=141></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=142></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=143></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=144></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => CONNECT"</span></pre></td></tr><tr><td data-num=145></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=146></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=147></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => CONNECT"</span></pre></td></tr><tr><td data-num=148></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=149></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_CONNECT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=151></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetMethodType() => UNKNOW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetMethodType() => UNKNOW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre></pre></td></tr><tr><td data-num=160></td><td><pre>RequestFileType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=161></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=162></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> filename_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre></pre></td></tr><tr><td data-num=165></td><td><pre>	std<span class="token double-colon punctuation">::</span>string type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=169></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> filename_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'.'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> type<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=171></td><td><pre>		<span class="token keyword">else</span><span class="token punctuation">&#123;</span> type <span class="token operator">+=</span> ch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=172></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=173></td><td><pre></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=175></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=176></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _html <span class="token operator">=</span> <span class="token string">"HTML"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _js <span class="token operator">=</span> <span class="token string">"JS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _css <span class="token operator">=</span> <span class="token string">"CSS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _png <span class="token operator">=</span> <span class="token string">"PNG"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>		<span class="token keyword">const</span> size_t type_len <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> type_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=184></td><td><pre>			<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>type<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_html <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_html <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_html<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=186></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_js <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_js <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_js<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=187></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_css <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_css <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_css<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=188></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_png <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_png <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_png<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_html<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=192></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=194></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=195></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => HTML"</span></pre></td></tr><tr><td data-num=196></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=197></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=198></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => HTML"</span></pre></td></tr><tr><td data-num=199></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=200></td><td><pre>			<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_HTML<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre></pre></td></tr><tr><td data-num=203></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_js<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=205></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=206></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=207></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => CSS"</span></pre></td></tr><tr><td data-num=208></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=209></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=210></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => CSS"</span></pre></td></tr><tr><td data-num=211></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=212></td><td><pre>			<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_JS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=214></td><td><pre></pre></td></tr><tr><td data-num=215></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> type_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=217></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_css<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=218></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=219></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=220></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=221></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => JS"</span></pre></td></tr><tr><td data-num=222></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=223></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=224></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => JS"</span></pre></td></tr><tr><td data-num=225></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=226></td><td><pre>				<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_CSS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=228></td><td><pre></pre></td></tr><tr><td data-num=229></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_png<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=230></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=231></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=232></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=233></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => PNG"</span></pre></td></tr><tr><td data-num=234></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=236></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => PNG"</span></pre></td></tr><tr><td data-num=237></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>				<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_PNG<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=240></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=244></td><td><pre>		<span class="token string">"TcpResponse::GetFileType() => UNKNOW"</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=247></td><td><pre>		<span class="token string">"TcpResponse::GetFileType() => UNKNOW"</span></pre></td></tr><tr><td data-num=248></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>	<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=251></td><td><pre></pre></td></tr><tr><td data-num=252></td><td><pre>RequestPathType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=253></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=254></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> path_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_NORMAL<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=256></td><td><pre></pre></td></tr><tr><td data-num=257></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> db <span class="token operator">=</span> <span class="token string">"DATABASE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> api <span class="token operator">=</span> <span class="token string">"API"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre></pre></td></tr><tr><td data-num=260></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=261></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=262></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>path_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>db <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>db <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>db<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=264></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>api <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>api <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>api<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=265></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=266></td><td><pre></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>db<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=268></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=269></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=270></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=272></td><td><pre>		<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=273></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=274></td><td><pre></pre></td></tr><tr><td data-num=275></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>api<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=276></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=277></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=278></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=279></td><td><pre>			<span class="token string">"TcpResponse::GetPathType() => API"</span></pre></td></tr><tr><td data-num=280></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=282></td><td><pre>			<span class="token string">"TcpResponse::GetPathType() => API"</span></pre></td></tr><tr><td data-num=283></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>		<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_API<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=285></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=286></td><td><pre></pre></td></tr><tr><td data-num=287></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=288></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=289></td><td><pre>		<span class="token string">"TcpResponse::GetPathType() => NORMAL"</span></pre></td></tr><tr><td data-num=290></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=291></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=292></td><td><pre>		<span class="token string">"TcpResponse::GetPathType() => NORMAL"</span></pre></td></tr><tr><td data-num=293></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=294></td><td><pre>	<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_NORMAL<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=295></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=296></td><td><pre></pre></td></tr><tr><td data-num=297></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=298></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=299></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=300></td><td><pre></pre></td></tr><tr><td data-num=301></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=302></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=303></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 400 BAD REQUEST\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=304></td><td><pre></pre></td></tr><tr><td data-num=305></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=306></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=307></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=308></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=309></td><td><pre>			<span class="token string">"TcpResponse::Response400() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=310></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=311></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=312></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=313></td><td><pre>			<span class="token string">"TcpResponse::Response400() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=314></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=315></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=316></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=317></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=318></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=319></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=320></td><td><pre>		<span class="token string">"TcpResponse::Response400() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=321></td><td><pre>		buf</pre></td></tr><tr><td data-num=322></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=323></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=324></td><td><pre>		<span class="token string">"TcpResponse::Response400() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=325></td><td><pre>		buf</pre></td></tr><tr><td data-num=326></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=327></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=328></td><td><pre></pre></td></tr><tr><td data-num=329></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=330></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=331></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=332></td><td><pre></pre></td></tr><tr><td data-num=333></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=334></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=335></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 404 NOT FOUND\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=336></td><td><pre></pre></td></tr><tr><td data-num=337></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=338></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=339></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=340></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=341></td><td><pre>			<span class="token string">"TcpResponse::Response404() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=342></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=343></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=344></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=345></td><td><pre>			<span class="token string">"TcpResponse::Response404() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=346></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=347></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=348></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=349></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=350></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=351></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=352></td><td><pre>		<span class="token string">"TcpResponse::Response404() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=353></td><td><pre>		buf</pre></td></tr><tr><td data-num=354></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=355></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=356></td><td><pre>		<span class="token string">"TcpResponse::Response404() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=357></td><td><pre>		buf </pre></td></tr><tr><td data-num=358></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=359></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=360></td><td><pre></pre></td></tr><tr><td data-num=361></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=362></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=363></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=364></td><td><pre></pre></td></tr><tr><td data-num=365></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=366></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=367></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=368></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=369></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=370></td><td><pre></pre></td></tr><tr><td data-num=371></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=372></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=373></td><td><pre>		<span class="token comment">// log....</span></pre></td></tr><tr><td data-num=374></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=375></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=376></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=377></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=378></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=379></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=380></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=381></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=382></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=383></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=384></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=385></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=386></td><td><pre>		<span class="token string">"TcpResponse::Response200_NF() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=387></td><td><pre>		buf</pre></td></tr><tr><td data-num=388></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=389></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=390></td><td><pre>		<span class="token string">"TcpResponse::Response200_NF() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=391></td><td><pre>		buf</pre></td></tr><tr><td data-num=392></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=393></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=394></td><td><pre></pre></td></tr><tr><td data-num=395></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=396></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=397></td><td><pre>	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">></span> records<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=398></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=399></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=400></td><td><pre>	std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=401></td><td><pre></pre></td></tr><tr><td data-num=402></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=403></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=404></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=405></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=406></td><td><pre></pre></td></tr><tr><td data-num=407></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=408></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">GetTableRecord</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=409></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> r<span class="token operator">:</span> records<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=410></td><td><pre>		body <span class="token operator">+=</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>nickname <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>email <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>content <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>createat <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=411></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=412></td><td><pre></pre></td></tr><tr><td data-num=413></td><td><pre>	<span class="token keyword">const</span> size_t bodyLen <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=414></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=415></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=416></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=417></td><td><pre></pre></td></tr><tr><td data-num=418></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=419></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=420></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=421></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=422></td><td><pre>			<span class="token string">"TcpResponse::Response200_DB() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=423></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=424></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=425></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=426></td><td><pre>			<span class="token string">"TcpResponse::Response200_DB() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=427></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=428></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=429></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=430></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=431></td><td><pre></pre></td></tr><tr><td data-num=432></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=433></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=434></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=435></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=436></td><td><pre>			<span class="token comment">// log...	</span></pre></td></tr><tr><td data-num=437></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=438></td><td><pre>				<span class="token string">"TcpResponse::Response200_DB() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=439></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=440></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=441></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=442></td><td><pre>				<span class="token string">"TcpResponse::Response200_DB() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=443></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=444></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=445></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=446></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=447></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=448></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=449></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=450></td><td><pre>		<span class="token string">"TcpResponse::Response200_DB() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=451></td><td><pre>		buf</pre></td></tr><tr><td data-num=452></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=453></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=454></td><td><pre>		<span class="token string">"TcpResponse::Response200_DB() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=455></td><td><pre>		buf</pre></td></tr><tr><td data-num=456></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=457></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=458></td><td><pre></pre></td></tr><tr><td data-num=459></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> off_t f_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=460></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=461></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=462></td><td><pre></pre></td></tr><tr><td data-num=463></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=464></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=465></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=466></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=467></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=468></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=469></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_HTML<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=470></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_CSS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=471></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_JS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=472></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_PNG<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=473></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=474></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=475></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=476></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=477></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=478></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=479></td><td><pre></pre></td></tr><tr><td data-num=480></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=481></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=482></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=483></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=484></td><td><pre>			<span class="token string">"TcpResponse::Response200() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=485></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=486></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=487></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=488></td><td><pre>			<span class="token string">"TcpResponse::Response200() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=489></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=490></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=491></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=492></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=493></td><td><pre>	std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">resource</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=494></td><td><pre></pre></td></tr><tr><td data-num=495></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resource<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=496></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=497></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=498></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=499></td><td><pre>			<span class="token string">"HttpServer::Response200() => file open fail"</span></pre></td></tr><tr><td data-num=500></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=501></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=502></td><td><pre>			<span class="token string">"HttpServer::Response200() => file open fail"</span></pre></td></tr><tr><td data-num=503></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=504></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=505></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=506></td><td><pre></pre></td></tr><tr><td data-num=507></td><td><pre>	<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=508></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=509></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=510></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=511></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=512></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=513></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=514></td><td><pre>				<span class="token string">"HttpServer::Response200() => file read fail"</span></pre></td></tr><tr><td data-num=515></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=516></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=517></td><td><pre>				<span class="token string">"HttpServer::Response200() => file read fail"</span></pre></td></tr><tr><td data-num=518></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=519></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=520></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=521></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=522></td><td><pre>		</pre></td></tr><tr><td data-num=523></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=524></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=525></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=526></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=527></td><td><pre>			<span class="token string">"HttpServer::Response200() => End of reading file"</span></pre></td></tr><tr><td data-num=528></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=529></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=530></td><td><pre>			<span class="token string">"HttpServer::Response200() => End of reading file"</span></pre></td></tr><tr><td data-num=531></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=532></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=533></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=534></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=535></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=536></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=537></td><td><pre>			<span class="token string">"HttpServer::Response200() => I/O error when reading"</span></pre></td></tr><tr><td data-num=538></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=539></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=540></td><td><pre>			<span class="token string">"HttpServer::Response200() => I/O error when reading"</span></pre></td></tr><tr><td data-num=541></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=542></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=543></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=544></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=545></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=546></td><td><pre>		<span class="token string">"TcpResponse::Response200() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=547></td><td><pre>		buf</pre></td></tr><tr><td data-num=548></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=549></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=550></td><td><pre>		<span class="token string">"TcpResponse::Response200() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=551></td><td><pre>		buf</pre></td></tr><tr><td data-num=552></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=553></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=554></td><td><pre></pre></td></tr><tr><td data-num=555></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=556></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=557></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetPathType</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=558></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=559></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=560></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_API<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=561></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num=562></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=563></td><td><pre>			std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=564></td><td><pre>			<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=565></td><td><pre></pre></td></tr><tr><td data-num=566></td><td><pre>			buf <span class="token operator">+=</span> <span class="token string">"./"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=567></td><td><pre>			buf <span class="token operator">+=</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetRootDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=568></td><td><pre>			buf <span class="token operator">+=</span> url_buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=569></td><td><pre></pre></td></tr><tr><td data-num=570></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=571></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=572></td><td><pre>				<span class="token string">"TcpResponse::ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=573></td><td><pre>				buf</pre></td></tr><tr><td data-num=574></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=575></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=576></td><td><pre>				<span class="token string">"TcpResponse::ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=577></td><td><pre>				buf</pre></td></tr><tr><td data-num=578></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=579></td><td><pre></pre></td></tr><tr><td data-num=580></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=581></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response200</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=582></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=583></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=584></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>http.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_response.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">ReqContent</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	std<span class="token double-colon punctuation">::</span>string req_method<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	std<span class="token double-colon punctuation">::</span>string req_url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string req_body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">class</span> <span class="token class-name">HttpServer</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">UrlFormat</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将url的格式标准化</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>ReqContent<span class="token operator">*</span> req_content<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// HTTP请求内容解析</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">BodyTackle</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">,</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// HTTP请求Body部分解析</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 处理HTTP的GET方法</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 处理HTTP的POST方法</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 接收HTTP请求报文，并处理相关操作</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>http.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>std<span class="token double-colon punctuation">::</span>string <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token char">'/'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=11></td><td><pre>		url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'/'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> i <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token char">'\\'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>			url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		url <span class="token operator">+=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token string">"HttpServer::UrlFormat() => Format URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>		url</pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token string">"HttpServer::UrlFormat() => Format URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=30></td><td><pre>		url</pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">return</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">ReqContentReceive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>ReqContent<span class="token operator">*</span> req_content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=42></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>			<span class="token string">"HttpServer::ReqContentReceive() => TcpStream::StreamParse_Line() fail"</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=46></td><td><pre>			<span class="token string">"HttpServer::ReqContentReceive() => TcpStream::StreamParse_Line() fail"</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">&#125;</span>	</pre></td></tr><tr><td data-num=50></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>buf_len <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">char</span> bodyLen<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		req_content<span class="token operator">-></span>req_method <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		req_content<span class="token operator">-></span>req_url <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => \nRequest Header:"</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => \nRequest Header:"</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre></pre></td></tr><tr><td data-num=76></td><td><pre>		buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">StartWith</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length:"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=79></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=80></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">,</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=81></td><td><pre>				bodyLen<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>buf<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=88></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=89></td><td><pre>		<span class="token keyword">char</span> body_buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>		<span class="token comment">/* 读取body内容 */</span></pre></td></tr><tr><td data-num=91></td><td><pre>		buf_len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=92></td><td><pre>			sock_fd<span class="token punctuation">,</span>body_buf<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=93></td><td><pre>			<span class="token punctuation">(</span>size_t<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_stoi</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=94></td><td><pre>			<span class="token number">0</span></pre></td></tr><tr><td data-num=95></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=97></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=98></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=99></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=100></td><td><pre>				<span class="token string">"HttpServer::ReqContentReceive() => Receive Nothing body"</span></pre></td></tr><tr><td data-num=101></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=103></td><td><pre>				<span class="token string">"HttpServer::ReqContentReceive() => Receive Nothing body"</span></pre></td></tr><tr><td data-num=104></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token keyword">else</span></pre></td></tr><tr><td data-num=107></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=108></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=109></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=110></td><td><pre>				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre>				req_content<span class="token operator">-></span>req_body <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=117></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => Succeed"</span></pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=120></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => Succeed"</span></pre></td></tr><tr><td data-num=121></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=123></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=124></td><td><pre></pre></td></tr><tr><td data-num=125></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">BodyTackle</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">,</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=126></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token keyword">const</span> size_t n <span class="token operator">=</span> body_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=131></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=132></td><td><pre>			<span class="token string">"HttpServer::BodyTackle() => Receive Nothing Body"</span></pre></td></tr><tr><td data-num=133></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=135></td><td><pre>			<span class="token string">"HttpServer::BodyTackle() => Receive Nothing Body"</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=139></td><td><pre></pre></td></tr><tr><td data-num=140></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre></pre></td></tr><tr><td data-num=142></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>nickname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>email<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>createat<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=147></td><td><pre>		record<span class="token operator">-></span>nickname <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>	<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=149></td><td><pre></pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=151></td><td><pre>		record<span class="token operator">-></span>email <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=153></td><td><pre></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> n <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=155></td><td><pre>		record<span class="token operator">-></span>content <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=157></td><td><pre></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=159></td><td><pre>		record<span class="token operator">-></span>createat <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre></pre></td></tr><tr><td data-num=162></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=163></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=164></td><td><pre>		<span class="token string">"HttpServer::BodyTackle() => Succeed"</span></pre></td></tr><tr><td data-num=165></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=167></td><td><pre>		<span class="token string">"HttpServer::BodyTackle() => Succeed"</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=170></td><td><pre></pre></td></tr><tr><td data-num=171></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=172></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=175></td><td><pre></pre></td></tr><tr><td data-num=176></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre></pre></td></tr><tr><td data-num=178></td><td><pre>	<span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=179></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=180></td><td><pre>		url <span class="token operator">+=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=182></td><td><pre></pre></td></tr><tr><td data-num=183></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=184></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=185></td><td><pre>		<span class="token string">"HttpServer::GetMethod() => Request URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=186></td><td><pre>		url</pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=189></td><td><pre>		<span class="token string">"HttpServer::GetMethod() => Request URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=190></td><td><pre>		url</pre></td></tr><tr><td data-num=191></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"HttpServer::GetMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::GetMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre></pre></td></tr><tr><td data-num=196></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=197></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=198></td><td><pre></pre></td></tr><tr><td data-num=199></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=200></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=201></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	Record record<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token function">BodyTackle</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">,</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=207></td><td><pre>		<span class="token string">"HttpServer::PostMethod() => record:\nnickname: "</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=208></td><td><pre>		record<span class="token punctuation">.</span>nickname <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=209></td><td><pre>		<span class="token string">"email: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>email <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=210></td><td><pre>		<span class="token string">"content: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>content <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=211></td><td><pre>		<span class="token string">"createat: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>createat</pre></td></tr><tr><td data-num=212></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=214></td><td><pre>		<span class="token string">"HttpServer::PostMethod() => record:\nnickname: "</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=215></td><td><pre>		record<span class="token punctuation">.</span>nickname <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token string">"email: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>email <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=217></td><td><pre>		<span class="token string">"content: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>content <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=218></td><td><pre>		<span class="token string">"createat: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>createat</pre></td></tr><tr><td data-num=219></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre></pre></td></tr><tr><td data-num=221></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=222></td><td><pre>	database<span class="token punctuation">.</span><span class="token function">TableInsert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre></pre></td></tr><tr><td data-num=224></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=225></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"HttpServer::PostMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=226></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::PostMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre></pre></td></tr><tr><td data-num=228></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token string">"api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=229></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=230></td><td><pre></pre></td></tr><tr><td data-num=231></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=232></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=233></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=234></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=235></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=236></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=237></td><td><pre>			<span class="token string">"HttpServer::Accept() => None apply socket"</span></pre></td></tr><tr><td data-num=238></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=239></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=240></td><td><pre>			<span class="token string">"HttpServer::Accept() => None apply socket"</span></pre></td></tr><tr><td data-num=241></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=244></td><td><pre>		</pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">ReqContent</span> req_content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre></pre></td></tr><tr><td data-num=247></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>req_content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=248></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=250></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=251></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=252></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=253></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=254></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=255></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=256></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=257></td><td><pre>			<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=258></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=259></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=260></td><td><pre>				<span class="token string">"HttpServer::Accept() => Not support for current "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=261></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=262></td><td><pre>				<span class="token string">" request method"</span></pre></td></tr><tr><td data-num=263></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=264></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=265></td><td><pre>				<span class="token string">"HttpServer::Accept() => Not support for current "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=266></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=267></td><td><pre>				<span class="token string">" request method"</span></pre></td></tr><tr><td data-num=268></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=269></td><td><pre>			<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=270></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=271></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=272></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>./</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>mylibs.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;vector></span></span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;spdlog/spdlog.h></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;spdlog/sinks/basic_file_sink.h></span></span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_config/_config.h"</span></span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyLibs</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token function">MyLibs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>spdlog<span class="token double-colon punctuation">::</span>logger<span class="token operator">></span> file_logger<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token keyword">static</span> MyLibs<span class="token operator">&amp;</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取唯一MyLibs对象</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token comment">// CallDebug..............</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token comment">/****************************/</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token comment">// CallLogInfo...............</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token comment">// CallLogError.............</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token comment">/**********************/</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token keyword">int</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 求平方</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// char [] to int </span></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token comment">// 前缀匹配</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">StartWith</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buf<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> prefix<span class="token punctuation">,</span>size_t<span class="token operator">&amp;</span> index<span class="token punctuation">)</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>mylibs.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"mylibs.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">MyLibs</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enable<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>		file_logger <span class="token operator">=</span> spdlog<span class="token double-colon punctuation">::</span><span class="token function">basic_logger_mt</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=8></td><td><pre>			<span class="token string">"my_logger"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>			<span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>path</pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		file_logger<span class="token operator">-></span><span class="token function">set_pattern</span><span class="token punctuation">(</span><span class="token string">"[%Y-%m-%d %H:%M:%S] [%l] %v"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>MyLibs<span class="token operator">&amp;</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">static</span> MyLibs mylibs<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">return</span> mylibs<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=24></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=31></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=38></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> str3 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=40></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=43></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=45></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> str3 <span class="token operator">&lt;&lt;</span> str4 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=50></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> _this <span class="token operator">=</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> _this <span class="token operator">=</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre></pre></td></tr><tr><td data-num=67></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=68></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> _this <span class="token operator">=</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre></pre></td></tr><tr><td data-num=72></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=75></td><td><pre></pre></td></tr><tr><td data-num=76></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=77></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=78></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> _this <span class="token operator">=</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=80></td><td><pre></pre></td></tr><tr><td data-num=81></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre></pre></td></tr><tr><td data-num=84></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=85></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=86></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> _this <span class="token operator">=</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=88></td><td><pre></pre></td></tr><tr><td data-num=89></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=92></td><td><pre></pre></td></tr><tr><td data-num=93></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=94></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=95></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> _this <span class="token operator">=</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=97></td><td><pre></pre></td></tr><tr><td data-num=98></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=101></td><td><pre></pre></td></tr><tr><td data-num=102></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=103></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=104></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> _this <span class="token operator">=</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre></pre></td></tr><tr><td data-num=107></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre></pre></td></tr><tr><td data-num=111></td><td><pre><span class="token keyword">void</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str1<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str2<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str3<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str4<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=112></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=113></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> _this <span class="token operator">=</span> <span class="token function">GetMyself</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetLogConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=115></td><td><pre></pre></td></tr><tr><td data-num=116></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">set_level</span><span class="token punctuation">(</span>spdlog<span class="token double-colon punctuation">::</span>level<span class="token double-colon punctuation">::</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>	_this<span class="token punctuation">.</span>file_logger<span class="token operator">-></span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=119></td><td><pre></pre></td></tr><tr><td data-num=120></td><td><pre><span class="token keyword">int</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token keyword">int</span> m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=121></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=123></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> n <span class="token operator">*=</span> n<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token keyword">return</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=126></td><td><pre></pre></td></tr><tr><td data-num=127></td><td><pre><span class="token keyword">int</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=128></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre>	<span class="token keyword">int</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>left<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=132></td><td><pre></pre></td></tr><tr><td data-num=133></td><td><pre>	right <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>right <span class="token operator">>=</span> left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=135></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token punctuation">(</span>strs<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>		ans <span class="token operator">=</span> <span class="token punctuation">(</span>temp <span class="token operator">*</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=138></td><td><pre>		<span class="token operator">--</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token keyword">return</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=142></td><td><pre></pre></td></tr><tr><td data-num=143></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">StartWith</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> buf<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> prefix<span class="token punctuation">,</span>size_t<span class="token operator">&amp;</span> index<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=144></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> prefix<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=147></td><td><pre>		index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=149></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=150></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre></pre></td></tr><tr><td data-num=152></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> prefix<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> prefix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=155></td><td><pre>			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=157></td><td><pre>		<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre>	index <span class="token operator">=</span> i<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=160></td><td><pre></pre></td></tr><tr><td data-num=161></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>httpserver.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;signal.h></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./mylibs.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_tcp/tcp.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_http/http.h"</span></span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>TcpStream server_tcp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">void</span> <span class="token function">ExitAction</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>	</pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token comment">// 屏蔽所有Linux信号</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">signal</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ExitAction<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 捕获Ctrl c中断 信号</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>ExitAction<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 捕获Kill命令 信号</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> server_tcp<span class="token punctuation">.</span><span class="token function">Construct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> server_tcp<span class="token punctuation">.</span><span class="token function">ToListen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">int</span> sock_fd <span class="token operator">=</span> server_tcp<span class="token punctuation">.</span>tcp_sock_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	size_t sock_addr_len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">int</span> accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> sock_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"main() => Waiting server connect..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=32></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"main() => Waiting server connect..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=33></td><td><pre>		accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sock_addr<span class="token punctuation">,</span><span class="token punctuation">(</span>socklen_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sock_addr_len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"main() => Server connected"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"main() => Server connected"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">HttpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight makefile"><figcaption data-lang=makefile><span>makefile</span></figcaption><table><tr><td data-num=1></td><td><pre>CP <span class="token operator">:=</span>g++</pre></td></tr><tr><td data-num=2></td><td><pre>AP1 <span class="token operator">:=</span>-Wall</pre></td></tr><tr><td data-num=3></td><td><pre>AP2 <span class="token operator">:=</span>-Wall -g</pre></td></tr><tr><td data-num=4></td><td><pre>STD <span class="token operator">:=</span>-std<span class="token operator">=</span>c++11</pre></td></tr><tr><td data-num=5></td><td><pre>DEBUG <span class="token operator">:=</span>-D _DEBUG -g</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment"># 头文件</span></pre></td></tr><tr><td data-num=7></td><td><pre>CPPFLAGS <span class="token operator">:=</span> -I/usr/<span class="token keyword">include</span>/mysql \</pre></td></tr><tr><td data-num=8></td><td><pre>			-I/usr/local/<span class="token keyword">include</span>/mysql++</pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment"># 库目录</span></pre></td></tr><tr><td data-num=10></td><td><pre>LDFLAGS <span class="token operator">:=</span> -L/usr/local/lib \</pre></td></tr><tr><td data-num=11></td><td><pre>			-L/usr/lib64/mysq</pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment"># 动态库文件</span></pre></td></tr><tr><td data-num=13></td><td><pre>LDLIBS <span class="token operator">:=</span> -lmysqlpp \</pre></td></tr><tr><td data-num=14></td><td><pre>		-lmysqlclient </pre></td></tr><tr><td data-num=15></td><td><pre>CPPMYSQL <span class="token operator">:=</span><span class="token variable">$</span><span class="token punctuation">(</span>CPPFLAGS<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>LDFAGS<span class="token punctuation">)</span> -lmysqlpp </pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token target symbol">all</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token target symbol">config</span><span class="token punctuation">:</span> ./_config/_config.* </pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> ./_config/_config.cc</pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token target symbol">mylibs</span><span class="token punctuation">:</span> ./_config/_config.* ./mylibs.*</pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> ./_config/_config.cc ./mylibs.cc </pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token target symbol">tcp</span><span class="token punctuation">:</span> ./_config/_config.* ./mylibs.* ./_tcp/tcp.* </pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> ./_config/_config.cc ./mylibs.cc \</pre></td></tr><tr><td data-num=27></td><td><pre>	./_tcp/tcp.cc </pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token target symbol">database</span><span class="token punctuation">:</span> ./_config/_config.* ./mylibs.* ./_database/db.*</pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPPMYSQL<span class="token punctuation">)</span> ./_config/_config.cc \</pre></td></tr><tr><td data-num=31></td><td><pre>	./mylibs.cc ./_database/db.cc</pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token target symbol">response</span><span class="token punctuation">:</span> ./_config/_config.* ./mylibs.* ./_tcp/tcp.* \</pre></td></tr><tr><td data-num=34></td><td><pre>		./_database/db.* ./_http/_response.*</pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPPMYSQL<span class="token punctuation">)</span> ./_config/_config.cc \</pre></td></tr><tr><td data-num=36></td><td><pre>	./mylibs.cc ./_tcp/tcp.cc ./_database/db.cc \</pre></td></tr><tr><td data-num=37></td><td><pre>	./_http/_response.cc</pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token target symbol">http</span><span class="token punctuation">:</span> ./_config/_config.* ./mylibs.* ./_tcp/tcp.* \</pre></td></tr><tr><td data-num=40></td><td><pre>	./_database/db.* ./_http/_response.* ./_http/http.*  </pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPPMYSQL<span class="token punctuation">)</span> ./_config/_config.cc \</pre></td></tr><tr><td data-num=42></td><td><pre>	./mylibs.cc ./_tcp/tcp.cc ./_database/db.cc \</pre></td></tr><tr><td data-num=43></td><td><pre>	./_http/_response.cc ./_http/http.cc</pre></td></tr><tr><td data-num=44></td><td><pre></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token target symbol">httpserver</span><span class="token punctuation">:</span> ./_config/_config.* ./mylibs.* ./_tcp/tcp.* \</pre></td></tr><tr><td data-num=46></td><td><pre>			./_http/_response.* ./_http/http.* ./_database/db.* \</pre></td></tr><tr><td data-num=47></td><td><pre>			./_http/http.* ./httpserver.cc</pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token variable">$</span><span class="token punctuation">(</span>CP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>STD<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CPPMYSQL<span class="token punctuation">)</span> ./_config/_config.cc \</pre></td></tr><tr><td data-num=49></td><td><pre>	./mylibs.cc ./_tcp/tcp.cc ./_database/db.cc ./_http/_response.cc \</pre></td></tr><tr><td data-num=50></td><td><pre>	./_http/http.cc ./httpserver.cc -o httpserver</pre></td></tr><tr><td data-num=51></td><td><pre><span class="token comment">#	export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre><span class="token target symbol">openport</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=54></td><td><pre>	firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>80/tcp --permanent</pre></td></tr><tr><td data-num=55></td><td><pre></pre></td></tr><tr><td data-num=56></td><td><pre><span class="token target symbol">httpbuild</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=57></td><td><pre>	make clean &amp;&amp; make httpserver</pre></td></tr><tr><td data-num=58></td><td><pre></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token target symbol">httptest</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=60></td><td><pre>	make openport &amp;&amp; make clean &amp;&amp; make httpserver &amp;&amp; ./httpserver</pre></td></tr><tr><td data-num=61></td><td><pre></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token target symbol">clean</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num=63></td><td><pre>	rm -rf ./_config/_config.h.gch ./mylibs.h.gch ./_tcp/tcp.h.gch \</pre></td></tr><tr><td data-num=64></td><td><pre>	./_http/http.h.gch ./_http/_response.h.gch ./_database/db.h.gch \</pre></td></tr><tr><td data-num=65></td><td><pre>	./httpserver ./httpserver_log.log</pre></td></tr></table></figure></div></details><h2 id=适配gravatar头像><a class=anchor href=#适配gravatar头像>#</a> 适配Gravatar头像</h2><h3 id=目录结构><a class=anchor href=#目录结构>#</a> 目录结构</h3><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>httpserver</pre></td></tr><tr><td data-num=2></td><td><pre>├── _config</pre></td></tr><tr><td data-num=3></td><td><pre>│   ├── _config.cc</pre></td></tr><tr><td data-num=4></td><td><pre>│   ├── _config.h</pre></td></tr><tr><td data-num=5></td><td><pre>│   ├── _config.json</pre></td></tr><tr><td data-num=6></td><td><pre>│   └── json.hpp</pre></td></tr><tr><td data-num=7></td><td><pre>├── _database</pre></td></tr><tr><td data-num=8></td><td><pre>│   ├── db.cc</pre></td></tr><tr><td data-num=9></td><td><pre>│   └── db.h</pre></td></tr><tr><td data-num=10></td><td><pre>├── docs</pre></td></tr><tr><td data-num=11></td><td><pre>│   ├── css</pre></td></tr><tr><td data-num=12></td><td><pre>│   │   └── comments.css</pre></td></tr><tr><td data-num=13></td><td><pre>│   ├── index.html</pre></td></tr><tr><td data-num=14></td><td><pre>│   └── js</pre></td></tr><tr><td data-num=15></td><td><pre>│       └── comments.js</pre></td></tr><tr><td data-num=16></td><td><pre>├── _http</pre></td></tr><tr><td data-num=17></td><td><pre>│   ├── http.cc</pre></td></tr><tr><td data-num=18></td><td><pre>│   ├── http.h</pre></td></tr><tr><td data-num=19></td><td><pre>│   ├── _response.cc</pre></td></tr><tr><td data-num=20></td><td><pre>│   └── _response.h</pre></td></tr><tr><td data-num=21></td><td><pre>├── httpserver</pre></td></tr><tr><td data-num=22></td><td><pre>├── httpserver.cc</pre></td></tr><tr><td data-num=23></td><td><pre>├── makefile</pre></td></tr><tr><td data-num=24></td><td><pre>├── mylibs.cc</pre></td></tr><tr><td data-num=25></td><td><pre>├── mylibs.h</pre></td></tr><tr><td data-num=26></td><td><pre>└── _tcp</pre></td></tr><tr><td data-num=27></td><td><pre>    ├── tcp.cc</pre></td></tr><tr><td data-num=28></td><td><pre>    └── tcp.h</pre></td></tr></table></figure><h3 id=使用gravatar-api><a class=anchor href=#使用gravatar-api>#</a> 使用Gravatar API</h3><p>Gravatar头像API的使用方法为<code>https://gravatar.com/avatar/HASH</code>，HASH为邮箱的SHA256加密编码。</p><p><strong>前端部分</strong></p><p>使用第三方库<code>crypto-js</code>中的SHA256处理，在<code>./docs/index.html</code>的head部分中添加以下两个js文件。</p><figure class="highlight html"><figcaption data-lang=HTML></figcaption><table><tr><td data-num=1></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/core.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/sha256.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>修正<code>./docs/js/comments.js</code>的头像获取逻辑</p><figure class="highlight javascript"><figcaption data-lang=javascript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>url<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>		<span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>		<span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=6></td><td><pre>			_URL<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>				<span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>				<span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>					<span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>				<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=12></td><td><pre>				<span class="token literal-property property">body</span><span class="token operator">:</span> data<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token keyword">return</span> response<span class="token punctuation">.</span>ok<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>url</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>_URL<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">function</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span><span class="token parameter">textsLable<span class="token punctuation">,</span>cols</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token keyword">var</span> texts <span class="token operator">=</span> <span class="token punctuation">(</span>textsLable<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r|\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">var</span> textLength <span class="token operator">=</span> texts<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> textLength<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> cache<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token number">0</span> <span class="token operator">===</span> cache<span class="token punctuation">.</span>length <span class="token operator">%</span> cols<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>			cache <span class="token operator">+=</span> <span class="token string">"&lt;br/>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=42></td><td><pre>		cache <span class="token operator">+=</span> texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token keyword">return</span> cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token keyword">function</span> <span class="token function">avatarAppend</span><span class="token punctuation">(</span><span class="token parameter">main_label<span class="token punctuation">,</span>email_md5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token keyword">var</span> avatarLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	avatarLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"avatar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">var</span> imgUrl <span class="token operator">=</span> <span class="token string">"https://gravatar.com/avatar/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	avatarLable<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"&lt;img src=\""</span> <span class="token operator">+</span> imgUrl <span class="token operator">+</span> email_md5 <span class="token operator">+</span> <span class="token string">"\" alt>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	main_label<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>avatarLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token keyword">function</span> <span class="token function">commentAppend</span><span class="token punctuation">(</span><span class="token parameter">main_label<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token keyword">var</span> commentBoxLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>	authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>	authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> record<span class="token punctuation">.</span>nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token keyword">var</span> timeSpend <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token keyword">var</span> timeSpace <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> record<span class="token punctuation">.</span>create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>	<span class="token keyword">var</span> days <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">24</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>	<span class="token keyword">var</span> f_days <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token keyword">var</span> hours <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>	<span class="token keyword">var</span> f_hours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token keyword">var</span> minutes <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>	<span class="token keyword">var</span> f_minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_days<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_days <span class="token operator">+</span> <span class="token string">" days ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_hours <span class="token operator">+</span> <span class="token string">" hours ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=81></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_minutes <span class="token operator">+</span> <span class="token string">" minutes ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre></pre></td></tr><tr><td data-num=83></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpend<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>	<span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=87></td><td><pre></pre></td></tr><tr><td data-num=88></td><td><pre>	<span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-conten"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre></pre></td></tr><tr><td data-num=92></td><td><pre>	boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> record<span class="token punctuation">.</span>content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre></pre></td></tr><tr><td data-num=95></td><td><pre>	main_label<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=97></td><td><pre></pre></td></tr><tr><td data-num=98></td><td><pre><span class="token keyword">function</span> <span class="token function">contentAppend</span><span class="token punctuation">(</span><span class="token parameter">labels<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=99></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=100></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>	<span class="token keyword">var</span> userBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>userBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>	<span class="token keyword">var</span> mainUserLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre></pre></td></tr><tr><td data-num=106></td><td><pre>	mainUserLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"main-level clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre></pre></td></tr><tr><td data-num=108></td><td><pre>	<span class="token function">avatarAppend</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">,</span>record<span class="token punctuation">.</span>email_md5<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	<span class="token function">commentAppend</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">,</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	userBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token comment">/* state stretch */</span></pre></td></tr><tr><td data-num=113></td><td><pre>	<span class="token keyword">var</span> O_CBHeight <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token keyword">var</span> newHeight <span class="token operator">=</span> O_CBHeight <span class="token operator">+</span> <span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre></pre></td></tr><tr><td data-num=116></td><td><pre>	commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>	commentContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">-</span> <span class="token number">325</span> <span class="token operator">+</span>  <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=119></td><td><pre></pre></td></tr><tr><td data-num=120></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">buttonClick</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=121></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token keyword">var</span> inputArea <span class="token operator">=</span> labels<span class="token punctuation">.</span>inputArea<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token keyword">var</span> inputs <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token keyword">var</span> nickname_label <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token keyword">var</span> email_label <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre>	<span class="token keyword">var</span> email_md5 <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">SHA256</span><span class="token punctuation">(</span>email_label<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre>	<span class="token keyword">var</span> texts <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"textarea"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre>	<span class="token keyword">var</span> nicknameValue <span class="token operator">=</span> nickname_label<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> nicknameValue<span class="token punctuation">.</span>length<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=135></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token comment">/* current time */</span></pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token keyword">var</span> textsContent <span class="token operator">=</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span>texts<span class="token punctuation">,</span>texts<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=138></td><td><pre>		<span class="token keyword">var</span> curTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>		<span class="token keyword">var</span> data <span class="token operator">=</span> nicknameValue <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> email_label<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> email_md5 <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> curTime  <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> textsContent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre></pre></td></tr><tr><td data-num=141></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">==</span> <span class="token keyword">await</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token string">"/api"</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=142></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=143></td><td><pre>			commentContainer<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>			commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">"360px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=145></td><td><pre>			commentContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">"0px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre></pre></td></tr><tr><td data-num=147></td><td><pre>			<span class="token keyword">var</span> commentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre></pre></td></tr><tr><td data-num=149></td><td><pre>			commentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>			commentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre></pre></td></tr><tr><td data-num=152></td><td><pre>			labels<span class="token punctuation">.</span>commentList <span class="token operator">=</span> commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>			<span class="token function">commentPreShow</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>labels<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=156></td><td><pre></pre></td></tr><tr><td data-num=157></td><td><pre>	nickname_label<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>	email_label<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>	texts<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre></pre></td></tr><tr><td data-num=162></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commentPreShow</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=163></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=164></td><td><pre>	<span class="token keyword">var</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token string">"/database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre></pre></td></tr><tr><td data-num=166></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token keyword">var</span> data <span class="token operator">=</span> responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>	<span class="token keyword">var</span> newLabels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>	<span class="token keyword">var</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token keyword">var</span> array <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre></pre></td></tr><tr><td data-num=175></td><td><pre>	array<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=177></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=178></td><td><pre>		<span class="token keyword">var</span> sub <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token keyword">var</span> nickname <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>		<span class="token keyword">var</span> email <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>		<span class="token keyword">var</span> email_md5 <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token keyword">var</span> textsContent <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token keyword">var</span> create_at <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>		<span class="token keyword">var</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre></pre></td></tr><tr><td data-num=186></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=187></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=188></td><td><pre>			<span class="token keyword">const</span> c <span class="token operator">=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre></pre></td></tr><tr><td data-num=190></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">":"</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">4</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=191></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=192></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>				<span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=194></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=195></td><td><pre>					<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> nickname <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=196></td><td><pre>					<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> email <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=197></td><td><pre>					<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> email_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=198></td><td><pre>					<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=199></td><td><pre>					<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> textsContent <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=201></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=203></td><td><pre>		<span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token keyword">var</span> commentListFirstChild <span class="token operator">=</span> commentList<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre></pre></td></tr><tr><td data-num=206></td><td><pre>		newLabels<span class="token punctuation">.</span>commentContainer <span class="token operator">=</span> commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>		newLabels<span class="token punctuation">.</span>commentBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=208></td><td><pre>		newLabels<span class="token punctuation">.</span>userBlock <span class="token operator">=</span> userBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>		newLabels<span class="token punctuation">.</span>commentList <span class="token operator">=</span> commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre></pre></td></tr><tr><td data-num=211></td><td><pre>		record<span class="token punctuation">.</span>nickname <span class="token operator">=</span> nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre>		record<span class="token punctuation">.</span>email <span class="token operator">=</span> email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>		record<span class="token punctuation">.</span>email_md5 <span class="token operator">=</span> email_md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre>		record<span class="token punctuation">.</span>create_at <span class="token operator">=</span> create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre>		record<span class="token punctuation">.</span>content <span class="token operator">=</span> textsContent<span class="token punctuation">;</span>		</pre></td></tr><tr><td data-num=216></td><td><pre></pre></td></tr><tr><td data-num=217></td><td><pre>		<span class="token function">contentAppend</span><span class="token punctuation">(</span>newLabels<span class="token punctuation">,</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=218></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> commentListFirstChild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=219></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=220></td><td><pre>			commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>			commentList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=223></td><td><pre>		<span class="token keyword">else</span><span class="token punctuation">&#123;</span> commentList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>commentListFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=224></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=225></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=226></td><td><pre></pre></td></tr><tr><td data-num=227></td><td><pre>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=228></td><td><pre>	<span class="token keyword">const</span> _host <span class="token operator">=</span> <span class="token string">"192.168.80.143"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=229></td><td><pre>	<span class="token comment">/* class="comment-block" */</span></pre></td></tr><tr><td data-num=230></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=231></td><td><pre>	<span class="token keyword">var</span> inputBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span><span class="token comment">/* class="input-block" */</span></pre></td></tr><tr><td data-num=232></td><td><pre></pre></td></tr><tr><td data-num=233></td><td><pre>	<span class="token comment">/*** input-block ***/</span></pre></td></tr><tr><td data-num=234></td><td><pre>	<span class="token comment">/******************************/</span></pre></td></tr><tr><td data-num=235></td><td><pre>	<span class="token comment">/* class="input-area" */</span></pre></td></tr><tr><td data-num=236></td><td><pre>	<span class="token keyword">var</span> inputArea <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre>	<span class="token comment">/* class="text-block" */</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token keyword">var</span> buttonArea <span class="token operator">=</span> inputArea<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>	<span class="token comment">/* class="commit" */</span></pre></td></tr><tr><td data-num=240></td><td><pre>	<span class="token keyword">var</span> commitButton <span class="token operator">=</span> buttonArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token comment">/******************************/</span></pre></td></tr><tr><td data-num=242></td><td><pre></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token keyword">var</span> newlabels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre>	<span class="token comment">/* class="comment-container" */</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre></pre></td></tr><tr><td data-num=248></td><td><pre>	commentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>	commentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>	</pre></td></tr><tr><td data-num=251></td><td><pre>	newlabels<span class="token punctuation">.</span>commentContainer <span class="token operator">=</span> commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>	newlabels<span class="token punctuation">.</span>commentBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre>	newlabels<span class="token punctuation">.</span>commentList <span class="token operator">=</span> commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=254></td><td><pre>	newlabels<span class="token punctuation">.</span>inputArea <span class="token operator">=</span> inputArea<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre></pre></td></tr><tr><td data-num=256></td><td><pre>	<span class="token function">commentPreShow</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span>newlabels<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=257></td><td><pre>	commitButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=258></td><td><pre>		<span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=259></td><td><pre>		<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">buttonClick</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span>newlabels<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=260></td><td><pre>		<span class="token boolean">false</span></pre></td></tr><tr><td data-num=261></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=262></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>修正<code>./docs/css/comments.css</code>的头像框样式</p><figure class="highlight css"><figcaption data-lang=CSS></figcaption><table><tr><td data-num=1></td><td><pre><span class="token selector">body,</span></pre></td></tr><tr><td data-num=2></td><td><pre>#comment-block,</pre></td></tr><tr><td data-num=3></td><td><pre>#comment-block input,</pre></td></tr><tr><td data-num=4></td><td><pre>#comment-block textarea,</pre></td></tr><tr><td data-num=5></td><td><pre>#comment-block button,</pre></td></tr><tr><td data-num=6></td><td><pre>#comment-block ul,</pre></td></tr><tr><td data-num=7></td><td><pre>#comment-block li<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">,</span>Helvetica<span class="token punctuation">,</span>sans-serif<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token selector">#comment-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment">/* input area part  start-area*/</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token selector">#comment-block .input-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 306px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token selector">#comment-block .input-block .input-area</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token selector">#comment-block .input-block .input-area .nickname</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 161px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 2px solid #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre><span class="token selector">#comment-block .input-block .input-area .email</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=55></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 345px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    <span class="token property">padding-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token selector">#comment-block .input-block .input-area .text-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=63></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 231px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>    <span class="token property">border-top</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>    <span class="token property">padding-top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>    <span class="token property">resize</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre></pre></td></tr><tr><td data-num=72></td><td><pre><span class="token selector">#comment-block .input-block .button-area .commit</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=73></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> .3rem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #eff2f3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 2.8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>    <span class="token property">line-height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token comment">/* input area part  end-area*/</span></pre></td></tr><tr><td data-num=84></td><td><pre></pre></td></tr><tr><td data-num=85></td><td><pre></pre></td></tr><tr><td data-num=86></td><td><pre><span class="token comment">/* comment show area */</span></pre></td></tr><tr><td data-num=87></td><td><pre><span class="token selector">#comment-block .comment-container</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=88></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=96></td><td><pre></pre></td></tr><tr><td data-num=97></td><td><pre><span class="token selector">#comment-block .comment-container .info</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=98></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #283035<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>    <span class="token property">font-weight</span><span class="token punctuation">:</span> 400<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=103></td><td><pre></pre></td></tr><tr><td data-num=104></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=105></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=106></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=107></td><td><pre></pre></td></tr><tr><td data-num=108></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=109></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 50px<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 45px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 29px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=117></td><td><pre></pre></td></tr><tr><td data-num=118></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::after</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=119></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>    <span class="token property">bottom</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 3px solid #dee1e3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=129></td><td><pre></pre></td></tr><tr><td data-num=130></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=131></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre>    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=135></td><td><pre></pre></td></tr><tr><td data-num=136></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li::after</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=137></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=138></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=143></td><td><pre></pre></td></tr><tr><td data-num=144></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level::after</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=145></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=151></td><td><pre></pre></td></tr><tr><td data-num=152></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=153></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 3px solid #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 2px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=162></td><td><pre></pre></td></tr><tr><td data-num=163></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar img</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=164></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=170></td><td><pre></pre></td></tr><tr><td data-num=171></td><td><pre><span class="token comment">/* comment box of coment area start-area */</span></pre></td></tr><tr><td data-num=172></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=173></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 465px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 1px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.15<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=178></td><td><pre></pre></td></tr><tr><td data-num=179></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=180></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=181></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>    <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=191></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=192></td><td><pre></pre></td></tr><tr><td data-num=193></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=194></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=197></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=198></td><td><pre></pre></td></tr><tr><td data-num=199></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=200></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=201></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=208></td><td><pre>    <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=212></td><td><pre></pre></td></tr><tr><td data-num=213></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=214></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=216></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=217></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=218></td><td><pre></pre></td></tr><tr><td data-num=219></td><td><pre><span class="token comment">/* comment box head area start-area */</span></pre></td></tr><tr><td data-num=220></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=221></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #E5E5E5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=224></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px 4px 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=226></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=227></td><td><pre></pre></td></tr><tr><td data-num=228></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=229></td><td><pre>.cbauthor-name<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=230></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=231></td><td><pre>    <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #283035<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=233></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=234></td><td><pre>    <span class="token property">font-weight</span><span class="token punctuation">:</span> 700<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=236></td><td><pre></pre></td></tr><tr><td data-num=237></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=238></td><td><pre>span<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=239></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=241></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=245></td><td><pre><span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=246></td><td><pre></pre></td></tr><tr><td data-num=247></td><td><pre><span class="token comment">/* comment box content area start-area */</span></pre></td></tr><tr><td data-num=248></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-content</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=249></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 0 0 4px 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #595959<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=254></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=256></td><td><pre><span class="token comment">/* comment box content area end-area */</span></pre></td></tr><tr><td data-num=257></td><td><pre><span class="token comment">/* comment box of coment area end-area */</span></pre></td></tr></table></figure><p><strong>后端部分</strong></p><p>由于前端的gravatar头像需要邮箱的SHA256编码，故需改变数据库的表结构。</p><details class=info><summary>./_database</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>db.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql++/mysql++.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">// 表记录中一行的数据，处理表名</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Record</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	std<span class="token double-colon punctuation">::</span>string email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	std<span class="token double-colon punctuation">::</span>string email_md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	std<span class="token double-colon punctuation">::</span>string create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	std<span class="token double-colon punctuation">::</span>string content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DataBase</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=18></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Connection conn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	std<span class="token double-colon punctuation">::</span>string table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	std<span class="token double-colon punctuation">::</span>string db_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">table_isnull</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>Connection<span class="token operator">&amp;</span> connector<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> db_name<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> table_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 链接数据库</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录插入</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录读取</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>db.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"db.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">table_isnull</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>Connection<span class="token operator">&amp;</span> connector<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> db_name<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> table_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> connector<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	</pre></td></tr><tr><td data-num=8></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">"SELECT COUNT(*) FROM information_schema.tables"</span></pre></td></tr><tr><td data-num=9></td><td><pre>			<span class="token string">" WHERE table_schema = '"</span> <span class="token operator">+</span> db_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=10></td><td><pre>			<span class="token string">"' AND table_name = '"</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> <span class="token string">"';"</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=13></td><td><pre>		<span class="token string">"DataBase::table_isnull() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>		_sql</pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=17></td><td><pre>	</pre></td></tr><tr><td data-num=18></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>StoreQueryResult res <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=21></td><td><pre>			<span class="token string">"DataBase::table_isnull() => true"</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token string">"DataBase::table_isnull() => false"</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> db_config <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetDatabaseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token keyword">bool</span> db_connect <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=35></td><td><pre>		db_config<span class="token punctuation">.</span>database_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=36></td><td><pre>		db_config<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=37></td><td><pre>		db_config<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=38></td><td><pre>		db_config<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre></pre></td></tr><tr><td data-num=41></td><td><pre>	db_name <span class="token operator">=</span> db_config<span class="token punctuation">.</span>database_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	table_name <span class="token operator">=</span> db_config<span class="token punctuation">.</span>table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> db_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=46></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=47></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=48></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=50></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=51></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=56></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre></pre></td></tr><tr><td data-num=64></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=65></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=67></td><td><pre>		mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>		std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre></pre></td></tr><tr><td data-num=70></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">table_isnull</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>db_name<span class="token punctuation">,</span>table_name<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=71></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			mysqlpp<span class="token double-colon punctuation">::</span>Query query_create <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"CREATE TABLE "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>			_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"("</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nNickName CHAR(64),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nEmail CHAR(64),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nEmailMd5 CHAR(65),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nCreateAt CHAR(16),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nContent TEXT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\n);"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre></pre></td></tr><tr><td data-num=83></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=84></td><td><pre>				<span class="token string">"DataBase::Connect() =>	query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=85></td><td><pre>				<span class="token string">"CREATE TABLE "</span> <span class="token operator">+</span> table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=86></td><td><pre>				<span class="token string">"("</span></pre></td></tr><tr><td data-num=87></td><td><pre>				<span class="token string">"\nNickName CHAR(64),"</span></pre></td></tr><tr><td data-num=88></td><td><pre>				<span class="token string">"\nEmail CHAR(64),"</span></pre></td></tr><tr><td data-num=89></td><td><pre>				<span class="token string">"\nEmailMd5 CHAR(65),"</span></pre></td></tr><tr><td data-num=90></td><td><pre>				<span class="token string">"\nCreateAt CHAR(16),"</span></pre></td></tr><tr><td data-num=91></td><td><pre>				<span class="token string">"\nContent TEXT"</span>	</pre></td></tr><tr><td data-num=92></td><td><pre>				<span class="token string">"\n);"</span>	</pre></td></tr><tr><td data-num=93></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>			query_create <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>			query_create<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>			_sql<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			</pre></td></tr><tr><td data-num=97></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=98></td><td><pre></pre></td></tr><tr><td data-num=99></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"INSERT INTO "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>		_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"(NickName,Email,EmailMd5,CreateAt,Content)\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"VALUES('"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>nickname <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>email <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>email_md5 <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=106></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>create_at <span class="token operator">+</span><span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"');"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=109></td><td><pre></pre></td></tr><tr><td data-num=110></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=112></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span> </pre></td></tr><tr><td data-num=113></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=114></td><td><pre>			<span class="token string">"(NickName,Email,EmailMd5,CreateAt,Content)\n"</span></pre></td></tr><tr><td data-num=115></td><td><pre>			<span class="token string">"VALUES('"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=116></td><td><pre>			record<span class="token operator">-></span>nickname <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=117></td><td><pre>			record<span class="token operator">-></span>email <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=118></td><td><pre>			record<span class="token operator">-></span>email_md5 <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=119></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=120></td><td><pre>			record<span class="token operator">-></span>content <span class="token operator">+</span> </pre></td></tr><tr><td data-num=121></td><td><pre>			<span class="token string">"');"</span></pre></td></tr><tr><td data-num=122></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=124></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span> </pre></td></tr><tr><td data-num=125></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=126></td><td><pre>			<span class="token string">"(NickName,Email,EmailMd5,CreateAt,Content)\n"</span></pre></td></tr><tr><td data-num=127></td><td><pre>			<span class="token string">"VALUES('"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=128></td><td><pre>			record<span class="token operator">-></span>nickname <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=129></td><td><pre>			record<span class="token operator">-></span>email <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=130></td><td><pre>			record<span class="token operator">-></span>email_md5 <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=131></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=132></td><td><pre>			record<span class="token operator">-></span>content <span class="token operator">+</span> </pre></td></tr><tr><td data-num=133></td><td><pre>			<span class="token string">"');"</span></pre></td></tr><tr><td data-num=134></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre></pre></td></tr><tr><td data-num=136></td><td><pre>		query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>		query<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">const</span> mysqlpp<span class="token double-colon punctuation">::</span>Exception<span class="token operator">&amp;</span> er<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=139></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=140></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=141></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=142></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=143></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=145></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=146></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=147></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=150></td><td><pre></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=152></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=153></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=156></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=160></td><td><pre></pre></td></tr><tr><td data-num=161></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=162></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=163></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=164></td><td><pre></pre></td></tr><tr><td data-num=165></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">table_isnull</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>db_name<span class="token punctuation">,</span>table_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=166></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=168></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre></pre></td></tr><tr><td data-num=170></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">"SELECT * FROM "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>	_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=175></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=176></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=177></td><td><pre>		<span class="token string">"SELECT * FROM "</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=178></td><td><pre>		table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=180></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token string">"SELECT * FROM "</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=184></td><td><pre>		table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=185></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre></pre></td></tr><tr><td data-num=188></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>StoreQueryResult res <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=190></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=191></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> row<span class="token operator">:</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=192></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>			Record<span class="token operator">*</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Record</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>			record<span class="token operator">-></span>nickname <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"NickName"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>			record<span class="token operator">-></span>email <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"Email"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>			record<span class="token operator">-></span>email_md5 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"EmailMd5"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=197></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"CreateAt"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=198></td><td><pre>			record<span class="token operator">-></span>content <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"Content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>			buf<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=205></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=206></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=207></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=208></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=210></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=211></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=212></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=215></td><td><pre></pre></td></tr><tr><td data-num=216></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=217></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=218></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=219></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=221></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=222></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=224></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h2 id=评论的回复系统的代码编写><a class=anchor href=#评论的回复系统的代码编写>#</a> 评论的回复系统的代码编写</h2><h3 id=评论的回复按钮前端样式><a class=anchor href=#评论的回复按钮前端样式>#</a> 评论的回复按钮前端样式</h3><h4 id=分离时间戳的处理代码><a class=anchor href=#分离时间戳的处理代码>#</a> 分离时间戳的处理代码</h4><figure class="highlight js"><figcaption data-lang=JavaScript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">function</span> <span class="token function">timestampTackle</span><span class="token punctuation">(</span><span class="token parameter">timeSpendLable<span class="token punctuation">,</span>create_at</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">const</span> timeSpace <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">const</span> days <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">24</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">const</span> f_days <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">const</span> hours <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">const</span> f_hours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">const</span> minutes <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token keyword">const</span> f_minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_days<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>f_days <span class="token operator">></span> <span class="token number">365</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>            <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeSpace<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>            <span class="token keyword">const</span> year <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>            <span class="token keyword">const</span> month <span class="token operator">=</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>            <span class="token keyword">const</span> day <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>            <span class="token keyword">const</span> format_time <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>year<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>month<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>day<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>            timeSpendLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> format_time<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> timeSpendLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_days <span class="token operator">+</span> <span class="token string">" 天前"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> timeSpendLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_hours <span class="token operator">+</span> <span class="token string">" 小时前"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span> timeSpendLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_minutes <span class="token operator">+</span> <span class="token string">" 分钟前"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token keyword">function</span> <span class="token function">commentAppend</span><span class="token punctuation">(</span><span class="token parameter">main_label<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token keyword">var</span> commentBoxLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>    authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> record<span class="token punctuation">.</span>nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token comment">/* timestamp transform into format time */</span></pre></td></tr><tr><td data-num=42></td><td><pre>    <span class="token keyword">var</span> timeSpendLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    <span class="token function">timestampTackle</span><span class="token punctuation">(</span>timeSpendLable<span class="token punctuation">,</span>record<span class="token punctuation">.</span>create_at<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre></pre></td></tr><tr><td data-num=45></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpendLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=50></td><td><pre></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=52></td><td><pre>    <span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>    boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-conten"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre>    boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> record<span class="token punctuation">.</span>content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre>    main_label<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=添加回复样式><a class=anchor href=#添加回复样式>#</a> 添加回复样式</h4><figure class="highlight js"><figcaption data-lang=JavaScript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">function</span> <span class="token function">commentAppend</span><span class="token punctuation">(</span><span class="token parameter">main_label<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>	<span class="token keyword">var</span> commentBoxLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token comment">/* nickname area */</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> record<span class="token punctuation">.</span>nick_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token comment">/* timestamp transform into format time */</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">var</span> timeSpendLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token function">timestampTackle</span><span class="token punctuation">(</span>timeSpendLable<span class="token punctuation">,</span>record<span class="token punctuation">.</span>create_at<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token comment">/* reply area */</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token keyword">var</span> replyLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	replyLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	replyLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"回复"</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpendLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>replyLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre>	boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> record<span class="token punctuation">.</span>content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>	main_label<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight css"><figcaption data-lang=CSS></figcaption><table><tr><td data-num=1></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=2></td><td><pre>.reply<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token property">margin-left</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #e9546b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token property">-webkit-transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token property">-o-transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token property">transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=15></td><td><pre>.reply:hover<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #03658c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=重构数据库的表><a class=anchor href=#重构数据库的表>#</a> 重构数据库的表</h3><table><thead><tr><th>id</th><th>parent_id</th><th>response_id</th><th>nick_name</th><th>mail</th><th>mail_md5</th><th>create_at</th><th>comment</th></tr></thead></table><ul><li>id - 评论唯一标识，作主键</li><li>parent_id - 回复评论所在的父评论</li><li>response_id - 回复评论所回复的评论id</li><li>nick_name - 用户昵称</li><li>mail - 用户邮件</li><li>mail_md5 - SHA256加密邮件的编码</li><li>create_at - 评论创建时间</li><li>comment - 评论内容</li></ul><p>由于之前的表结构以不能支持评论的回复系统，这里便重构了数据库的表结构，参考了minivaline数据库表布局。</p><p>所有评论储存在一张表中。</p><p>id的增长目前以当前评论在数据库中是第几条记录来定。</p><h3 id=回复评论的原理><a class=anchor href=#回复评论的原理>#</a> 回复评论的原理</h3><p>由主界面的评论输入区而产生的评论，称为主线评论，由评论回复功能的评论输入区而产生的评论，称为主线子评论。主线评论只有索引id，而主线子评论有索引id、主线评论id和回复对象id，这里的索引id称为id，主线评论id称为parent_id，回复对象id称为response_id。</p><p>主线子评论通过回复按钮的html标签上绑定的主线评论id，可获取到当前主线子评论所回复对象的response_id。当主线子评论回复时，便会向上迭代寻找主线评论的id，之后会将当前所获取的主线评论id和回复对象的id，即parent_id与response_id，存储到服务器上的数据库中。当显示评论时，数据库中同时没有parent_id和response_id的记录将会以主线评论的形式展示，而既有parent_id和response_id的记录会在前端向后端获取数据时，通过获取的parent_id来索引到主线评论的位置，之后再将该主线子评论添加到索引的位置，最终主线子评论便以主线评论的下级形式而展示了。</p><h3 id=变更后端与前端的数据格式接收内容><a class=anchor href=#变更后端与前端的数据格式接收内容>#</a> 变更后端与前端的数据格式接收内容</h3><p>由于数据库的表的结构的变动，数据传输的内容发生了变化。</p><details class=info><summary>后端部分</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>./_database/db.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql++/mysql++.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">// 表记录中一行的数据，处理表名</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Record</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	std<span class="token double-colon punctuation">::</span>string parent_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	std<span class="token double-colon punctuation">::</span>string response_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	std<span class="token double-colon punctuation">::</span>string nick_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	std<span class="token double-colon punctuation">::</span>string mail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	std<span class="token double-colon punctuation">::</span>string mail_md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	std<span class="token double-colon punctuation">::</span>string create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	std<span class="token double-colon punctuation">::</span>string comment<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DataBase</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=21></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Connection conn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	std<span class="token double-colon punctuation">::</span>string table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	std<span class="token double-colon punctuation">::</span>string db_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">TableCount</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>Connection<span class="token operator">&amp;</span> connector<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> db_name<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> table_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 链接数据库</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录插入</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录读取</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_database/db.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"db.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">int</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableCount</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>Connection<span class="token operator">&amp;</span> connector<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> db_name<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> table_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> connector<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	</pre></td></tr><tr><td data-num=8></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">"SELECT COUNT(*) FROM information_schema.tables"</span></pre></td></tr><tr><td data-num=9></td><td><pre>			<span class="token string">" WHERE table_schema = '"</span> <span class="token operator">+</span> db_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=10></td><td><pre>			<span class="token string">"' AND table_name = '"</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> <span class="token string">"';"</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=13></td><td><pre>		<span class="token string">"DataBase::TableCount() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>		_sql</pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> db_config <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetDatabaseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token keyword">bool</span> db_connect <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=25></td><td><pre>		db_config<span class="token punctuation">.</span>database_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>		db_config<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=27></td><td><pre>		db_config<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=28></td><td><pre>		db_config<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre>	db_name <span class="token operator">=</span> db_config<span class="token punctuation">.</span>database_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	table_name <span class="token operator">=</span> db_config<span class="token punctuation">.</span>table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> db_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=40></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=46></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=49></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">TableCount</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>db_name<span class="token punctuation">,</span>table_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> count<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=62></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=63></td><td><pre>			mysqlpp<span class="token double-colon punctuation">::</span>Query query_create <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre></pre></td></tr><tr><td data-num=65></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=66></td><td><pre>				<span class="token string">"DataBase::TableInsert => Table is NULL"</span></pre></td></tr><tr><td data-num=67></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"CREATE TABLE "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>			_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"("</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nid CHAR(8) PRIMARY KEY,"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nparent_id CHAR(8),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nresponse_id CHAR(8),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nnick_name CHAR(64),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nmail CHAR(64),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nmail_md5 CHAR(65),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\ncreate_at CHAR(16),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\ncomment TEXT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\n);"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre></pre></td></tr><tr><td data-num=81></td><td><pre>			query_create <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>			query_create<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>			_sql<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			</pre></td></tr><tr><td data-num=84></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=85></td><td><pre></pre></td></tr><tr><td data-num=86></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"INSERT INTO "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>		_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"(id,parent_id,response_id,nick_name,mail,mail_md5,create_at,comment)\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"VALUES('"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>		_sql <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>create_at <span class="token operator">+</span><span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>comment<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"');"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=99></td><td><pre></pre></td></tr><tr><td data-num=100></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=101></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=102></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span> </pre></td></tr><tr><td data-num=103></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=104></td><td><pre>			<span class="token string">"(id,parent_id,response_id,nick_name,mail,mail_md5,create_at,comment)\n"</span>	</pre></td></tr><tr><td data-num=105></td><td><pre>			<span class="token string">"VALUES('"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=106></td><td><pre>			std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=107></td><td><pre>			<span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=108></td><td><pre>			<span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=109></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=110></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=111></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=112></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=113></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">+</span> </pre></td></tr><tr><td data-num=114></td><td><pre>			<span class="token string">"');"</span></pre></td></tr><tr><td data-num=115></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=117></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span> </pre></td></tr><tr><td data-num=118></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=119></td><td><pre>			<span class="token string">"(id,parent_id,response_id,nick_name,mail,mail_md5,create_at,comment)\n"</span>	</pre></td></tr><tr><td data-num=120></td><td><pre>			<span class="token string">"VALUES('"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=121></td><td><pre>			std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=122></td><td><pre>			<span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=123></td><td><pre>			<span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=124></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=125></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=126></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=127></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=128></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">+</span> </pre></td></tr><tr><td data-num=129></td><td><pre>			<span class="token string">"');"</span></pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre></pre></td></tr><tr><td data-num=132></td><td><pre>		query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre>		query<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">const</span> mysqlpp<span class="token double-colon punctuation">::</span>Exception<span class="token operator">&amp;</span> er<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=135></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=137></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=138></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=139></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=141></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=142></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=143></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=146></td><td><pre></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=148></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=149></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=156></td><td><pre></pre></td></tr><tr><td data-num=157></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=158></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=159></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre></pre></td></tr><tr><td data-num=161></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">TableCount</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>db_name<span class="token punctuation">,</span>table_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=162></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre></pre></td></tr><tr><td data-num=166></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">"SELECT * FROM "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>	_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre></pre></td></tr><tr><td data-num=170></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=171></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=173></td><td><pre>		<span class="token string">"SELECT * FROM "</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=174></td><td><pre>		table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=175></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=176></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=178></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token string">"SELECT * FROM "</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=180></td><td><pre>		table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=181></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=182></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre></pre></td></tr><tr><td data-num=184></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>StoreQueryResult res <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=187></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> row<span class="token operator">:</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=188></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=189></td><td><pre>			Record<span class="token operator">*</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Record</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre>			record<span class="token operator">-></span>id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=191></td><td><pre>			record<span class="token operator">-></span>parent_id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"parent_id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>			record<span class="token operator">-></span>response_id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"response_id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"nick_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"mail"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"mail_md5"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"create_at"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=197></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"comment"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=198></td><td><pre>			buf<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=203></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=205></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=206></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=207></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=208></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=209></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=210></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=211></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=214></td><td><pre></pre></td></tr><tr><td data-num=215></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=216></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=217></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=218></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=220></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=221></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_http/_response.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_response.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>RequestMethodType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> method_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> method_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _get <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _post <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _put <span class="token operator">=</span> <span class="token string">"PUT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _delete <span class="token operator">=</span> <span class="token string">"DELETE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _head <span class="token operator">=</span> <span class="token string">"HEAD"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _options <span class="token operator">=</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _patch <span class="token operator">=</span> <span class="token string">"PATCH"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _connect <span class="token operator">=</span> <span class="token string">"CONNECT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _trace <span class="token operator">=</span> <span class="token string">"TRACE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>method_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_get <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_get<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_post <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_post<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_put <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_put<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_delete <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_delete<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_head <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_head<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_options <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_options<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_patch <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_patch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_connect <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_connect<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_trace <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_trace<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span>buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=39></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=40></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => GET"</span></pre></td></tr><tr><td data-num=41></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => GET"</span></pre></td></tr><tr><td data-num=44></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_GET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=50></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=51></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PUT"</span></pre></td></tr><tr><td data-num=52></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=54></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PUT"</span></pre></td></tr><tr><td data-num=55></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PUT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=63></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=64></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=65></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=66></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => POST"</span></pre></td></tr><tr><td data-num=67></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=68></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=69></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => POST"</span></pre></td></tr><tr><td data-num=70></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=71></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_POST<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=73></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=74></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=75></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=76></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=77></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => HEAD"</span></pre></td></tr><tr><td data-num=78></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=79></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=80></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => HEAD"</span></pre></td></tr><tr><td data-num=81></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=82></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_HEAD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=87></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=88></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=89></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=90></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=91></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=92></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PATCH"</span></pre></td></tr><tr><td data-num=93></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=94></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=95></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PATCH"</span></pre></td></tr><tr><td data-num=96></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=97></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PATCH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=99></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=100></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=101></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=102></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=103></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => TRACE"</span></pre></td></tr><tr><td data-num=104></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=105></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=106></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => TRACE"</span></pre></td></tr><tr><td data-num=107></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=108></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_TRACE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=112></td><td><pre>		<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=114></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=115></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=116></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=117></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=118></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => DELETE"</span></pre></td></tr><tr><td data-num=119></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=120></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=121></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => DELETE"</span></pre></td></tr><tr><td data-num=122></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=123></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_DELETE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=125></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=128></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=129></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=130></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=131></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=132></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=133></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => OPTIONS"</span></pre></td></tr><tr><td data-num=134></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=135></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=136></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => OPTIONS"</span></pre></td></tr><tr><td data-num=137></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_OPTIONS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=140></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=141></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=142></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=143></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=144></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => CONNECT"</span></pre></td></tr><tr><td data-num=145></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=146></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=147></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => CONNECT"</span></pre></td></tr><tr><td data-num=148></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=149></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_CONNECT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=151></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetMethodType() => UNKNOW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetMethodType() => UNKNOW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre></pre></td></tr><tr><td data-num=160></td><td><pre>RequestFileType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=161></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=162></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> filename_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre></pre></td></tr><tr><td data-num=165></td><td><pre>	std<span class="token double-colon punctuation">::</span>string type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=169></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> filename_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'.'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> type<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=171></td><td><pre>		<span class="token keyword">else</span><span class="token punctuation">&#123;</span> type <span class="token operator">+=</span> ch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=172></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=173></td><td><pre></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=175></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=176></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _html <span class="token operator">=</span> <span class="token string">"HTML"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _js <span class="token operator">=</span> <span class="token string">"JS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _css <span class="token operator">=</span> <span class="token string">"CSS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _png <span class="token operator">=</span> <span class="token string">"PNG"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>		<span class="token keyword">const</span> size_t type_len <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> type_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=184></td><td><pre>			<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>type<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_html <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_html <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_html<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=186></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_js <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_js <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_js<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=187></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_css <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_css <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_css<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=188></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_png <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_png <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_png<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_html<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=192></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=194></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=195></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => HTML"</span></pre></td></tr><tr><td data-num=196></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=197></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=198></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => HTML"</span></pre></td></tr><tr><td data-num=199></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=200></td><td><pre>			<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_HTML<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre></pre></td></tr><tr><td data-num=203></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_js<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=205></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=206></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=207></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => CSS"</span></pre></td></tr><tr><td data-num=208></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=209></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=210></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => CSS"</span></pre></td></tr><tr><td data-num=211></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=212></td><td><pre>			<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_JS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=214></td><td><pre></pre></td></tr><tr><td data-num=215></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> type_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=217></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_css<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=218></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=219></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=220></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=221></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => JS"</span></pre></td></tr><tr><td data-num=222></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=223></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=224></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => JS"</span></pre></td></tr><tr><td data-num=225></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=226></td><td><pre>				<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_CSS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=228></td><td><pre></pre></td></tr><tr><td data-num=229></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_png<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=230></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=231></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=232></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=233></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => PNG"</span></pre></td></tr><tr><td data-num=234></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=236></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => PNG"</span></pre></td></tr><tr><td data-num=237></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>				<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_PNG<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=240></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=244></td><td><pre>		<span class="token string">"TcpResponse::GetFileType() => UNKNOW"</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=247></td><td><pre>		<span class="token string">"TcpResponse::GetFileType() => UNKNOW"</span></pre></td></tr><tr><td data-num=248></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>	<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=251></td><td><pre></pre></td></tr><tr><td data-num=252></td><td><pre>RequestPathType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=253></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=254></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> path_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_NORMAL<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=256></td><td><pre></pre></td></tr><tr><td data-num=257></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> db <span class="token operator">=</span> <span class="token string">"DATABASE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> api <span class="token operator">=</span> <span class="token string">"API"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre></pre></td></tr><tr><td data-num=260></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=261></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=262></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>path_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>db <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>db <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>db<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=264></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>api <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>api <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>api<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=265></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=266></td><td><pre></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>db<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=268></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=269></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=270></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=272></td><td><pre>		<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=273></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=274></td><td><pre></pre></td></tr><tr><td data-num=275></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>api<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=276></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=277></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=278></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=279></td><td><pre>			<span class="token string">"TcpResponse::GetPathType() => API"</span></pre></td></tr><tr><td data-num=280></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=282></td><td><pre>			<span class="token string">"TcpResponse::GetPathType() => API"</span></pre></td></tr><tr><td data-num=283></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>		<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_API<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=285></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=286></td><td><pre></pre></td></tr><tr><td data-num=287></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=288></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=289></td><td><pre>		<span class="token string">"TcpResponse::GetPathType() => NORMAL"</span></pre></td></tr><tr><td data-num=290></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=291></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=292></td><td><pre>		<span class="token string">"TcpResponse::GetPathType() => NORMAL"</span></pre></td></tr><tr><td data-num=293></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=294></td><td><pre>	<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_NORMAL<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=295></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=296></td><td><pre></pre></td></tr><tr><td data-num=297></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=298></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=299></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=300></td><td><pre></pre></td></tr><tr><td data-num=301></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=302></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=303></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 400 BAD REQUEST\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=304></td><td><pre></pre></td></tr><tr><td data-num=305></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=306></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=307></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=308></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=309></td><td><pre>			<span class="token string">"TcpResponse::Response400() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=310></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=311></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=312></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=313></td><td><pre>			<span class="token string">"TcpResponse::Response400() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=314></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=315></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=316></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=317></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=318></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=319></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=320></td><td><pre>		<span class="token string">"TcpResponse::Response400() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=321></td><td><pre>		buf</pre></td></tr><tr><td data-num=322></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=323></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=324></td><td><pre>		<span class="token string">"TcpResponse::Response400() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=325></td><td><pre>		buf</pre></td></tr><tr><td data-num=326></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=327></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=328></td><td><pre></pre></td></tr><tr><td data-num=329></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=330></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=331></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=332></td><td><pre></pre></td></tr><tr><td data-num=333></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=334></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=335></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 404 NOT FOUND\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=336></td><td><pre></pre></td></tr><tr><td data-num=337></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=338></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=339></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=340></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=341></td><td><pre>			<span class="token string">"TcpResponse::Response404() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=342></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=343></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=344></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=345></td><td><pre>			<span class="token string">"TcpResponse::Response404() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=346></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=347></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=348></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=349></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=350></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=351></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=352></td><td><pre>		<span class="token string">"TcpResponse::Response404() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=353></td><td><pre>		buf</pre></td></tr><tr><td data-num=354></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=355></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=356></td><td><pre>		<span class="token string">"TcpResponse::Response404() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=357></td><td><pre>		buf </pre></td></tr><tr><td data-num=358></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=359></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=360></td><td><pre></pre></td></tr><tr><td data-num=361></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=362></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=363></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=364></td><td><pre></pre></td></tr><tr><td data-num=365></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=366></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=367></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=368></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=369></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=370></td><td><pre></pre></td></tr><tr><td data-num=371></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=372></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=373></td><td><pre>		<span class="token comment">// log....</span></pre></td></tr><tr><td data-num=374></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=375></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=376></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=377></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=378></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=379></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=380></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=381></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=382></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=383></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=384></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=385></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=386></td><td><pre>		<span class="token string">"TcpResponse::Response200_NF() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=387></td><td><pre>		buf</pre></td></tr><tr><td data-num=388></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=389></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=390></td><td><pre>		<span class="token string">"TcpResponse::Response200_NF() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=391></td><td><pre>		buf</pre></td></tr><tr><td data-num=392></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=393></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=394></td><td><pre></pre></td></tr><tr><td data-num=395></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=396></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=397></td><td><pre>	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span> records<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=398></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=399></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=400></td><td><pre>	std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=401></td><td><pre></pre></td></tr><tr><td data-num=402></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=403></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=404></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=405></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=406></td><td><pre></pre></td></tr><tr><td data-num=407></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=408></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=409></td><td><pre>		<span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=410></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=411></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=412></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">GetTableRecord</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=413></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=414></td><td><pre>		<span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=415></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=416></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=417></td><td><pre></pre></td></tr><tr><td data-num=418></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> r<span class="token operator">:</span> records<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=419></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=420></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=421></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>parent_id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=422></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>response_id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=423></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=424></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=425></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=426></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=427></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>comment <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=428></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=429></td><td><pre></pre></td></tr><tr><td data-num=430></td><td><pre>	<span class="token keyword">const</span> size_t bodyLen <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=431></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=432></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=433></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=434></td><td><pre></pre></td></tr><tr><td data-num=435></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=436></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=437></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=438></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=439></td><td><pre>			<span class="token string">"TcpResponse::Response200_DB() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=440></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=441></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=442></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=443></td><td><pre>			<span class="token string">"TcpResponse::Response200_DB() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=444></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=445></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=446></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=447></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=448></td><td><pre></pre></td></tr><tr><td data-num=449></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=450></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=451></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=452></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=453></td><td><pre>			<span class="token comment">// log...	</span></pre></td></tr><tr><td data-num=454></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=455></td><td><pre>				<span class="token string">"TcpResponse::Response200_DB() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=456></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=457></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=458></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=459></td><td><pre>				<span class="token string">"TcpResponse::Response200_DB() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=460></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=461></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=462></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=463></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=464></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=465></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=466></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=467></td><td><pre>		<span class="token string">"TcpResponse::Response200_DB() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=468></td><td><pre>		buf</pre></td></tr><tr><td data-num=469></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=470></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=471></td><td><pre>		<span class="token string">"TcpResponse::Response200_DB() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=472></td><td><pre>		buf</pre></td></tr><tr><td data-num=473></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=474></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=475></td><td><pre></pre></td></tr><tr><td data-num=476></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> off_t f_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=477></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=478></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=479></td><td><pre></pre></td></tr><tr><td data-num=480></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=481></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=482></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=483></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=484></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=485></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=486></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_HTML<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=487></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_CSS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=488></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_JS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=489></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_PNG<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=490></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=491></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=492></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=493></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=494></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=495></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=496></td><td><pre></pre></td></tr><tr><td data-num=497></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=498></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=499></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=500></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=501></td><td><pre>			<span class="token string">"TcpResponse::Response200() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=502></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=503></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=504></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=505></td><td><pre>			<span class="token string">"TcpResponse::Response200() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=506></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=507></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=508></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=509></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=510></td><td><pre>	std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">resource</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=511></td><td><pre></pre></td></tr><tr><td data-num=512></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resource<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=513></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=514></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=515></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=516></td><td><pre>			<span class="token string">"HttpServer::Response200() => file open fail"</span></pre></td></tr><tr><td data-num=517></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=518></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=519></td><td><pre>			<span class="token string">"HttpServer::Response200() => file open fail"</span></pre></td></tr><tr><td data-num=520></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=521></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=522></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=523></td><td><pre></pre></td></tr><tr><td data-num=524></td><td><pre>	<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=525></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=526></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=527></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=528></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=529></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=530></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=531></td><td><pre>				<span class="token string">"HttpServer::Response200() => file read fail"</span></pre></td></tr><tr><td data-num=532></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=533></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=534></td><td><pre>				<span class="token string">"HttpServer::Response200() => file read fail"</span></pre></td></tr><tr><td data-num=535></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=536></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=537></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=538></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=539></td><td><pre>		</pre></td></tr><tr><td data-num=540></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=541></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=542></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=543></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=544></td><td><pre>			<span class="token string">"HttpServer::Response200() => End of reading file"</span></pre></td></tr><tr><td data-num=545></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=546></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=547></td><td><pre>			<span class="token string">"HttpServer::Response200() => End of reading file"</span></pre></td></tr><tr><td data-num=548></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=549></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=550></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=551></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=552></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=553></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=554></td><td><pre>			<span class="token string">"HttpServer::Response200() => I/O error when reading"</span></pre></td></tr><tr><td data-num=555></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=556></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=557></td><td><pre>			<span class="token string">"HttpServer::Response200() => I/O error when reading"</span></pre></td></tr><tr><td data-num=558></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=559></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=560></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=561></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=562></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=563></td><td><pre>		<span class="token string">"TcpResponse::Response200() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=564></td><td><pre>		buf</pre></td></tr><tr><td data-num=565></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=566></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=567></td><td><pre>		<span class="token string">"TcpResponse::Response200() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=568></td><td><pre>		buf</pre></td></tr><tr><td data-num=569></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=570></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=571></td><td><pre></pre></td></tr><tr><td data-num=572></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=573></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=574></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetPathType</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=575></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=576></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=577></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_API<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=578></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num=579></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=580></td><td><pre>			std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=581></td><td><pre>			<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=582></td><td><pre></pre></td></tr><tr><td data-num=583></td><td><pre>			buf <span class="token operator">+=</span> <span class="token string">"./"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=584></td><td><pre>			buf <span class="token operator">+=</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetRootDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=585></td><td><pre>			buf <span class="token operator">+=</span> url_buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=586></td><td><pre></pre></td></tr><tr><td data-num=587></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=588></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=589></td><td><pre>				<span class="token string">"TcpResponse::ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=590></td><td><pre>				buf</pre></td></tr><tr><td data-num=591></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=592></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=593></td><td><pre>				<span class="token string">"TcpResponse::ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=594></td><td><pre>				buf</pre></td></tr><tr><td data-num=595></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=596></td><td><pre></pre></td></tr><tr><td data-num=597></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=598></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response200</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=599></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=600></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=601></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_http/http.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>std<span class="token double-colon punctuation">::</span>string <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token char">'/'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=11></td><td><pre>		url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'/'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> i <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token char">'\\'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>			url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		url <span class="token operator">+=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token string">"HttpServer::UrlFormat() => Format URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>		url</pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token string">"HttpServer::UrlFormat() => Format URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=30></td><td><pre>		url</pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">return</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">ReqContentReceive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>ReqContent<span class="token operator">*</span> req_content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=42></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>			<span class="token string">"HttpServer::ReqContentReceive() => TcpStream::StreamParse_Line() fail"</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=46></td><td><pre>			<span class="token string">"HttpServer::ReqContentReceive() => TcpStream::StreamParse_Line() fail"</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">&#125;</span>	</pre></td></tr><tr><td data-num=50></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>buf_len <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">char</span> bodyLen<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		req_content<span class="token operator">-></span>req_method <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		req_content<span class="token operator">-></span>req_url <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => \nRequest Header:"</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => \nRequest Header:"</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre></pre></td></tr><tr><td data-num=76></td><td><pre>		buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">StartWith</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length:"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=79></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=80></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">,</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=81></td><td><pre>				bodyLen<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>buf<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=88></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=89></td><td><pre>		<span class="token keyword">char</span> body_buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>		<span class="token comment">/* 读取body内容 */</span></pre></td></tr><tr><td data-num=91></td><td><pre>		buf_len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=92></td><td><pre>			sock_fd<span class="token punctuation">,</span>body_buf<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=93></td><td><pre>			<span class="token punctuation">(</span>size_t<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_stoi</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=94></td><td><pre>			<span class="token number">0</span></pre></td></tr><tr><td data-num=95></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=97></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=98></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=99></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=100></td><td><pre>				<span class="token string">"HttpServer::ReqContentReceive() => Receive Nothing body"</span></pre></td></tr><tr><td data-num=101></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=103></td><td><pre>				<span class="token string">"HttpServer::ReqContentReceive() => Receive Nothing body"</span></pre></td></tr><tr><td data-num=104></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token keyword">else</span></pre></td></tr><tr><td data-num=107></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=108></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=109></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=110></td><td><pre>				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre>				req_content<span class="token operator">-></span>req_body <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=117></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => Succeed"</span></pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=120></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => Succeed"</span></pre></td></tr><tr><td data-num=121></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=123></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=124></td><td><pre></pre></td></tr><tr><td data-num=125></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">BodyTackle</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">,</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=126></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token keyword">const</span> size_t n <span class="token operator">=</span> body_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=131></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=132></td><td><pre>			<span class="token string">"HttpServer::BodyTackle() => Receive Nothing Body"</span></pre></td></tr><tr><td data-num=133></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=135></td><td><pre>			<span class="token string">"HttpServer::BodyTackle() => Receive Nothing Body"</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=139></td><td><pre></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token keyword">int</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>parent_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>response_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>nick_name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>mail<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>mail_md5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>create_at<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>comment<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>	</pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">':'</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">7</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=155></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=156></td><td><pre>			<span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=157></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=158></td><td><pre>				<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre>				<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>parent_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=160></td><td><pre>				<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>response_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre>				<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>nick_name <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=162></td><td><pre>				<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>mail <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=163></td><td><pre>				<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>mail_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre>				<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=165></td><td><pre>				<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>comment <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=166></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=167></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=169></td><td><pre></pre></td></tr><tr><td data-num=170></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=171></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token string">"HttpServer::BodyTackle() => Succeed"</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=175></td><td><pre>		<span class="token string">"HttpServer::BodyTackle() => Succeed"</span></pre></td></tr><tr><td data-num=176></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=178></td><td><pre></pre></td></tr><tr><td data-num=179></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=180></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=183></td><td><pre></pre></td></tr><tr><td data-num=184></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=188></td><td><pre>		url <span class="token operator">+=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=193></td><td><pre>		<span class="token string">"HttpServer::GetMethod() => Request URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=194></td><td><pre>		url</pre></td></tr><tr><td data-num=195></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=197></td><td><pre>		<span class="token string">"HttpServer::GetMethod() => Request URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=198></td><td><pre>		url</pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"HttpServer::GetMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::GetMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=205></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=206></td><td><pre></pre></td></tr><tr><td data-num=207></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=208></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=209></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>	Record record<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>	<span class="token function">BodyTackle</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">,</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=214></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=215></td><td><pre>		<span class="token string">"HttpServer::PostMethod() => record:"</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token string">"\nid: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>id <span class="token operator">+</span></pre></td></tr><tr><td data-num=217></td><td><pre>		<span class="token string">"\nparent_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=218></td><td><pre>		<span class="token string">"\nresponse_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=219></td><td><pre>		<span class="token string">"\nnick_name: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=220></td><td><pre>		<span class="token string">"\nmail: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=221></td><td><pre>		<span class="token string">"\nmail_md5: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail_md5<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=222></td><td><pre>		<span class="token string">"\ncreate_at: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>create_at<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=223></td><td><pre>		<span class="token string">"\ncomment: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>comment</pre></td></tr><tr><td data-num=224></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=226></td><td><pre>		<span class="token string">"HttpServer::PostMethod() => record:"</span></pre></td></tr><tr><td data-num=227></td><td><pre>		<span class="token string">"\nid: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>id <span class="token operator">+</span></pre></td></tr><tr><td data-num=228></td><td><pre>		<span class="token string">"\nparent_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=229></td><td><pre>		<span class="token string">"\nresponse_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=230></td><td><pre>		<span class="token string">"\nnick_name: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=231></td><td><pre>		<span class="token string">"\nmail: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=232></td><td><pre>		<span class="token string">"\nmail_md5: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail_md5<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=233></td><td><pre>		<span class="token string">"\ncreate_at: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>create_at<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=234></td><td><pre>		<span class="token string">"\ncomment: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>comment</pre></td></tr><tr><td data-num=235></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre></pre></td></tr><tr><td data-num=237></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=239></td><td><pre>		<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	database<span class="token punctuation">.</span><span class="token function">TableInsert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre></pre></td></tr><tr><td data-num=244></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"HttpServer::PostMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::PostMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre></pre></td></tr><tr><td data-num=248></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token string">"api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=250></td><td><pre></pre></td></tr><tr><td data-num=251></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=252></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=253></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=254></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=255></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=256></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=257></td><td><pre>			<span class="token string">"HttpServer::Accept() => None apply socket"</span></pre></td></tr><tr><td data-num=258></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=259></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=260></td><td><pre>			<span class="token string">"HttpServer::Accept() => None apply socket"</span></pre></td></tr><tr><td data-num=261></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=262></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=264></td><td><pre>		</pre></td></tr><tr><td data-num=265></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">ReqContent</span> req_content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=266></td><td><pre></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>req_content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=268></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=269></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=270></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=271></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=272></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=273></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=274></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=275></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=276></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=277></td><td><pre>			<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=278></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=279></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=280></td><td><pre>				<span class="token string">"HttpServer::Accept() => Not support for current "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=281></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=282></td><td><pre>				<span class="token string">" request method"</span></pre></td></tr><tr><td data-num=283></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=285></td><td><pre>				<span class="token string">"HttpServer::Accept() => Not support for current "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=286></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=287></td><td><pre>				<span class="token string">" request method"</span></pre></td></tr><tr><td data-num=288></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=289></td><td><pre>			<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=290></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=291></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=292></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>前端部分</summary><div><figure class="highlight js"><figcaption data-lang=JavaScript><span>./docs/js/comments.js</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* ------------snip------------ */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commentPreShow</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>	<span class="token keyword">var</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token string">"/database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token keyword">var</span> data <span class="token operator">=</span> responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">var</span> newLabels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">var</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">var</span> array <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>	array<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token keyword">var</span> sub <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token keyword">var</span> parent_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token keyword">var</span> response_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token keyword">var</span> nick_name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">var</span> mail <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token keyword">var</span> mail_md5 <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token keyword">var</span> create_at <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token keyword">var</span> comment <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">var</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>			<span class="token keyword">const</span> c <span class="token operator">=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">":"</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">7</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=35></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>				<span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>					<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=39></td><td><pre>					<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> parent_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=40></td><td><pre>					<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> response_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=41></td><td><pre>					<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> nick_name <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=42></td><td><pre>					<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> mail <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre>					<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> mail_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=44></td><td><pre>					<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre>					<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> comment <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=48></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=49></td><td><pre>		<span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		<span class="token keyword">var</span> commentListFirstChild <span class="token operator">=</span> commentList<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre></pre></td></tr><tr><td data-num=52></td><td><pre>		newLabels<span class="token punctuation">.</span>commentContainer <span class="token operator">=</span> commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>		newLabels<span class="token punctuation">.</span>commentBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		newLabels<span class="token punctuation">.</span>userBlock <span class="token operator">=</span> userBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>		newLabels<span class="token punctuation">.</span>commentList <span class="token operator">=</span> commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre>		record<span class="token punctuation">.</span>nick_name <span class="token operator">=</span> nick_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		record<span class="token punctuation">.</span>mail <span class="token operator">=</span> mail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		record<span class="token punctuation">.</span>mail_md5 <span class="token operator">=</span> mail_md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>		record<span class="token punctuation">.</span>create_at <span class="token operator">=</span> create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>		record<span class="token punctuation">.</span>content <span class="token operator">=</span> comment<span class="token punctuation">;</span>		</pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token function">contentAppend</span><span class="token punctuation">(</span>newLabels<span class="token punctuation">,</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> commentListFirstChild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=65></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=66></td><td><pre>			commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>			commentList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=69></td><td><pre>		<span class="token keyword">else</span><span class="token punctuation">&#123;</span> commentList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>commentListFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre><span class="token comment">/* ------------snip------------ */</span></pre></td></tr></table></figure></div></details><h3 id=统计主评论条数><a class=anchor href=#统计主评论条数>#</a> 统计主评论条数</h3><p>当表中的parent_id与response_id同时为空时，则表示该评论为主评论并参与统计。</p><p>提交按钮每成功点击一次，主评论就加一。</p><details class=info><summary>前端</summary><div><figure class="highlight css"><figcaption data-lang=CSS><span>./docs/css/comments.css</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token selector">#comment-block,</span></pre></td></tr><tr><td data-num=2></td><td><pre>#comment-block *<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token property">-webkit-box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token property">-moz-box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token selector">#comment-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Roboto'</span><span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> Helvetica<span class="token punctuation">,</span> Sans-serif<span class="token punctuation">,</span> Verdana<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token comment">/* input area part  start-area */</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token selector">#comment-block .input-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 306px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token selector">#comment-block .input-block .input-area</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token selector">#comment-block .input-block .input-area .nickname</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 161px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 2px solid #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre><span class="token selector">#comment-block .input-block .input-area .email</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=55></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 345px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    <span class="token property">padding-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token selector">#comment-block .input-block .input-area .text-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=63></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 231px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>    <span class="token property">border-top</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>    <span class="token property">padding-top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>    <span class="token property">resize</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre></pre></td></tr><tr><td data-num=72></td><td><pre><span class="token selector">#comment-block .input-block .button-area .commit</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=73></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> .3rem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #eff2f3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>    <span class="token property">line-height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token selector">#comment-block .input-block .button-area .commit:hover</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=84></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #e9546b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #eff2f3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=87></td><td><pre><span class="token comment">/* input area part  end-area */</span></pre></td></tr><tr><td data-num=88></td><td><pre></pre></td></tr><tr><td data-num=89></td><td><pre></pre></td></tr><tr><td data-num=90></td><td><pre><span class="token comment">/* comment show area */</span></pre></td></tr><tr><td data-num=91></td><td><pre><span class="token selector">#comment-block .comment-container</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=92></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre>    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=100></td><td><pre></pre></td></tr><tr><td data-num=101></td><td><pre><span class="token selector">#comment-block .comment-container .info</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=102></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> .3125rem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>    <span class="token property">font-weight</span><span class="token punctuation">:</span> 600<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 1.25em<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre></pre></td></tr><tr><td data-num=107></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=108></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=112></td><td><pre></pre></td></tr><tr><td data-num=113></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=114></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 50px<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 45px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 27px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=122></td><td><pre></pre></td></tr><tr><td data-num=123></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::after</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=124></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 23px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 3px solid #dee1e3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre>    <span class="token property">-webkit-border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre>    <span class="token property">-moz-border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=136></td><td><pre></pre></td></tr><tr><td data-num=137></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=138></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=142></td><td><pre></pre></td></tr><tr><td data-num=143></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li::after</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=144></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=145></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=150></td><td><pre></pre></td></tr><tr><td data-num=151></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level::after</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=152></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=158></td><td><pre></pre></td></tr><tr><td data-num=159></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=160></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=164></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 17px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 3px solid #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 2px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=170></td><td><pre></pre></td></tr><tr><td data-num=171></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar img</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=172></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=178></td><td><pre></pre></td></tr><tr><td data-num=179></td><td><pre><span class="token comment">/* comment box of coment area start-area */</span></pre></td></tr><tr><td data-num=180></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=181></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 465px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 1px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.15<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=186></td><td><pre></pre></td></tr><tr><td data-num=187></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=188></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=189></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=191></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>    <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=197></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=198></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre></pre></td></tr><tr><td data-num=201></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=202></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=206></td><td><pre></pre></td></tr><tr><td data-num=207></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=208></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=209></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=216></td><td><pre>    <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=217></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=218></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=220></td><td><pre></pre></td></tr><tr><td data-num=221></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=222></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=224></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=226></td><td><pre></pre></td></tr><tr><td data-num=227></td><td><pre><span class="token comment">/* comment box head area start-area */</span></pre></td></tr><tr><td data-num=228></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=229></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=230></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=231></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #E5E5E5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px 4px 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=233></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=234></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=235></td><td><pre></pre></td></tr><tr><td data-num=236></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=237></td><td><pre>.cbauthor-name<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=238></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #283035<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>    <span class="token property">font-weight</span><span class="token punctuation">:</span> 700<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=241></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre>    <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=244></td><td><pre></pre></td></tr><tr><td data-num=245></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=246></td><td><pre>span<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=247></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=248></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=253></td><td><pre></pre></td></tr><tr><td data-num=254></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=255></td><td><pre>.reply<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=256></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=257></td><td><pre>    <span class="token property">margin-left</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=260></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #e9546b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=261></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=262></td><td><pre>    <span class="token property">-webkit-transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre>    <span class="token property">-o-transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=264></td><td><pre>    <span class="token property">transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=265></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=266></td><td><pre></pre></td></tr><tr><td data-num=267></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=268></td><td><pre>.reply:hover<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=269></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #03658c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=270></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=271></td><td><pre></pre></td></tr><tr><td data-num=272></td><td><pre><span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=273></td><td><pre></pre></td></tr><tr><td data-num=274></td><td><pre><span class="token comment">/* comment box content area start-area */</span></pre></td></tr><tr><td data-num=275></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-content</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=276></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=277></td><td><pre>    <span class="token comment">/* padding: 12px; */</span></pre></td></tr><tr><td data-num=278></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=279></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #595959<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=280></td><td><pre>    <span class="token property">-webkit-border-radius</span><span class="token punctuation">:</span> 0 0 4px 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre>    <span class="token property">-moz-border-radius</span><span class="token punctuation">:</span> 0 0 4px 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=282></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 0 0 4px 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=283></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=284></td><td><pre><span class="token comment">/* comment box content area end-area */</span></pre></td></tr><tr><td data-num=285></td><td><pre><span class="token comment">/* comment box of comment area end-area */</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang=JavaScript><span>./docs/js/comments.js</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>url<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>		<span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>		<span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=6></td><td><pre>			_URL<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>				<span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>				<span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>					<span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>				<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=12></td><td><pre>				<span class="token literal-property property">body</span><span class="token operator">:</span> data<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token keyword">return</span> response<span class="token punctuation">.</span>ok<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>url</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>_URL<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">function</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span><span class="token parameter">textsLable<span class="token punctuation">,</span>cols</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token keyword">var</span> texts <span class="token operator">=</span> <span class="token punctuation">(</span>textsLable<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r|\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">var</span> textLength <span class="token operator">=</span> texts<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> textLength<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> cache<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token number">0</span> <span class="token operator">===</span> cache<span class="token punctuation">.</span>length <span class="token operator">%</span> cols<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>			cache <span class="token operator">+=</span> <span class="token string">"&lt;br/>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=42></td><td><pre>		cache <span class="token operator">+=</span> texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token keyword">return</span> cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token keyword">function</span> <span class="token function">avatarAppend</span><span class="token punctuation">(</span><span class="token parameter">main_label<span class="token punctuation">,</span>mail_md5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token keyword">var</span> avatarLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	avatarLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"avatar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">var</span> imgUrl <span class="token operator">=</span> <span class="token string">"https://gravatar.com/avatar/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	avatarLable<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"&lt;img src=\""</span> <span class="token operator">+</span> imgUrl <span class="token operator">+</span> mail_md5 <span class="token operator">+</span> <span class="token string">"\" alt=img>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	main_label<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>avatarLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token keyword">function</span> <span class="token function">timestampTackle</span><span class="token punctuation">(</span><span class="token parameter">timeSpendLable<span class="token punctuation">,</span>create_at</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token keyword">const</span> timeSpace <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">const</span> days <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">24</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token keyword">const</span> f_days <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token keyword">const</span> hours <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token keyword">const</span> f_hours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token keyword">const</span> minutes <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token keyword">const</span> f_minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_days<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=68></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=69></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span>f_days <span class="token operator">></span> <span class="token number">365</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=70></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=71></td><td><pre>			<span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeSpace<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token keyword">const</span> year <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>			<span class="token keyword">const</span> month <span class="token operator">=</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>			<span class="token keyword">const</span> day <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		</pre></td></tr><tr><td data-num=75></td><td><pre>			<span class="token keyword">const</span> format_time <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>year<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>month<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>day<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>			timeSpendLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> format_time<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> timeSpendLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_days <span class="token operator">+</span> <span class="token string">" 天前"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=78></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> timeSpendLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_hours <span class="token operator">+</span> <span class="token string">" 小时前"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> timeSpendLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_minutes <span class="token operator">+</span> <span class="token string">" 分钟前"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token keyword">function</span> <span class="token function">commentAppend</span><span class="token punctuation">(</span><span class="token parameter">main_label<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=84></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=85></td><td><pre>	<span class="token keyword">var</span> commentBoxLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre></pre></td></tr><tr><td data-num=88></td><td><pre>	<span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre></pre></td></tr><tr><td data-num=93></td><td><pre>	<span class="token comment">/* nickname area */</span></pre></td></tr><tr><td data-num=94></td><td><pre>	<span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>	authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> record<span class="token punctuation">.</span>nick_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre></pre></td></tr><tr><td data-num=98></td><td><pre>	<span class="token comment">/* timestamp transform into format time */</span></pre></td></tr><tr><td data-num=99></td><td><pre>	<span class="token keyword">var</span> timeSpendLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>	<span class="token function">timestampTackle</span><span class="token punctuation">(</span>timeSpendLable<span class="token punctuation">,</span>record<span class="token punctuation">.</span>create_at<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre></pre></td></tr><tr><td data-num=102></td><td><pre>	<span class="token comment">/* reply area */</span></pre></td></tr><tr><td data-num=103></td><td><pre>	<span class="token keyword">var</span> replyLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>	replyLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>	replyLable<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"回复"</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=106></td><td><pre></pre></td></tr><tr><td data-num=107></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpendLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>replyLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>	<span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=113></td><td><pre></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>	boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre></pre></td></tr><tr><td data-num=118></td><td><pre>	boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> record<span class="token punctuation">.</span>content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre></pre></td></tr><tr><td data-num=121></td><td><pre>	main_label<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=123></td><td><pre></pre></td></tr><tr><td data-num=124></td><td><pre><span class="token keyword">function</span> <span class="token function">contentAppend</span><span class="token punctuation">(</span><span class="token parameter">labels<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=125></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=126></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token keyword">var</span> userBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>userBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre>	<span class="token keyword">var</span> mainUserLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre></pre></td></tr><tr><td data-num=132></td><td><pre>	mainUserLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"main-level clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token function">avatarAppend</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">,</span>record<span class="token punctuation">.</span>mail_md5<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>	<span class="token function">commentAppend</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">,</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>	userBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre></pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token comment">/* state stretch */</span></pre></td></tr><tr><td data-num=139></td><td><pre>	<span class="token keyword">var</span> O_CBHeight <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token keyword">var</span> newHeight <span class="token operator">=</span> O_CBHeight <span class="token operator">+</span> <span class="token number">90</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre></pre></td></tr><tr><td data-num=142></td><td><pre>	commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre>	commentContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">-</span> <span class="token number">325</span> <span class="token operator">+</span>  <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=145></td><td><pre></pre></td></tr><tr><td data-num=146></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">buttonClick</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=147></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=148></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token keyword">var</span> inputArea <span class="token operator">=</span> labels<span class="token punctuation">.</span>inputArea<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token keyword">var</span> inputs <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token keyword">var</span> nick_name_label <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token keyword">var</span> mail_label <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token keyword">var</span> mail_md5 <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">SHA256</span><span class="token punctuation">(</span>mail_label<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token keyword">var</span> texts <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"textarea"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token keyword">var</span> nick_name_value <span class="token operator">=</span> nick_name_label<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre></pre></td></tr><tr><td data-num=160></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> nick_name_value<span class="token punctuation">.</span>length<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=161></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=162></td><td><pre>		<span class="token comment">/* current time */</span></pre></td></tr><tr><td data-num=163></td><td><pre>		<span class="token keyword">var</span> comment <span class="token operator">=</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span>texts<span class="token punctuation">,</span>texts<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=164></td><td><pre>		<span class="token keyword">var</span> curTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>		<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">":"</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> nick_name_value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> mail_label<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> mail_md5 <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> curTime  <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> comment<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre></pre></td></tr><tr><td data-num=167></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">==</span> <span class="token keyword">await</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token string">"/api"</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=168></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=169></td><td><pre>			commentContainer<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>			commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">"360px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>			commentContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">"0px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre></pre></td></tr><tr><td data-num=173></td><td><pre>			<span class="token keyword">var</span> commentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre></pre></td></tr><tr><td data-num=175></td><td><pre>			commentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>			commentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre></pre></td></tr><tr><td data-num=178></td><td><pre>			labels<span class="token punctuation">.</span>commentList <span class="token operator">=</span> commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>			<span class="token function">commentPreShow</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>labels<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=182></td><td><pre></pre></td></tr><tr><td data-num=183></td><td><pre>	nick_name_label<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>	mail_label<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>	texts<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre></pre></td></tr><tr><td data-num=187></td><td><pre>	labels<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>	labels<span class="token punctuation">.</span>info<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"已有"</span> <span class="token operator">+</span> labels<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token string">"条评论"</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=189></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre><span class="token keyword">function</span> <span class="token function">replyClick</span><span class="token punctuation">(</span><span class="token parameter">labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=192></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=195></td><td><pre></pre></td></tr><tr><td data-num=196></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commentCount</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=197></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=198></td><td><pre>	<span class="token keyword">const</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token string">"/database_count"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>	<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> count <span class="token operator">=</span> responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=203></td><td><pre></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token keyword">var</span> info <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre></pre></td></tr><tr><td data-num=208></td><td><pre>	commentContainer<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>	commentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>	info<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>	info<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			</pre></td></tr><tr><td data-num=212></td><td><pre>	info<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"已有"</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">"条评论"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=213></td><td><pre></pre></td></tr><tr><td data-num=214></td><td><pre>	labels<span class="token punctuation">.</span>commentContainer <span class="token operator">=</span> commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre>	labels<span class="token punctuation">.</span>commentList <span class="token operator">=</span> commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=216></td><td><pre>	labels<span class="token punctuation">.</span>info <span class="token operator">=</span> info<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=217></td><td><pre></pre></td></tr><tr><td data-num=218></td><td><pre>	commentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>	commentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre>	commentBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre></pre></td></tr><tr><td data-num=222></td><td><pre>	<span class="token keyword">return</span> count<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=224></td><td><pre></pre></td></tr><tr><td data-num=225></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commentPreShow</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=226></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=227></td><td><pre>	<span class="token keyword">const</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token string">"/database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=228></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=229></td><td><pre></pre></td></tr><tr><td data-num=230></td><td><pre>	<span class="token keyword">var</span> data <span class="token operator">=</span> responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=231></td><td><pre>	<span class="token keyword">var</span> array <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>	<span class="token keyword">const</span> array_length <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=233></td><td><pre></pre></td></tr><tr><td data-num=234></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">||</span> <span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=235></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=237></td><td><pre></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token keyword">var</span> newLabels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	<span class="token keyword">var</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre></pre></td></tr><tr><td data-num=244></td><td><pre>	array<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> array_length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=247></td><td><pre>		<span class="token keyword">var</span> sub <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=248></td><td><pre>		<span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>		<span class="token keyword">var</span> parent_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>		<span class="token keyword">var</span> response_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>		<span class="token keyword">var</span> nick_name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>		<span class="token keyword">var</span> mail <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre>		<span class="token keyword">var</span> mail_md5 <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=254></td><td><pre>		<span class="token keyword">var</span> create_at <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>		<span class="token keyword">var</span> comment <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=256></td><td><pre>		<span class="token keyword">var</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=257></td><td><pre></pre></td></tr><tr><td data-num=258></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=259></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=260></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=261></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=262></td><td><pre>				<span class="token keyword">const</span> c <span class="token operator">=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre></pre></td></tr><tr><td data-num=264></td><td><pre>				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">":"</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">7</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=265></td><td><pre>				<span class="token keyword">else</span></pre></td></tr><tr><td data-num=266></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=267></td><td><pre>					<span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=268></td><td><pre>					<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=269></td><td><pre>						<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=270></td><td><pre>						<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> parent_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=271></td><td><pre>						<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> response_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=272></td><td><pre>						<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> nick_name <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=273></td><td><pre>						<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> mail <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=274></td><td><pre>						<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> mail_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=275></td><td><pre>						<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=276></td><td><pre>						<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> comment <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=277></td><td><pre>					<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=278></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=279></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=280></td><td><pre>			<span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre>			<span class="token keyword">var</span> commentListFirstChild <span class="token operator">=</span> commentList<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=282></td><td><pre></pre></td></tr><tr><td data-num=283></td><td><pre>			newLabels<span class="token punctuation">.</span>commentContainer <span class="token operator">=</span> commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>			newLabels<span class="token punctuation">.</span>commentBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=285></td><td><pre>			newLabels<span class="token punctuation">.</span>userBlock <span class="token operator">=</span> userBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=286></td><td><pre>			newLabels<span class="token punctuation">.</span>commentList <span class="token operator">=</span> commentList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=287></td><td><pre></pre></td></tr><tr><td data-num=288></td><td><pre>			record<span class="token punctuation">.</span>nick_name <span class="token operator">=</span> nick_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=289></td><td><pre>			record<span class="token punctuation">.</span>mail <span class="token operator">=</span> mail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=290></td><td><pre>			record<span class="token punctuation">.</span>mail_md5 <span class="token operator">=</span> mail_md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=291></td><td><pre>			record<span class="token punctuation">.</span>create_at <span class="token operator">=</span> create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=292></td><td><pre>			record<span class="token punctuation">.</span>content <span class="token operator">=</span> comment<span class="token punctuation">;</span>		</pre></td></tr><tr><td data-num=293></td><td><pre></pre></td></tr><tr><td data-num=294></td><td><pre>			<span class="token function">contentAppend</span><span class="token punctuation">(</span>newLabels<span class="token punctuation">,</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=295></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> commentListFirstChild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=296></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=297></td><td><pre>				commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=298></td><td><pre>				commentList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=299></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=300></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> commentList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>commentListFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=301></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=302></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=303></td><td><pre></pre></td></tr><tr><td data-num=304></td><td><pre>	<span class="token keyword">var</span> replyElements <span class="token operator">=</span> commentList<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=305></td><td><pre></pre></td></tr><tr><td data-num=306></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> reply <span class="token keyword">of</span> replyElements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=307></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=308></td><td><pre>		reply<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=309></td><td><pre>			<span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=310></td><td><pre>			<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">replyClick</span><span class="token punctuation">(</span>newLabels<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=311></td><td><pre>			<span class="token boolean">false</span></pre></td></tr><tr><td data-num=312></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=313></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=314></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=315></td><td><pre></pre></td></tr><tr><td data-num=316></td><td><pre>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=317></td><td><pre>	<span class="token keyword">const</span> _host <span class="token operator">=</span> <span class="token string">"192.168.80.144"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=318></td><td><pre>	<span class="token comment">/* class="comment-block" */</span></pre></td></tr><tr><td data-num=319></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=320></td><td><pre>	<span class="token keyword">var</span> inputBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span><span class="token comment">/* class="input-block" */</span></pre></td></tr><tr><td data-num=321></td><td><pre></pre></td></tr><tr><td data-num=322></td><td><pre>	<span class="token comment">/*** input-block ***/</span></pre></td></tr><tr><td data-num=323></td><td><pre>	<span class="token comment">/******************************/</span></pre></td></tr><tr><td data-num=324></td><td><pre>	<span class="token comment">/* class="input-area" */</span></pre></td></tr><tr><td data-num=325></td><td><pre>	<span class="token keyword">var</span> inputArea <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=326></td><td><pre>	<span class="token comment">/* class="text-block" */</span></pre></td></tr><tr><td data-num=327></td><td><pre>	<span class="token keyword">var</span> buttonArea <span class="token operator">=</span> inputArea<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=328></td><td><pre>	<span class="token comment">/* class="commit" */</span></pre></td></tr><tr><td data-num=329></td><td><pre>	<span class="token keyword">var</span> commitButton <span class="token operator">=</span> buttonArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=330></td><td><pre>	<span class="token comment">/******************************/</span></pre></td></tr><tr><td data-num=331></td><td><pre></pre></td></tr><tr><td data-num=332></td><td><pre>	<span class="token keyword">var</span> newlabels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=333></td><td><pre>	<span class="token comment">/* class="comment-container" */</span></pre></td></tr><tr><td data-num=334></td><td><pre>	newlabels<span class="token punctuation">.</span>commentBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=335></td><td><pre>	newlabels<span class="token punctuation">.</span>inputArea <span class="token operator">=</span> inputArea<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=336></td><td><pre>	newlabels<span class="token punctuation">.</span>commentContainer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=337></td><td><pre>	newlabels<span class="token punctuation">.</span>commentList <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=338></td><td><pre>	newlabels<span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=339></td><td><pre>	newlabels<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">commentCount</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span>newlabels<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=340></td><td><pre></pre></td></tr><tr><td data-num=341></td><td><pre>	<span class="token function">commentPreShow</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span>newlabels<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=342></td><td><pre>	commitButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=343></td><td><pre>		<span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=344></td><td><pre>		<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">buttonClick</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span>newlabels<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=345></td><td><pre>		<span class="token boolean">false</span></pre></td></tr><tr><td data-num=346></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=347></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight html"><figcaption data-lang=HTML><span>./index.html</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./css/comments.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/core.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/sha256.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/comments.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=15></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=16></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=17></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nickname<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>19<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> nickname(1~19个字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=18></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>44<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> email(8~44字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=19></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-block<span class="token punctuation">"</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=20></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=21></td><td><pre>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>commit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=22></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=23></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=24></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></div></details><details class=info><summary>后端</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>./_database/db.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql++/mysql++.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">// 表记录中一行的数据，处理表名</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Record</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	std<span class="token double-colon punctuation">::</span>string parent_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	std<span class="token double-colon punctuation">::</span>string response_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	std<span class="token double-colon punctuation">::</span>string nick_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	std<span class="token double-colon punctuation">::</span>string mail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	std<span class="token double-colon punctuation">::</span>string mail_md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	std<span class="token double-colon punctuation">::</span>string create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	std<span class="token double-colon punctuation">::</span>string comment<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DataBase</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=21></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Connection conn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	std<span class="token double-colon punctuation">::</span>string table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	std<span class="token double-colon punctuation">::</span>string db_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 链接数据库</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token keyword">int</span> <span class="token function">TableRecordCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">int</span> <span class="token function">GetTableParentRecordNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录插入</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录读取</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_database/db.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"db.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> db_config <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetDatabaseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">bool</span> db_connect <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=7></td><td><pre>		db_config<span class="token punctuation">.</span>database_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>		db_config<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>		db_config<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>		db_config<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>	db_name <span class="token operator">=</span> db_config<span class="token punctuation">.</span>database_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	table_name <span class="token operator">=</span> db_config<span class="token punctuation">.</span>table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> db_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=19></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=22></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	</pre></td></tr><tr><td data-num=41></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=42></td><td><pre>		<span class="token string">"SELECT COUNT(*) FROM information_schema.tables"</span></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token string">" WHERE table_schema = '"</span> <span class="token operator">+</span> db_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token string">"' AND table_name = '"</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> <span class="token string">"';"</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token string">"DataBase::TableIsNull() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=48></td><td><pre>		_sql</pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=51></td><td><pre></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token punctuation">&#125;</span> 	</pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token keyword">int</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableRecordCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre></pre></td></tr><tr><td data-num=64></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>	</pre></td></tr><tr><td data-num=67></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=68></td><td><pre>		<span class="token string">"SELECT COUNT(*) FROM "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=69></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token string">"DataBase::TableRecordCount() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=73></td><td><pre>		_sql</pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=76></td><td><pre>	</pre></td></tr><tr><td data-num=77></td><td><pre>	<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=79></td><td><pre></pre></td></tr><tr><td data-num=80></td><td><pre><span class="token keyword">int</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">GetTableParentRecordNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=81></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=83></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=85></td><td><pre></pre></td></tr><tr><td data-num=86></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre>	</pre></td></tr><tr><td data-num=89></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=90></td><td><pre>		<span class="token string">"SELECT COUNT(*) FROM "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=91></td><td><pre>		<span class="token string">" WHERE parent_id IS NULL"</span> </pre></td></tr><tr><td data-num=92></td><td><pre>		<span class="token string">" AND response_id IS NULL"</span> </pre></td></tr><tr><td data-num=93></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=94></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=96></td><td><pre>		<span class="token string">"DataBase::GetTableParentRecordNum() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=97></td><td><pre>		_sql</pre></td></tr><tr><td data-num=98></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=100></td><td><pre>	</pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=103></td><td><pre></pre></td></tr><tr><td data-num=104></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=105></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=106></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=107></td><td><pre>		std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>		mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>		<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre></pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=112></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=113></td><td><pre>			mysqlpp<span class="token double-colon punctuation">::</span>Query query_create <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre></pre></td></tr><tr><td data-num=115></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=116></td><td><pre>				<span class="token string">"DataBase::TableInsert => Table is NULL"</span></pre></td></tr><tr><td data-num=117></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"CREATE TABLE "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>			_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"("</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nid CHAR(8) PRIMARY KEY,"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nparent_id CHAR(8),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nresponse_id CHAR(8),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nnick_name CHAR(64),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nmail CHAR(64),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nmail_md5 CHAR(65),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\ncreate_at CHAR(16),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\ncomment TEXT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\n);"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre></pre></td></tr><tr><td data-num=131></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=132></td><td><pre>				<span class="token string">"DataBase::TableInsert => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=133></td><td><pre>				_sql</pre></td></tr><tr><td data-num=134></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=136></td><td><pre>				<span class="token string">"DataBase::TableInsert => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=137></td><td><pre>				_sql</pre></td></tr><tr><td data-num=138></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre></pre></td></tr><tr><td data-num=140></td><td><pre>			query_create <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>			query_create<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>			_sql<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			</pre></td></tr><tr><td data-num=143></td><td><pre>		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> count <span class="token operator">=</span> <span class="token function">TableRecordCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=144></td><td><pre></pre></td></tr><tr><td data-num=145></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"INSERT INTO "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>		_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"(id,parent_id,response_id,nick_name,mail,mail_md5,create_at,comment)\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"VALUES('"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>		_sql <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"',"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"NULL,"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"NULL,'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>create_at <span class="token operator">+</span><span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>comment<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"');"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=158></td><td><pre></pre></td></tr><tr><td data-num=159></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=160></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=161></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span> </pre></td></tr><tr><td data-num=162></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=163></td><td><pre>			<span class="token string">"(id,parent_id,response_id,nick_name,mail,mail_md5,create_at,comment)\n"</span>	</pre></td></tr><tr><td data-num=164></td><td><pre>			<span class="token string">"VALUES('"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=165></td><td><pre>			std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=166></td><td><pre>			<span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=167></td><td><pre>			<span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=168></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=169></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=170></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=171></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=172></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">+</span> </pre></td></tr><tr><td data-num=173></td><td><pre>			<span class="token string">"');"</span></pre></td></tr><tr><td data-num=174></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=176></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span> </pre></td></tr><tr><td data-num=177></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=178></td><td><pre>			<span class="token string">"(id,parent_id,response_id,nick_name,mail,mail_md5,create_at,comment)\n"</span>	</pre></td></tr><tr><td data-num=179></td><td><pre>			<span class="token string">"VALUES('"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=180></td><td><pre>			std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=181></td><td><pre>			<span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=182></td><td><pre>			<span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=183></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=184></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=185></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=186></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=187></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">+</span> </pre></td></tr><tr><td data-num=188></td><td><pre>			<span class="token string">"');"</span></pre></td></tr><tr><td data-num=189></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre>		query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>		query<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">const</span> mysqlpp<span class="token double-colon punctuation">::</span>Exception<span class="token operator">&amp;</span> er<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=194></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=195></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=196></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=197></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=198></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=199></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=200></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=201></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=204></td><td><pre></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=207></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=208></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=210></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=211></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=214></td><td><pre></pre></td></tr><tr><td data-num=215></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">GetTableRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=216></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=217></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=218></td><td><pre></pre></td></tr><tr><td data-num=219></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=220></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=222></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre></pre></td></tr><tr><td data-num=224></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">"SELECT * FROM "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>	_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=226></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">" ORDER BY create_at"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=228></td><td><pre></pre></td></tr><tr><td data-num=229></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=230></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=231></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=232></td><td><pre>		<span class="token string">"SELECT * FROM "</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=233></td><td><pre>		table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=234></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=235></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=237></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=238></td><td><pre>		<span class="token string">"SELECT * FROM "</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num=239></td><td><pre>		table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=240></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre></pre></td></tr><tr><td data-num=243></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>StoreQueryResult res <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=246></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> row<span class="token operator">:</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=247></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=248></td><td><pre>			Record<span class="token operator">*</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Record</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>			record<span class="token operator">-></span>id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>			record<span class="token operator">-></span>id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"parent_id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>			record<span class="token operator">-></span>id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"response_id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"nick_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"mail"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=254></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"mail_md5"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"create_at"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=256></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"comment"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=257></td><td><pre>			buf<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=259></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=260></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=261></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=262></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=263></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=264></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=265></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=266></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=267></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=268></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=269></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=270></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=272></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=273></td><td><pre></pre></td></tr><tr><td data-num=274></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=275></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=276></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=277></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=278></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=279></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=280></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=282></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_http/_response.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_database/db.h"</span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_tcp/tcp.h"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_HTTPVERSION</span> <span class="token string">"1.0"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">// HTTP请求方法</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">RequestMethodType</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    _UNKNOW<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>    _GET<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>    _POST<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>    _PUT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>    _DELETE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>    _HEAD<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=18></td><td><pre>    _OPTIONS<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>    _PATCH<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=20></td><td><pre>    _CONNECT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=21></td><td><pre>    _TRACE</pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment">// HTTP请求文件格式</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">RequestFileType</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    _UNKNOW<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=28></td><td><pre>    _HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=29></td><td><pre>    _CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=30></td><td><pre>    _JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=31></td><td><pre>    _PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token comment">// 请求路径功能所属</span></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">RequestPathType</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    _NORMAL<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=38></td><td><pre>    _DATABASE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=39></td><td><pre>	_DATABASE_COUNT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=40></td><td><pre>    _API</pre></td></tr><tr><td data-num=41></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TcpResponse</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=46></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的普通响应</span></pre></td></tr><tr><td data-num=47></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的数据库响应</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DBC</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的数据库表元素数量响应</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token comment">// 200状态的文件请求响应</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> off_t f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=52></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>    <span class="token keyword">static</span> RequestMethodType <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> method_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTTP请求方法</span></pre></td></tr><tr><td data-num=55></td><td><pre>    <span class="token keyword">static</span> RequestFileType <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTPP请求文件类型</span></pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token keyword">static</span> RequestPathType <span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTTP请求路径类型</span></pre></td></tr><tr><td data-num=57></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 状态响应选择器</span></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_http/_response.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_response.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>RequestMethodType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> method_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> method_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _get <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _post <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _put <span class="token operator">=</span> <span class="token string">"PUT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _delete <span class="token operator">=</span> <span class="token string">"DELETE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _head <span class="token operator">=</span> <span class="token string">"HEAD"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _options <span class="token operator">=</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _patch <span class="token operator">=</span> <span class="token string">"PATCH"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _connect <span class="token operator">=</span> <span class="token string">"CONNECT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _trace <span class="token operator">=</span> <span class="token string">"TRACE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>method_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_get <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_get<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_post <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_post<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_put <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_put<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_delete <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_delete<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_head <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_head<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_options <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_options<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_patch <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_patch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_connect <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_connect<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_trace <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_trace<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span>buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=39></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=40></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => GET"</span></pre></td></tr><tr><td data-num=41></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => GET"</span></pre></td></tr><tr><td data-num=44></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_GET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=50></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=51></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PUT"</span></pre></td></tr><tr><td data-num=52></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=54></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PUT"</span></pre></td></tr><tr><td data-num=55></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PUT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=63></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=64></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=65></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=66></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => POST"</span></pre></td></tr><tr><td data-num=67></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=68></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=69></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => POST"</span></pre></td></tr><tr><td data-num=70></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=71></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_POST<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=73></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=74></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=75></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=76></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=77></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => HEAD"</span></pre></td></tr><tr><td data-num=78></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=79></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=80></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => HEAD"</span></pre></td></tr><tr><td data-num=81></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=82></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_HEAD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=87></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=88></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=89></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=90></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=91></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=92></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PATCH"</span></pre></td></tr><tr><td data-num=93></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=94></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=95></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PATCH"</span></pre></td></tr><tr><td data-num=96></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=97></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PATCH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=99></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=100></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=101></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=102></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=103></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => TRACE"</span></pre></td></tr><tr><td data-num=104></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=105></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=106></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => TRACE"</span></pre></td></tr><tr><td data-num=107></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=108></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_TRACE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=112></td><td><pre>		<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=114></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=115></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=116></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=117></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=118></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => DELETE"</span></pre></td></tr><tr><td data-num=119></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=120></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=121></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => DELETE"</span></pre></td></tr><tr><td data-num=122></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=123></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_DELETE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=125></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=128></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=129></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=130></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=131></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=132></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=133></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => OPTIONS"</span></pre></td></tr><tr><td data-num=134></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=135></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=136></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => OPTIONS"</span></pre></td></tr><tr><td data-num=137></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_OPTIONS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=140></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=141></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=142></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=143></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=144></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => CONNECT"</span></pre></td></tr><tr><td data-num=145></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=146></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=147></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => CONNECT"</span></pre></td></tr><tr><td data-num=148></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=149></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_CONNECT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=151></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetMethodType() => UNKNOW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetMethodType() => UNKNOW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre></pre></td></tr><tr><td data-num=160></td><td><pre>RequestFileType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=161></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=162></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> filename_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre></pre></td></tr><tr><td data-num=165></td><td><pre>	std<span class="token double-colon punctuation">::</span>string type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=169></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> filename_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'.'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> type<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=171></td><td><pre>		<span class="token keyword">else</span><span class="token punctuation">&#123;</span> type <span class="token operator">+=</span> ch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=172></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=173></td><td><pre></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=175></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=176></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _html <span class="token operator">=</span> <span class="token string">"HTML"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _js <span class="token operator">=</span> <span class="token string">"JS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _css <span class="token operator">=</span> <span class="token string">"CSS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _png <span class="token operator">=</span> <span class="token string">"PNG"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>		<span class="token keyword">const</span> size_t type_len <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> type_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=184></td><td><pre>			<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>type<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_html <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_html <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_html<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=186></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_js <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_js <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_js<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=187></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_css <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_css <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_css<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=188></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_png <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_png <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_png<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_html<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=192></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=194></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=195></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => HTML"</span></pre></td></tr><tr><td data-num=196></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=197></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=198></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => HTML"</span></pre></td></tr><tr><td data-num=199></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=200></td><td><pre>			<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_HTML<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre></pre></td></tr><tr><td data-num=203></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_js<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=205></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=206></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=207></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => CSS"</span></pre></td></tr><tr><td data-num=208></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=209></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=210></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => CSS"</span></pre></td></tr><tr><td data-num=211></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=212></td><td><pre>			<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_JS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=214></td><td><pre></pre></td></tr><tr><td data-num=215></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> type_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=217></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_css<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=218></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=219></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=220></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=221></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => JS"</span></pre></td></tr><tr><td data-num=222></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=223></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=224></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => JS"</span></pre></td></tr><tr><td data-num=225></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=226></td><td><pre>				<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_CSS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=228></td><td><pre></pre></td></tr><tr><td data-num=229></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_png<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=230></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=231></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=232></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=233></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => PNG"</span></pre></td></tr><tr><td data-num=234></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=236></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => PNG"</span></pre></td></tr><tr><td data-num=237></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>				<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_PNG<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=240></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=244></td><td><pre>		<span class="token string">"TcpResponse::GetFileType() => UNKNOW"</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=247></td><td><pre>		<span class="token string">"TcpResponse::GetFileType() => UNKNOW"</span></pre></td></tr><tr><td data-num=248></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>	<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=251></td><td><pre></pre></td></tr><tr><td data-num=252></td><td><pre>RequestPathType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=253></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=254></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> path_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_NORMAL<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=256></td><td><pre></pre></td></tr><tr><td data-num=257></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> db <span class="token operator">=</span> <span class="token string">"DATABASE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> dbc <span class="token operator">=</span> <span class="token string">"DATABASE_COUNT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> api <span class="token operator">=</span> <span class="token string">"API"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=260></td><td><pre></pre></td></tr><tr><td data-num=261></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=262></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=263></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>path_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=264></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>db <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>db <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>db<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=265></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>dbc <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>dbc <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>dbc<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=266></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>api <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>api <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>api<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=268></td><td><pre></pre></td></tr><tr><td data-num=269></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>db<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=270></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=271></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=272></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=273></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=274></td><td><pre>		<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=275></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=276></td><td><pre></pre></td></tr><tr><td data-num=277></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">15</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>dbc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=278></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=279></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=280></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE_COUNT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE_COUNT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=282></td><td><pre>		<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE_COUNT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=283></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=284></td><td><pre></pre></td></tr><tr><td data-num=285></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>api<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=286></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=287></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=288></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=289></td><td><pre>			<span class="token string">"TcpResponse::GetPathType() => API"</span></pre></td></tr><tr><td data-num=290></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=291></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=292></td><td><pre>			<span class="token string">"TcpResponse::GetPathType() => API"</span></pre></td></tr><tr><td data-num=293></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=294></td><td><pre>		<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_API<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=295></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=296></td><td><pre></pre></td></tr><tr><td data-num=297></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=298></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=299></td><td><pre>		<span class="token string">"TcpResponse::GetPathType() => NORMAL"</span></pre></td></tr><tr><td data-num=300></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=301></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=302></td><td><pre>		<span class="token string">"TcpResponse::GetPathType() => NORMAL"</span></pre></td></tr><tr><td data-num=303></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=304></td><td><pre>	<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_NORMAL<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=305></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=306></td><td><pre></pre></td></tr><tr><td data-num=307></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=308></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=309></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=310></td><td><pre></pre></td></tr><tr><td data-num=311></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=312></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=313></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 400 BAD REQUEST\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=314></td><td><pre></pre></td></tr><tr><td data-num=315></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=316></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=317></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=318></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=319></td><td><pre>			<span class="token string">"TcpResponse::Response400() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=320></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=321></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=322></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=323></td><td><pre>			<span class="token string">"TcpResponse::Response400() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=324></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=325></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=326></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=327></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=328></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=329></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=330></td><td><pre>		<span class="token string">"TcpResponse::Response400() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=331></td><td><pre>		buf</pre></td></tr><tr><td data-num=332></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=333></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=334></td><td><pre>		<span class="token string">"TcpResponse::Response400() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=335></td><td><pre>		buf</pre></td></tr><tr><td data-num=336></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=337></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=338></td><td><pre></pre></td></tr><tr><td data-num=339></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=340></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=341></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=342></td><td><pre></pre></td></tr><tr><td data-num=343></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=344></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=345></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 404 NOT FOUND\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=346></td><td><pre></pre></td></tr><tr><td data-num=347></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=348></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=349></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=350></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=351></td><td><pre>			<span class="token string">"TcpResponse::Response404() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=352></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=353></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=354></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=355></td><td><pre>			<span class="token string">"TcpResponse::Response404() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=356></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=357></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=358></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=359></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=360></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=361></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=362></td><td><pre>		<span class="token string">"TcpResponse::Response404() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=363></td><td><pre>		buf</pre></td></tr><tr><td data-num=364></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=365></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=366></td><td><pre>		<span class="token string">"TcpResponse::Response404() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=367></td><td><pre>		buf </pre></td></tr><tr><td data-num=368></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=369></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=370></td><td><pre></pre></td></tr><tr><td data-num=371></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=372></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=373></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=374></td><td><pre></pre></td></tr><tr><td data-num=375></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=376></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=377></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=378></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=379></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=380></td><td><pre></pre></td></tr><tr><td data-num=381></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=382></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=383></td><td><pre>		<span class="token comment">// log....</span></pre></td></tr><tr><td data-num=384></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=385></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=386></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=387></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=388></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=389></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=390></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=391></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=392></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=393></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=394></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=395></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=396></td><td><pre>		<span class="token string">"TcpResponse::Response200_NF() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=397></td><td><pre>		buf</pre></td></tr><tr><td data-num=398></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=399></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=400></td><td><pre>		<span class="token string">"TcpResponse::Response200_NF() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=401></td><td><pre>		buf</pre></td></tr><tr><td data-num=402></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=403></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=404></td><td><pre></pre></td></tr><tr><td data-num=405></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=406></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=407></td><td><pre>	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span> records<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=408></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=409></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=410></td><td><pre>	std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=411></td><td><pre></pre></td></tr><tr><td data-num=412></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=413></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=414></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=415></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=416></td><td><pre></pre></td></tr><tr><td data-num=417></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=418></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=419></td><td><pre>		<span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=420></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=421></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=422></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">GetTableRecord</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=423></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=424></td><td><pre>		<span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=425></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=426></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=427></td><td><pre></pre></td></tr><tr><td data-num=428></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> r<span class="token operator">:</span> records<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=429></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=430></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=431></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>parent_id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=432></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>response_id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=433></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=434></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=435></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=436></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=437></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>comment <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=438></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=439></td><td><pre></pre></td></tr><tr><td data-num=440></td><td><pre>	<span class="token keyword">const</span> size_t bodyLen <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=441></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=442></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=443></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=444></td><td><pre></pre></td></tr><tr><td data-num=445></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=446></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=447></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=448></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=449></td><td><pre>			<span class="token string">"TcpResponse::Response200_DB() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=450></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=451></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=452></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=453></td><td><pre>			<span class="token string">"TcpResponse::Response200_DB() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=454></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=455></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=456></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=457></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=458></td><td><pre></pre></td></tr><tr><td data-num=459></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=460></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=461></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=462></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=463></td><td><pre>			<span class="token comment">// log...	</span></pre></td></tr><tr><td data-num=464></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=465></td><td><pre>				<span class="token string">"TcpResponse::Response200_DB() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=466></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=467></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=468></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=469></td><td><pre>				<span class="token string">"TcpResponse::Response200_DB() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=470></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=471></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=472></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=473></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=474></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=475></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=476></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=477></td><td><pre>		<span class="token string">"TcpResponse::Response200_DB() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=478></td><td><pre>		buf</pre></td></tr><tr><td data-num=479></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=480></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=481></td><td><pre>		<span class="token string">"TcpResponse::Response200_DB() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=482></td><td><pre>		buf</pre></td></tr><tr><td data-num=483></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=484></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=485></td><td><pre></pre></td></tr><tr><td data-num=486></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_DBC</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=487></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=488></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=489></td><td><pre>	std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=490></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=491></td><td><pre></pre></td></tr><tr><td data-num=492></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=493></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=494></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=495></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=496></td><td><pre></pre></td></tr><tr><td data-num=497></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> body <span class="token operator">+=</span> <span class="token string">"0"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=498></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> body <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>database<span class="token punctuation">.</span><span class="token function">GetTableParentRecordNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=499></td><td><pre></pre></td></tr><tr><td data-num=500></td><td><pre>	<span class="token keyword">int</span> body_size <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=501></td><td><pre></pre></td></tr><tr><td data-num=502></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=503></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>body_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=504></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=505></td><td><pre></pre></td></tr><tr><td data-num=506></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=507></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=508></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=509></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=510></td><td><pre>			<span class="token string">"TcpResponse::Response200_DBC() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=511></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=512></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=513></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=514></td><td><pre>			<span class="token string">"TcpResponse::Response200_DBC() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=515></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=516></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=517></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=518></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=519></td><td><pre></pre></td></tr><tr><td data-num=520></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> body_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=521></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=522></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>body_size<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=523></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=524></td><td><pre>			<span class="token comment">// log...	</span></pre></td></tr><tr><td data-num=525></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=526></td><td><pre>				<span class="token string">"TcpResponse::Response200_DBC() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=527></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=528></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=529></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=530></td><td><pre>				<span class="token string">"TcpResponse::Response200_DBC() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=531></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=532></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=533></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=534></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=535></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=536></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=537></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=538></td><td><pre>		<span class="token string">"TcpResponse::Response200_DBC() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=539></td><td><pre>		buf</pre></td></tr><tr><td data-num=540></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=541></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=542></td><td><pre>		<span class="token string">"TcpResponse::Response200_DBC() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=543></td><td><pre>		buf</pre></td></tr><tr><td data-num=544></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=545></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=546></td><td><pre></pre></td></tr><tr><td data-num=547></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> off_t f_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=548></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=549></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=550></td><td><pre></pre></td></tr><tr><td data-num=551></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=552></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=553></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=554></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=555></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=556></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=557></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_HTML<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=558></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_CSS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=559></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_JS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=560></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_PNG<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=561></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=562></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=563></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=564></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=565></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=566></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=567></td><td><pre></pre></td></tr><tr><td data-num=568></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=569></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=570></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=571></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=572></td><td><pre>			<span class="token string">"TcpResponse::Response200() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=573></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=574></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=575></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=576></td><td><pre>			<span class="token string">"TcpResponse::Response200() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=577></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=578></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=579></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=580></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=581></td><td><pre>	std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">resource</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=582></td><td><pre></pre></td></tr><tr><td data-num=583></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resource<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=584></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=585></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=586></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=587></td><td><pre>			<span class="token string">"HttpServer::Response200() => file open fail"</span></pre></td></tr><tr><td data-num=588></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=589></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=590></td><td><pre>			<span class="token string">"HttpServer::Response200() => file open fail"</span></pre></td></tr><tr><td data-num=591></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=592></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=593></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=594></td><td><pre></pre></td></tr><tr><td data-num=595></td><td><pre>	<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=596></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=597></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=598></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=599></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=600></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=601></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=602></td><td><pre>				<span class="token string">"HttpServer::Response200() => file read fail"</span></pre></td></tr><tr><td data-num=603></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=604></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=605></td><td><pre>				<span class="token string">"HttpServer::Response200() => file read fail"</span></pre></td></tr><tr><td data-num=606></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=607></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=608></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=609></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=610></td><td><pre>		</pre></td></tr><tr><td data-num=611></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=612></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=613></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=614></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=615></td><td><pre>			<span class="token string">"HttpServer::Response200() => End of reading file"</span></pre></td></tr><tr><td data-num=616></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=617></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=618></td><td><pre>			<span class="token string">"HttpServer::Response200() => End of reading file"</span></pre></td></tr><tr><td data-num=619></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=620></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=621></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=622></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=623></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=624></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=625></td><td><pre>			<span class="token string">"HttpServer::Response200() => I/O error when reading"</span></pre></td></tr><tr><td data-num=626></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=627></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=628></td><td><pre>			<span class="token string">"HttpServer::Response200() => I/O error when reading"</span></pre></td></tr><tr><td data-num=629></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=630></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=631></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=632></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=633></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=634></td><td><pre>		<span class="token string">"TcpResponse::Response200() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=635></td><td><pre>		buf</pre></td></tr><tr><td data-num=636></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=637></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=638></td><td><pre>		<span class="token string">"TcpResponse::Response200() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=639></td><td><pre>		buf</pre></td></tr><tr><td data-num=640></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=641></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=642></td><td><pre></pre></td></tr><tr><td data-num=643></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=644></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=645></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetPathType</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=646></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=647></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=648></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE_COUNT<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_DBC</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=649></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_API<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=650></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num=651></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=652></td><td><pre>			std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=653></td><td><pre>			<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=654></td><td><pre></pre></td></tr><tr><td data-num=655></td><td><pre>			buf <span class="token operator">+=</span> <span class="token string">"./"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=656></td><td><pre>			buf <span class="token operator">+=</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetRootDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=657></td><td><pre>			buf <span class="token operator">+=</span> url_buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=658></td><td><pre></pre></td></tr><tr><td data-num=659></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=660></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=661></td><td><pre>				<span class="token string">"TcpResponse::ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=662></td><td><pre>				buf</pre></td></tr><tr><td data-num=663></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=664></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=665></td><td><pre>				<span class="token string">"TcpResponse::ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=666></td><td><pre>				buf</pre></td></tr><tr><td data-num=667></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=668></td><td><pre></pre></td></tr><tr><td data-num=669></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=670></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response200</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=671></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=672></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=673></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_http/http.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>std<span class="token double-colon punctuation">::</span>string <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token char">'/'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=11></td><td><pre>		url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'/'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> i <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token char">'\\'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>			url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		url <span class="token operator">+=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token string">"HttpServer::UrlFormat() => Format URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>		url</pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token string">"HttpServer::UrlFormat() => Format URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=30></td><td><pre>		url</pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">return</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">ReqContentReceive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>ReqContent<span class="token operator">*</span> req_content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=42></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>			<span class="token string">"HttpServer::ReqContentReceive() => TcpStream::StreamParse_Line() fail"</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=46></td><td><pre>			<span class="token string">"HttpServer::ReqContentReceive() => TcpStream::StreamParse_Line() fail"</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">&#125;</span>	</pre></td></tr><tr><td data-num=50></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>buf_len <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">char</span> bodyLen<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		req_content<span class="token operator">-></span>req_method <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		req_content<span class="token operator">-></span>req_url <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => \nRequest Header:"</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => \nRequest Header:"</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre></pre></td></tr><tr><td data-num=76></td><td><pre>		buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">StartWith</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length:"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=79></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=80></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">,</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=81></td><td><pre>				bodyLen<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>buf<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=88></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=89></td><td><pre>		<span class="token keyword">char</span> body_buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>		<span class="token comment">/* 读取body内容 */</span></pre></td></tr><tr><td data-num=91></td><td><pre>		buf_len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=92></td><td><pre>			sock_fd<span class="token punctuation">,</span>body_buf<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=93></td><td><pre>			<span class="token punctuation">(</span>size_t<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_stoi</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=94></td><td><pre>			<span class="token number">0</span></pre></td></tr><tr><td data-num=95></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=97></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=98></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=99></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=100></td><td><pre>				<span class="token string">"HttpServer::ReqContentReceive() => Receive Nothing body"</span></pre></td></tr><tr><td data-num=101></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=103></td><td><pre>				<span class="token string">"HttpServer::ReqContentReceive() => Receive Nothing body"</span></pre></td></tr><tr><td data-num=104></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token keyword">else</span></pre></td></tr><tr><td data-num=107></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=108></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=109></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=110></td><td><pre>				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre>				req_content<span class="token operator">-></span>req_body <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=117></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => Succeed"</span></pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=120></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => Succeed"</span></pre></td></tr><tr><td data-num=121></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=123></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=124></td><td><pre></pre></td></tr><tr><td data-num=125></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">BodyTackle</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">,</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=126></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token keyword">const</span> size_t n <span class="token operator">=</span> body_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=131></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=132></td><td><pre>			<span class="token string">"HttpServer::BodyTackle() => Receive Nothing Body"</span></pre></td></tr><tr><td data-num=133></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=135></td><td><pre>			<span class="token string">"HttpServer::BodyTackle() => Receive Nothing Body"</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=139></td><td><pre></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token keyword">int</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>parent_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>response_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>nick_name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>mail<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>mail_md5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>create_at<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>comment<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>	</pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">':'</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">7</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=155></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=156></td><td><pre>			<span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=157></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=158></td><td><pre>				<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre>				<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>parent_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=160></td><td><pre>				<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>response_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre>				<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>nick_name <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=162></td><td><pre>				<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>mail <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=163></td><td><pre>				<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>mail_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre>				<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=165></td><td><pre>				<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>comment <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=166></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=167></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=169></td><td><pre></pre></td></tr><tr><td data-num=170></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=171></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token string">"HttpServer::BodyTackle() => Succeed"</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=175></td><td><pre>		<span class="token string">"HttpServer::BodyTackle() => Succeed"</span></pre></td></tr><tr><td data-num=176></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=178></td><td><pre></pre></td></tr><tr><td data-num=179></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=180></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=183></td><td><pre></pre></td></tr><tr><td data-num=184></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=188></td><td><pre>		url <span class="token operator">+=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=193></td><td><pre>		<span class="token string">"HttpServer::GetMethod() => Request URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=194></td><td><pre>		url</pre></td></tr><tr><td data-num=195></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=197></td><td><pre>		<span class="token string">"HttpServer::GetMethod() => Request URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=198></td><td><pre>		url</pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"HttpServer::GetMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::GetMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=205></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=206></td><td><pre></pre></td></tr><tr><td data-num=207></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=208></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=209></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>	Record record<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>	<span class="token function">BodyTackle</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">,</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=214></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=215></td><td><pre>		<span class="token string">"HttpServer::PostMethod() => record:"</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token string">"\nid: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>id <span class="token operator">+</span></pre></td></tr><tr><td data-num=217></td><td><pre>		<span class="token string">"\nparent_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=218></td><td><pre>		<span class="token string">"\nresponse_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=219></td><td><pre>		<span class="token string">"\nnick_name: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=220></td><td><pre>		<span class="token string">"\nmail: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=221></td><td><pre>		<span class="token string">"\nmail_md5: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail_md5<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=222></td><td><pre>		<span class="token string">"\ncreate_at: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>create_at<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=223></td><td><pre>		<span class="token string">"\ncomment: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>comment</pre></td></tr><tr><td data-num=224></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=226></td><td><pre>		<span class="token string">"HttpServer::PostMethod() => record:"</span></pre></td></tr><tr><td data-num=227></td><td><pre>		<span class="token string">"\nid: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>id <span class="token operator">+</span></pre></td></tr><tr><td data-num=228></td><td><pre>		<span class="token string">"\nparent_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=229></td><td><pre>		<span class="token string">"\nresponse_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=230></td><td><pre>		<span class="token string">"\nnick_name: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=231></td><td><pre>		<span class="token string">"\nmail: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=232></td><td><pre>		<span class="token string">"\nmail_md5: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail_md5<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=233></td><td><pre>		<span class="token string">"\ncreate_at: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>create_at<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=234></td><td><pre>		<span class="token string">"\ncomment: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>comment</pre></td></tr><tr><td data-num=235></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre></pre></td></tr><tr><td data-num=237></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=239></td><td><pre>		<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	database<span class="token punctuation">.</span><span class="token function">TableInsert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre></pre></td></tr><tr><td data-num=244></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"HttpServer::PostMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::PostMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre></pre></td></tr><tr><td data-num=248></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=250></td><td><pre></pre></td></tr><tr><td data-num=251></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=252></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=253></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=254></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=255></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=256></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=257></td><td><pre>			<span class="token string">"HttpServer::Accept() => None apply socket"</span></pre></td></tr><tr><td data-num=258></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=259></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=260></td><td><pre>			<span class="token string">"HttpServer::Accept() => None apply socket"</span></pre></td></tr><tr><td data-num=261></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=262></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=264></td><td><pre>		</pre></td></tr><tr><td data-num=265></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">ReqContent</span> req_content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=266></td><td><pre></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>req_content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=268></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=269></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=270></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=271></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=272></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=273></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=274></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=275></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=276></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=277></td><td><pre>			<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=278></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=279></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=280></td><td><pre>				<span class="token string">"HttpServer::Accept() => Not support for current "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=281></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=282></td><td><pre>				<span class="token string">" request method"</span></pre></td></tr><tr><td data-num=283></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=285></td><td><pre>				<span class="token string">"HttpServer::Accept() => Not support for current "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=286></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=287></td><td><pre>				<span class="token string">" request method"</span></pre></td></tr><tr><td data-num=288></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=289></td><td><pre>			<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=290></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=291></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=292></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h3 id=点击回复按钮功能的前端样式><a class=anchor href=#点击回复按钮功能的前端样式>#</a> 点击回复按钮功能的前端样式</h3><p>参考了CodePen中<code>Agustin Ortiz</code>作者的<span class=exturl data-url="aHR0cHM6Ly9jb2RlcGVuLmlvL0NyZWF0aWNvZGUvcGVuL3lMV3FYbw==">评论块样式模板</span>并以此来进行设计。</p><p><img data-src=https://cdn.jsdelivr.net/gh/ReverseSacle/Gallery@latest/programming/project/comment-system/3.webp alt="" height=75% width=75%></p><figure class="highlight js"><figcaption data-lang=JavaScript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">function</span> <span class="token function">replyCancleClick</span><span class="token punctuation">(</span><span class="token parameter">reply_labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">var</span> commentBox <span class="token operator">=</span> reply_labels<span class="token punctuation">.</span>reply_commentBox<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> reply_labels<span class="token punctuation">.</span>reply_commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">var</span> reply_prev_sibling <span class="token operator">=</span> reply_labels<span class="token punctuation">.</span>reply_prev_sibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">var</span> origin_height <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">var</span> orgin_prev_height <span class="token operator">=</span> reply_prev_sibling<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre>    commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> origin_height <span class="token operator">-</span> <span class="token number">310</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    reply_prev_sibling<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> orgin_prev_height <span class="token operator">-</span> <span class="token number">340</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    reply_prev_sibling<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"unset"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>    commentBox<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>commentBox<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">replyClick</span><span class="token punctuation">(</span><span class="token parameter">reply_label<span class="token punctuation">,</span>labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token keyword">var</span> reply_cboxHead <span class="token operator">=</span> reply_label<span class="token punctuation">.</span>parentElement<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token keyword">var</span> reply_commentBox <span class="token operator">=</span> reply_cboxHead<span class="token punctuation">.</span>parentElement<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token keyword">var</span> has_inputBlock <span class="token operator">=</span> reply_commentBox<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"input-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> has_inputBlock<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token keyword">var</span> reply_inputBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">var</span> reply_inputArea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token keyword">var</span> reply_nickname <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token keyword">var</span> reply_email <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token keyword">var</span> reply_textBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"textarea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token keyword">var</span> reply_buttonArea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token keyword">var</span> reply_commit <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token keyword">var</span> reply_labels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>    reply_inputBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"input-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"input-area clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>    reply_nickname<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>    reply_nickname<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"nickname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    reply_nickname<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"maxlength"</span><span class="token punctuation">,</span><span class="token string">"19"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    reply_nickname<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"placeholder"</span><span class="token punctuation">,</span><span class="token string">" nickname(1~19个字符)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre>    reply_email<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    reply_email<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>    reply_email<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"maxlength"</span><span class="token punctuation">,</span><span class="token string">"44"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>    reply_email<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"placeholder"</span><span class="token punctuation">,</span><span class="token string">" email(8~44个字符)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre>    reply_textBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"text-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    reply_textBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"cols"</span><span class="token punctuation">,</span><span class="token string">"50"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>    reply_textBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"placeholder"</span><span class="token punctuation">,</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre></pre></td></tr><tr><td data-num=51></td><td><pre>    reply_buttonArea<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"button-area clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=52></td><td><pre>    reply_commit<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=53></td><td><pre>    reply_commit<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"commit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre>    reply_commit<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"提交"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre>    reply_inputBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_inputArea<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_nickname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_email<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_textBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_buttonArea<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre>    reply_buttonArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_commit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>    reply_commentBox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_inputBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=65></td><td><pre></pre></td></tr><tr><td data-num=66></td><td><pre>    <span class="token keyword">var</span> origin_height <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>    labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> origin_height <span class="token operator">+</span> <span class="token number">310</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>    <span class="token keyword">var</span> reply_prev_sibling <span class="token operator">=</span> reply_inputBlock<span class="token punctuation">.</span>previousSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>    <span class="token keyword">var</span> orgin_prev_height <span class="token operator">=</span> reply_prev_sibling<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>    reply_prev_sibling<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> orgin_prev_height <span class="token operator">+</span> <span class="token number">340</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>    reply_prev_sibling<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre></pre></td></tr><tr><td data-num=74></td><td><pre>    reply_labels<span class="token punctuation">.</span>reply_commentBox <span class="token operator">=</span> reply_commentBox<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>    reply_labels<span class="token punctuation">.</span>reply_commentBlock <span class="token operator">=</span> labels<span class="token punctuation">.</span>commentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>    reply_labels<span class="token punctuation">.</span>reply_inputBlock <span class="token operator">=</span> reply_inputBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>    reply_labels<span class="token punctuation">.</span>reply_prev_sibling <span class="token operator">=</span> reply_prev_sibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre></pre></td></tr><tr><td data-num=79></td><td><pre>    <span class="token keyword">var</span> reply_cancle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>    reply_cancle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>    reply_cancle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cancle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>    reply_cancle<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"X"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>reply_cancle<span class="token punctuation">,</span>reply_textBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre></pre></td></tr><tr><td data-num=85></td><td><pre>    reply_cancle<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=86></td><td><pre>        <span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=87></td><td><pre>        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">replyCancleClick</span><span class="token punctuation">(</span>reply_labels<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=88></td><td><pre>        <span class="token boolean">false</span></pre></td></tr><tr><td data-num=89></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=前端回复按钮提交与后端响应><a class=anchor href=#前端回复按钮提交与后端响应>#</a> 前端回复按钮提交与后端响应</h3><p><img data-src=https://cdn.jsdelivr.net/gh/ReverseSacle/Gallery@latest/programming/project/comment-system/4.webp alt="" height=70% width=70%></p><p>这里的前端css样式，对选择器进行了精简。js代码的逻辑进行了变更，与之前相比更易阅读。html文件中删除了预先设定的评论展示区块，变成了由js动态触发而展示的区域了。</p><p>后端代码中主要区分了前端的主线评论，主线子评论的响应方式以及对主线评论的数量统计的响应。</p><details class=info><summary>前端回复评论的样式与功能</summary><div><figure class="highlight css"><figcaption data-lang=CSS><span>./docs/css/comment_reply.css</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token selector">#comment-block .comment-list li .comment-box .input-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 450px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 290px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 70px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token selector">#comment-block .comment-list li .comment-box .input-block </span></pre></td></tr><tr><td data-num=8></td><td><pre>.input-area<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 430px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 285px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token selector">#comment-block .comment-list li .comment-box .input-block </span></pre></td></tr><tr><td data-num=14></td><td><pre>.input-area .nickname<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 158px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 28px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token selector">#comment-block .comment-list li .comment-box .input-block </span></pre></td></tr><tr><td data-num=20></td><td><pre>.input-area .email<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 228px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 28px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token selector">#comment-block .comment-list li .comment-box .input-block </span></pre></td></tr><tr><td data-num=26></td><td><pre>.input-area .text-block<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 430px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 225px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token selector">#comment-block .comment-list li .comment-box .input-block </span></pre></td></tr><tr><td data-num=32></td><td><pre>.input-area .cancle<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token selector">#comment-block .comment-list li .comment-box .input-block </span></pre></td></tr><tr><td data-num=39></td><td><pre>.input-area .cancle:hover<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #e9546b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token selector">#comment-block .comment-list li .comment-box .input-block </span></pre></td></tr><tr><td data-num=44></td><td><pre>.button-area .commit<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>    <span class="token property">line-height</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=50></td><td><pre></pre></td></tr><tr><td data-num=51></td><td><pre><span class="token comment">/* child list reply input */</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token comment">/****************************************/</span></pre></td></tr><tr><td data-num=53></td><td><pre><span class="token selector">#comment-block .comment-list li .child-list .comment-box .input-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 290px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token selector">#comment-block .comment-list li .child-list .comment-box .input-block </span></pre></td></tr><tr><td data-num=60></td><td><pre>.input-area<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 380px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 285px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=64></td><td><pre></pre></td></tr><tr><td data-num=65></td><td><pre><span class="token selector">#comment-block .comment-list li .child-list .comment-box .input-block </span></pre></td></tr><tr><td data-num=66></td><td><pre>.input-area .nickname<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=67></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 158px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=70></td><td><pre></pre></td></tr><tr><td data-num=71></td><td><pre><span class="token selector">#comment-block .comment-list li .child-list .comment-box .input-block </span></pre></td></tr><tr><td data-num=72></td><td><pre>.input-area .email<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=73></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 208px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=76></td><td><pre></pre></td></tr><tr><td data-num=77></td><td><pre><span class="token selector">#comment-block .comment-list li .child-list .comment-box .input-block </span></pre></td></tr><tr><td data-num=78></td><td><pre>.input-area .text-block<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=79></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 380px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 225px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token selector">#comment-block .comment-list li .child-list .comment-box .input-block </span></pre></td></tr><tr><td data-num=84></td><td><pre>.input-area .cancle<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=85></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=89></td><td><pre></pre></td></tr><tr><td data-num=90></td><td><pre><span class="token selector">#comment-block .comment-list li .child-list .comment-box .input-block </span></pre></td></tr><tr><td data-num=91></td><td><pre>.input-area .cancle:hover<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=92></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #e9546b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=94></td><td><pre></pre></td></tr><tr><td data-num=95></td><td><pre><span class="token selector">#comment-block .comment-list li .child-list .comment-box .input-block </span></pre></td></tr><tr><td data-num=96></td><td><pre>.button-area .commit<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=97></td><td><pre>    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>    <span class="token property">line-height</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=102></td><td><pre><span class="token comment">/****************************************/</span></pre></td></tr><tr><td data-num=103></td><td><pre></pre></td></tr><tr><td data-num=104></td><td><pre><span class="token comment">/* reply style */</span></pre></td></tr><tr><td data-num=105></td><td><pre><span class="token selector">#comment-block .comment-list .comment-box .cbox-head .reply</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=106></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>    <span class="token property">margin-left</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #e9546b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>    <span class="token property">-webkit-transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>    <span class="token property">-o-transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre>    <span class="token property">transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=116></td><td><pre></pre></td></tr><tr><td data-num=117></td><td><pre><span class="token selector">#comment-block .comment-list .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=118></td><td><pre>.reply:hover<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=119></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #03658c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=121></td><td><pre><span class="token comment">/******************************/</span></pre></td></tr><tr><td data-num=122></td><td><pre></pre></td></tr><tr><td data-num=123></td><td><pre><span class="token selector">#comment-block .comment-list .child-list::before,</span></pre></td></tr><tr><td data-num=124></td><td><pre>#comment-block .comment-list .child-list::after<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=125></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre></pre></td></tr><tr><td data-num=128></td><td><pre><span class="token selector">#comment-block .comment-list .child-list li::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=129></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 56px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 28px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=137></td><td><pre></pre></td></tr><tr><td data-num=138></td><td><pre><span class="token selector">#comment-block .comment-list .child-list .avatar</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=139></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>    <span class="token property">margin-left</span><span class="token punctuation">:</span> 75px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=144></td><td><pre></pre></td></tr><tr><td data-num=145></td><td><pre><span class="token selector">#comment-block .comment-list .child-list .comment-box</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=146></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 405px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=148></td><td><pre></pre></td></tr><tr><td data-num=149></td><td><pre><span class="token selector">#comment-block .comment-list .child-list .comment-box</span></pre></td></tr><tr><td data-num=150></td><td><pre>.cbox-head<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=151></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 6px 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=153></td><td><pre></pre></td></tr><tr><td data-num=154></td><td><pre><span class="token selector">#comment-block .comment-list .child-list .comment-box</span></pre></td></tr><tr><td data-num=155></td><td><pre>.cbox-head .cbauthor-name<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=156></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=158></td><td><pre></pre></td></tr><tr><td data-num=159></td><td><pre><span class="token selector">#comment-block .comment-list .child-list .comment-box</span></pre></td></tr><tr><td data-num=160></td><td><pre>.cbox-head span<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=161></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=163></td><td><pre></pre></td></tr><tr><td data-num=164></td><td><pre><span class="token selector">#comment-block .comment-list .child-list .comment-box</span></pre></td></tr><tr><td data-num=165></td><td><pre>.cbox-head .reply<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=166></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>    <span class="token property">margin-left</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #e9546b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>    <span class="token property">-webkit-transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>    <span class="token property">-o-transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>    <span class="token property">transition</span><span class="token punctuation">:</span> color 0.3s ease<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=176></td><td><pre></pre></td></tr><tr><td data-num=177></td><td><pre><span class="token selector">#comment-block .comment-list .child-list .comment-box</span></pre></td></tr><tr><td data-num=178></td><td><pre>.cbox-head .reply:hover<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=179></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #03658c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=181></td><td><pre></pre></td></tr><tr><td data-num=182></td><td><pre><span class="token selector">#comment-block .comment-list .child-list .comment-box</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=183></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang=JavaScript><span>./docs/js/comments.js</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">const</span> _host <span class="token operator">=</span> <span class="token string">"192.168.80.145"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>        <span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> _host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=8></td><td><pre>            _URL<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>                <span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>                    <span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>                <span class="token literal-property property">body</span><span class="token operator">:</span> data<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>        <span class="token keyword">return</span> response<span class="token punctuation">.</span>ok<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>        <span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> _host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>        <span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>_URL<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commentCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token keyword">const</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token string">"/database_count"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>    <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> count <span class="token operator">=</span> responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=39></td><td><pre></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token keyword">return</span> count<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token keyword">function</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span><span class="token parameter">textsLabel<span class="token punctuation">,</span>cols</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>    <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>    <span class="token keyword">var</span> texts <span class="token operator">=</span> <span class="token punctuation">(</span>textsLabel<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r|\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>    <span class="token keyword">var</span> textLength <span class="token operator">=</span> texts<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> textLength<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=51></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> cache<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token number">0</span> <span class="token operator">===</span> cache<span class="token punctuation">.</span>length <span class="token operator">%</span> cols<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=52></td><td><pre>            cache <span class="token operator">+=</span> <span class="token string">"&lt;br/>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=54></td><td><pre>        cache <span class="token operator">+=</span> texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token keyword">return</span> cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token keyword">function</span> <span class="token function">timestampTackle</span><span class="token punctuation">(</span><span class="token parameter">timeSpendLabel<span class="token punctuation">,</span>create_at</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=60></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>    <span class="token keyword">const</span> timeSpace <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>    <span class="token keyword">const</span> days <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">24</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>    <span class="token keyword">const</span> f_days <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>    <span class="token keyword">const</span> hours <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>    <span class="token keyword">const</span> f_hours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>    <span class="token keyword">const</span> minutes <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>    <span class="token keyword">const</span> f_minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_days<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=70></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=71></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>f_days <span class="token operator">></span> <span class="token number">365</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=72></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=73></td><td><pre>            <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>timeSpace<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>            <span class="token keyword">const</span> year <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>            <span class="token keyword">const</span> month <span class="token operator">=</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>            <span class="token keyword">const</span> day <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>            <span class="token keyword">const</span> format_time <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>year<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>month<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>day<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>            timeSpendLabel<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> format_time<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> timeSpendLabel<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_days <span class="token operator">+</span> <span class="token string">" 天前"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=80></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> timeSpendLabel<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_hours <span class="token operator">+</span> <span class="token string">" 小时前"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span> timeSpendLabel<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_minutes <span class="token operator">+</span> <span class="token string">" 分钟前"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre></pre></td></tr><tr><td data-num=85></td><td><pre><span class="token keyword">function</span> <span class="token function">avatarAppend</span><span class="token punctuation">(</span><span class="token parameter">mainUserLabel<span class="token punctuation">,</span>mail_md5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=86></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=87></td><td><pre>    <span class="token keyword">var</span> avatarLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre>    avatarLabel<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"avatar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre></pre></td></tr><tr><td data-num=90></td><td><pre>    <span class="token keyword">var</span> imgUrl <span class="token operator">=</span> <span class="token string">"https://gravatar.com/avatar/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>    avatarLabel<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"&lt;img src=\""</span> <span class="token operator">+</span> imgUrl <span class="token operator">+</span> mail_md5 <span class="token operator">+</span> <span class="token string">"\" alt=img>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>    mainUserLabel<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>avatarLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=94></td><td><pre></pre></td></tr><tr><td data-num=95></td><td><pre><span class="token keyword">function</span> <span class="token function">commentAppend</span><span class="token punctuation">(</span><span class="token parameter">mainUserLabel<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=96></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=97></td><td><pre>    <span class="token keyword">var</span> commentBoxLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>    commentBoxLabel<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre></pre></td></tr><tr><td data-num=100></td><td><pre>    <span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=101></td><td><pre>    <span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=102></td><td><pre>    <span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre></pre></td></tr><tr><td data-num=105></td><td><pre>    <span class="token comment">/* nickname area */</span></pre></td></tr><tr><td data-num=106></td><td><pre>    <span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>    authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>    authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> record<span class="token punctuation">.</span>nick_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre></pre></td></tr><tr><td data-num=110></td><td><pre>    <span class="token comment">/* timestamp transform into format time */</span></pre></td></tr><tr><td data-num=111></td><td><pre>    <span class="token keyword">var</span> timeSpendLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>    <span class="token function">timestampTackle</span><span class="token punctuation">(</span>timeSpendLabel<span class="token punctuation">,</span>record<span class="token punctuation">.</span>create_at<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre></pre></td></tr><tr><td data-num=114></td><td><pre>    <span class="token comment">/* reply area */</span></pre></td></tr><tr><td data-num=115></td><td><pre>    <span class="token keyword">var</span> replyLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>    replyLabel<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>    replyLabel<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"response_id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>    replyLabel<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"回复"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre></pre></td></tr><tr><td data-num=120></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpendLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>replyLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>    commentBoxLabel<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>    <span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=125></td><td><pre>    <span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=126></td><td><pre></pre></td></tr><tr><td data-num=127></td><td><pre>    <span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=128></td><td><pre>    <span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre>    boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre></pre></td></tr><tr><td data-num=131></td><td><pre>    boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> record<span class="token punctuation">.</span>comment<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre>    commentBoxLabel<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre></pre></td></tr><tr><td data-num=134></td><td><pre>    mainUserLabel<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=136></td><td><pre></pre></td></tr><tr><td data-num=137></td><td><pre><span class="token keyword">function</span> <span class="token function">contentAppend</span><span class="token punctuation">(</span><span class="token parameter">userBlock<span class="token punctuation">,</span>record</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=138></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=139></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>    <span class="token keyword">var</span> mainUserLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre></pre></td></tr><tr><td data-num=143></td><td><pre>    mainUserLabel<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"main-level clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre></pre></td></tr><tr><td data-num=145></td><td><pre>    <span class="token function">avatarAppend</span><span class="token punctuation">(</span>mainUserLabel<span class="token punctuation">,</span>record<span class="token punctuation">.</span>mail_md5<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>    <span class="token function">commentAppend</span><span class="token punctuation">(</span>mainUserLabel<span class="token punctuation">,</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>    userBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mainUserLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre></pre></td></tr><tr><td data-num=149></td><td><pre>    <span class="token comment">/* state stretch */</span></pre></td></tr><tr><td data-num=150></td><td><pre>    <span class="token keyword">var</span> CB_Height <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>    <span class="token keyword">var</span> newHeight <span class="token operator">=</span> CB_Height <span class="token operator">+</span> <span class="token number">90</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre></pre></td></tr><tr><td data-num=153></td><td><pre>    commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>    commentContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">-</span> <span class="token number">325</span> <span class="token operator">+</span>  <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=156></td><td><pre></pre></td></tr><tr><td data-num=157></td><td><pre><span class="token keyword">function</span> <span class="token function">replyCancleClick</span><span class="token punctuation">(</span><span class="token parameter">reply_label</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=158></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=159></td><td><pre>    <span class="token keyword">var</span> cboxHead <span class="token operator">=</span> reply_label<span class="token punctuation">.</span>parentElement<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>    <span class="token keyword">var</span> commentBox <span class="token operator">=</span> cboxHead<span class="token punctuation">.</span>parentElement<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>    <span class="token keyword">var</span> cboxContent <span class="token operator">=</span> cboxHead<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>    <span class="token keyword">var</span> CB_height <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=164></td><td><pre>    <span class="token keyword">var</span> CC_height <span class="token operator">=</span> cboxContent<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre></pre></td></tr><tr><td data-num=166></td><td><pre>    commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> CB_height <span class="token operator">-</span> <span class="token number">305</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>    cboxContent<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> CC_height <span class="token operator">-</span> <span class="token number">340</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>    cboxContent<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"unset"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre></pre></td></tr><tr><td data-num=170></td><td><pre>    commentBox<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>commentBox<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=171></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=172></td><td><pre></pre></td></tr><tr><td data-num=173></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">replyCommitClick</span><span class="token punctuation">(</span><span class="token parameter">reply_label</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=174></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=175></td><td><pre>    <span class="token keyword">var</span> cboxHead <span class="token operator">=</span> reply_label<span class="token punctuation">.</span>parentElement<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>    <span class="token keyword">var</span> cboxContent <span class="token operator">=</span> cboxHead<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre>    <span class="token keyword">var</span> inputBlock <span class="token operator">=</span> cboxContent<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>    <span class="token keyword">var</span> inputArea <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>    <span class="token keyword">var</span> nickname_label <span class="token operator">=</span> inputArea<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>    <span class="token keyword">var</span> email_label <span class="token operator">=</span> nickname_label<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>    <span class="token keyword">var</span> button_label <span class="token operator">=</span> email_label<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>    <span class="token keyword">var</span> text_label <span class="token operator">=</span> button_label<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre></pre></td></tr><tr><td data-num=184></td><td><pre>    <span class="token keyword">var</span> nickname_label_value <span class="token operator">=</span> nickname_label<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>    <span class="token keyword">var</span> email_md5 <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">SHA256</span><span class="token punctuation">(</span>email_label<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre>    <span class="token keyword">var</span> reply_parent <span class="token operator">=</span> cboxHead<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre></pre></td></tr><tr><td data-num=188></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token string">"parent_id"</span> <span class="token operator">!=</span> reply_parent<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=189></td><td><pre>        reply_parent <span class="token operator">=</span> reply_parent<span class="token punctuation">.</span>parentElement<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=191></td><td><pre></pre></td></tr><tr><td data-num=192></td><td><pre>    <span class="token keyword">var</span> response_id <span class="token operator">=</span> reply_label<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"response_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre>    <span class="token keyword">var</span> parent_id <span class="token operator">=</span> reply_parent<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre></pre></td></tr><tr><td data-num=195></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> nickname_label_value<span class="token punctuation">.</span>length<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=196></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=197></td><td><pre>        <span class="token keyword">var</span> comment <span class="token operator">=</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=198></td><td><pre>            text_label<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=199></td><td><pre>            text_label<span class="token punctuation">.</span>cols</pre></td></tr><tr><td data-num=200></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>        <span class="token keyword">var</span> curTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=203></td><td><pre>            <span class="token string">":"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=204></td><td><pre>            parent_id <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=205></td><td><pre>            response_id <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=206></td><td><pre>            nickname_label_value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=207></td><td><pre>            email_label<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=208></td><td><pre>            email_md5 <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=209></td><td><pre>            curTime <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=210></td><td><pre>            comment</pre></td></tr><tr><td data-num=211></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre></pre></td></tr><tr><td data-num=213></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">==</span> <span class="token keyword">await</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=214></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=215></td><td><pre>            <span class="token function">replyCancleClick</span><span class="token punctuation">(</span>reply_label<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=216></td><td><pre>            <span class="token function">commentReplyShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=217></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=218></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=219></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=220></td><td><pre></pre></td></tr><tr><td data-num=221></td><td><pre><span class="token keyword">function</span> <span class="token function">replyClick</span><span class="token punctuation">(</span><span class="token parameter">reply_label</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=222></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=223></td><td><pre>    <span class="token keyword">var</span> cboxHead <span class="token operator">=</span> reply_label<span class="token punctuation">.</span>parentElement<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=224></td><td><pre>    <span class="token keyword">var</span> reply_commentBox <span class="token operator">=</span> cboxHead<span class="token punctuation">.</span>parentElement<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>    <span class="token keyword">var</span> comment_inputBlock <span class="token operator">=</span> reply_commentBox<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=226></td><td><pre></pre></td></tr><tr><td data-num=227></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"input-block"</span> <span class="token operator">==</span> comment_inputBlock<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=228></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=229></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=230></td><td><pre></pre></td></tr><tr><td data-num=231></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>    <span class="token keyword">var</span> reply_inputBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=233></td><td><pre>    <span class="token keyword">var</span> reply_inputArea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=234></td><td><pre>    <span class="token keyword">var</span> reply_nickname <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre>    <span class="token keyword">var</span> reply_email <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre>    <span class="token keyword">var</span> reply_textBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"textarea"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre>    <span class="token keyword">var</span> reply_buttonArea <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>    <span class="token keyword">var</span> reply_commit <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre></pre></td></tr><tr><td data-num=240></td><td><pre>    reply_inputBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"input-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=241></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"input-area clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre></pre></td></tr><tr><td data-num=243></td><td><pre>    reply_nickname<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre>    reply_nickname<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"nickname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=245></td><td><pre>    reply_nickname<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"maxlength"</span><span class="token punctuation">,</span><span class="token string">"19"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>    reply_nickname<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"placeholder"</span><span class="token punctuation">,</span><span class="token string">" nickname(1~19个字符)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre></pre></td></tr><tr><td data-num=248></td><td><pre>    reply_email<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>    reply_email<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>    reply_email<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"maxlength"</span><span class="token punctuation">,</span><span class="token string">"44"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>    reply_email<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"placeholder"</span><span class="token punctuation">,</span><span class="token string">" email(8~44个字符)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre></pre></td></tr><tr><td data-num=253></td><td><pre>    reply_textBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"text-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=254></td><td><pre>    reply_textBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"cols"</span><span class="token punctuation">,</span><span class="token string">"50"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>    reply_textBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"placeholder"</span><span class="token punctuation">,</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=256></td><td><pre></pre></td></tr><tr><td data-num=257></td><td><pre>    reply_buttonArea<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"button-area clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>    reply_commit<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre>    reply_commit<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"commit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=260></td><td><pre>    reply_commit<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"提交"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=261></td><td><pre></pre></td></tr><tr><td data-num=262></td><td><pre>    reply_inputBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_inputArea<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_nickname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=264></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_email<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=265></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_textBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=266></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_buttonArea<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=267></td><td><pre></pre></td></tr><tr><td data-num=268></td><td><pre>    reply_buttonArea<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_commit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=269></td><td><pre>    reply_commentBox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>reply_inputBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=270></td><td><pre></pre></td></tr><tr><td data-num=271></td><td><pre>    <span class="token keyword">var</span> origin_height <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=272></td><td><pre>    commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> origin_height <span class="token operator">+</span> <span class="token number">300</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=273></td><td><pre></pre></td></tr><tr><td data-num=274></td><td><pre>    <span class="token keyword">var</span> reply_prev_sibling <span class="token operator">=</span> reply_inputBlock<span class="token punctuation">.</span>previousSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=275></td><td><pre>    <span class="token keyword">var</span> orgin_prev_height <span class="token operator">=</span> reply_prev_sibling<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=276></td><td><pre>    reply_prev_sibling<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> orgin_prev_height <span class="token operator">+</span> <span class="token number">335</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=277></td><td><pre>    reply_prev_sibling<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=278></td><td><pre></pre></td></tr><tr><td data-num=279></td><td><pre>    <span class="token keyword">var</span> reply_cancle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=280></td><td><pre>    reply_cancle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre></pre></td></tr><tr><td data-num=282></td><td><pre>    reply_cancle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cancle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=283></td><td><pre>    reply_cancle<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"X"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>    reply_inputArea<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>reply_cancle<span class="token punctuation">,</span>reply_textBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=285></td><td><pre></pre></td></tr><tr><td data-num=286></td><td><pre>    reply_cancle<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=287></td><td><pre>        <span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=288></td><td><pre>        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">replyCancleClick</span><span class="token punctuation">(</span>reply_label<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=289></td><td><pre>        <span class="token boolean">false</span></pre></td></tr><tr><td data-num=290></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=291></td><td><pre></pre></td></tr><tr><td data-num=292></td><td><pre>    reply_commit<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=293></td><td><pre>        <span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=294></td><td><pre>        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">replyCommitClick</span><span class="token punctuation">(</span>reply_label<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=295></td><td><pre>        <span class="token boolean">false</span></pre></td></tr><tr><td data-num=296></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=297></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=298></td><td><pre></pre></td></tr><tr><td data-num=299></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commentPreShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=300></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=301></td><td><pre>    <span class="token keyword">const</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token string">"/database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=302></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=303></td><td><pre></pre></td></tr><tr><td data-num=304></td><td><pre>    <span class="token keyword">var</span> data <span class="token operator">=</span> responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=305></td><td><pre>    <span class="token keyword">var</span> array <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=306></td><td><pre>    <span class="token keyword">const</span> array_length <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=307></td><td><pre></pre></td></tr><tr><td data-num=308></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">||</span> <span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=309></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=310></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=311></td><td><pre></pre></td></tr><tr><td data-num=312></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=313></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=314></td><td><pre></pre></td></tr><tr><td data-num=315></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"comment-container"</span> <span class="token operator">!=</span> commentContainer<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=316></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=317></td><td><pre>        <span class="token keyword">var</span> newCommentContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=318></td><td><pre>        <span class="token keyword">var</span> newInfo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=319></td><td><pre>        <span class="token keyword">var</span> newCommentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=320></td><td><pre></pre></td></tr><tr><td data-num=321></td><td><pre>        newCommentContainer<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=322></td><td><pre>        newInfo<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=323></td><td><pre>        newInfo<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=324></td><td><pre>        newCommentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=325></td><td><pre></pre></td></tr><tr><td data-num=326></td><td><pre>        newCommentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=327></td><td><pre>        newCommentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newCommentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=328></td><td><pre>        commentBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newCommentContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=329></td><td><pre></pre></td></tr><tr><td data-num=330></td><td><pre>        commentContainer <span class="token operator">=</span> newCommentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=331></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=332></td><td><pre>    <span class="token keyword">var</span> commentList <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=333></td><td><pre>    <span class="token keyword">var</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=334></td><td><pre></pre></td></tr><tr><td data-num=335></td><td><pre>    array<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=336></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> array_length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=337></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=338></td><td><pre>        <span class="token keyword">var</span> sub <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=339></td><td><pre>        <span class="token keyword">var</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=340></td><td><pre></pre></td></tr><tr><td data-num=341></td><td><pre>        record<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=342></td><td><pre>        record<span class="token punctuation">.</span>parent_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=343></td><td><pre>        record<span class="token punctuation">.</span>response_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=344></td><td><pre>        record<span class="token punctuation">.</span>nick_name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=345></td><td><pre>        record<span class="token punctuation">.</span>mail <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=346></td><td><pre>        record<span class="token punctuation">.</span>mail_md5 <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=347></td><td><pre>        record<span class="token punctuation">.</span>create_at <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=348></td><td><pre>        record<span class="token punctuation">.</span>comment <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=349></td><td><pre></pre></td></tr><tr><td data-num=350></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">undefined</span> <span class="token operator">==</span> sub<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=351></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=352></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=353></td><td><pre>            <span class="token keyword">const</span> c <span class="token operator">=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=354></td><td><pre></pre></td></tr><tr><td data-num=355></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">":"</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">7</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=356></td><td><pre>            <span class="token keyword">else</span></pre></td></tr><tr><td data-num=357></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=358></td><td><pre>                <span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=359></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=360></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=361></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=362></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=363></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=364></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>mail <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=365></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>mail_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=366></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=367></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>comment <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=368></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=369></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=370></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=371></td><td><pre>        <span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=372></td><td><pre>        <span class="token keyword">var</span> commentListFirstChild <span class="token operator">=</span> commentList<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=373></td><td><pre></pre></td></tr><tr><td data-num=374></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=375></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"parent_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=376></td><td><pre></pre></td></tr><tr><td data-num=377></td><td><pre>        <span class="token function">contentAppend</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=378></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> commentListFirstChild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=379></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=380></td><td><pre>            commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=381></td><td><pre>            commentList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=382></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=383></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span> commentList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>commentListFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=384></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=385></td><td><pre>    <span class="token keyword">var</span> commentNum <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">commentCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=386></td><td><pre>    <span class="token keyword">var</span> info <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=387></td><td><pre>    <span class="token keyword">var</span> replyElements <span class="token operator">=</span> commentList<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=388></td><td><pre></pre></td></tr><tr><td data-num=389></td><td><pre>    info<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"已有"</span> <span class="token operator">+</span> commentNum <span class="token operator">+</span> <span class="token string">"条评论"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=390></td><td><pre></pre></td></tr><tr><td data-num=391></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> reply <span class="token keyword">of</span> replyElements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=392></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=393></td><td><pre>        reply<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=394></td><td><pre>            <span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=395></td><td><pre>            <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">replyClick</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=396></td><td><pre>            <span class="token boolean">false</span></pre></td></tr><tr><td data-num=397></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=398></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=399></td><td><pre>	<span class="token function">commentReplyShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=400></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=401></td><td><pre></pre></td></tr><tr><td data-num=402></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">buttonClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=403></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=404></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=405></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=406></td><td><pre></pre></td></tr><tr><td data-num=407></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"comment-container"</span> <span class="token operator">!=</span> commentContainer<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=408></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=409></td><td><pre>        <span class="token keyword">var</span> newCommentContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=410></td><td><pre>        <span class="token keyword">var</span> newInfo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=411></td><td><pre>        <span class="token keyword">var</span> newCommentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=412></td><td><pre></pre></td></tr><tr><td data-num=413></td><td><pre>        newCommentContainer<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=414></td><td><pre>        newInfo<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=415></td><td><pre>        newInfo<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=416></td><td><pre>        newCommentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=417></td><td><pre></pre></td></tr><tr><td data-num=418></td><td><pre>        newCommentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=419></td><td><pre>        newCommentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newCommentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=420></td><td><pre>        commentBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newCommentContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=421></td><td><pre></pre></td></tr><tr><td data-num=422></td><td><pre>        commentContainer <span class="token operator">=</span> newCommentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=423></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=424></td><td><pre>    <span class="token keyword">var</span> commentList <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=425></td><td><pre>    <span class="token keyword">var</span> inputBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=426></td><td><pre>    <span class="token keyword">var</span> inputArea <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=427></td><td><pre></pre></td></tr><tr><td data-num=428></td><td><pre>    <span class="token keyword">var</span> nickname_label <span class="token operator">=</span> inputArea<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=429></td><td><pre>    <span class="token keyword">var</span> email_label <span class="token operator">=</span> nickname_label<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=430></td><td><pre>    <span class="token keyword">var</span> text_label <span class="token operator">=</span> email_label<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=431></td><td><pre>    <span class="token keyword">var</span> email_md5 <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">SHA256</span><span class="token punctuation">(</span>email_label<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=432></td><td><pre>    <span class="token keyword">var</span> nickname_label_value <span class="token operator">=</span> nickname_label<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=433></td><td><pre></pre></td></tr><tr><td data-num=434></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> nickname_label_value<span class="token punctuation">.</span>length<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=435></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=436></td><td><pre>        <span class="token comment">/* current time */</span></pre></td></tr><tr><td data-num=437></td><td><pre>        <span class="token keyword">var</span> comment <span class="token operator">=</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span>text_label<span class="token punctuation">,</span>text_label<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=438></td><td><pre>        <span class="token keyword">var</span> curTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=439></td><td><pre>        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=440></td><td><pre>            <span class="token string">":"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=441></td><td><pre>            <span class="token string">":"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=442></td><td><pre>            <span class="token string">":"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=443></td><td><pre>            nickname_label_value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=444></td><td><pre>            email_label<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=445></td><td><pre>            email_md5 <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=446></td><td><pre>            curTime  <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=447></td><td><pre>            comment</pre></td></tr><tr><td data-num=448></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=449></td><td><pre></pre></td></tr><tr><td data-num=450></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">==</span> <span class="token keyword">await</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=451></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=452></td><td><pre>            commentContainer<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=453></td><td><pre>            commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">"360px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=454></td><td><pre>            commentContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">"0px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=455></td><td><pre></pre></td></tr><tr><td data-num=456></td><td><pre>            <span class="token keyword">var</span> commentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=457></td><td><pre>            <span class="token keyword">var</span> commentNum <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">commentCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=458></td><td><pre>            <span class="token keyword">var</span> info <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=459></td><td><pre></pre></td></tr><tr><td data-num=460></td><td><pre>            commentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=461></td><td><pre>            commentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=462></td><td><pre>            <span class="token function">commentPreShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=463></td><td><pre></pre></td></tr><tr><td data-num=464></td><td><pre>            info<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"已有"</span> <span class="token operator">+</span> commentNum <span class="token operator">+</span> <span class="token string">"条评论"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=465></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=466></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=467></td><td><pre></pre></td></tr><tr><td data-num=468></td><td><pre>    nickname_label<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=469></td><td><pre>    email_label<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=470></td><td><pre>    text_label<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=471></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=472></td><td><pre></pre></td></tr><tr><td data-num=473></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commentReplyShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=474></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=475></td><td><pre>    <span class="token keyword">const</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token string">"/database_reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=476></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=477></td><td><pre></pre></td></tr><tr><td data-num=478></td><td><pre>    <span class="token keyword">var</span> data <span class="token operator">=</span> responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=479></td><td><pre>    <span class="token keyword">var</span> array <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=480></td><td><pre>    <span class="token keyword">const</span> array_length <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=481></td><td><pre></pre></td></tr><tr><td data-num=482></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">||</span> <span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=483></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=484></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=485></td><td><pre></pre></td></tr><tr><td data-num=486></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=487></td><td><pre>    <span class="token keyword">var</span> parent_id_elements <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"parent_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=488></td><td><pre>    <span class="token keyword">var</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=489></td><td><pre></pre></td></tr><tr><td data-num=490></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> parent_id_elements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=491></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=492></td><td><pre>        <span class="token keyword">var</span> child_element <span class="token operator">=</span> p<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=493></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"child-list"</span> <span class="token operator">==</span> child_element<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=494></td><td><pre>            p<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child_element<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=495></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=496></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=497></td><td><pre></pre></td></tr><tr><td data-num=498></td><td><pre>    array<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=499></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> array_length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=500></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=501></td><td><pre>        <span class="token keyword">var</span> sub <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=502></td><td><pre>        <span class="token keyword">var</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=503></td><td><pre></pre></td></tr><tr><td data-num=504></td><td><pre>        record<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=505></td><td><pre>        record<span class="token punctuation">.</span>parent_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=506></td><td><pre>        record<span class="token punctuation">.</span>response_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=507></td><td><pre>        record<span class="token punctuation">.</span>nick_name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=508></td><td><pre>        record<span class="token punctuation">.</span>mail <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=509></td><td><pre>        record<span class="token punctuation">.</span>mail_md5 <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=510></td><td><pre>        record<span class="token punctuation">.</span>create_at <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=511></td><td><pre>        record<span class="token punctuation">.</span>comment <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=512></td><td><pre></pre></td></tr><tr><td data-num=513></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">undefined</span> <span class="token operator">==</span> sub<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=514></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=515></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=516></td><td><pre>            <span class="token keyword">const</span> c <span class="token operator">=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=517></td><td><pre></pre></td></tr><tr><td data-num=518></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">":"</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">7</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=519></td><td><pre>            <span class="token keyword">else</span></pre></td></tr><tr><td data-num=520></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=521></td><td><pre>                <span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=522></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=523></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=524></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=525></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=526></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=527></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>mail <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=528></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>mail_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=529></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=530></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>comment <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=531></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=532></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=533></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=534></td><td><pre>        <span class="token keyword">var</span> parent_label <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>parent_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=535></td><td><pre>        <span class="token keyword">var</span> childList <span class="token operator">=</span> parent_label<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=536></td><td><pre>        <span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=537></td><td><pre></pre></td></tr><tr><td data-num=538></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"child-list"</span> <span class="token operator">!=</span> childList<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=539></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=540></td><td><pre>            childList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=541></td><td><pre>            childList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"child-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=542></td><td><pre>            childList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop <span class="token operator">=</span> <span class="token string">"5px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=543></td><td><pre></pre></td></tr><tr><td data-num=544></td><td><pre>            parent_label<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>childList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=545></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=546></td><td><pre></pre></td></tr><tr><td data-num=547></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=548></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"child_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=549></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"parent_id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>parent_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=550></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"response_id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>response_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=551></td><td><pre></pre></td></tr><tr><td data-num=552></td><td><pre>        <span class="token function">contentAppend</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=553></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> childList<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=554></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=555></td><td><pre>            childList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=556></td><td><pre>            childList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=557></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> childList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=558></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=559></td><td><pre></pre></td></tr><tr><td data-num=560></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> parent_id_elements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=561></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=562></td><td><pre>        <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=563></td><td><pre>        <span class="token keyword">var</span> commentList <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=564></td><td><pre>        <span class="token keyword">var</span> replyElements <span class="token operator">=</span> commentList<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=565></td><td><pre></pre></td></tr><tr><td data-num=566></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> reply <span class="token keyword">of</span> replyElements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=567></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=568></td><td><pre>            reply<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=569></td><td><pre>                <span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=570></td><td><pre>                <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">replyClick</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=571></td><td><pre>                <span class="token boolean">false</span></pre></td></tr><tr><td data-num=572></td><td><pre>            <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=573></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=574></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=575></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=576></td><td><pre></pre></td></tr><tr><td data-num=577></td><td><pre>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=578></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=579></td><td><pre>    <span class="token keyword">var</span> inputBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=580></td><td><pre>    <span class="token keyword">var</span> inputArea <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=581></td><td><pre>    <span class="token keyword">var</span> buttonArea <span class="token operator">=</span> inputArea<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=582></td><td><pre>    <span class="token keyword">var</span> commitButton <span class="token operator">=</span> buttonArea<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=583></td><td><pre></pre></td></tr><tr><td data-num=584></td><td><pre>    <span class="token keyword">await</span> <span class="token function">commentPreShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=585></td><td><pre>    commitButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=586></td><td><pre>        <span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=587></td><td><pre>        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">buttonClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=588></td><td><pre>        <span class="token boolean">false</span></pre></td></tr><tr><td data-num=589></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=590></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight html"><figcaption data-lang=HTML><span>./docs/index.html</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./css/comments.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./css/comment_reply.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/core.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/sha256.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/comments.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=15></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=16></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=17></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nickname<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>19<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> nickname(1~19个字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=18></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>44<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> email(8~44字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=19></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-block<span class="token punctuation">"</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=20></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=21></td><td><pre>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>commit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=22></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=23></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=24></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></div></details><details class=info><summary>后端对前端回复功能请求的处理</summary><div><figure class="highlight cpp"><figcaption data-lang=C++><span>./_database/db.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql++/mysql++.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">// 表记录中一行的数据，处理表名</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Record</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	std<span class="token double-colon punctuation">::</span>string parent_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	std<span class="token double-colon punctuation">::</span>string response_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	std<span class="token double-colon punctuation">::</span>string nick_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	std<span class="token double-colon punctuation">::</span>string mail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	std<span class="token double-colon punctuation">::</span>string mail_md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	std<span class="token double-colon punctuation">::</span>string create_at<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	std<span class="token double-colon punctuation">::</span>string comment<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DataBase</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=21></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Connection conn<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	std<span class="token double-colon punctuation">::</span>string table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	std<span class="token double-colon punctuation">::</span>string db_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 链接数据库</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token keyword">int</span> <span class="token function">TableRecordCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">int</span> <span class="token function">GetTableParentRecordNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录插入</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">GetTableParentRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录中的主评论记录读取</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token keyword">bool</span> <span class="token function">GetTableChildRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 表记录中的回复评论记录读取</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_database/db.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"db.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">auto</span><span class="token operator">&amp;</span> db_config <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetDatabaseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">bool</span> db_connect <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=7></td><td><pre>		db_config<span class="token punctuation">.</span>database_name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>		db_config<span class="token punctuation">.</span>host<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>		db_config<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>		db_config<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>	db_name <span class="token operator">=</span> db_config<span class="token punctuation">.</span>database_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	table_name <span class="token operator">=</span> db_config<span class="token punctuation">.</span>table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> db_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=19></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=22></td><td><pre>			<span class="token string">"DataBase::Connect() => conn.connect() fail"</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token string">"DataBase::Connect() => Succeed"</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre></pre></td></tr><tr><td data-num=41></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=42></td><td><pre>		<span class="token string">"SELECT COUNT(*) FROM information_schema.tables"</span></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token string">" WHERE table_schema = '"</span> <span class="token operator">+</span> db_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token string">"' AND table_name = '"</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> <span class="token string">"';"</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token string">"DataBase::TableIsNull() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=48></td><td><pre>		_sql</pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=51></td><td><pre></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token punctuation">&#125;</span> 	</pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token keyword">int</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableRecordCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre></pre></td></tr><tr><td data-num=64></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre></pre></td></tr><tr><td data-num=67></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=68></td><td><pre>		<span class="token string">"SELECT COUNT(*) FROM "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=69></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token string">"DataBase::TableRecordCount() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=73></td><td><pre>		_sql</pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=76></td><td><pre></pre></td></tr><tr><td data-num=77></td><td><pre>	<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=79></td><td><pre></pre></td></tr><tr><td data-num=80></td><td><pre><span class="token keyword">int</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">GetTableParentRecordNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=81></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=83></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=85></td><td><pre></pre></td></tr><tr><td data-num=86></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre></pre></td></tr><tr><td data-num=89></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=90></td><td><pre>		<span class="token string">"SELECT COUNT(*) FROM "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=91></td><td><pre>		<span class="token string">" WHERE parent_id IS NULL"</span> </pre></td></tr><tr><td data-num=92></td><td><pre>		<span class="token string">" AND response_id IS NULL"</span> </pre></td></tr><tr><td data-num=93></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=94></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=96></td><td><pre>		<span class="token string">"DataBase::GetTableParentRecordNum() => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=97></td><td><pre>		_sql</pre></td></tr><tr><td data-num=98></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=100></td><td><pre></pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=103></td><td><pre></pre></td></tr><tr><td data-num=104></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">TableInsert</span><span class="token punctuation">(</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=105></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=106></td><td><pre>	<span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=107></td><td><pre>		std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>		mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>		<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre></pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=112></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=113></td><td><pre>			mysqlpp<span class="token double-colon punctuation">::</span>Query query_create <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre></pre></td></tr><tr><td data-num=115></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=116></td><td><pre>				<span class="token string">"DataBase::TableInsert => Table is NULL"</span></pre></td></tr><tr><td data-num=117></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"CREATE TABLE "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>			_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"("</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nid CHAR(8) PRIMARY KEY,"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nparent_id CHAR(8),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nresponse_id CHAR(8),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nnick_name CHAR(64),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nmail CHAR(64),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\nmail_md5 CHAR(65),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\ncreate_at CHAR(16),"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\ncomment TEXT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"\n);"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre></pre></td></tr><tr><td data-num=131></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=132></td><td><pre>				<span class="token string">"DataBase::TableInsert => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=133></td><td><pre>				_sql</pre></td></tr><tr><td data-num=134></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=136></td><td><pre>				<span class="token string">"DataBase::TableInsert => query\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=137></td><td><pre>				_sql</pre></td></tr><tr><td data-num=138></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre></pre></td></tr><tr><td data-num=140></td><td><pre>			query_create <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>			query_create<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>			_sql<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			</pre></td></tr><tr><td data-num=143></td><td><pre>		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> count <span class="token operator">=</span> <span class="token function">TableRecordCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=144></td><td><pre></pre></td></tr><tr><td data-num=145></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"INSERT INTO "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>		_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"(id,parent_id,response_id,nick_name,mail,mail_md5,create_at,comment)\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"VALUES('"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>		_sql <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"',"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre></pre></td></tr><tr><td data-num=151></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>record<span class="token operator">-></span>parent_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>record<span class="token operator">-></span>response_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=153></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"NULL,"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"NULL,'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=156></td><td><pre>		<span class="token keyword">else</span></pre></td></tr><tr><td data-num=157></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=158></td><td><pre>			_sql <span class="token operator">+=</span> <span class="token string">"'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>			_sql <span class="token operator">+=</span> record<span class="token operator">-></span>parent_id <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>			_sql <span class="token operator">+=</span> record<span class="token operator">-></span>response_id <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=162></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=164></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>create_at <span class="token operator">+</span><span class="token string">"','"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre>		_sql <span class="token operator">+=</span> record<span class="token operator">-></span>comment<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>		_sql <span class="token operator">+=</span> <span class="token string">"');"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=168></td><td><pre></pre></td></tr><tr><td data-num=169></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=170></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=171></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span> </pre></td></tr><tr><td data-num=172></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=173></td><td><pre>			<span class="token string">"(id,parent_id,response_id,nick_name,mail,mail_md5,create_at,comment)\n"</span>	</pre></td></tr><tr><td data-num=174></td><td><pre>			<span class="token string">"VALUES('"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=175></td><td><pre>			std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=176></td><td><pre>			record<span class="token operator">-></span>parent_id <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=177></td><td><pre>			record<span class="token operator">-></span>response_id <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=178></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=179></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=180></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=181></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=182></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">+</span> </pre></td></tr><tr><td data-num=183></td><td><pre>			<span class="token string">"');"</span></pre></td></tr><tr><td data-num=184></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=186></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query\n"</span> </pre></td></tr><tr><td data-num=187></td><td><pre>			<span class="token string">"INSERT INTO "</span> <span class="token operator">+</span> table_name <span class="token operator">+</span> </pre></td></tr><tr><td data-num=188></td><td><pre>			<span class="token string">"(id,parent_id,response_id,nick_name,mail,mail_md5,create_at,comment)\n"</span>	</pre></td></tr><tr><td data-num=189></td><td><pre>			<span class="token string">"VALUES('"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=190></td><td><pre>			std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=191></td><td><pre>			record<span class="token operator">-></span>parent_id <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=192></td><td><pre>			record<span class="token operator">-></span>response_id <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=193></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=194></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=195></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=196></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">"','"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=197></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">+</span> </pre></td></tr><tr><td data-num=198></td><td><pre>			<span class="token string">"');"</span></pre></td></tr><tr><td data-num=199></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre></pre></td></tr><tr><td data-num=201></td><td><pre>		query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>		query<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">const</span> mysqlpp<span class="token double-colon punctuation">::</span>Exception<span class="token operator">&amp;</span> er<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=205></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=206></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=207></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=208></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=209></td><td><pre>			<span class="token string">"DataBase::TableInsert() => query fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=210></td><td><pre>			er<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=211></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=214></td><td><pre></pre></td></tr><tr><td data-num=215></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=216></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=217></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=218></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=220></td><td><pre>		<span class="token string">"DataBase::TableInsert() => Succeed"</span></pre></td></tr><tr><td data-num=221></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=224></td><td><pre></pre></td></tr><tr><td data-num=225></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">GetTableParentRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=226></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=227></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=228></td><td><pre></pre></td></tr><tr><td data-num=229></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=230></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=231></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=232></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=233></td><td><pre></pre></td></tr><tr><td data-num=234></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">"SELECT * FROM "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre>	_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">" WHERE parent_id IS NULL"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">" AND response_id IS NULL"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">" ORDER BY create_at"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=242></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=243></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=244></td><td><pre>		<span class="token string">"SELECT * FROM "</span> <span class="token operator">+</span> table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=245></td><td><pre>		<span class="token string">" WHERE parent_id IS NULL"</span> </pre></td></tr><tr><td data-num=246></td><td><pre>		<span class="token string">" AND response_id IS NULL"</span> </pre></td></tr><tr><td data-num=247></td><td><pre>		<span class="token string">" ORDER BY create_at"</span>	</pre></td></tr><tr><td data-num=248></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=249></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=251></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=252></td><td><pre>		<span class="token string">"SELECT * FROM "</span> <span class="token operator">+</span> table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=253></td><td><pre>		<span class="token string">" WHERE parent_id IS NULL"</span> </pre></td></tr><tr><td data-num=254></td><td><pre>		<span class="token string">" AND response_id IS NULL"</span> </pre></td></tr><tr><td data-num=255></td><td><pre>		<span class="token string">" ORDER BY create_at"</span>	</pre></td></tr><tr><td data-num=256></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=257></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre></pre></td></tr><tr><td data-num=259></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=260></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>StoreQueryResult res <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=261></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=262></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> row<span class="token operator">:</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=263></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=264></td><td><pre>			Record<span class="token operator">*</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Record</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=265></td><td><pre>			record<span class="token operator">-></span>id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=266></td><td><pre>			record<span class="token operator">-></span>parent_id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"parent_id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=267></td><td><pre>			record<span class="token operator">-></span>response_id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"response_id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=268></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"nick_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=269></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"mail"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=270></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"mail_md5"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"create_at"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=272></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"comment"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=273></td><td><pre>			buf<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=274></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=275></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=276></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=277></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=278></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=279></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=280></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=281></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=282></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=283></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=284></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=285></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=286></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=287></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=288></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=289></td><td><pre></pre></td></tr><tr><td data-num=290></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=291></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=292></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=293></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=294></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=295></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=296></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=297></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=298></td><td><pre><span class="token punctuation">&#125;</span>	</pre></td></tr><tr><td data-num=299></td><td><pre></pre></td></tr><tr><td data-num=300></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">DataBase</span><span class="token double-colon punctuation">::</span><span class="token function">GetTableChildRecord</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=301></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=302></td><td><pre>	mysqlpp<span class="token double-colon punctuation">::</span>Query query <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=303></td><td><pre></pre></td></tr><tr><td data-num=304></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">TableIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=305></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=306></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=307></td><td><pre>	std<span class="token double-colon punctuation">::</span>string _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=308></td><td><pre></pre></td></tr><tr><td data-num=309></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">"SELECT * FROM "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=310></td><td><pre>	_sql <span class="token operator">+=</span> table_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=311></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">" WHERE parent_id IS NOT NULL"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=312></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">" AND response_id IS NOT NULL"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=313></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">" ORDER BY create_at"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=314></td><td><pre>	_sql <span class="token operator">+=</span> <span class="token string">";"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=315></td><td><pre></pre></td></tr><tr><td data-num=316></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=317></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=318></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=319></td><td><pre>		<span class="token string">"SELECT * FROM "</span> <span class="token operator">+</span> table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=320></td><td><pre>		<span class="token string">" WHERE parent_id IS NOT NULL"</span> </pre></td></tr><tr><td data-num=321></td><td><pre>		<span class="token string">" AND response_id IS NOT NULL"</span> </pre></td></tr><tr><td data-num=322></td><td><pre>		<span class="token string">" ORDER BY create_at"</span></pre></td></tr><tr><td data-num=323></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=324></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=325></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=326></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => query\n"</span></pre></td></tr><tr><td data-num=327></td><td><pre>		<span class="token string">"SELECT * FROM "</span> <span class="token operator">+</span> table_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=328></td><td><pre>		<span class="token string">" WHERE parent_id IS NOT NULL"</span> </pre></td></tr><tr><td data-num=329></td><td><pre>		<span class="token string">" AND response_id IS NOT NULL"</span> </pre></td></tr><tr><td data-num=330></td><td><pre>		<span class="token string">" ORDER BY create_at"</span></pre></td></tr><tr><td data-num=331></td><td><pre>		<span class="token string">";"</span></pre></td></tr><tr><td data-num=332></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=333></td><td><pre></pre></td></tr><tr><td data-num=334></td><td><pre>	query <span class="token operator">&lt;&lt;</span> _sql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=335></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>mysqlpp<span class="token double-colon punctuation">::</span>StoreQueryResult res <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=336></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=337></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> row<span class="token operator">:</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=338></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=339></td><td><pre>			Record<span class="token operator">*</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Record</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=340></td><td><pre>			record<span class="token operator">-></span>id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=341></td><td><pre>			record<span class="token operator">-></span>parent_id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"parent_id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=342></td><td><pre>			record<span class="token operator">-></span>response_id <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"response_id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=343></td><td><pre>			record<span class="token operator">-></span>nick_name <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"nick_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=344></td><td><pre>			record<span class="token operator">-></span>mail <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"mail"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=345></td><td><pre>			record<span class="token operator">-></span>mail_md5 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"mail_md5"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=346></td><td><pre>			record<span class="token operator">-></span>create_at <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"create_at"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=347></td><td><pre>			record<span class="token operator">-></span>comment <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">"comment"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=348></td><td><pre>			buf<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=349></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=350></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=351></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=352></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=353></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=354></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=355></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=356></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=357></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=358></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=359></td><td><pre>			<span class="token string">"DataBase::GetTableRecord() => query.store() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=360></td><td><pre>			query<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=361></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=362></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=363></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=364></td><td><pre></pre></td></tr><tr><td data-num=365></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=366></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=367></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=368></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=369></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=370></td><td><pre>		<span class="token string">"DataBase::GetTableRecord() => Succeed"</span></pre></td></tr><tr><td data-num=371></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=372></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=373></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_http/_response.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../mylibs.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_database/db.h"</span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"../_tcp/tcp.h"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_HTTPVERSION</span> <span class="token string">"1.0"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">// HTTP请求方法</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">RequestMethodType</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    _UNKNOW<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>    _GET<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>    _POST<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>    _PUT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>    _DELETE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>    _HEAD<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=18></td><td><pre>    _OPTIONS<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>    _PATCH<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=20></td><td><pre>    _CONNECT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=21></td><td><pre>    _TRACE</pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment">// HTTP请求文件格式</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">RequestFileType</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    _UNKNOW<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=28></td><td><pre>    _HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=29></td><td><pre>    _CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=30></td><td><pre>    _JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=31></td><td><pre>    _PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token comment">// 请求路径功能所属</span></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">RequestPathType</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    _NORMAL<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=38></td><td><pre>    _DATABASE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=39></td><td><pre>    _DATABASE_COUNT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=40></td><td><pre>    _DATABASE_REPLY<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=41></td><td><pre>    _API</pre></td></tr><tr><td data-num=42></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TcpResponse</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=47></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的普通响应</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的数据库响应</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DBR</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的数据库响应</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DBC</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 200状态的数据库表元素数量响应</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token comment">// 200状态的文件请求响应</span></pre></td></tr><tr><td data-num=52></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> off_t f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=54></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token keyword">static</span> RequestMethodType <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> method_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTTP请求方法</span></pre></td></tr><tr><td data-num=57></td><td><pre>    <span class="token keyword">static</span> RequestFileType <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTPP请求文件类型</span></pre></td></tr><tr><td data-num=58></td><td><pre>    <span class="token keyword">static</span> RequestPathType <span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取HTTP请求路径类型</span></pre></td></tr><tr><td data-num=59></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 状态响应选择器</span></pre></td></tr><tr><td data-num=60></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_http/_response.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_response.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>RequestMethodType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> method_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> method_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _get <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _post <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _put <span class="token operator">=</span> <span class="token string">"PUT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _delete <span class="token operator">=</span> <span class="token string">"DELETE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _head <span class="token operator">=</span> <span class="token string">"HEAD"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _options <span class="token operator">=</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _patch <span class="token operator">=</span> <span class="token string">"PATCH"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _connect <span class="token operator">=</span> <span class="token string">"CONNECT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _trace <span class="token operator">=</span> <span class="token string">"TRACE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>method_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_get <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_get<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_post <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_post<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_put <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_put<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_delete <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_delete<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_head <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_head<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_options <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_options<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_patch <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_patch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_connect <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_connect<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_trace <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_trace<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span>buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_get<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=39></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=40></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => GET"</span></pre></td></tr><tr><td data-num=41></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => GET"</span></pre></td></tr><tr><td data-num=44></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_GET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_put<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=50></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=51></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PUT"</span></pre></td></tr><tr><td data-num=52></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=54></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PUT"</span></pre></td></tr><tr><td data-num=55></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PUT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_post<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=63></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=64></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=65></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=66></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => POST"</span></pre></td></tr><tr><td data-num=67></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=68></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=69></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => POST"</span></pre></td></tr><tr><td data-num=70></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=71></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_POST<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=73></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=74></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=75></td><td><pre>				<span class="token comment">// log..</span></pre></td></tr><tr><td data-num=76></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=77></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => HEAD"</span></pre></td></tr><tr><td data-num=78></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=79></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=80></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => HEAD"</span></pre></td></tr><tr><td data-num=81></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=82></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_HEAD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=87></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=88></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_patch<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=89></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=90></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=91></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=92></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PATCH"</span></pre></td></tr><tr><td data-num=93></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=94></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=95></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => PATCH"</span></pre></td></tr><tr><td data-num=96></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=97></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PATCH<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=99></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_trace<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=100></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=101></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=102></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=103></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => TRACE"</span></pre></td></tr><tr><td data-num=104></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=105></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=106></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => TRACE"</span></pre></td></tr><tr><td data-num=107></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=108></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_TRACE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=112></td><td><pre>		<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=114></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_delete<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=115></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=116></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=117></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=118></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => DELETE"</span></pre></td></tr><tr><td data-num=119></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=120></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=121></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => DELETE"</span></pre></td></tr><tr><td data-num=122></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=123></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_DELETE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=125></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=128></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=129></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=130></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=131></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=132></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=133></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => OPTIONS"</span></pre></td></tr><tr><td data-num=134></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=135></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=136></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => OPTIONS"</span></pre></td></tr><tr><td data-num=137></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_OPTIONS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=140></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_connect<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=141></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=142></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=143></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=144></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => CONNECT"</span></pre></td></tr><tr><td data-num=145></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=146></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=147></td><td><pre>					<span class="token string">"TcpResponse::GetMethodType() => CONNECT"</span></pre></td></tr><tr><td data-num=148></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=149></td><td><pre>				<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_CONNECT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=151></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetMethodType() => UNKNOW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetMethodType() => UNKNOW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token keyword">return</span> RequestMethodType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre></pre></td></tr><tr><td data-num=160></td><td><pre>RequestFileType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=161></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=162></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> filename_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre></pre></td></tr><tr><td data-num=165></td><td><pre>	std<span class="token double-colon punctuation">::</span>string type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=169></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> filename_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'.'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> type<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=171></td><td><pre>		<span class="token keyword">else</span><span class="token punctuation">&#123;</span> type <span class="token operator">+=</span> ch<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=172></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=173></td><td><pre></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=175></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=176></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _html <span class="token operator">=</span> <span class="token string">"HTML"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _js <span class="token operator">=</span> <span class="token string">"JS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _css <span class="token operator">=</span> <span class="token string">"CSS"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> _png <span class="token operator">=</span> <span class="token string">"PNG"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>		<span class="token keyword">const</span> size_t type_len <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> type_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=184></td><td><pre>			<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>type<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_html <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_html <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_html<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=186></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_js <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_js <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_js<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=187></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_css <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_css <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_css<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=188></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>_png <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>_png <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>_png<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_html<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=192></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=194></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=195></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => HTML"</span></pre></td></tr><tr><td data-num=196></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=197></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=198></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => HTML"</span></pre></td></tr><tr><td data-num=199></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=200></td><td><pre>			<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_HTML<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre></pre></td></tr><tr><td data-num=203></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> type_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_js<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=204></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=205></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=206></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=207></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => CSS"</span></pre></td></tr><tr><td data-num=208></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=209></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=210></td><td><pre>				<span class="token string">"TcpResponse::GetFileType() => CSS"</span></pre></td></tr><tr><td data-num=211></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=212></td><td><pre>			<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_JS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=214></td><td><pre></pre></td></tr><tr><td data-num=215></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> type_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=217></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_css<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=218></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=219></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=220></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=221></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => JS"</span></pre></td></tr><tr><td data-num=222></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=223></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=224></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => JS"</span></pre></td></tr><tr><td data-num=225></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=226></td><td><pre>				<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_CSS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=228></td><td><pre></pre></td></tr><tr><td data-num=229></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>_png<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=230></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=231></td><td><pre>				<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=232></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=233></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => PNG"</span></pre></td></tr><tr><td data-num=234></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre>				<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=236></td><td><pre>					<span class="token string">"TcpResponse::GetFileType() => PNG"</span></pre></td></tr><tr><td data-num=237></td><td><pre>				<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>				<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_PNG<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=240></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=244></td><td><pre>		<span class="token string">"TcpResponse::GetFileType() => UNKNOW"</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=247></td><td><pre>		<span class="token string">"TcpResponse::GetFileType() => UNKNOW"</span></pre></td></tr><tr><td data-num=248></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>	<span class="token keyword">return</span> RequestFileType<span class="token double-colon punctuation">::</span>_UNKNOW<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=251></td><td><pre></pre></td></tr><tr><td data-num=252></td><td><pre>RequestPathType <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetPathType</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=253></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=254></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> path_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_NORMAL<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=256></td><td><pre></pre></td></tr><tr><td data-num=257></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> db <span class="token operator">=</span> <span class="token string">"DATABASE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> dbr <span class="token operator">=</span> <span class="token string">"DATABASE_REPLY"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> dbc <span class="token operator">=</span> <span class="token string">"DATABASE_COUNT"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=260></td><td><pre>	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> api <span class="token operator">=</span> <span class="token string">"API"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=261></td><td><pre></pre></td></tr><tr><td data-num=262></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=263></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=264></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>path_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=265></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>db <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>db <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>db<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=266></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>dbr <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>dbr <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>dbr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=267></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>dbc <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>dbc <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>dbc<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=268></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>api <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>api <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>api<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=269></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=270></td><td><pre></pre></td></tr><tr><td data-num=271></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>db<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=272></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=273></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=274></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=275></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=276></td><td><pre>		<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=277></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=278></td><td><pre></pre></td></tr><tr><td data-num=279></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">15</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=280></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=281></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>dbr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=282></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=283></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=284></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE_REPLY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=285></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE_REPLY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=286></td><td><pre>			<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE_REPLY<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=287></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=288></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>dbc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=289></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=290></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=291></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE_COUNT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=292></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"TcpResponse::GetPathType() => DATABASE_COUNT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=293></td><td><pre>			<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE_COUNT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=294></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=295></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=296></td><td><pre></pre></td></tr><tr><td data-num=297></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>api<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=298></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=299></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=300></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=301></td><td><pre>			<span class="token string">"TcpResponse::GetPathType() => API"</span></pre></td></tr><tr><td data-num=302></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=303></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=304></td><td><pre>			<span class="token string">"TcpResponse::GetPathType() => API"</span></pre></td></tr><tr><td data-num=305></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=306></td><td><pre>		<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_API<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=307></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=308></td><td><pre></pre></td></tr><tr><td data-num=309></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=310></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=311></td><td><pre>		<span class="token string">"TcpResponse::GetPathType() => NORMAL"</span></pre></td></tr><tr><td data-num=312></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=313></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=314></td><td><pre>		<span class="token string">"TcpResponse::GetPathType() => NORMAL"</span></pre></td></tr><tr><td data-num=315></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=316></td><td><pre>	<span class="token keyword">return</span> RequestPathType<span class="token double-colon punctuation">::</span>_NORMAL<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=317></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=318></td><td><pre></pre></td></tr><tr><td data-num=319></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=320></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=321></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=322></td><td><pre></pre></td></tr><tr><td data-num=323></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=324></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=325></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 400 BAD REQUEST\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=326></td><td><pre></pre></td></tr><tr><td data-num=327></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=328></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=329></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=330></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=331></td><td><pre>			<span class="token string">"TcpResponse::Response400() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=332></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=333></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=334></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=335></td><td><pre>			<span class="token string">"TcpResponse::Response400() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=336></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=337></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=338></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=339></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=340></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=341></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=342></td><td><pre>		<span class="token string">"TcpResponse::Response400() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=343></td><td><pre>		buf</pre></td></tr><tr><td data-num=344></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=345></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=346></td><td><pre>		<span class="token string">"TcpResponse::Response400() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=347></td><td><pre>		buf</pre></td></tr><tr><td data-num=348></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=349></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=350></td><td><pre></pre></td></tr><tr><td data-num=351></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=352></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=353></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=354></td><td><pre></pre></td></tr><tr><td data-num=355></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=356></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=357></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 404 NOT FOUND\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=358></td><td><pre></pre></td></tr><tr><td data-num=359></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=360></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=361></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=362></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=363></td><td><pre>			<span class="token string">"TcpResponse::Response404() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=364></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=365></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=366></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=367></td><td><pre>			<span class="token string">"TcpResponse::Response404() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=368></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=369></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=370></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=371></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=372></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=373></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=374></td><td><pre>		<span class="token string">"TcpResponse::Response404() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=375></td><td><pre>		buf</pre></td></tr><tr><td data-num=376></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=377></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=378></td><td><pre>		<span class="token string">"TcpResponse::Response404() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=379></td><td><pre>		buf </pre></td></tr><tr><td data-num=380></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=381></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=382></td><td><pre></pre></td></tr><tr><td data-num=383></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_NF</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=384></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=385></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=386></td><td><pre></pre></td></tr><tr><td data-num=387></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=388></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=389></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=390></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=391></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=392></td><td><pre></pre></td></tr><tr><td data-num=393></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=394></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=395></td><td><pre>		<span class="token comment">// log....</span></pre></td></tr><tr><td data-num=396></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=397></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=398></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=399></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=400></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=401></td><td><pre>			<span class="token string">"TcpResponse::Response200_NF() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=402></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=403></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=404></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=405></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=406></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=407></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=408></td><td><pre>		<span class="token string">"TcpResponse::Response200_NF() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=409></td><td><pre>		buf</pre></td></tr><tr><td data-num=410></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=411></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=412></td><td><pre>		<span class="token string">"TcpResponse::Response200_NF() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=413></td><td><pre>		buf</pre></td></tr><tr><td data-num=414></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=415></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=416></td><td><pre></pre></td></tr><tr><td data-num=417></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_DB</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=418></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=419></td><td><pre>	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span> records<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=420></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=421></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=422></td><td><pre>	std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=423></td><td><pre></pre></td></tr><tr><td data-num=424></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=425></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=426></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=427></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=428></td><td><pre></pre></td></tr><tr><td data-num=429></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=430></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=431></td><td><pre>		<span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=432></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=433></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=434></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">GetTableParentRecord</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=435></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=436></td><td><pre>		<span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=437></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=438></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=439></td><td><pre></pre></td></tr><tr><td data-num=440></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> r<span class="token operator">:</span> records<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=441></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=442></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=443></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>parent_id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=444></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>response_id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=445></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=446></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=447></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=448></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=449></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>comment <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=450></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=451></td><td><pre></pre></td></tr><tr><td data-num=452></td><td><pre>	<span class="token keyword">const</span> size_t bodyLen <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=453></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=454></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=455></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=456></td><td><pre></pre></td></tr><tr><td data-num=457></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=458></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=459></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=460></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=461></td><td><pre>			<span class="token string">"TcpResponse::Response200_DB() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=462></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=463></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=464></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=465></td><td><pre>			<span class="token string">"TcpResponse::Response200_DB() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=466></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=467></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=468></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=469></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=470></td><td><pre></pre></td></tr><tr><td data-num=471></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=472></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=473></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=474></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=475></td><td><pre>			<span class="token comment">// log...	</span></pre></td></tr><tr><td data-num=476></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=477></td><td><pre>				<span class="token string">"TcpResponse::Response200_DB() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=478></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=479></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=480></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=481></td><td><pre>				<span class="token string">"TcpResponse::Response200_DB() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=482></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=483></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=484></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=485></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=486></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=487></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=488></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=489></td><td><pre>		<span class="token string">"TcpResponse::Response200_DB() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=490></td><td><pre>		buf</pre></td></tr><tr><td data-num=491></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=492></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=493></td><td><pre>		<span class="token string">"TcpResponse::Response200_DB() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=494></td><td><pre>		buf</pre></td></tr><tr><td data-num=495></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=496></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=497></td><td><pre></pre></td></tr><tr><td data-num=498></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_DBR</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=499></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=500></td><td><pre>	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Record<span class="token operator">*</span><span class="token operator">></span> records<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=501></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=502></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=503></td><td><pre>	std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=504></td><td><pre></pre></td></tr><tr><td data-num=505></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=506></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=507></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=508></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=509></td><td><pre></pre></td></tr><tr><td data-num=510></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=511></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=512></td><td><pre>		<span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=513></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=514></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=515></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">GetTableChildRecord</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=516></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=517></td><td><pre>		<span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=518></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=519></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=520></td><td><pre></pre></td></tr><tr><td data-num=521></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> r<span class="token operator">:</span> records<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=522></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=523></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=524></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>parent_id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=525></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>response_id <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=526></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>nick_name <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=527></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>mail <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=528></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>mail_md5 <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=529></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>create_at <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=530></td><td><pre>		body <span class="token operator">+=</span> r<span class="token operator">-></span>comment <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=531></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=532></td><td><pre></pre></td></tr><tr><td data-num=533></td><td><pre>	<span class="token keyword">const</span> size_t bodyLen <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=534></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=535></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=536></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=537></td><td><pre></pre></td></tr><tr><td data-num=538></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=539></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=540></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=541></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=542></td><td><pre>			<span class="token string">"TcpResponse::Response200_DBR() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=543></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=544></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=545></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=546></td><td><pre>			<span class="token string">"TcpResponse::Response200_DBR() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=547></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=548></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=549></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=550></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=551></td><td><pre></pre></td></tr><tr><td data-num=552></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=553></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=554></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=555></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=556></td><td><pre>			<span class="token comment">// log...	</span></pre></td></tr><tr><td data-num=557></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=558></td><td><pre>				<span class="token string">"TcpResponse::Response200_DBR() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=559></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=560></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=561></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=562></td><td><pre>				<span class="token string">"TcpResponse::Response200_DBR() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=563></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=564></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=565></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=566></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=567></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=568></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=569></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=570></td><td><pre>		<span class="token string">"TcpResponse::Response200_DBR() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=571></td><td><pre>		buf</pre></td></tr><tr><td data-num=572></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=573></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=574></td><td><pre>		<span class="token string">"TcpResponse::Response200_DBR() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=575></td><td><pre>		buf</pre></td></tr><tr><td data-num=576></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=577></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=578></td><td><pre></pre></td></tr><tr><td data-num=579></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200_DBC</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=580></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=581></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=582></td><td><pre>	std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=583></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=584></td><td><pre></pre></td></tr><tr><td data-num=585></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=586></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=587></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=588></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=589></td><td><pre></pre></td></tr><tr><td data-num=590></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> body <span class="token operator">+=</span> <span class="token string">"0"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=591></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> body <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>database<span class="token punctuation">.</span><span class="token function">GetTableParentRecordNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=592></td><td><pre></pre></td></tr><tr><td data-num=593></td><td><pre>	<span class="token keyword">int</span> body_size <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=594></td><td><pre></pre></td></tr><tr><td data-num=595></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=596></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>body_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=597></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=598></td><td><pre></pre></td></tr><tr><td data-num=599></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=600></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=601></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=602></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=603></td><td><pre>			<span class="token string">"TcpResponse::Response200_DBC() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=604></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=605></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=606></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=607></td><td><pre>			<span class="token string">"TcpResponse::Response200_DBC() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=608></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=609></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=610></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=611></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=612></td><td><pre></pre></td></tr><tr><td data-num=613></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> body_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=614></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=615></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>body<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>body_size<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=616></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=617></td><td><pre>			<span class="token comment">// log...	</span></pre></td></tr><tr><td data-num=618></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=619></td><td><pre>				<span class="token string">"TcpResponse::Response200_DBC() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=620></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=621></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=622></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=623></td><td><pre>				<span class="token string">"TcpResponse::Response200_DBC() => body send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=624></td><td><pre>				<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=625></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=626></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=627></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=628></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=629></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=630></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=631></td><td><pre>		<span class="token string">"TcpResponse::Response200_DBC() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=632></td><td><pre>		buf</pre></td></tr><tr><td data-num=633></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=634></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=635></td><td><pre>		<span class="token string">"TcpResponse::Response200_DBC() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=636></td><td><pre>		buf</pre></td></tr><tr><td data-num=637></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=638></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=639></td><td><pre></pre></td></tr><tr><td data-num=640></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span><span class="token keyword">const</span> off_t f_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=641></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=642></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=643></td><td><pre></pre></td></tr><tr><td data-num=644></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"HTTP/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=645></td><td><pre>	buf <span class="token operator">+=</span> _HTTPVERSION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=646></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">" 200 OK\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=647></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=648></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=649></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=650></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_HTML<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=651></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_CSS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=652></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_JS<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=653></td><td><pre>		<span class="token keyword">case</span> RequestFileType<span class="token double-colon punctuation">::</span>_PNG<span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=654></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> buf <span class="token operator">+=</span> <span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=655></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=656></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=657></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=658></td><td><pre>	buf <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>f_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=659></td><td><pre>	buf <span class="token operator">+=</span> <span class="token string">"\r\n\r\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=660></td><td><pre></pre></td></tr><tr><td data-num=661></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=662></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=663></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=664></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=665></td><td><pre>			<span class="token string">"TcpResponse::Response200() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=666></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=667></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=668></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=669></td><td><pre>			<span class="token string">"TcpResponse::Response200() => send() fail.\nreason: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=670></td><td><pre>			<span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=671></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=672></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=673></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=674></td><td><pre>	std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">resource</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=675></td><td><pre></pre></td></tr><tr><td data-num=676></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resource<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=677></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=678></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=679></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=680></td><td><pre>			<span class="token string">"HttpServer::Response200() => file open fail"</span></pre></td></tr><tr><td data-num=681></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=682></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=683></td><td><pre>			<span class="token string">"HttpServer::Response200() => file open fail"</span></pre></td></tr><tr><td data-num=684></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=685></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=686></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=687></td><td><pre></pre></td></tr><tr><td data-num=688></td><td><pre>	<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=689></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=690></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=691></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=692></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=693></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=694></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=695></td><td><pre>				<span class="token string">"HttpServer::Response200() => file read fail"</span></pre></td></tr><tr><td data-num=696></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=697></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=698></td><td><pre>				<span class="token string">"HttpServer::Response200() => file read fail"</span></pre></td></tr><tr><td data-num=699></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=700></td><td><pre>			<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=701></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=702></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=703></td><td><pre>		</pre></td></tr><tr><td data-num=704></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=705></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=706></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=707></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=708></td><td><pre>			<span class="token string">"HttpServer::Response200() => End of reading file"</span></pre></td></tr><tr><td data-num=709></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=710></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=711></td><td><pre>			<span class="token string">"HttpServer::Response200() => End of reading file"</span></pre></td></tr><tr><td data-num=712></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=713></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=714></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=715></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=716></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=717></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=718></td><td><pre>			<span class="token string">"HttpServer::Response200() => I/O error when reading"</span></pre></td></tr><tr><td data-num=719></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=720></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=721></td><td><pre>			<span class="token string">"HttpServer::Response200() => I/O error when reading"</span></pre></td></tr><tr><td data-num=722></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=723></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=724></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=725></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=726></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=727></td><td><pre>		<span class="token string">"TcpResponse::Response200() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=728></td><td><pre>		buf</pre></td></tr><tr><td data-num=729></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=730></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=731></td><td><pre>		<span class="token string">"TcpResponse::Response200() => Succeed\nResponse Header:\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=732></td><td><pre>		buf</pre></td></tr><tr><td data-num=733></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=734></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=735></td><td><pre></pre></td></tr><tr><td data-num=736></td><td><pre><span class="token keyword">void</span> <span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=737></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=738></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetPathType</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=739></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=740></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=741></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE_COUNT<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_DBC</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=742></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_DATABASE_REPLY<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_DBR</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=743></td><td><pre>		<span class="token keyword">case</span> RequestPathType<span class="token double-colon punctuation">::</span>_API<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=744></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num=745></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=746></td><td><pre>			std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=747></td><td><pre>			<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=748></td><td><pre></pre></td></tr><tr><td data-num=749></td><td><pre>			buf <span class="token operator">+=</span> <span class="token string">"./"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=750></td><td><pre>			buf <span class="token operator">+=</span> <span class="token class-name">MyConfig</span><span class="token double-colon punctuation">::</span><span class="token function">GetRootDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=751></td><td><pre>			buf <span class="token operator">+=</span> url_buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=752></td><td><pre></pre></td></tr><tr><td data-num=753></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=754></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=755></td><td><pre>				<span class="token string">"TcpResponse::ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=756></td><td><pre>				buf</pre></td></tr><tr><td data-num=757></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=758></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=759></td><td><pre>				<span class="token string">"TcpResponse::ResponseSelector() => Index_Path: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=760></td><td><pre>				buf</pre></td></tr><tr><td data-num=761></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=762></td><td><pre></pre></td></tr><tr><td data-num=763></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=764></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response200</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=765></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=766></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=767></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_http/http.h</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"./_response.h"</span></span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">ReqContent</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	std<span class="token double-colon punctuation">::</span>string req_method<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	std<span class="token double-colon punctuation">::</span>string req_url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string req_body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">class</span> <span class="token class-name">HttpServer</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">UrlFormat</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将url的格式标准化</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>ReqContent<span class="token operator">*</span> req_content<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// HTTP请求内容解析</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">BodyTackle</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">,</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// HTTP请求Body部分解析</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 处理HTTP的GET方法</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 处理HTTP的POST方法</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 接收HTTP请求报文，并处理相关操作</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang=C++><span>./_http/http.cc</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>std<span class="token double-colon punctuation">::</span>string <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token char">'/'</span> <span class="token operator">!=</span> url_buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=11></td><td><pre>		url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> ch <span class="token operator">=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\\'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> <span class="token char">'/'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> i <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token char">'/'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token char">'\\'</span> <span class="token operator">==</span> url_buf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>			url <span class="token operator">+=</span> <span class="token char">'/'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		url <span class="token operator">+=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=25></td><td><pre>		<span class="token string">"HttpServer::UrlFormat() => Format URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>		url</pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token string">"HttpServer::UrlFormat() => Format URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=30></td><td><pre>		url</pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token keyword">return</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">bool</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">ReqContentReceive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span>ReqContent<span class="token operator">*</span> req_content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	std<span class="token double-colon punctuation">::</span>string buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=42></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>			<span class="token string">"HttpServer::ReqContentReceive() => TcpStream::StreamParse_Line() fail"</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=46></td><td><pre>			<span class="token string">"HttpServer::ReqContentReceive() => TcpStream::StreamParse_Line() fail"</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">&#125;</span>	</pre></td></tr><tr><td data-num=50></td><td><pre>	size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>buf_len <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">char</span> bodyLen<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		req_content<span class="token operator">-></span>req_method <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		req_content<span class="token operator">-></span>req_url <span class="token operator">+=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => \nRequest Header:"</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => \nRequest Header:"</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre></pre></td></tr><tr><td data-num=76></td><td><pre>		buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token class-name">TcpStream</span><span class="token double-colon punctuation">::</span><span class="token function">StreamParse_Line</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">StartWith</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length:"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=79></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=80></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">,</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=81></td><td><pre>				bodyLen<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>buf<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=88></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=89></td><td><pre>		<span class="token keyword">char</span> body_buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>		<span class="token comment">/* 读取body内容 */</span></pre></td></tr><tr><td data-num=91></td><td><pre>		buf_len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=92></td><td><pre>			sock_fd<span class="token punctuation">,</span>body_buf<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=93></td><td><pre>			<span class="token punctuation">(</span>size_t<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">_stoi</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=94></td><td><pre>			<span class="token number">0</span></pre></td></tr><tr><td data-num=95></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=97></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=98></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=99></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=100></td><td><pre>				<span class="token string">"HttpServer::ReqContentReceive() => Receive Nothing body"</span></pre></td></tr><tr><td data-num=101></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=103></td><td><pre>				<span class="token string">"HttpServer::ReqContentReceive() => Receive Nothing body"</span></pre></td></tr><tr><td data-num=104></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token keyword">else</span></pre></td></tr><tr><td data-num=107></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=108></td><td><pre>			<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=109></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=110></td><td><pre>				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre>				req_content<span class="token operator">-></span>req_body <span class="token operator">+=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=117></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => Succeed"</span></pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=120></td><td><pre>		<span class="token string">"HttpServer::ReqContentReceive() => Succeed"</span></pre></td></tr><tr><td data-num=121></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=123></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=124></td><td><pre></pre></td></tr><tr><td data-num=125></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">BodyTackle</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">,</span>Record<span class="token operator">*</span> record<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=126></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token keyword">const</span> size_t n <span class="token operator">=</span> body_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=131></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=132></td><td><pre>			<span class="token string">"HttpServer::BodyTackle() => Receive Nothing Body"</span></pre></td></tr><tr><td data-num=133></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=135></td><td><pre>			<span class="token string">"HttpServer::BodyTackle() => Receive Nothing Body"</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=139></td><td><pre></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token keyword">int</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>parent_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>response_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>nick_name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>mail<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>mail_md5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>create_at<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>	<span class="token punctuation">(</span>record<span class="token operator">-></span>comment<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre></pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token keyword">const</span> <span class="token keyword">char</span> c <span class="token operator">=</span> body_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">':'</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">7</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=155></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=156></td><td><pre>			<span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=157></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=158></td><td><pre>				<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre>				<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>parent_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=160></td><td><pre>				<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>response_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre>				<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>nick_name <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=162></td><td><pre>				<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>mail <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=163></td><td><pre>				<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>mail_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre>				<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=165></td><td><pre>				<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token operator">-></span>comment <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=166></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=167></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=169></td><td><pre></pre></td></tr><tr><td data-num=170></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=171></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token string">"HttpServer::BodyTackle() => Succeed"</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=175></td><td><pre>		<span class="token string">"HttpServer::BodyTackle() => Succeed"</span></pre></td></tr><tr><td data-num=176></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=178></td><td><pre></pre></td></tr><tr><td data-num=179></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=180></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token keyword">const</span> size_t buf_len <span class="token operator">=</span> url_buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> buf_len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=183></td><td><pre></pre></td></tr><tr><td data-num=184></td><td><pre>	std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> buf_len <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=188></td><td><pre>		url <span class="token operator">+=</span> url_buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=193></td><td><pre>		<span class="token string">"HttpServer::GetMethod() => Request URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=194></td><td><pre>		url</pre></td></tr><tr><td data-num=195></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=197></td><td><pre>		<span class="token string">"HttpServer::GetMethod() => Request URL: "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=198></td><td><pre>		url</pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"HttpServer::GetMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::GetMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token function">UrlFormat</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=205></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=206></td><td><pre></pre></td></tr><tr><td data-num=207></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> body_buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=208></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=209></td><td><pre>	DataBase database<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>	Record record<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>	<span class="token function">BodyTackle</span><span class="token punctuation">(</span>body_buf<span class="token punctuation">,</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=214></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=215></td><td><pre>		<span class="token string">"HttpServer::PostMethod() => record:"</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token string">"\nid: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>id <span class="token operator">+</span></pre></td></tr><tr><td data-num=217></td><td><pre>		<span class="token string">"\nparent_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=218></td><td><pre>		<span class="token string">"\nresponse_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=219></td><td><pre>		<span class="token string">"\nnick_name: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=220></td><td><pre>		<span class="token string">"\nmail: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=221></td><td><pre>		<span class="token string">"\nmail_md5: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail_md5<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=222></td><td><pre>		<span class="token string">"\ncreate_at: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>create_at<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=223></td><td><pre>		<span class="token string">"\ncomment: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>comment</pre></td></tr><tr><td data-num=224></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=226></td><td><pre>		<span class="token string">"HttpServer::PostMethod() => record:"</span></pre></td></tr><tr><td data-num=227></td><td><pre>		<span class="token string">"\nid: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>id <span class="token operator">+</span></pre></td></tr><tr><td data-num=228></td><td><pre>		<span class="token string">"\nparent_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=229></td><td><pre>		<span class="token string">"\nresponse_id: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+</span></pre></td></tr><tr><td data-num=230></td><td><pre>		<span class="token string">"\nnick_name: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+</span></pre></td></tr><tr><td data-num=231></td><td><pre>		<span class="token string">"\nmail: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=232></td><td><pre>		<span class="token string">"\nmail_md5: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>mail_md5<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=233></td><td><pre>		<span class="token string">"\ncreate_at: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>create_at<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=234></td><td><pre>		<span class="token string">"\ncomment: "</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>comment</pre></td></tr><tr><td data-num=235></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre></pre></td></tr><tr><td data-num=237></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> database<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=239></td><td><pre>		<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	database<span class="token punctuation">.</span><span class="token function">TableInsert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre></pre></td></tr><tr><td data-num=244></td><td><pre>	<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span><span class="token string">"HttpServer::PostMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"HttpServer::PostMethod() => Response..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre></pre></td></tr><tr><td data-num=248></td><td><pre>	<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">ResponseSelector</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=250></td><td><pre></pre></td></tr><tr><td data-num=251></td><td><pre><span class="token keyword">void</span> <span class="token class-name">HttpServer</span><span class="token double-colon punctuation">::</span><span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=252></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=253></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> sock_fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=254></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=255></td><td><pre>		<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=256></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogError</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=257></td><td><pre>			<span class="token string">"HttpServer::Accept() => None apply socket"</span></pre></td></tr><tr><td data-num=258></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=259></td><td><pre>		<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=260></td><td><pre>			<span class="token string">"HttpServer::Accept() => None apply socket"</span></pre></td></tr><tr><td data-num=261></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=262></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=264></td><td><pre>		</pre></td></tr><tr><td data-num=265></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">ReqContent</span> req_content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=266></td><td><pre></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> <span class="token function">ReqContentReceive</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>req_content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=268></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=269></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=270></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=271></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=272></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=273></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">,</span>req_content<span class="token punctuation">.</span>req_body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=274></td><td><pre>		<span class="token keyword">case</span> RequestMethodType<span class="token double-colon punctuation">::</span>_PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=275></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=276></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=277></td><td><pre>			<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=278></td><td><pre>			<span class="token comment">// log...</span></pre></td></tr><tr><td data-num=279></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallLogInfo</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=280></td><td><pre>				<span class="token string">"HttpServer::Accept() => Not support for current "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=281></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=282></td><td><pre>				<span class="token string">" request method"</span></pre></td></tr><tr><td data-num=283></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>			<span class="token class-name">MyLibs</span><span class="token double-colon punctuation">::</span><span class="token function">CallDebug</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=285></td><td><pre>				<span class="token string">"HttpServer::Accept() => Not support for current "</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=286></td><td><pre>				req_content<span class="token punctuation">.</span>req_method<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=287></td><td><pre>				<span class="token string">" request method"</span></pre></td></tr><tr><td data-num=288></td><td><pre>			<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=289></td><td><pre>			<span class="token class-name">TcpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">Response400</span><span class="token punctuation">(</span>sock_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=290></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=291></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=292></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h3 id=显示评论消息中的回复对象><a class=anchor href=#显示评论消息中的回复对象>#</a> 显示评论消息中的回复对象</h3><p>为评论的html标签添加<code>nick_name</code>属性，主线子评论通过id可获取回复对象的标签，通过标签上的<code>nick_name</code>属性可辨别回复对象。</p><figure class="highlight js"><figcaption data-lang=JavaScript><span>./docs/js/comments.js</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">function</span> <span class="token function">commentAppend</span><span class="token punctuation">(</span><span class="token parameter">mainUserLabel<span class="token punctuation">,</span>record<span class="token punctuation">,</span>response_label <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">var</span> commentBoxLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    commentBoxLabel<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token comment">/* nickname area */</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> record<span class="token punctuation">.</span>nick_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token comment">/* timestamp transform into format time */</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token keyword">var</span> timeSpendLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token function">timestampTackle</span><span class="token punctuation">(</span>timeSpendLabel<span class="token punctuation">,</span>record<span class="token punctuation">.</span>create_at<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token comment">/* reply area */</span></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token keyword">var</span> replyLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>    replyLabel<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    replyLabel<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"response_id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    replyLabel<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"回复"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpendLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>replyLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    commentBoxLabel<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token comment">/****************************************************/</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token keyword">var</span> response_user <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> response_label<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>		response_user <span class="token operator">=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=41></td><td><pre>			<span class="token string">"&lt;a class=\"at\" href=\"#\">"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=42></td><td><pre>			<span class="token string">"@"</span> <span class="token operator">+</span> response_label<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"nick_name"</span><span class="token punctuation">)</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=43></td><td><pre>			<span class="token string">"&lt;/a>"</span> <span class="token operator">+</span> <span class="token string">","</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre>    boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=47></td><td><pre>		response_user <span class="token operator">+</span> </pre></td></tr><tr><td data-num=48></td><td><pre>		<span class="token string">"&lt;p>"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num=49></td><td><pre>		record<span class="token punctuation">.</span>comment <span class="token operator">+</span></pre></td></tr><tr><td data-num=50></td><td><pre>		<span class="token string">"&lt;/p>"</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>    commentBoxLabel<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre>    mainUserLabel<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token keyword">function</span> <span class="token function">contentAppend</span><span class="token punctuation">(</span><span class="token parameter">userBlock<span class="token punctuation">,</span>record<span class="token punctuation">,</span>response_label <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>    <span class="token keyword">var</span> mainUserLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre>    mainUserLabel<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"main-level clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre></pre></td></tr><tr><td data-num=65></td><td><pre>    <span class="token function">avatarAppend</span><span class="token punctuation">(</span>mainUserLabel<span class="token punctuation">,</span>record<span class="token punctuation">.</span>mail_md5<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>    <span class="token function">commentAppend</span><span class="token punctuation">(</span>mainUserLabel<span class="token punctuation">,</span>record<span class="token punctuation">,</span>response_label<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>    userBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mainUserLabel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>    <span class="token comment">/* state stretch */</span></pre></td></tr><tr><td data-num=70></td><td><pre>    <span class="token keyword">var</span> CB_Height <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>    <span class="token keyword">var</span> newHeight <span class="token operator">=</span> CB_Height <span class="token operator">+</span> <span class="token number">90</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre></pre></td></tr><tr><td data-num=73></td><td><pre>    commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>    commentContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">-</span> <span class="token number">325</span> <span class="token operator">+</span>  <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=76></td><td><pre></pre></td></tr><tr><td data-num=77></td><td><pre><span class="token comment">/* -------------snip------------- */</span></pre></td></tr><tr><td data-num=78></td><td><pre></pre></td></tr><tr><td data-num=79></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commentPreShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=80></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=81></td><td><pre>    <span class="token keyword">const</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token string">"/database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre></pre></td></tr><tr><td data-num=84></td><td><pre>    <span class="token keyword">var</span> data <span class="token operator">=</span> responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>    <span class="token keyword">var</span> array <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>    <span class="token keyword">const</span> array_length <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre></pre></td></tr><tr><td data-num=88></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">||</span> <span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=89></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=91></td><td><pre></pre></td></tr><tr><td data-num=92></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre></pre></td></tr><tr><td data-num=95></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"comment-container"</span> <span class="token operator">!=</span> commentContainer<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=96></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=97></td><td><pre>        <span class="token keyword">var</span> newCommentContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>        <span class="token keyword">var</span> newInfo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>        <span class="token keyword">var</span> newCommentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre></pre></td></tr><tr><td data-num=101></td><td><pre>        newCommentContainer<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>        newInfo<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>        newInfo<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>        newCommentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre></pre></td></tr><tr><td data-num=106></td><td><pre>        newCommentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>        newCommentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newCommentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>        commentBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newCommentContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre></pre></td></tr><tr><td data-num=110></td><td><pre>        commentContainer <span class="token operator">=</span> newCommentContainer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=112></td><td><pre>    <span class="token keyword">var</span> commentList <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>    <span class="token keyword">var</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre></pre></td></tr><tr><td data-num=115></td><td><pre>    array<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> array_length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=117></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=118></td><td><pre>        <span class="token keyword">var</span> sub <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>        <span class="token keyword">var</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre></pre></td></tr><tr><td data-num=121></td><td><pre>        record<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>        record<span class="token punctuation">.</span>parent_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>        record<span class="token punctuation">.</span>response_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>        record<span class="token punctuation">.</span>nick_name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>        record<span class="token punctuation">.</span>mail <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>        record<span class="token punctuation">.</span>mail_md5 <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>        record<span class="token punctuation">.</span>create_at <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>        record<span class="token punctuation">.</span>comment <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre></pre></td></tr><tr><td data-num=130></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">undefined</span> <span class="token operator">==</span> sub<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=131></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=132></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=133></td><td><pre>            <span class="token keyword">const</span> c <span class="token operator">=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre></pre></td></tr><tr><td data-num=135></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">":"</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">7</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=136></td><td><pre>            <span class="token keyword">else</span></pre></td></tr><tr><td data-num=137></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=138></td><td><pre>                <span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=139></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=140></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=141></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=142></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=143></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=144></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>mail <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=145></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>mail_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=146></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=147></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>comment <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=148></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=149></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=150></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=151></td><td><pre>        <span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>        <span class="token keyword">var</span> commentListFirstChild <span class="token operator">=</span> commentList<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre></pre></td></tr><tr><td data-num=154></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>		  userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"nick_name"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>nick_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"parent_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=157></td><td><pre></pre></td></tr><tr><td data-num=158></td><td><pre>        <span class="token function">contentAppend</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> commentListFirstChild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=160></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=161></td><td><pre>            commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre>            commentList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span> commentList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>commentListFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=165></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=166></td><td><pre>    <span class="token keyword">var</span> commentNum <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">commentCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>    <span class="token keyword">var</span> info <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>    <span class="token keyword">var</span> replyElements <span class="token operator">=</span> commentList<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre></pre></td></tr><tr><td data-num=170></td><td><pre>    info<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"已有"</span> <span class="token operator">+</span> commentNum <span class="token operator">+</span> <span class="token string">"条评论"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre></pre></td></tr><tr><td data-num=172></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> reply <span class="token keyword">of</span> replyElements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=173></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=174></td><td><pre>        reply<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=175></td><td><pre>            <span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=176></td><td><pre>            <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">replyClick</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=177></td><td><pre>            <span class="token boolean">false</span></pre></td></tr><tr><td data-num=178></td><td><pre>        <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=180></td><td><pre>	<span class="token function">commentReplyShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=182></td><td><pre></pre></td></tr><tr><td data-num=183></td><td><pre><span class="token comment">/* -------------snip------------- */</span></pre></td></tr><tr><td data-num=184></td><td><pre></pre></td></tr><tr><td data-num=185></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commentReplyShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=186></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=187></td><td><pre>    <span class="token keyword">const</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token string">"/database_reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre></pre></td></tr><tr><td data-num=190></td><td><pre>    <span class="token keyword">var</span> data <span class="token operator">=</span> responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=191></td><td><pre>    <span class="token keyword">var</span> array <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>    <span class="token keyword">const</span> array_length <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre></pre></td></tr><tr><td data-num=194></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">||</span> <span class="token number">0</span> <span class="token operator">==</span> array_length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=195></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=197></td><td><pre></pre></td></tr><tr><td data-num=198></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>    <span class="token keyword">var</span> parent_id_elements <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"parent_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>    <span class="token keyword">var</span> record <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre></pre></td></tr><tr><td data-num=202></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> parent_id_elements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=203></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=204></td><td><pre>        <span class="token keyword">var</span> child_element <span class="token operator">=</span> p<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"child-list"</span> <span class="token operator">==</span> child_element<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=206></td><td><pre>            p<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child_element<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=208></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=209></td><td><pre></pre></td></tr><tr><td data-num=210></td><td><pre>    array<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> array_length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=212></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=213></td><td><pre>        <span class="token keyword">var</span> sub <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre>        <span class="token keyword">var</span> member_ptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre></pre></td></tr><tr><td data-num=216></td><td><pre>        record<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=217></td><td><pre>        record<span class="token punctuation">.</span>parent_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=218></td><td><pre>        record<span class="token punctuation">.</span>response_id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>        record<span class="token punctuation">.</span>nick_name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre>        record<span class="token punctuation">.</span>mail <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>        record<span class="token punctuation">.</span>mail_md5 <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>        record<span class="token punctuation">.</span>create_at <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre>        record<span class="token punctuation">.</span>comment <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=224></td><td><pre></pre></td></tr><tr><td data-num=225></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">undefined</span> <span class="token operator">==</span> sub<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=226></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=227></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=228></td><td><pre>            <span class="token keyword">const</span> c <span class="token operator">=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=229></td><td><pre></pre></td></tr><tr><td data-num=230></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">":"</span> <span class="token operator">==</span> c <span class="token operator">&amp;&amp;</span> <span class="token number">7</span> <span class="token operator">!=</span> member_ptr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>member_ptr<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=231></td><td><pre>            <span class="token keyword">else</span></pre></td></tr><tr><td data-num=232></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=233></td><td><pre>                <span class="token keyword">switch</span><span class="token punctuation">(</span>member_ptr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=234></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=235></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=236></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>parent_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=237></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>response_id <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=238></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>nick_name <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=239></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>mail <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=240></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>mail_md5 <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=241></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>create_at <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre>                    <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> record<span class="token punctuation">.</span>comment <span class="token operator">+=</span> c<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=243></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=244></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=245></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=246></td><td><pre>        <span class="token keyword">var</span> parent_label <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>parent_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre>		  <span class="token keyword">var</span> response_label <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>response_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=248></td><td><pre>        <span class="token keyword">var</span> childList <span class="token operator">=</span> parent_label<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>        <span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre></pre></td></tr><tr><td data-num=251></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"child-list"</span> <span class="token operator">!=</span> childList<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=252></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=253></td><td><pre>            childList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=254></td><td><pre>            childList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"child-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>            childList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop <span class="token operator">=</span> <span class="token string">"5px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=256></td><td><pre></pre></td></tr><tr><td data-num=257></td><td><pre>            parent_label<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>childList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=259></td><td><pre></pre></td></tr><tr><td data-num=260></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=261></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"child_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=262></td><td><pre>		userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"nick_name"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>nick_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"parent_id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>parent_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=264></td><td><pre>        userBlock<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"response_id"</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>response_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=265></td><td><pre></pre></td></tr><tr><td data-num=266></td><td><pre>        <span class="token function">contentAppend</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>record<span class="token punctuation">,</span>response_label<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=267></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> childList<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=268></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=269></td><td><pre>            childList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=270></td><td><pre>            childList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> childList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=272></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=273></td><td><pre></pre></td></tr><tr><td data-num=274></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> parent_id_elements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=275></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=276></td><td><pre>        <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=277></td><td><pre>        <span class="token keyword">var</span> commentList <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=278></td><td><pre>        <span class="token keyword">var</span> replyElements <span class="token operator">=</span> commentList<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"reply"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=279></td><td><pre></pre></td></tr><tr><td data-num=280></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> reply <span class="token keyword">of</span> replyElements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=281></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=282></td><td><pre>            reply<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=283></td><td><pre>                <span class="token string">"click"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=284></td><td><pre>                <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">replyClick</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=285></td><td><pre>                <span class="token boolean">false</span></pre></td></tr><tr><td data-num=286></td><td><pre>            <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=287></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=288></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=289></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class=tags><a href=/tags/osp/ rel=tag><i class="ic i-tag"></i> 开源项目</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span> <span class=text>更新于</span> <time title="修改时间：2025-09-19 22:24:59" itemprop=dateModified datetime=2025-09-19T22:24:59+08:00>2025-09-19</time></span><span class=item data-path=/computer-science/programming/c-language/c-project/comment-system-mid/ title=阅读次数><span class=icon><i class="ic i-eye"></i></span> <span class=text>阅读次数</span><span class=waline-pageview-count></span> <span class=text>次</span></span></div><div id=copyright><ul><li class=author><strong>本文作者：</strong> ReverseSacle <i class="ic i-at"><em>@</em></i>逆转天平</li><li class=link><strong>本文链接：</strong> <a href=https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-mid/ title=网站留言评论系统的设计与手动实现-中稿>https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-mid/</a></li><li class=license><strong>版权声明：</strong> 本站所有文章除特别声明外，均采用 <span class=exturl data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class=post-nav><div class="item left"><a href=/computer-science/programming/c-language/c-project/comment-system-part2/ itemprop=url rel=prev data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg6.webp title=网站留言评论系统的设计与手动实现-初稿-第二部分><span class=type>上一篇</span><span class=category><i class="ic i-flag"></i> C语言项目</span><h3>网站留言评论系统的设计与手动实现-初稿-第二部分</h3></a></div><div class="item right"><a href=/computer-science/programming/reverse-engineering/cheatengine/ itemprop=url rel=next data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg3.webp title=CheatEngine基础><span class=type>下一篇</span><span class=category><i class="ic i-flag"></i> 逆向工程</span><h3>CheatEngine基础</h3></a></div></div><div class=wrap id=comments><div id=waline-comment></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=文章目录><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#%E4%BB%8E0%E5%88%B01%E7%9A%84%E6%BA%90%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E7%9A%84%E7%BD%91%E7%AB%99%E7%95%99%E8%A8%80%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F-%E4%B8%AD%E7%A8%BF><span class=toc-number>1.</span> <span class=toc-text>从0到1的源代码编写的网站留言评论系统-中稿</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%A2%9E%E5%8A%A0%E7%9A%84%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86%E8%8C%83%E5%9B%B4><span class=toc-number>1.1.</span> <span class=toc-text>增加的计算机知识范围</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8D%95%E8%BF%9B%E7%A8%8B%E5%90%8E%E7%AB%AF%E6%BA%90%E7%A0%81%E7%9A%84%E7%BB%93%E6%9E%84%E5%A4%84%E7%90%86%E4%B8%8E%E5%88%86%E5%B1%82><span class=toc-number>1.2.</span> <span class=toc-text>(单进程)后端源码的结构处理与分层</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BD%BF%E7%94%A8mysql%E7%9A%84c-api-mysql><span class=toc-number>1.3.</span> <span class=toc-text>使用MySQL的C++ API - MySQL++</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%90%8E%E7%AB%AF%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E8%BD%AC%E7%A7%BB%E8%87%B3cpp><span class=toc-number>1.4.</span> <span class=toc-text>后端编程语言转移至cpp</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%97%A5%E5%BF%97%E5%BA%93spdlog><span class=toc-number>1.5.</span> <span class=toc-text>使用第三方日志库spdlog</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%88%A9%E7%94%A8%E5%8A%A8%E6%80%81%E8%A7%A3%E6%9E%90json%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0%E8%BF%90%E8%A1%8C%E6%97%B6%E9%85%8D%E7%BD%AE%E5%8F%98%E6%9B%B4%E6%93%8D%E4%BD%9C><span class=toc-number>1.6.</span> <span class=toc-text>利用动态解析JSON文件，实现运行时配置变更操作</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%80%82%E9%85%8Dgravatar%E5%A4%B4%E5%83%8F><span class=toc-number>1.7.</span> <span class=toc-text>适配Gravatar头像</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84><span class=toc-number>1.7.1.</span> <span class=toc-text>目录结构</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BD%BF%E7%94%A8gravatar-api><span class=toc-number>1.7.2.</span> <span class=toc-text>使用Gravatar API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%AF%84%E8%AE%BA%E7%9A%84%E5%9B%9E%E5%A4%8D%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99><span class=toc-number>1.8.</span> <span class=toc-text>评论的回复系统的代码编写</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%AF%84%E8%AE%BA%E7%9A%84%E5%9B%9E%E5%A4%8D%E6%8C%89%E9%92%AE%E5%89%8D%E7%AB%AF%E6%A0%B7%E5%BC%8F><span class=toc-number>1.8.1.</span> <span class=toc-text>评论的回复按钮前端样式</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%88%86%E7%A6%BB%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E5%A4%84%E7%90%86%E4%BB%A3%E7%A0%81><span class=toc-number>1.8.1.1.</span> <span class=toc-text>分离时间戳的处理代码</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%B7%BB%E5%8A%A0%E5%9B%9E%E5%A4%8D%E6%A0%B7%E5%BC%8F><span class=toc-number>1.8.1.2.</span> <span class=toc-text>添加回复样式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%87%8D%E6%9E%84%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%A1%A8><span class=toc-number>1.8.2.</span> <span class=toc-text>重构数据库的表</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9B%9E%E5%A4%8D%E8%AF%84%E8%AE%BA%E7%9A%84%E5%8E%9F%E7%90%86><span class=toc-number>1.8.3.</span> <span class=toc-text>回复评论的原理</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%98%E6%9B%B4%E5%90%8E%E7%AB%AF%E4%B8%8E%E5%89%8D%E7%AB%AF%E7%9A%84%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E6%8E%A5%E6%94%B6%E5%86%85%E5%AE%B9><span class=toc-number>1.8.4.</span> <span class=toc-text>变更后端与前端的数据格式接收内容</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BB%9F%E8%AE%A1%E4%B8%BB%E8%AF%84%E8%AE%BA%E6%9D%A1%E6%95%B0><span class=toc-number>1.8.5.</span> <span class=toc-text>统计主评论条数</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%82%B9%E5%87%BB%E5%9B%9E%E5%A4%8D%E6%8C%89%E9%92%AE%E5%8A%9F%E8%83%BD%E7%9A%84%E5%89%8D%E7%AB%AF%E6%A0%B7%E5%BC%8F><span class=toc-number>1.8.6.</span> <span class=toc-text>点击回复按钮功能的前端样式</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%89%8D%E7%AB%AF%E5%9B%9E%E5%A4%8D%E6%8C%89%E9%92%AE%E6%8F%90%E4%BA%A4%E4%B8%8E%E5%90%8E%E7%AB%AF%E5%93%8D%E5%BA%94><span class=toc-number>1.8.7.</span> <span class=toc-text>前端回复按钮提交与后端响应</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%98%BE%E7%A4%BA%E8%AF%84%E8%AE%BA%E6%B6%88%E6%81%AF%E4%B8%AD%E7%9A%84%E5%9B%9E%E5%A4%8D%E5%AF%B9%E8%B1%A1><span class=toc-number>1.8.8.</span> <span class=toc-text>显示评论消息中的回复对象</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title=系列文章><ul><li><a href=/computer-science/programming/c-language/c-project/comment-system-part1/ rel=bookmark title=网站留言评论系统的设计与手动实现-初稿-第一部分>网站留言评论系统的设计与手动实现-初稿-第一部分</a></li><li><a href=/computer-science/programming/c-language/c-project/comment-system-part2/ rel=bookmark title=网站留言评论系统的设计与手动实现-初稿-第二部分>网站留言评论系统的设计与手动实现-初稿-第二部分</a></li><li class=active><a href=/computer-science/programming/c-language/c-project/comment-system-mid/ rel=bookmark title=网站留言评论系统的设计与手动实现-中稿>网站留言评论系统的设计与手动实现-中稿</a></li></ul></div><div class="overview panel" data-title=站点概览><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img class=image itemprop=image alt=ReverseSacle data-src=/images/avatar.webp><p class=name itemprop=name>ReverseSacle</p><div class=description itemprop=description>知识书库 & 学习点滴</div></div><nav class=state><div class="item posts"><a href=/archives/ ><span class=count>186</span> <span class=name>文章</span></a></div><div class="item categories"><a href=/categories/ ><span class=count>52</span> <span class=name>分类</span></a></div><div class="item tags"><a href=/tags/ ><span class=count>18</span> <span class=name>标签</span></a></div></nav><div class=social><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JldmVyc2VTYWNsZQ==" title=https:&#x2F;&#x2F;github.com&#x2F;ReverseSacle><i class="ic i-github"></i></span><span class="exturl item email" data-url="bWFpbHRvOnByaXZhdGVAcmV2ZXJzZXNhY2xlLmNvbQ==" title=mailto:private@reversesacle.com><i class="ic i-envelope"></i></span></div><ul class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i> 首页</a></li><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-feather"></i> 文章</a><ul class=submenu><li class=item><a href=/archives/ rel=section><i class="ic i-list-alt"></i> 归档</a></li><li class=item><a href=/categories/ rel=section><i class="ic i-th"></i> 分类</a></li><li class=item><a href=/tags/ rel=section><i class="ic i-tags"></i> 标签</a></li></ul></li><li class=item><a href=/about/ rel=section><i class="ic i-user"></i> 关于</a></li><li class=item><a href=/friend-links/ rel=section><i class="ic i-heart"></i> 友链</a></li></ul></div></div></div><ul id=quick><li class="prev pjax"><a href=/computer-science/programming/c-language/c-project/comment-system-part2/ rel=prev title=上一篇><i class="ic i-chevron-left"></i></a></li><li class=up><i class="ic i-arrow-up"></i></li><li class=down><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href=/computer-science/programming/reverse-engineering/cheatengine/ rel=next title=下一篇><i class="ic i-chevron-right"></i></a></li><li class=percent></li></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>随机文章</h2><ul><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/algorithm/ title="分类于 算法">算法</a></div><span><a href=/computer-science/programming/algorithm/math/sieve-of-eratosthenes/ title=埃拉托斯特尼筛法>埃拉托斯特尼筛法</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/c-basic/ title="分类于 C语言基础">C语言基础</a></div><span><a href=/computer-science/programming/c-language/basis/c/cpart1/ title=C语言基础-第一部分-C89&#x2F;C90标准>C语言基础-第一部分-C89/C90标准</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/backtracking/ title="分类于 回溯">回溯</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/backtracking/combination/ title=回溯-组合>回溯-组合</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/python/ title="分类于 Python">Python</a></div><span><a href=/computer-science/programming/python/python-environment/ title=Python环境配置(Windows)>Python环境配置(Windows)</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/web/ title="分类于 web">web</a></div><span><a href=/computer-science/programming/web/anti-scraping-vs-countermeasures/ title=防爬虫与反防爬虫知识聚合>防爬虫与反防爬虫知识聚合</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/web/ title="分类于 web">web</a></div><span><a href=/computer-science/programming/web/jspart2/ title=JavaScript基础-第二部分>JavaScript基础-第二部分</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/network-programming/ title="分类于 网络编程">网络编程</a></div><span><a href=/computer-science/programming/network-programming/executable-program/ title=在C&#x2F;C++程序中调用可执行程序>在C/C++程序中调用可执行程序</a></span></li><li class=item><div class=breadcrumb><a href=/categories/general-science-and-technology/ title="分类于 通用科学技术">通用科学技术</a><i class="ic i-angle-right"></i> <a href=/categories/general-science-and-technology/pc/ title="分类于 通用技术之PC端">通用技术之PC端</a><i class="ic i-angle-right"></i> <a href=/categories/general-science-and-technology/pc/laptop/ title="分类于 笔记本">笔记本</a></div><span><a href=/general-science-and-technology/pc/laptop/occupied-cpu-by-lenovo-isf/ title=占用CPU的Lenovo-ISFramework>占用CPU的Lenovo-ISFramework</a></span></li><li class=item><div class=breadcrumb><a href=/categories/general-science-and-technology/ title="分类于 通用科学技术">通用科学技术</a><i class="ic i-angle-right"></i> <a href=/categories/general-science-and-technology/pc/ title="分类于 通用技术之PC端">通用技术之PC端</a><i class="ic i-angle-right"></i> <a href=/categories/general-science-and-technology/pc/laptop/ title="分类于 笔记本">笔记本</a></div><span><a href=/general-science-and-technology/pc/laptop/laptop-clean/ title=笔记本的清洁>笔记本的清洁</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a></div><span><a href=/computer-science/programming/c-language/c-data-structure/nonlinear-structure/threaded-binary-tree/ title=C语言-二叉树线索化(线索链表)>C语言-二叉树线索化(线索链表)</a></span></li></ul></div><div><h2>最新评论</h2><ul id=waline-recent></ul></div></div><div class=status><div class=copyright>&copy; 2021 – <span itemprop=copyrightYear>2025</span><span class=with-love><i class="ic i-sakura rotate"></i></span> <span class=author itemprop=copyrightHolder>ReverseSacle @ ReverseSacle-Blog</span></div><div class=count><i class="ic i-clock" aria-hidden=true></i> <span id=time align=center>载入时间中...<script defer>var now=new Date;function createtime(){var n=new Date("2021-11-16 22:30:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("time").innerHTML="已经过 "+dnum+" 天 "+hnum+" 小时 "+mnum+" 分 "+snum+" 秒 "}setInterval("createtime()",250)</script></span><span class=post-meta-item-icon>|&nbsp<i class="ic i-chart-area"></i></span> <span title=站点总字数>2.1m 字</span> <span class=post-meta-item-icon>|&nbsp<i class="ic i-coffee"></i></span> <span title=站点阅读时长>40:40</span></div></div></div></footer></div><script data-config>var LOCAL={path:"computer-science/programming/c-language/c-project/comment-system-mid/",favicon:{show:"ReverseSacle-Blog",hide:"ReverseSacle-Blog"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},waline:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src=https://polyfill.alicdn.com/v3/polyfill.min.js></script><script src=https://cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1.16.0/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js></script><script src=/js/app.js></script></body></html>