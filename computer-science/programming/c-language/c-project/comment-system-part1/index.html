<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#222><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/ico sizes=48x48 href=/images/favicon.ico><link rel=alternate type=application/rss+xml title=逆转天平 href=https://www.reversesacle.com/rss.xml><link rel=alternate type=application/atom+xml title=逆转天平 href=https://www.reversesacle.com/atom.xml><link rel=alternate type=application/json title=逆转天平 href=https://www.reversesacle.com/feed.json><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=/css/app.css><meta name=description content=开源项目><link rel=canonical href=https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-part1/ ><title>网站留言评论系统的设计与手动实现-初稿-第一部分 - C语言项目 - C语言 - 编程 - 计算机科学 | ReverseSacle-Blog</title><meta name=generator content="Hexo 6.3.0"></head><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=dotloader><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">网站留言评论系统的设计与手动实现-初稿-第一部分</h1><div class=meta><span class=item title="创建时间：2023-09-07 13:58:44"><span class=icon><i class="ic i-calendar"></i></span> <span class=text>发表于</span> <time itemprop="dateCreated datePublished" datetime=2023-09-07T13:58:44+08:00>2023-09-07</time></span><span class=item title=本文字数><span class=icon><i class="ic i-pen"></i></span> <span class=text>本文字数</span> <span>46k</span> <span class=text>字</span></span><span class=item title=阅读时长><span class=icon><i class="ic i-clock"></i></span> <span class=text>阅读时长</span> <span>54 分钟</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div class=lines role=navigation aria-label=切换导航栏><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>ReverseSacle-Blog</a></li></ul><ul class=right><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id=imgs class=pjax><ul><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg17.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg11.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg4.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg3.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg18.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg14.webp></li></ul></div></header><div id=waves><svg class=waves xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewBox="0 24 150 28" preserveAspectRatio=none shape-rendering=auto><defs><path id=gentle-wave d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352z"/></defs><g class=parallax><use xlink:href=#gentle-wave x=48 y=0 /><use xlink:href=#gentle-wave x=48 y=3 /><use xlink:href=#gentle-wave x=48 y=5 /><use xlink:href=#gentle-wave x=48 y=7 /></g></svg></div><main><div class=inner><div id=main class=pjax><div class="article wrap"><div class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i> <span><a href=/ >首页</a></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/ itemprop=item rel=index title="分类于 计算机科学"><span itemprop=name>计算机科学</span></a><meta itemprop=position content=1></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/ itemprop=item rel=index title="分类于 编程"><span itemprop=name>编程</span></a><meta itemprop=position content=2></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/c-language/ itemprop=item rel=index title="分类于 C语言"><span itemprop=name>C语言</span></a><meta itemprop=position content=3></span><i class="ic i-angle-right"></i> <span class=current itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/c-language/c-project/ itemprop=item rel=index title="分类于 C语言项目"><span itemprop=name>C语言项目</span></a><meta itemprop=position content=4></span></div><article itemscope itemtype=http://schema.org/Article class="post block" lang=zh-CN><link itemprop=mainEntityOfPage href=https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-part1/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.webp><meta itemprop=name content=ReverseSacle><meta itemprop=description content="所见即所得，所思即所行, 知识书库 & 学习点滴"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=逆转天平></span><div class="body md" itemprop=articleBody><h1 id=从0到1的源代码编写的网站留言评论系统-初稿><a class=anchor href=#从0到1的源代码编写的网站留言评论系统-初稿>#</a> 从0到1的源代码编写的网站留言评论系统-初稿</h1><h2 id=概述><a class=anchor href=#概述>#</a> 概述</h2><p>此项目为【从计算机<code>入门</code>水平升阶为计算机<code>进阶-前期</code>水平】的升阶考核项目。</p><p><strong>初稿</strong>部分以简单、简洁性和完整性为主，除了必要的数据库API外，没有额外的外部插件库，全是由个人手动实现的底层源码。</p><p>此项目在<strong>Linux系统CentOS 7环境</strong>下编译，测试和运行，对于初稿所指的C语言指C，不包含<code>C++</code>，使用的C标准在C99之下(不包括C99)。</p><p><strong>中稿</strong>部分以附加功能为主，主要是将编程语言切换到cpp，并利用了cpp中的第三方库添加并改善了相关功能。</p><p>在该篇文章中能感受到下列所述内容：设计思路、分析思路、如何寻找思路、如何改善思路、通过思路如何设计、设计过程中出现问题如何解决问题、实现过程中如何确定应用那些知识等。</p><h3 id=涉及的计算机知识范围><a class=anchor href=#涉及的计算机知识范围>#</a> 涉及的计算机知识范围</h3><ul><li><p><a href=https://www.reversesacle.com/computer-science/programming/c-language/basis/c/cpart1/ >C语言基础知识</a></p></li><li><p><a href=https://www.reversesacle.com/computer-science/computer-basic/network/nwpart3/ >计算机网络(运输层和应用层)基础知识</a></p></li><li><p><a href=https://www.reversesacle.com/computer-science/programming/web/hcpart1/ >HTML与CSS基础知识</a></p></li><li><p><a href=https://www.reversesacle.com/computer-science/programming/web/jspart1/ >JavaScript基础知识</a></p></li><li><p><a href=https://www.reversesacle.com/tags/network-programming/ >有关网络编程的全基础知识(额外包含了Linux环境编程/GCC编译器/GDB调试器)</a></p></li><li><p><a href=https://www.reversesacle.com/computer-science/programming/c-language/network-programming/http/ >HTTP网络通信基础</a></p></li><li><p><a href=https://www.reversesacle.com/tags/database/ >数据库基础知识与MySQL数据库基础</a></p></li></ul><h3 id=相关参考资料><a class=anchor href=#相关参考资料>#</a> 相关参考资料</h3><ul><li><span class=exturl data-url="aHR0cHM6Ly9jcGx1c3BsdXMuY29tLw==">cplusplus官网</span> - 用于C语言函数声明的查看</li><li><span class=exturl data-url="aHR0cHM6Ly9jb2RlcGVuLmlvLw==">codepen官网</span> - 用于评论展示样式设计思路的参考</li><li>自主总结的知识文章</li><li>ChatGPT - 用于所需知识的方向查找，用作提词器兼百科全书</li><li>当前博客的hexo-shoka主题的minivaline评论样式 - 用于评论输入样式设计的参考</li></ul><h3 id=思路来源><a class=anchor href=#思路来源>#</a> 思路来源</h3><ul><li>LeanCloud的云引擎服务和minivaline数据库表布局</li><li>Vercel的云服务平台</li><li>Cloudflare的防火墙事件和WAF规则</li><li>使用hexo-shoka主题建站而经历的一系列事情</li></ul><h3 id=问题分析与解决方法><a class=anchor href=#问题分析与解决方法>#</a> 问题分析与解决方法</h3><ul><li>将错误通过<strong>搜索引擎</strong>搜索(推荐谷歌和必应)，搜索过程中能相较模糊地捕获到问题所涉及的知识范围或者是直接解决问题的方法</li><li>使用<strong>ChatGPT</strong>，采用将问题轮询的方式(就是先问原始问题，得到回答后将回答中的疑问当做下一个问题，以此循环)来获取答案，由于有些回答是错误的，需自身有较高的辨明度，<strong>一般人不推荐</strong>。因此，使用ChatGPT并非用于直接获取答案，而是用于获取指明答案的方向，通过分析其回答内容所涉及的知识方面，将涉及的知识方面通过<strong>搜索引擎</strong>来搜索，以此来获取正确答案，而非直接使用ChatGPT原来的具有不确定性的答案，此外ChatGPT还可当作查看项目所需相关语言函数声明/案例的百科全书</li></ul><h2 id=设计模式分析><a class=anchor href=#设计模式分析>#</a> 设计模式分析</h2><p>倘若不将内置库函数计入，该项目中的自定义函数的时间复杂度基本上全维持在<code>O(n)</code>，空间复杂度全维持在<code>O(1)</code>。(埋个<strong>坑1</strong>)</p><p>该设计模式分析部分的编写是随着整篇文章的进程而一直处于动态修改的状态的，也就是说随着项目的编写，此处的内容已经修改或重新编写几次了。</p><p>由于发生的错误和能发生错误的地方，本人对于这些地方有种说不出的感觉，就是有一种【一眼看上去就是这个地方错了之类的】感觉。能发生的错误，基本上都是由【变量/函数名拼写错误，漏写/多写个字符，漏掉括号等】而导致的，基本没有进行过Debug操作，因此，此处就没有使用GDB调试器的教程部分，但还是添加了用于Debug的标准输出流文本提示。</p><p><strong>初稿的基本创建过程基本上分为下面9大步</strong></p><ul><li><p><strong>1.前端评论区基本样式</strong></p></li><li><p><strong>2.后端Linux服务器处理进程(HTTP服务器)</strong></p></li><li><p><strong>3.Linux服务器处理进程的数据库链接</strong></p></li><li><p><strong>4.前端通过后端与数据库进行数据交换</strong></p></li><li><p><strong>5.适应性评论显示区域样式布局</strong></p></li><li><p><strong>6.服务器进程的多线程模式</strong></p></li><li><p><strong>7.服务器进程的日志监听模式</strong></p></li><li><p><strong>8.动态库与静态库的制作</strong></p></li><li><p><strong>9.服务器进程的高性能化处理</strong></p></li></ul><h2 id=前端评论区基本样式><a class=anchor href=#前端评论区基本样式>#</a> 前端评论区基本样式</h2><p>由<strong>HTML和CSS</strong>与<strong>JavaScript脚本语言</strong>共同设计并实现的评论系统样式骨架。</p><p>初稿以基本输入和基本输出功能的完整性为主，分为评论输入区域和评论显示区域。</p><p>基本样式设计思路来源于hexo-shoka主题的minivaline魔改版的评论区和LeanCloud的数据存储格式，以简洁为主，能不用的地方就尽量不用，因此省略了大部分装饰效果。</p><p>对于CSS样式的调试，可通过在浏览器(推荐Firefox)中按F12键打开开发工具，通过选中元素并右键点击检查来查看CSS样式的详细情况，还可手动修改样式之后再回到源代码处修改。</p><h3 id=目录及样式初期布局预览><a class=anchor href=#目录及样式初期布局预览>#</a> 目录及样式初期布局预览</h3><p><img data-src=https://cdn.jsdelivr.net/gh/ReverseSacle/Gallery@latest/programming/project/comment-system/1.webp alt=""></p><h3 id=基本输入区域><a class=anchor href=#基本输入区域>#</a> 基本输入区域</h3><p><strong>样式</strong>参考了hexo-shoka主题中minivaline魔改版的评论区样式。</p><p><strong>输入的内容</strong>参考了LeanCloud的数据存储格式。</p><p>输入区域分为背景板区域(整体区域)，内容板区域(3个区域)。输入区域中，背景板区域用于评论框的样式修改，内容板区域包含普通输入区域和文本输入区域和按钮区域。</p><p>个人自行筛选了minivaline中的各样式属性，初稿以简约为主，中稿部分才会考虑添加修饰效果。</p><details class=info><summary>index.html</summary><div><p>id为<code>comment-block</code>的div标签是<strong>整个评论区的体</strong></p><ul><li><p>class为<code>input-block</code>的div子标签是<strong>评论的输入区域的体</strong></p><ul><li><p>class为<code>nickname</code>的input子标签是评论的输入区域的<strong>nickname输入区域</strong>，添加了默认属性name(待定)，maxlength(最大可输入字符数量)，placeholder(占位字符)</p></li><li><p>class为<code>email</code>的input子标签是评论的输入区域的<strong>eamil输入区域</strong>，添加了默认属性name(待定)，maxlength(最大可输入字符数量)，placeholder(占位字符)</p></li><li><p>class为<code>text-block</code>的textarea子标签是评论的输入区域的<strong>文本输入区域</strong>，添加了默认属性name(待定)，rows(最大行数，限制高)，cols(最大列数，限制宽)</p></li><li><p>class为<code>button-area</code>的div子标签是评论的输入区域的<strong>按钮集合区域</strong></p><ul><li>class为<code>commit</code>的button子标签是按钮集合区域的<strong>提交按钮</strong></li></ul></li></ul></li></ul><p>为了更精准的指明所说明的对象，文章后面都用id和class名来代替所指的对象，结构为</p><p><code>comment-block</code> → <strong>评论区的体</strong></p><ul><li><code>input-block</code> → 评论区的体中的<strong>输入区域的体</strong><ul><li><code>nickname</code> → 评论区的体中的输入区域中的<strong>nickname输入区域</strong></li><li><code>email</code> → 评论区的体中的输入区域中的<strong>email输入区域</strong></li><li><code>text-block</code> → 评论区的体中的输入区域中的<strong>文本输入区域</strong></li><li><code>button-area</code> → 评论区的体中的<strong>按钮集合区域</strong><ul><li><code>commit</code> → 评论区的体中的按钮集合区域中的<strong>提交按钮</strong></li></ul></li></ul></li></ul><figure class="highlight html"><figcaption data-lang=HTML></figcaption><table><tr><td data-num=1></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./css/comments.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/comments.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=12></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=13></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=14></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nickname<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>19<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> nickname(1~19个字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=15></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>45<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> mail(8~44字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=16></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-block<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>236<span class="token punctuation">"</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>496<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=17></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=18></td><td><pre>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>commit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=19></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=20></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=21></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></div></details><details class=info><summary>comments.css</summary><div><p>输入区域的CSS样式，先是依照此hexo主题的评论区的视觉效果再由所学的CSS知识而进行编写的，之后的阴影效果是通过浏览器的F12开发工具检查了此hexo主题的评论区的样式而得知的。</p><p>先是初始化了<code>comment-block</code>后代的所有input、textarea和button标签的盒子属性。</p><p>接着为<code>input-block</code>设置样式(就是一个有宽高和定位的平面，并设置了边框用来添加阴影效果)，并在其HTML标签处添加了浮动声明。</p><p>接着是<code>input-block</code>内的</p><ul><li><code>nickname</code>，抹除了默认样式，开启左浮动，添加了右和下边框的修饰，还添加了选中类型的伪类，以及其他属性</li><li><code>email</code>，抹除了默认样式，开启左浮动，添加了下边框的修饰，还添加了选中类型的伪类，以及其他属性</li><li><code>text-block</code> ，抹除了默认样式，开启溢出(用于开启超出边距自动添加换行符的功能)，以及其他属性</li><li><code>commit</code>，先在<code>button-area</code>HTML标签处添加浮动声明，再回到<code>commit</code>，添加右浮动，添加鼠标移动到按钮样式处时显示的pointer(鼠标小手)属性，以及其他属性</li></ul><figure class="highlight css"><figcaption data-lang=CSS><span>index.css</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token selector">#comment-block,</span></pre></td></tr><tr><td data-num=2></td><td><pre>#comment-block input,</pre></td></tr><tr><td data-num=3></td><td><pre>#comment-block textarea,</pre></td></tr><tr><td data-num=4></td><td><pre>#comment-block button <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">/* input area part */</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token selector">#comment-block .input-block</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 306px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token selector">#comment-block .input-block .input-area</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token selector">#comment-block .input-block .input-area .nickname</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 161px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 2px solid #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>    <span class="token property">padding-right</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token selector">#comment-block .input-block .input-area .nickname:focus</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token selector">#comment-block .input-block .input-area .email</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=47></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 345px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>    <span class="token property">padding-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>    <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=55></td><td><pre></pre></td></tr><tr><td data-num=56></td><td><pre><span class="token selector">#comment-block .input-block .input-area .email:focus</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=57></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=59></td><td><pre></pre></td></tr><tr><td data-num=60></td><td><pre><span class="token selector">#comment-block .input-block .input-area .text-block</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 232px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>    <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=67></td><td><pre></pre></td></tr><tr><td data-num=68></td><td><pre><span class="token selector">#comment-block .input-block .button-area .commit</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=69></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> .3rem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #eff2f3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>    <span class="token property">line-height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h3 id=评论显示区域><a class=anchor href=#评论显示区域>#</a> 评论显示区域</h3><p>参考了CodePen中<code>Agustin Ortiz</code>作者的<span class=exturl data-url="aHR0cHM6Ly9jb2RlcGVuLmlvL0NyZWF0aWNvZGUvcGVuL3lMV3FYbw==">评论块样式模板</span>并以此来进行设计。</p><p><strong>Agustin Ortiz作者的评论块样式模板结构分析</strong></p><p>首先是class为<code>comments-container</code>的div标签，是整个评论显示区域的体，其下有</p><ul><li><p>第一个子元素<code>h1</code>标签，用于显示评论标签的</p></li><li><p>id为<code>comments-list</code>的ul标签，是整个评论内容的显示区域，其下有</p><ul><li><p>li标签，其下有</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>class为`comment-main-level`的div标签，用于显示主要评论用户的评论内容，其下有</pre></td></tr><tr><td data-num=2></td><td><pre>--1.class为`comment-avatar`的div标签，用于评论用户的头像修饰，目前里面就有个img标签</pre></td></tr><tr><td data-num=3></td><td><pre>--2.class为`comment-box`的div标签，其下有</pre></td></tr><tr><td data-num=4></td><td><pre>----2.1.class为`comment-head`的div标签，其下有</pre></td></tr><tr><td data-num=5></td><td><pre>------2.1.1.class为`comment-name by-author`的h6标签，用于显示author用户昵称，去掉by-author则表示普通用户昵称</pre></td></tr><tr><td data-num=6></td><td><pre>------2.1.2.span标签，用于显示距离评论创建时间已过多久</pre></td></tr><tr><td data-num=7></td><td><pre>------2.1.3.class为`fa fa-reply`的i标签，回复评论图标，当前无作用</pre></td></tr><tr><td data-num=8></td><td><pre>------2.1.4.class为`fa fa-heart`的i标签，点赞图标，当前无作用</pre></td></tr><tr><td data-num=9></td><td><pre>----2.2.class为`comment-content`的div标签，用于评论文本内容展示</pre></td></tr></table></figure></li></ul></li></ul><p>由以上结构可知评论显示区域的整体布局。</p><p>初稿部分省去了回复评论图标，点赞图标以及author用户的内容部分。</p><p>由于评论显示区域还需要与输入区域的提交按钮配合，当点击提交按钮时，会通过JavaScript的DOM操作来创建一个评论并在评论显示区域内显示。</p><details class=info><summary>index.html</summary><div><p>(<strong>改动</strong>)在基本输入区域的基础上，删除了没必要的<code>text-block</code>HTML标签默认属性rows。</p><p>再在<code>comment-block</code>内额外添加了class为<code>comment-container</code>的div子标签，即整个<strong>评论显示区域的体</strong>。</p><p>并在评论显示区域的体中添加了</p><ul><li>class为<code>info</code>的span子标签，用于<strong>评论显示区域的标题文字声明</strong></li><li>class为<code>comment-list</code>的ul子标签，用于<strong>评论显示区域的用户评论内容展示区域</strong></li></ul><p>为了更精准的指明所说明的对象，文章后面都用id或class名来代替所指的对象，结构为</p><p><code>comment-block</code> → <strong>评论区的体</strong></p><ul><li><p><code>input-block</code> → 评论区的体中的<strong>输入区域的体</strong></p><ul><li><code>nickname</code> → 评论区的体中的输入区域中的<strong>nickname输入区域</strong></li><li><code>email</code> → 评论区的体中的输入区域中的<strong>email输入区域</strong></li><li><code>text-block</code> → 评论区的体中的输入区域中的<strong>文本输入区域</strong></li><li><code>button-area</code> → 评论区的体中的<strong>按钮集合区域</strong><ul><li><code>commit</code> → 评论区的体中的按钮集合区域中的<strong>提交按钮</strong></li></ul></li></ul></li><li><p><code>comment-container</code> → 评论区的体中的<strong>评论显示区域的体</strong></p><ul><li><code>info</code> → 评论区的体中的评论显示区域中的<strong>标题文字声明</strong></li><li><code>comment-list</code> → 评论区的体中的评论显示区域的体中的<strong>用户评论内容展示区域</strong></li></ul></li></ul><figure class="highlight html"><figcaption data-lang=HTML></figcaption><table><tr><td data-num=1></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./css/comments.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/comments.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"></span></span></pre></td></tr><tr><td data-num=10></td><td><pre>        <span class="token selector">.body</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>            <span class="token property">height</span><span class="token punctuation">:</span> 1920px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>            <span class="token property">width</span><span class="token punctuation">:</span> 1080px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=18></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=19></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=20></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nickname<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>19<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> nickname(1~19个字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=21></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>45<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> email(8~44字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=22></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-block<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=23></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=24></td><td><pre>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>commit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=25></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=26></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=27></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=28></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=29></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Comentarios<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=30></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=31></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></div></details><details class=info><summary>comments.js</summary><div><p><strong>编写过程中搜索的知识</strong></p><p>此处的编写，先借助了ChatGPT工具，查找了元素标签(Element)的获取方法案例，但其给出的答案并不能用于实际，最终还是通过浏览器搜索了ChatGPT给出的所涉及的知识方向才得以完成。</p><p>获取<strong>一个</strong>指定id名元素标签的方法 - <code>document.getElementById(&quot;id名&quot;)</code></p><p>获取元素标签的<strong>第一个</strong>元素标签的属性 - <code>元素标签变量名.firstElementChild</code></p><p>获取元素标签的<strong>最后一个</strong>元素标签的属性 - <code>元素标签变量名.lastElementChild</code></p><p>获取元素标签下<strong>所有</strong>指定标签类型元素标签的方法 - <code>元素标签变量名.getElementsByTagName(&quot;标签类型名&quot;)</code></p><p>创建<strong>一个</strong>指定标签类型的元素标签的方法 - <code>document.createElement(&quot;标签类型名&quot;)</code></p><p>为元素标签添加属性的方法 - <code>元素标签变量名.setAttribute(&quot;属性名&quot;, &quot;属性值&quot;)</code></p><p>在元素标签内添加文本 - <code>元素标签变量名.innerText = 文本字符串</code></p><p>在元素标签内添加HTML文本 - <code>元素标签变量名.innerHTML = 文本字符串</code></p><p>在元素标签下添加子标签的方法 - <code>元素标签变量名.appendChild(子元素标签名)</code></p><p><strong>具体编写过程思路</strong></p><p>由JavaScript脚本语言的DOM操作，</p><p>查找<code>comment-block</code>元素标签的第一个子元素标签<code>input-block</code>，再查找<code>input-block</code>元素标签的第一个子元素标签<code>input-area</code>，再查找<code>input-area</code>元素标签的最后一个子元素标签<code>button-area</code>，最后再查找<code>button-area</code>元素标签里的<code>commit</code>元素标签，接着开始监听<code>commit</code>标签的点击事件。</p><p>当有点击事件发生时，通过传入的匿名函数，来获取<code>input-block</code>下所有可输入的标签，当nickname不为空时，会触发<code>contentAppend</code>自定义函数。</p><p>查看<code>评论显示区域</code>内容开头提及的<strong>评论块样式模板结构分析</strong>，按结构来创建元素标签，再在创建的标签中添加子标签，以此方法来完成用户评论的创建，此部分由<code>contentAppend</code>自定义函数来完成。</p><p>在<code>contentAppend</code>自定义函数中，先创建一个在<code>comment-list</code>中ul标签下的li标签，再在li标签下，创建一个class为<code>main-level</code>的div标签，其下还有</p><ul><li>class为<code>avatar</code>的div标签，其包裹着一个img标签，用于<strong>修饰头像</strong></li><li>class为<code>comment-box</code>的div标签，其下有<ul><li>class为<code>cbox-head</code>的div标签，其下有<ul><li>class为<code>cbauthor-name</code>的span标签，用于<strong>展示昵称</strong></li><li>和一个用于时间计数的普通span标签，用于<strong>显示距离评论创建时间已过了多久</strong></li></ul></li><li>class为<code>cbox-content</code>的span标签，用于展示经过textareaBeautify自定义函数处理过的<strong>文本内容</strong></li></ul></li></ul><figure class="highlight js"><figcaption data-lang=JavaScript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">function</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span><span class="token parameter">textsLable<span class="token punctuation">,</span> cols</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">var</span> texts <span class="token operator">=</span> <span class="token punctuation">(</span>textsLable<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r|\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">var</span> textLength <span class="token operator">=</span> texts<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> textLength<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> cache<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token number">0</span> <span class="token operator">===</span> cache<span class="token punctuation">.</span>length <span class="token operator">%</span> cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre>            cache <span class="token operator">+=</span> <span class="token string">"&lt;br/>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>        cache <span class="token operator">+=</span> texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">return</span> cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">function</span> <span class="token function">contentAppend</span><span class="token punctuation">(</span><span class="token parameter">lable<span class="token punctuation">,</span> nickNameValue<span class="token punctuation">,</span> textsLable</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token keyword">var</span> mainUserLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    mainUserLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"main-level clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token comment">/* avatar area  start-area */</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token keyword">var</span> avatarLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    avatarLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"avatar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token keyword">var</span> imgLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    imgLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> <span class="token string">"./img/img.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    imgLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"alt"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre>    avatarLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>imgLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    mainUserLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>avatarLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token comment">/* avatar area  end-area */</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token keyword">var</span> commentBoxLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token comment">/* comment box of coment area start-area */</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre>    <span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> nickNameValue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre>    <span class="token keyword">var</span> timeSpend <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"hace 20 minutos"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre></pre></td></tr><tr><td data-num=45></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpend<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=49></td><td><pre></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>    boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"cbox-content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre>    boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span>textsLable<span class="token punctuation">,</span> textsLable<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token comment">/* comment box of coment area end-area */</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre>    mainUserLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    lable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre></pre></td></tr><tr><td data-num=62></td><td><pre>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=63></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>    <span class="token keyword">var</span> inputBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>    <span class="token keyword">var</span> inputArea <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>    <span class="token keyword">var</span> buttonArea <span class="token operator">=</span> inputArea<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>    <span class="token keyword">var</span> commitButton <span class="token operator">=</span> buttonArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>    commitButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=70></td><td><pre>        <span class="token keyword">var</span> inputs <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>        <span class="token keyword">var</span> nickName <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>        <span class="token keyword">var</span> email <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>        <span class="token keyword">var</span> texts <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"textarea"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre></pre></td></tr><tr><td data-num=75></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">""</span> <span class="token operator">!=</span> nickName<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=76></td><td><pre>            <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>            <span class="token keyword">var</span> commentList <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>            <span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre></pre></td></tr><tr><td data-num=80></td><td><pre>            <span class="token function">contentAppend</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span> nickName<span class="token punctuation">.</span>value<span class="token punctuation">,</span> texts<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>            commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre></pre></td></tr><tr><td data-num=84></td><td><pre>        nickName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>        email<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>        texts<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre></pre></td></tr><tr><td data-num=89></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>comments.css</summary><div><p>(<strong>改动</strong>)稍微精简下了代码，就是将重复的内容合在一起。</p><p>在基本输入区域样式表的基础上，额外初始化了<code>comment-block</code>后代的所有ul和li标签的盒子属性与默认模式。</p><p>再将评论块样式模板的CSS代码拷贝到这，将回复评论图标，点赞图标以及 author 用户的内容部分全部去除了，另外再按照<code>comments.js</code>里<code>contentAppend</code> 自定义函数中的创建标签的类名进行了类名替换。</p><figure class="highlight css"><figcaption data-lang=CSS></figcaption><table><tr><td data-num=1></td><td><pre><span class="token selector">#comment-block,</span></pre></td></tr><tr><td data-num=2></td><td><pre>#comment-block input,</pre></td></tr><tr><td data-num=3></td><td><pre>#comment-block textarea,</pre></td></tr><tr><td data-num=4></td><td><pre>#comment-block button <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">/* input area part  start-area*/</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token selector">#comment-block .input-block</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 306px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token selector">#comment-block .input-block .input-area</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token selector">#comment-block .input-block .input-area .nickname</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 161px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 2px solid #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>    <span class="token property">padding-right</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token selector">#comment-block .input-block .input-area .email</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 345px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token property">padding-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=51></td><td><pre></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token selector">#comment-block .input-block .input-area .nickname:focus,</span></pre></td></tr><tr><td data-num=53></td><td><pre>#comment-block .input-block .input-area .email:focus <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token selector">#comment-block .input-block .input-area .text-block</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=58></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 231px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>    <span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>    <span class="token property">padding-top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>    <span class="token property">resize</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre></pre></td></tr><tr><td data-num=67></td><td><pre><span class="token selector">#comment-block .input-block .button-area .commit</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=68></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> .3rem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #eff2f3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>    <span class="token property">line-height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre></pre></td></tr><tr><td data-num=78></td><td><pre><span class="token comment">/* input area part  end-area*/</span></pre></td></tr><tr><td data-num=79></td><td><pre></pre></td></tr><tr><td data-num=80></td><td><pre></pre></td></tr><tr><td data-num=81></td><td><pre><span class="token comment">/* comment show area */</span></pre></td></tr><tr><td data-num=82></td><td><pre><span class="token selector">#comment-block ul,</span></pre></td></tr><tr><td data-num=83></td><td><pre>#comment-block li <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=84></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>    <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=89></td><td><pre></pre></td></tr><tr><td data-num=90></td><td><pre><span class="token selector">#comment-block .comment-container</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=91></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 310px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre>    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=102></td><td><pre></pre></td></tr><tr><td data-num=103></td><td><pre><span class="token selector">#comment-block .comment-container .info</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=104></td><td><pre>    <span class="token property">padding-top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=106></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #283035<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>    <span class="token property">font-weight</span><span class="token punctuation">:</span> 400<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=109></td><td><pre></pre></td></tr><tr><td data-num=110></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::before</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=111></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 250px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=119></td><td><pre></pre></td></tr><tr><td data-num=120></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::after</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=121></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 27px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 3px solid #dee1e3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=131></td><td><pre></pre></td></tr><tr><td data-num=132></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=133></td><td><pre>    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=137></td><td><pre></pre></td></tr><tr><td data-num=138></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li::after</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=139></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=145></td><td><pre></pre></td></tr><tr><td data-num=146></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level::after</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=147></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=153></td><td><pre></pre></td></tr><tr><td data-num=154></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=155></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 3px solid #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 2px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre></pre></td></tr><tr><td data-num=165></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar .img</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=166></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=169></td><td><pre></pre></td></tr><tr><td data-num=170></td><td><pre><span class="token comment">/* comment box of coment area start-area */</span></pre></td></tr><tr><td data-num=171></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=172></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 465px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 1px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.15<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=177></td><td><pre></pre></td></tr><tr><td data-num=178></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=179></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=180></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre>    <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=191></td><td><pre></pre></td></tr><tr><td data-num=192></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=197></td><td><pre></pre></td></tr><tr><td data-num=198></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=199></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=200></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>    <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=208></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=211></td><td><pre></pre></td></tr><tr><td data-num=212></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=213></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=216></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=217></td><td><pre></pre></td></tr><tr><td data-num=218></td><td><pre><span class="token comment">/* comment box head area start-area */</span></pre></td></tr><tr><td data-num=219></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=220></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #E5E5E5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=224></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px 4px 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=226></td><td><pre></pre></td></tr><tr><td data-num=227></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head .cbauthor-name</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=228></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #283035<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=229></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=230></td><td><pre>    <span class="token property">font-weight</span><span class="token punctuation">:</span> 700<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=231></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>    <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=233></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=234></td><td><pre></pre></td></tr><tr><td data-num=235></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head span</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=236></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=241></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre></pre></td></tr><tr><td data-num=243></td><td><pre><span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=244></td><td><pre></pre></td></tr><tr><td data-num=245></td><td><pre><span class="token comment">/* comment box content area start-area */</span></pre></td></tr><tr><td data-num=246></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-content</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=247></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=248></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #595959<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 0 0 4px 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=254></td><td><pre></pre></td></tr><tr><td data-num=255></td><td><pre><span class="token comment">/* comment box content area end-area */</span></pre></td></tr><tr><td data-num=256></td><td><pre></pre></td></tr><tr><td data-num=257></td><td><pre><span class="token comment">/* comment box of coment area end-area */</span></pre></td></tr></table></figure></div></details><h2 id=后端linux服务器处理进程http服务器><a class=anchor href=#后端linux服务器处理进程http服务器>#</a> 后端Linux服务器处理进程(HTTP服务器)</h2><p>由<strong>纯C语言</strong>实现的支持http1.0版本协议的socket通信。</p><h3 id=c源码初代版本案例版本><a class=anchor href=#c源码初代版本案例版本>#</a> C源码初代版本(案例版本)</h3><details class=info><summary>http.h</summary><div><p>C语言头文件，包含socket通信所需头文件、标准输入输出流头文件、字符串头文件、标准错误输出流的头文件、以及标识符定义、相关函数的声明。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;netdb.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u16</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u32</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEBUG</span></span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">int</span> <span class="token function">serverSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">void</span> <span class="token function">httpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">void</span> <span class="token function">httpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.c</summary><div><p>C语言头文件函数声明的实现源文件，额外包含了相关处理过程的函数，主要有服务器socket的建立，http请求的接收，对http请求头的处理，对HTTP的GET方法的专门处理与其他请求方法的处理，http的响应处理(200状态的处理，404状态的处理)，以及预处理调试相关代码的实现。</p><p><strong>服务器socket的建立(serverSocketConstruct)</strong></p><p>TCP/IP体系的运输层使用端口号来区分应用层的不同应用进程，端口号使用16比特表示，取值范围<code>0 ~ 65535</code></p><p>建立过程为</p><ul><li>面向字节流的socket通信资源申请</li><li>设定【协议族，网络接口的任意一个IP地址，监听的端口号】配置</li><li>初始化监听端口号</li><li>将设置绑定在socket资源上</li><li>开启socket通信的监听模式</li></ul><p><strong>http请求接收(httpAccept)</strong></p><p>依照HTTP协议格式，按行读取请求头和载荷数据。</p><p>过程为</p><ul><li>读取请求行，获取并保存请求方法和请求URL</li><li>读取剩下全部的首部行和实体主体(载荷数据)</li><li>倘若接收的是GET方法，则将获取的路径交给http响应函数</li></ul><p><strong>http响应发送(httpResponse)</strong></p><p>中转函数，用于按规则返回不同的响应方法。</p><p>过程为</p><ul><li>当路径文件存在，就返回200响应</li><li>当路径文件不存在，就返回404响应</li></ul><p><strong>200响应(response200)</strong></p><p>依照HTTP协议格式，按行输入请求头并发送响应，之后即可发送载荷数据。</p><p>过程为</p><ul><li>检查路径文件是否合法</li><li>按行编写请求头，之后发送请求头，即响应</li><li>打开请求的文件，按行将内容发送给请求客户</li><li>发送完成后，即可关闭文件</li></ul><p><strong>400响应(response404)</strong></p><p>依照HTTP协议格式，按行输入请求头并发送响应。</p><p>过程为，按行编写请求头，之后发送请求头，即响应。</p><p><strong>调试信息输出(callDebug)</strong></p><p>用预处理的条件编译方法输出信息，并将代码嵌入到调用的位置(<code>inline</code>声明)。</p><p><strong>读取客户端请求的一行(getLine)</strong></p><p>过程为</p><ul><li>接收客户端发送的数据</li><li>当不为换行符(<code>\n</code>)就继续存储数据，当为换行符(<code>\n</code>)时就终止接收数据。</li></ul><p><strong>字符串比较(_cmp)</strong> - 不赘述，就是简单的字符比较</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> content<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> arg1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"%s%s\n"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span>arg1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">int</span> <span class="token function">serverSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre>   <span class="token keyword">int</span> server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socketConstruct: server_fd = socket() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>   <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>   <span class="token keyword">int</span> opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>   u32 len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>   <span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=31></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=32></td><td><pre>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socketConstruct: bind failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>      <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=38></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socketConstruct: listen failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>      <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre>   <span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getLine</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>   <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>   <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=52></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=55></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre>         buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>      <span class="token keyword">else</span></pre></td></tr><tr><td data-num=61></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"getLine: read failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre>         <span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"client close.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=64></td><td><pre>         index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>         <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=67></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=68></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> index <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=69></td><td><pre></pre></td></tr><tr><td data-num=70></td><td><pre>   <span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre></pre></td></tr><tr><td data-num=73></td><td><pre><span class="token keyword">static</span> bool <span class="token function">_cmp</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str1<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=74></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=75></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>str1 <span class="token operator">||</span> <span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=76></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=77></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>str1<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=78></td><td><pre>         <span class="token keyword">return</span> false<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>      <span class="token operator">++</span>str1<span class="token punctuation">;</span> <span class="token operator">++</span>str2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre>   <span class="token keyword">return</span> true<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre></pre></td></tr><tr><td data-num=84></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=85></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=86></td><td><pre>   <span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=89></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response404: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=91></td><td><pre></pre></td></tr><tr><td data-num=92></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=93></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=94></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre></pre></td></tr><tr><td data-num=96></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=97></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>   <span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre></pre></td></tr><tr><td data-num=100></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>   <span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=106></td><td><pre></pre></td></tr><tr><td data-num=107></td><td><pre>   <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"header: "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=109></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response200: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre>   <span class="token keyword">else</span></pre></td></tr><tr><td data-num=111></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=112></td><td><pre>      <span class="token keyword">char</span> body<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>      FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre></pre></td></tr><tr><td data-num=115></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">fgets</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=116></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=117></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>body<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=118></td><td><pre>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response200: send body error. reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=121></td><td><pre></pre></td></tr><tr><td data-num=122></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"I/O error when reading"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=123></td><td><pre>      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"End of file reached successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=124></td><td><pre>      <span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=126></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre></pre></td></tr><tr><td data-num=128></td><td><pre><span class="token keyword">void</span> <span class="token function">httpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=129></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=130></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre></pre></td></tr><tr><td data-num=132></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=133></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=134></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"httpResponse %s failed.reason: %s\n"</span><span class="token punctuation">,</span>path<span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>      <span class="token function">response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=137></td><td><pre>   <span class="token keyword">else</span></pre></td></tr><tr><td data-num=138></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=139></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISDIR</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>st_mode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=140></td><td><pre>      <span class="token function">response200</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=142></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=143></td><td><pre></pre></td></tr><tr><td data-num=144></td><td><pre><span class="token keyword">void</span> <span class="token function">httpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=145></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=146></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>   <span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>   <span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>   <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>   <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre></pre></td></tr><tr><td data-num=152></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=153></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=154></td><td><pre>      <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=156></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=157></td><td><pre>         method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>         <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=160></td><td><pre>      method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>      <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"request method: "</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre></pre></td></tr><tr><td data-num=163></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">_cmp</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span><span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=164></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=165></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"method = GET"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre></pre></td></tr><tr><td data-num=167></td><td><pre>         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>         j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre>         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=170></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=171></td><td><pre>            url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>            <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=174></td><td><pre>         url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"url: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre></pre></td></tr><tr><td data-num=177></td><td><pre>         <span class="token keyword">do</span></pre></td></tr><tr><td data-num=178></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=179></td><td><pre>            len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"recv: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre></pre></td></tr><tr><td data-num=183></td><td><pre>         <span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=185></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=186></td><td><pre>            <span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>            <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"search path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre>         <span class="token function">sprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./html_docs/%s"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"path: "</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=191></td><td><pre></pre></td></tr><tr><td data-num=192></td><td><pre>         <span class="token function">httpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=194></td><td><pre>      <span class="token keyword">else</span></pre></td></tr><tr><td data-num=195></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=196></td><td><pre>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"warning! could not accept %s method"</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=197></td><td><pre>         <span class="token keyword">do</span></pre></td></tr><tr><td data-num=198></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=199></td><td><pre>            len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"read: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=203></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=204></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>httpserver.c</summary><div><p>C语言程序的入口(main函数)，包含socket通信的基本流程。</p><p>过程为</p><ul><li>调用serverSocketConstruct函数创建一个监听80端口号的socket资源</li><li>等待并接收客户端请求的socket资源</li><li>调用接收客户端请求函数(httpAccept)</li></ul><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">int</span> server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">serverSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>  </pre></td></tr><tr><td data-num=9></td><td><pre>   <span class="token keyword">int</span> accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>   <span class="token keyword">int</span> socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>   accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre>   <span class="token function">httpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>  </pre></td></tr><tr><td data-num=19></td><td><pre>   <span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>   <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h3 id=c源码初代改进版本><a class=anchor href=#c源码初代改进版本>#</a> C源码初代改进版本</h3><details class=info><summary>http.h</summary><div><p>相较于初代版本，多了几个枚举常量和一个<code>#define</code>指令定义的标识符常量，以及使用函数中要用的标准库函数。</p><p>FileType枚举体用于判断接收请求的不同文件类型。</p><p>u16和u32的标识符定义是为了便于之后的Rust项目的编写。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;netdb.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u16</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u32</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ROOTDIR</span> <span class="token string">"docs"</span></span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEBUG</span></span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">FileType</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>   _HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=22></td><td><pre>   _CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=23></td><td><pre>   _JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=24></td><td><pre>   _PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token keyword">int</span> <span class="token function">serverSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">void</span> <span class="token function">httpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token keyword">void</span> <span class="token function">httpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.c</summary><div><p>相较于初代版本，额外添加了http响应的400状态处理，添加了对<code>html/css/js/.png</code>图片的类型处理。</p><p><strong>文件类型判断(getType)</strong></p><p>算法原理非常简单，由于文件格式有非常明显的数量和字符差异，因此，可用数组索引位置表示对应的文件类型，当依次读取文件结尾<code>.</code>之后的字符，当单个字符存在于文件类型中便将索引加一，最后统计个索引对应空间的整数是否与文件类型的字符数量相等。</p><p><strong>404响应(response404)</strong> - 与400响应类似</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> content<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> arg1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"%s%s\n"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span>arg1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">int</span> <span class="token function">serverSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre>   <span class="token keyword">int</span> server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"socketConstruct: server_fd = socket() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>   <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>   <span class="token keyword">int</span> opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>   u32 len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>   <span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=31></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=32></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"socketConstruct: bind failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>      <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=38></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"socketConstruct: listen failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>      <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre>   <span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getLine</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>   <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>   <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=52></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=55></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre>         buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>      <span class="token keyword">else</span></pre></td></tr><tr><td data-num=61></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"getLine: read failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre>         <span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"client close.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=64></td><td><pre>         index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>         <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=67></td><td><pre>   <span class="token punctuation">&#125;</span>    </pre></td></tr><tr><td data-num=68></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> index <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=69></td><td><pre></pre></td></tr><tr><td data-num=70></td><td><pre>   <span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre></pre></td></tr><tr><td data-num=73></td><td><pre><span class="token keyword">static</span> bool <span class="token function">_cmp</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str1<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=74></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=75></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>str1 <span class="token operator">||</span> <span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=76></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=77></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>str1<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=78></td><td><pre>         <span class="token keyword">return</span> false<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>      <span class="token operator">++</span>str1<span class="token punctuation">;</span> <span class="token operator">++</span>str2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre>   <span class="token keyword">return</span> true<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre></pre></td></tr><tr><td data-num=84></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> ostr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=85></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=86></td><td><pre>   <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>   <span class="token keyword">char</span><span class="token operator">*</span> ch <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre>   <span class="token keyword">char</span><span class="token operator">*</span> cache <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>   <span class="token keyword">int</span> select<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre></pre></td></tr><tr><td data-num=91></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>ostr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>   <span class="token keyword">for</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">NULL</span> <span class="token operator">!=</span> ch<span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=93></td><td><pre>      cache <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre></pre></td></tr><tr><td data-num=95></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>cache<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=96></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=97></td><td><pre>      <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'H'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'M'</span><span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'L'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=99></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'C'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=100></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'J'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=101></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'N'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'G'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=102></td><td><pre>      <span class="token operator">++</span>cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=104></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=105></td><td><pre>   <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"\n%d %d %d %d\n"</span><span class="token punctuation">,</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=106></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=107></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _HTML<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=108></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _CSS<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=109></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _JS<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _PNG<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre>   <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=113></td><td><pre></pre></td></tr><tr><td data-num=114></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=115></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=116></td><td><pre>   <span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=119></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response404: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=121></td><td><pre></pre></td></tr><tr><td data-num=122></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=123></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=124></td><td><pre>   <span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 400 BAD REQUEST\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=127></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response400: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=129></td><td><pre></pre></td></tr><tr><td data-num=130></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=131></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=132></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre></pre></td></tr><tr><td data-num=134></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=135></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>   <span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>   <span class="token keyword">int</span> fileType <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=138></td><td><pre></pre></td></tr><tr><td data-num=139></td><td><pre>   fileType <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>   <span class="token keyword">switch</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=143></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=144></td><td><pre>      <span class="token keyword">case</span> _HTML<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=145></td><td><pre>      <span class="token keyword">case</span> _CSS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=146></td><td><pre>      <span class="token keyword">case</span> _JS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=147></td><td><pre>      <span class="token keyword">case</span> _PNG<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=148></td><td><pre>      <span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=149></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=150></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>   <span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre></pre></td></tr><tr><td data-num=154></td><td><pre>   <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"header: "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=156></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response200: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>   <span class="token keyword">else</span></pre></td></tr><tr><td data-num=158></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=159></td><td><pre>      FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>      <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>      resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre></pre></td></tr><tr><td data-num=163></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=164></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=165></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=166></td><td><pre>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response200: send body error. reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=168></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"I/O error when reading"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=169></td><td><pre>      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"End of file reached successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=170></td><td><pre>      <span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=172></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=173></td><td><pre></pre></td></tr><tr><td data-num=174></td><td><pre><span class="token keyword">void</span> <span class="token function">httpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=175></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=176></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre></pre></td></tr><tr><td data-num=178></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=179></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=180></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"httpResponse %s failed.reason: %s\n"</span><span class="token punctuation">,</span>path<span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>      <span class="token function">response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=183></td><td><pre>   <span class="token keyword">else</span></pre></td></tr><tr><td data-num=184></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=185></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISDIR</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>st_mode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=186></td><td><pre>      <span class="token function">response200</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=188></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre></pre></td></tr><tr><td data-num=190></td><td><pre><span class="token keyword">void</span> <span class="token function">httpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=191></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=192></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre>   <span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>   <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>   <span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>   <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=197></td><td><pre></pre></td></tr><tr><td data-num=198></td><td><pre>   len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=200></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=201></td><td><pre>      <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>      <span class="token comment">/* 获取请求的method */</span></pre></td></tr><tr><td data-num=203></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=204></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=205></td><td><pre>         method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>         <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=208></td><td><pre>      method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>      <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"request method: "</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre></pre></td></tr><tr><td data-num=211></td><td><pre>      <span class="token comment">/* 处理GET方法 */</span></pre></td></tr><tr><td data-num=212></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">_cmp</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span><span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=213></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=214></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"method = GET"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre></pre></td></tr><tr><td data-num=216></td><td><pre>         <span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=217></td><td><pre>         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=218></td><td><pre>         <span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">,</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=219></td><td><pre>            url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre>         url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"url: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre></pre></td></tr><tr><td data-num=223></td><td><pre>         <span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=224></td><td><pre>         <span class="token keyword">do</span></pre></td></tr><tr><td data-num=225></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=226></td><td><pre>            len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"recv: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=228></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=229></td><td><pre></pre></td></tr><tr><td data-num=230></td><td><pre>         <span class="token comment">/* 通过定位?号来处理url */</span></pre></td></tr><tr><td data-num=231></td><td><pre>         <span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=233></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=234></td><td><pre>            <span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre>            <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"search path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=237></td><td><pre>         <span class="token function">sprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./%s/%s"</span><span class="token punctuation">,</span>ROOTDIR<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"path: "</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre></pre></td></tr><tr><td data-num=240></td><td><pre>         <span class="token comment">/* 返回响应报文 */</span></pre></td></tr><tr><td data-num=241></td><td><pre>         <span class="token function">httpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=243></td><td><pre>      <span class="token keyword">else</span></pre></td></tr><tr><td data-num=244></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=245></td><td><pre>         <span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=246></td><td><pre>         <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"warning! could not accept %s method"</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre>         <span class="token keyword">do</span></pre></td></tr><tr><td data-num=248></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=249></td><td><pre>            len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"read: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=253></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=254></td><td><pre>   <span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">response400</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=255></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>httpserver.c</summary><div><p>额外添加了循环监听http监听，就是加了个while循环。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">int</span> server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">serverSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>   </pre></td></tr><tr><td data-num=9></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=10></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>      <span class="token keyword">int</span> accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>      <span class="token keyword">int</span> socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>      <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>      accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>         </pre></td></tr><tr><td data-num=19></td><td><pre>      <span class="token function">httpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>      <span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>   <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h2 id=linux服务器处理进程的数据库链接><a class=anchor href=#linux服务器处理进程的数据库链接>#</a> Linux服务器处理进程的数据库链接</h2><p>以Linux系统下的<code>MySQL数据库(5.7版本)</code>为主，</p><p>通过MySQL数据库的C语言API库函数(接口)进行信息交换。</p><p>此处通过搜索引擎搜索应该选哪个版本，最后得知<code>MySQL5.7</code>版本的使用人数多(容易查找错误)并且稳定，因此此项目也使用该版本。</p><h3 id=卸载linux下的mysql><a class=anchor href=#卸载linux下的mysql>#</a> 卸载Linux下的MySQL</h3><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment"># 检查是否安装了mysql </span></pre></td></tr><tr><td data-num=2></td><td><pre>yum list installed <span class="token operator">|</span> <span class="token function">grep</span> mysql</pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"># 倘若有安装了mysql，就执行下面的卸载命令</span></pre></td></tr><tr><td data-num=5></td><td><pre>yum <span class="token parameter variable">-y</span> remove mysql-libs</pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">#****************************************#</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment"># 查看mysql组件工具是否存在</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> mysql</pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment"># 倘若有组件工具，执行下面的卸载命令。</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment"># 鼠标选中组件名，按快捷键ctrl + shift + c 复制</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment"># 按快捷键ctrl + shift + v 粘贴</span></pre></td></tr><tr><td data-num=15></td><td><pre>yum remove 组件名</pre></td></tr></table></figure><h3 id=安装linux下的mysql的><a class=anchor href=#安装linux下的mysql的>#</a> 安装Linux下的MySQL的</h3><ul><li><p><span class=exturl data-url=aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vNS43L2VuL2xpbnV4LWluc3RhbGxhdGlvbi15dW0tcmVwby5odG1s>Linux下MySQL指定版本的安装-官方教程</span></p></li><li><p><span class=exturl data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2Rvd25sb2Fkcy9yZXBvL3l1bS8=">MySQL-yum源查看网址</span></p></li><li><p><code>Red Hat Enterprise Linux 7 / Oracle Linux 7 (Architecture Independent), RPM Package</code></p><ul><li><code>RPM Package</code>表示该文件为RPM包</li><li><code>Red Hat Enterprise Linux 7 / Oracle Linux 7</code>表示该 RPM 包适用于<code>Red Hat Enterprise Linux 7</code>和<code>Oracle Linux 7</code>这两个操作系统版本(如CentOS 7，Oracle Linux 7等)</li><li><code>Architecture Independent</code>表示该软件包与硬件架构无关</li></ul></li></ul><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment"># 先安装wget</span></pre></td></tr><tr><td data-num=2></td><td><pre>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">wget</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"># 下载MySQL的yum的Repository</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token function">wget</span> https://repo.mysql.com/mysql80-community-release-el7-10.noarch.rpm</pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment"># 添加MySQL的yum源</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql80-community-release-el7-10.noarch.rpm</pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment"># 安装yum-config-manager</span></pre></td></tr><tr><td data-num=11></td><td><pre>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> yum-utils</pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment"># 查看当前Release版本的默认安装版本情况</span></pre></td></tr><tr><td data-num=14></td><td><pre>yum repolist all <span class="token operator">|</span> <span class="token function">grep</span> mysql</pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"># 取消MySQL8.0版本的默认安装选中</span></pre></td></tr><tr><td data-num=17></td><td><pre>yum-config-manager <span class="token parameter variable">--disable</span> mysql80-community</pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment"># 开启MySQL5.7版本的默认安装选中</span></pre></td></tr><tr><td data-num=20></td><td><pre>yum-config-manager <span class="token parameter variable">--enable</span> mysql57-community</pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token comment"># 安装MySQL5.7版本</span></pre></td></tr><tr><td data-num=23></td><td><pre>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> mysql-community-server <span class="token parameter variable">--nogpgcheck</span></pre></td></tr></table></figure><h3 id=mysql初始化配置><a class=anchor href=#mysql初始化配置>#</a> MySQL初始化配置</h3><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment"># 启动MySQL服务</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token function">service</span> mysqld start</pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"># 查看MySQL服务的状态</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token function">service</span> mysqld status</pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment"># 刚安装完MySQL后，可通过临时密码来重设数据库密码</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"># 查看临时密码</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log</pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment"># 隐式登录MySQL</span></pre></td></tr><tr><td data-num=12></td><td><pre>mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment"># 接着输入临时密码</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment"># 重设密码</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"># 密码要求：</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">#  1.需包含一个大写字母，一个小写字母，一个数字，一个特殊字符(类似!)</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment">#  2.总长度不少于8位</span></pre></td></tr><tr><td data-num=19></td><td><pre>ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'你的新密码'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=mysql数据库的基本创建><a class=anchor href=#mysql数据库的基本创建>#</a> MySQL数据库的基本创建</h3><p><strong>创建评论用的数据库</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 评论系统使用的是UTF-8编码，创建数据库时需指定 */</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 创建评论系统数据库 */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> CommentSystem <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'utf8'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 查看当前数据库有哪些 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">/* 清除数据库 */</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> 数据库名<span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>创建评论用的表</strong></p><p>评论系统属性分析，首先初期的表以逻辑简洁为主，</p><p>首先是评论昵称(NickName)，昵称指定了最大长度为19位，故评论昵称的类型为<code>CHAR(19)</code>，</p><p>接着是邮箱(Email)，邮箱也指定了最大长度为45位，故邮箱的类型为<code>CHAR(45)</code>，</p><p>之后就是评论内容(Content)，评论内容没有固定的长度，故评论内容以基本文本长度为主，类型为<code>TEXT</code>，</p><p>最后是评论创建时间(CreateAt)，评论创建时间用来判断距离当前时间已经过去多久了，故评论时间类型为<code>DATETIME</code>(埋个<strong>坑2</strong>)。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 切换当前使用的数据库为CommentSystem数据库 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">USE</span> CommentSystem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* 创建评论块表 */</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> CommentBlock<span class="token punctuation">(</span></pre></td></tr><tr><td data-num=6></td><td><pre>    NickName <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>    Email <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>    Content <span class="token keyword">TEXT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>    CreateAT <span class="token keyword">DATETIME</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">/* 查看当前数据的表有哪些 */</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">/* 查看选定的CommentBlock表的结构 */</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">DESC</span> CommentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment">/* 清空表中所有数据 */</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> CommentBlock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token comment">/* 清除表 */</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> 表名</pre></td></tr></table></figure><h3 id=mysql数据库c源码的编写><a class=anchor href=#mysql数据库c源码的编写>#</a> MySQL数据库C源码的编写</h3><p><strong>安装C语言API接口</strong></p><p>安装命令 - <code>yum install mysql-devel</code></p><p>安装之后使用的头文件<code>#include&lt;mysql/mysql.h&gt;</code>，其对应的路径为<code>/usr/include/mysql/mysql.h</code></p><p>使用GCC编译时需链接【<strong>头文件目录</strong>，<strong>库文件目录</strong>，<strong>使用的库文件名</strong>】，</p><p>推荐使用shell命令代替(<code>$(mysql_config --cflags --libs)</code>)，例子</p><p><code>gcc -Wall -g main.c xxx.c -o main $(mysql_config --cflags --libs)</code></p><p><strong>使用API接口来编写源码</strong></p><ul><li><span class=exturl data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9jLWFwaS81LjcvZW4vYy1hcGktaW50cm9kdWN0aW9uLmh0bWw=">MySQL-C API开发文档</span></li><li><span class=exturl data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9jLWFwaS81LjcvZW4vYy1hcGktZnVuY3Rpb24tZGVzY3JpcHRpb25zLmh0bWw=">MySQL-C API开发文档的函数总和</span></li></ul><details class=info><summary>database.h</summary><div><p>数据库链接头文件，包含数据库相关头文件，数据连接函数声明，数据库表的插入函数声明和其他相关库的声明。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql/mysql.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HOST</span> <span class="token string">"127.0.0.1"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">USER</span> <span class="token string">"root"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PASSWORD</span> <span class="token string">"@Killl611"</span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DBNAME</span> <span class="token string">"CommentSystem"</span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEBUG</span></span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Element</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>   <span class="token keyword">char</span> tablename<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>   <span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>   <span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>   <span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>   <span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Element</span><span class="token operator">*</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>database.c</summary><div><p>数据库链接头文件相关函数的实现。</p><p><strong>初始化一个MySQL结构</strong> - <code>MYSQL *mysql_init(MYSQL *mysql)</code></p><p><strong>与MySQL数据库服务器建立实际连接</strong> -</p><p><code>MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd, const char *db, unsigned int port, const char *unix_socket, unsigned long client_flag)</code></p><ul><li><code>mysql</code>：一个已经通过 <code>mysql_init</code> 初始化的 <code>MYSQL</code> 结构指针</li><li><code>host</code>：要连接的MySQL服务器的主机名或 IP 地址</li><li><code>user</code>： MySQL用户名</li><li><code>passwd</code>：MySQL用户的密码</li><li><code>db</code>：要连接的默认数据库名称</li><li><code>port</code>：MySQL服务器的端口号</li><li><code>unix_socket</code>：Unix域套接字路径，如果连接使用Unix域套接字而不是TCP/IP，则提供此参数</li><li><code>client_flag</code>：客户端标志，用于指定连接选项</li><li>返回一个 <code>MYSQL</code> 结构指针，如果连接成功，则该指针指向一个有效的连接对象，否则返回 <code>NULL</code></li></ul><p><strong>关闭MySQL数据库连接</strong> - <code>void mysql_close(MYSQL *mysql)</code></p><p><strong>执行SQL查询</strong> - <code>int mysql_query(MYSQL *mysql, const char *query)</code></p><ul><li><code>mysql</code>：一个已经通过 <code>mysql_init</code> 初始化的 <code>MYSQL</code> 结构指针，表示与数据库的连接</li><li><code>query</code>：包含要执行的SQL查询字符串的C字符串</li></ul><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> arg1<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> arg2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"%s%s\n"</span><span class="token punctuation">,</span>arg1<span class="token punctuation">,</span>arg2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>   MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">mysql_init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_init() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>      <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>   mysql <span class="token operator">=</span> <span class="token function">mysql_real_connect</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>HOST<span class="token punctuation">,</span>USER<span class="token punctuation">,</span>PASSWORD<span class="token punctuation">,</span>DBNAME<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=21></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_real_connect() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>      <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre>   <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"DatabaseConnet Succeed\n"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>   <span class="token keyword">return</span> mysql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=32></td><td><pre>   <span class="token function">mysql_close</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Element</span><span class="token operator">*</span> el<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"INSERT INTO %s(NickName,Email,Content,CreateAt)\nVALUES('%s','%s','%s','%s')"</span><span class="token punctuation">,</span>el<span class="token operator">-></span>tablename<span class="token punctuation">,</span>el<span class="token operator">-></span>nickname<span class="token punctuation">,</span>el<span class="token operator">-></span>email<span class="token punctuation">,</span>el<span class="token operator">-></span>content<span class="token punctuation">,</span>el<span class="token operator">-></span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>   <span class="token function">callDebug</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=42></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=43></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"TableInsert: mysql_query() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>      <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre>   <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"TableInsert Succeed\n"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   </pre></td></tr><tr><td data-num=47></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>databasetest.c</summary><div><p>此处是用于数据库链接的测试案例。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">Element</span> el<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>   MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   </pre></td></tr><tr><td data-num=8></td><td><pre>   <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>el<span class="token punctuation">,</span><span class="token char">'\0'</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>tablename<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>nickname<span class="token punctuation">,</span><span class="token string">"test1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>email<span class="token punctuation">,</span><span class="token string">"xxx@xx.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>content<span class="token punctuation">,</span><span class="token string">"sadgastgewatewatastsagsdag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>createat<span class="token punctuation">,</span><span class="token string">"2023-09-11 17:00:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>   <span class="token function">TableInsert</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token operator">&amp;</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>   <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h2 id=前端通过后端与数据库进行数据交换><a class=anchor href=#前端通过后端与数据库进行数据交换>#</a> 前端通过后端与数据库进行数据交换</h2><p>通过JavaScript脚本语言的监听代码来监听评论提交按钮的点击事件，当点击按钮时，先经过JavaScript脚本语言编写的检查代码检查前端输入区域是否符合自定义要求后，检查失败就直接返回，检查成功就发送http的POST请求到后端服务器进程。</p><p>后端接收前端http的POST请求后，通过分析请求头的方法和路径，将接收的数据通过由MySQL数据库API接口编写的数据库处理源码的处理后，将处理后的数据存储在MySQL数据库相应表中。</p><p>当数据库处理结束后，后端还需发送POST请求的200状态响应请求(报文)到前端。当前端接收到后端的200响应报文后，之前由JavaScript脚本语言编写的添加评论的代码块将会被触发，之后前端网页中就可以看到新添加的一个评论。</p><h3 id=http源码变量名与函数名标准化处理与算法变更><a class=anchor href=#http源码变量名与函数名标准化处理与算法变更>#</a> http源码变量名与函数名标准化处理与算法变更</h3><details class=info><summary>http.h</summary><div><p>按照自己设定的命名规则做了下标准化处理。</p><p>添加了RequestMethod枚举体，用于区分前端的各种请求。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;netdb.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u16</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span> </span></span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u32</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ROOTDIR</span> <span class="token string">"docs"</span></span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_DEBUG</span></span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">FileType</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	_HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=23></td><td><pre>	_CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=24></td><td><pre>	_JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=25></td><td><pre>	_PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestMethod</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	_GET <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=31></td><td><pre>	_POST <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=32></td><td><pre>	_PUT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">int</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.c</summary><div><p>按照自己的命名规则，将变量名或函数名进行了标准化，并为了保证内存安全性，确保了声明的变量都进行了初始化，之后将代码做了下逻辑简单化处理。</p><p>用getType函数方法相同的原理(已改名为GetFileType方法)来写了<code>GetMethodType</code>函数。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> content<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> arg1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"%s%s\n"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span>arg1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">int</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">int</span> server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"socketConstruct: server_fd = socket() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">int</span> server_addrSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	</pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token comment">/* Initial port */</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token keyword">int</span> opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>	u32 len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"socketConstruct: bind() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=40></td><td><pre></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"socketConstruct: listen() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>	</pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=50></td><td><pre></pre></td></tr><tr><td data-num=51></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">GetLine</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=60></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=62></td><td><pre>			buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=64></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=65></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=66></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"GetLine: read failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=67></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"client close.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=68></td><td><pre>			index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			</pre></td></tr><tr><td data-num=73></td><td><pre>	buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=76></td><td><pre></pre></td></tr><tr><td data-num=77></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=78></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token keyword">int</span> select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=81></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=82></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'O'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'G'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'E'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=85></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'U'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token operator">++</span>method<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=88></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _POST<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _GET<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _PUT<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=91></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=93></td><td><pre></pre></td></tr><tr><td data-num=94></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> ostr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=95></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	<span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> ch <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token operator">*</span> cache <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>	<span class="token keyword">int</span> select<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>	</pre></td></tr><tr><td data-num=100></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>ostr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">NULL</span> <span class="token operator">!=</span> ch<span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=102></td><td><pre>		cache <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>	</pre></td></tr><tr><td data-num=104></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>cache<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=105></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'H'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'M'</span><span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'L'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=108></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'C'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=109></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'J'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'N'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'G'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token operator">++</span>cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=113></td><td><pre></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"\n%d %d %d %d\n"</span><span class="token punctuation">,</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=117></td><td><pre></pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _HTML<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _CSS<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=120></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _JS<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=121></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> _PNG<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=124></td><td><pre></pre></td></tr><tr><td data-num=125></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=126></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response404: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=132></td><td><pre></pre></td></tr><tr><td data-num=133></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=134></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=135></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 400 BAD REQUEST\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=138></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response400: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=140></td><td><pre></pre></td></tr><tr><td data-num=141></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=142></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=143></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>	</pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre></pre></td></tr><tr><td data-num=149></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=152></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=153></td><td><pre>		<span class="token keyword">case</span> _HTML<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token keyword">case</span> _CSS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=155></td><td><pre>		<span class="token keyword">case</span> _JS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=156></td><td><pre>		<span class="token keyword">case</span> _PNG<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=157></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>	<span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre>	</pre></td></tr><tr><td data-num=163></td><td><pre>	<span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"header: "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=164></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=165></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=168></td><td><pre>		FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre>		<span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre></pre></td></tr><tr><td data-num=171></td><td><pre>		resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=173></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=174></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=175></td><td><pre>				<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200: send body error. reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=177></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"I/O error when reading"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=178></td><td><pre>		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"End of file reached successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>	<span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=181></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=182></td><td><pre></pre></td></tr><tr><td data-num=183></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=184></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=185></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre></pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=189></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"HttpResponse %s failed.reason: %s\n"</span><span class="token punctuation">,</span>path<span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre>		<span class="token function">Response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=191></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISDIR</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>st_mode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token function">Response200</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=196></td><td><pre></pre></td></tr><tr><td data-num=197></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span><span class="token keyword">int</span> bufSize<span class="token punctuation">,</span><span class="token keyword">int</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=198></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=199></td><td><pre>    <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>    <span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>    <span class="token keyword">int</span> urlSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre></pre></td></tr><tr><td data-num=204></td><td><pre>    <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"method = GET"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>    <span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=206></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>urlSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=208></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=209></td><td><pre>        url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>        <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=212></td><td><pre>    url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>    <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"url: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre></pre></td></tr><tr><td data-num=215></td><td><pre>    <span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=216></td><td><pre>    <span class="token keyword">do</span></pre></td></tr><tr><td data-num=217></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=218></td><td><pre>        len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"recv: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre></pre></td></tr><tr><td data-num=222></td><td><pre>    <span class="token comment">/* 通过定位?号来处理url */</span></pre></td></tr><tr><td data-num=223></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=224></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=225></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=226></td><td><pre>     <span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>     <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"search path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=228></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=229></td><td><pre>    <span class="token function">sprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./%s/%s"</span><span class="token punctuation">,</span>_ROOTDIR<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=230></td><td><pre>    <span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"path: "</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=231></td><td><pre></pre></td></tr><tr><td data-num=232></td><td><pre>    <span class="token comment">/* 返回响应报文 */</span></pre></td></tr><tr><td data-num=233></td><td><pre>    <span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=234></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=235></td><td><pre></pre></td></tr><tr><td data-num=236></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=237></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=239></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=240></td><td><pre></pre></td></tr><tr><td data-num=241></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=242></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre>	<span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>bufSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre></pre></td></tr><tr><td data-num=247></td><td><pre>	len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=248></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=249></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=250></td><td><pre>		<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>		<span class="token keyword">int</span> methodSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre></pre></td></tr><tr><td data-num=253></td><td><pre>		<span class="token comment">/* 获取请求的method */</span></pre></td></tr><tr><td data-num=254></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>methodSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=255></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=256></td><td><pre>			method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=257></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=259></td><td><pre>		method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=260></td><td><pre>		<span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"request method: "</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=261></td><td><pre>		</pre></td></tr><tr><td data-num=262></td><td><pre>		<span class="token comment">/* 处理对应的方法 */</span></pre></td></tr><tr><td data-num=263></td><td><pre>		<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=264></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=265></td><td><pre>			<span class="token keyword">case</span> _GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=266></td><td><pre>			<span class="token keyword">case</span> _POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=267></td><td><pre>			<span class="token keyword">case</span> _PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=268></td><td><pre>			<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=269></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=270></td><td><pre>				<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=271></td><td><pre>				<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"warning! could not accept %s method"</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=272></td><td><pre>				<span class="token keyword">do</span></pre></td></tr><tr><td data-num=273></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=274></td><td><pre>					len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=275></td><td><pre>					<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"read: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=276></td><td><pre>				<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=277></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=278></td><td><pre>		<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=279></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=280></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response400</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=281></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h3 id=前端输入区域的post请求源码><a class=anchor href=#前端输入区域的post请求源码>#</a> 前端输入区域的POST请求源码</h3><p>发起网络POST请求 - <code>fetch(input[, init])</code></p><ul><li><code>input</code>：表示要获取的资源的 URL。可以是一个字符串(URL地址)，也可以是一个Request对象(表示已经配置好的请求)</li><li><code>init</code>(可选)：一个配置对象，包含可选的请求配置选项，如请求的方法、请求头、请求体等(省略则使用默认配置)</li><li>返回一个Promise，该Promise在请求完成后会解析为 Response 对象，可以使用该对象来处理请求的响应数据。<code>fetch</code> 不会在请求返回错误状态码时抛出错误，而是会将Promise解析为一个成功状态，只要服务器成功响应，即使响应状态码表示错误也是如此。因此，需要在Promise的<code>then</code>方法中检查响应的状态码，并根据需要来处理错误</li></ul><p>发送数据的格式为 - <code>nickname:email:content:createat</code></p><figure class="highlight javascript"><figcaption data-lang=javascript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">function</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span><span class="token parameter">textsLable<span class="token punctuation">,</span> cols</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">var</span> texts <span class="token operator">=</span> <span class="token punctuation">(</span>textsLable<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r|\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">var</span> textLength <span class="token operator">=</span> texts<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> textLength<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> cache<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token number">0</span> <span class="token operator">===</span> cache<span class="token punctuation">.</span>length <span class="token operator">%</span> cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre>            cache <span class="token operator">+=</span> <span class="token string">"&lt;br/>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>        cache <span class="token operator">+=</span> texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">return</span> cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">function</span> <span class="token function">_postRequest</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> url<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>            <span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=20></td><td><pre>        <span class="token literal-property property">body</span><span class="token operator">:</span> data<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"_postRequest: fetch() response was not ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token keyword">function</span> <span class="token function">contentAppend</span><span class="token punctuation">(</span><span class="token parameter">lable<span class="token punctuation">,</span> nickNameValue<span class="token punctuation">,</span> textsContent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token keyword">var</span> mainUserLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    mainUserLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"main-level clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token comment">/* avatar area  start-area */</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token keyword">var</span> avatarLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>    avatarLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"avatar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre>    <span class="token keyword">var</span> imgLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    imgLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span> <span class="token string">"./img/img.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    imgLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"alt"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre>    avatarLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>imgLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    mainUserLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>avatarLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token comment">/* avatar area  end-area */</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre>    <span class="token keyword">var</span> commentBoxLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token comment">/* comment box of coment area start-area */</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre>    <span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>    authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>    authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> nickNameValue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre>    <span class="token keyword">var</span> timeSpend <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"hace 20 minutos"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre></pre></td></tr><tr><td data-num=61></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpend<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>    <span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=65></td><td><pre></pre></td></tr><tr><td data-num=66></td><td><pre>    <span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=67></td><td><pre>    <span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>    boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"cbox-conten"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre></pre></td></tr><tr><td data-num=70></td><td><pre>    boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> textsContent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>    <span class="token comment">/* comment box of coment area end-area */</span></pre></td></tr><tr><td data-num=73></td><td><pre></pre></td></tr><tr><td data-num=74></td><td><pre>    mainUserLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>    lable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre></pre></td></tr><tr><td data-num=78></td><td><pre>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=79></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>    <span class="token keyword">var</span> inputBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>    <span class="token keyword">var</span> inputArea <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>    <span class="token keyword">var</span> buttonArea <span class="token operator">=</span> inputArea<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>    <span class="token keyword">var</span> commitButton <span class="token operator">=</span> buttonArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre></pre></td></tr><tr><td data-num=85></td><td><pre>    commitButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=86></td><td><pre>        <span class="token keyword">var</span> inputs <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>        <span class="token keyword">var</span> nickName <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre>        <span class="token keyword">var</span> email <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>        <span class="token keyword">var</span> texts <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"textarea"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre></pre></td></tr><tr><td data-num=91></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">""</span> <span class="token operator">!=</span> nickName<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=92></td><td><pre>            <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>            <span class="token keyword">var</span> commentList <span class="token operator">=</span> commentContainer<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>            <span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre></pre></td></tr><tr><td data-num=96></td><td><pre>            <span class="token comment">/* current time */</span></pre></td></tr><tr><td data-num=97></td><td><pre>            <span class="token keyword">var</span> curTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>            <span class="token keyword">var</span> _year <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>            <span class="token keyword">var</span> _month <span class="token operator">=</span> <span class="token punctuation">(</span>curTime<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>            <span class="token keyword">var</span> _day <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>            <span class="token keyword">var</span> _hours <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>            <span class="token keyword">var</span> _minutes <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>            <span class="token keyword">var</span> _seconds <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>            <span class="token keyword">var</span> timeFormat <span class="token operator">=</span> _year <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> _month <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> _day <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=105></td><td><pre>                _hours <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> _minutes <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> _seconds<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=106></td><td><pre>            <span class="token comment">/********/</span></pre></td></tr><tr><td data-num=107></td><td><pre>            <span class="token keyword">var</span> textsContent <span class="token operator">=</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span>texts<span class="token punctuation">,</span> texts<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>            <span class="token keyword">var</span> data <span class="token operator">=</span> nickName<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> email<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> textsContent <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> timeFormat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_postRequest</span><span class="token punctuation">(</span><span class="token string">"192.168.80.131"</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=110></td><td><pre>                <span class="token function">contentAppend</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span> nickName<span class="token punctuation">.</span>value<span class="token punctuation">,</span> textsContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>                commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=113></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=114></td><td><pre></pre></td></tr><tr><td data-num=115></td><td><pre>        nickName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>        email<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>        texts<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=后端post请求处理及数据库链接源码><a class=anchor href=#后端post请求处理及数据库链接源码>#</a> 后端POST请求处理及数据库链接源码</h3><p>POST请求会将前端输入区域的数据以一定的格式整合而成的复合数据作为数据载荷，后端接收POST请求后，根据自定义的格式规则将数据分用。</p><p>此项目的格式为<code>nickname:email:content:createat</code>，分用方法很简单，前三个依靠<code>:</code>符号分割，最后一个时间格式包含<code>:</code>，因此最后一个取剩下的全部字符。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span><span class="token keyword">int</span> bufSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>	<span class="token keyword">char</span> contentLength<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token function">CallDebug</span><span class="token punctuation">(</span><span class="token string">"PostMethod Response"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>		len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"recv:%s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=12></td><td><pre>			<span class="token function">strcpy</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">strchr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token char">':'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">_stoi</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"PostMethod: 0 == GetLine() Not have body\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_nickname <span class="token operator">=</span> nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_email <span class="token operator">=</span> email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_content <span class="token operator">=</span> content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_createat <span class="token operator">=</span> createat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	</pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=32></td><td><pre>		<span class="token operator">*</span>p_nickname <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>		<span class="token operator">++</span>p_nickname<span class="token punctuation">;</span> <span class="token operator">++</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=35></td><td><pre>	</pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_email<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token operator">*</span>p_email <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	</pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_content<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token operator">*</span>p_content <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_createat<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token operator">*</span>p_createat <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"body: %s:%s:%s:%s\n"</span><span class="token punctuation">,</span>nickname<span class="token punctuation">,</span>email<span class="token punctuation">,</span>content<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">Element</span> el<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>   MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>  </pre></td></tr><tr><td data-num=52></td><td><pre>   <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>el<span class="token punctuation">,</span><span class="token char">'\0'</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>tablename<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>nickname<span class="token punctuation">,</span>nickname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>email<span class="token punctuation">,</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>content<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>createat<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>   <span class="token function">TableInsert</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token operator">&amp;</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>   <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>   <span class="token function">Response200_NF</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token string">"api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class=tags><a href=/tags/osp/ rel=tag><i class="ic i-tag"></i> 开源项目</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span> <span class=text>更新于</span> <time title="修改时间：2025-09-19 22:24:59" itemprop=dateModified datetime=2025-09-19T22:24:59+08:00>2025-09-19</time></span><span class=item data-path=/computer-science/programming/c-language/c-project/comment-system-part1/ title=阅读次数><span class=icon><i class="ic i-eye"></i></span> <span class=text>阅读次数</span><span class=waline-pageview-count></span> <span class=text>次</span></span></div><div id=copyright><ul><li class=author><strong>本文作者：</strong> ReverseSacle <i class="ic i-at"><em>@</em></i>逆转天平</li><li class=link><strong>本文链接：</strong> <a href=https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-part1/ title=网站留言评论系统的设计与手动实现-初稿-第一部分>https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-part1/</a></li><li class=license><strong>版权声明：</strong> 本站所有文章除特别声明外，均采用 <span class=exturl data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class=post-nav><div class="item left"><a href=/computer-science/programming/network-programming/http/ itemprop=url rel=prev data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg10.webp title=HTTP网络通信基础><span class=type>上一篇</span><span class=category><i class="ic i-flag"></i> 网络编程</span><h3>HTTP网络通信基础</h3></a></div><div class="item right"><a href=/computer-science/programming/c-language/c-project/comment-system-part2/ itemprop=url rel=next data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg19.webp title=网站留言评论系统的设计与手动实现-初稿-第二部分><span class=type>下一篇</span><span class=category><i class="ic i-flag"></i> C语言项目</span><h3>网站留言评论系统的设计与手动实现-初稿-第二部分</h3></a></div></div><div class=wrap id=comments><div id=waline-comment></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=文章目录><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#%E4%BB%8E0%E5%88%B01%E7%9A%84%E6%BA%90%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E7%9A%84%E7%BD%91%E7%AB%99%E7%95%99%E8%A8%80%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F-%E5%88%9D%E7%A8%BF><span class=toc-number>1.</span> <span class=toc-text>从0到1的源代码编写的网站留言评论系统-初稿</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A6%82%E8%BF%B0><span class=toc-number>1.1.</span> <span class=toc-text>概述</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%B6%89%E5%8F%8A%E7%9A%84%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86%E8%8C%83%E5%9B%B4><span class=toc-number>1.1.1.</span> <span class=toc-text>涉及的计算机知识范围</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%9B%B8%E5%85%B3%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99><span class=toc-number>1.1.2.</span> <span class=toc-text>相关参考资料</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%80%9D%E8%B7%AF%E6%9D%A5%E6%BA%90><span class=toc-number>1.1.3.</span> <span class=toc-text>思路来源</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95><span class=toc-number>1.1.4.</span> <span class=toc-text>问题分析与解决方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%88%86%E6%9E%90><span class=toc-number>1.2.</span> <span class=toc-text>设计模式分析</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%89%8D%E7%AB%AF%E8%AF%84%E8%AE%BA%E5%8C%BA%E5%9F%BA%E6%9C%AC%E6%A0%B7%E5%BC%8F><span class=toc-number>1.3.</span> <span class=toc-text>前端评论区基本样式</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%9B%AE%E5%BD%95%E5%8F%8A%E6%A0%B7%E5%BC%8F%E5%88%9D%E6%9C%9F%E5%B8%83%E5%B1%80%E9%A2%84%E8%A7%88><span class=toc-number>1.3.1.</span> <span class=toc-text>目录及样式初期布局预览</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%BA%E6%9C%AC%E8%BE%93%E5%85%A5%E5%8C%BA%E5%9F%9F><span class=toc-number>1.3.2.</span> <span class=toc-text>基本输入区域</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%AF%84%E8%AE%BA%E6%98%BE%E7%A4%BA%E5%8C%BA%E5%9F%9F><span class=toc-number>1.3.3.</span> <span class=toc-text>评论显示区域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%90%8E%E7%AB%AFlinux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%84%E7%90%86%E8%BF%9B%E7%A8%8Bhttp%E6%9C%8D%E5%8A%A1%E5%99%A8><span class=toc-number>1.4.</span> <span class=toc-text>后端Linux服务器处理进程(HTTP服务器)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#c%E6%BA%90%E7%A0%81%E5%88%9D%E4%BB%A3%E7%89%88%E6%9C%AC%E6%A1%88%E4%BE%8B%E7%89%88%E6%9C%AC><span class=toc-number>1.4.1.</span> <span class=toc-text>C源码初代版本(案例版本)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#c%E6%BA%90%E7%A0%81%E5%88%9D%E4%BB%A3%E6%94%B9%E8%BF%9B%E7%89%88%E6%9C%AC><span class=toc-number>1.4.2.</span> <span class=toc-text>C源码初代改进版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%84%E7%90%86%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E9%93%BE%E6%8E%A5><span class=toc-number>1.5.</span> <span class=toc-text>Linux服务器处理进程的数据库链接</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8D%B8%E8%BD%BDlinux%E4%B8%8B%E7%9A%84mysql><span class=toc-number>1.5.1.</span> <span class=toc-text>卸载Linux下的MySQL</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%89%E8%A3%85linux%E4%B8%8B%E7%9A%84mysql%E7%9A%84><span class=toc-number>1.5.2.</span> <span class=toc-text>安装Linux下的MySQL的</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#mysql%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE><span class=toc-number>1.5.3.</span> <span class=toc-text>MySQL初始化配置</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%88%9B%E5%BB%BA><span class=toc-number>1.5.4.</span> <span class=toc-text>MySQL数据库的基本创建</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#mysql%E6%95%B0%E6%8D%AE%E5%BA%93c%E6%BA%90%E7%A0%81%E7%9A%84%E7%BC%96%E5%86%99><span class=toc-number>1.5.5.</span> <span class=toc-text>MySQL数据库C源码的编写</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%89%8D%E7%AB%AF%E9%80%9A%E8%BF%87%E5%90%8E%E7%AB%AF%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2><span class=toc-number>1.6.</span> <span class=toc-text>前端通过后端与数据库进行数据交换</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#http%E6%BA%90%E7%A0%81%E5%8F%98%E9%87%8F%E5%90%8D%E4%B8%8E%E5%87%BD%E6%95%B0%E5%90%8D%E6%A0%87%E5%87%86%E5%8C%96%E5%A4%84%E7%90%86%E4%B8%8E%E7%AE%97%E6%B3%95%E5%8F%98%E6%9B%B4><span class=toc-number>1.6.1.</span> <span class=toc-text>http源码变量名与函数名标准化处理与算法变更</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%89%8D%E7%AB%AF%E8%BE%93%E5%85%A5%E5%8C%BA%E5%9F%9F%E7%9A%84post%E8%AF%B7%E6%B1%82%E6%BA%90%E7%A0%81><span class=toc-number>1.6.2.</span> <span class=toc-text>前端输入区域的POST请求源码</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%90%8E%E7%AB%AFpost%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E9%93%BE%E6%8E%A5%E6%BA%90%E7%A0%81><span class=toc-number>1.6.3.</span> <span class=toc-text>后端POST请求处理及数据库链接源码</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title=系列文章><ul><li class=active><a href=/computer-science/programming/c-language/c-project/comment-system-part1/ rel=bookmark title=网站留言评论系统的设计与手动实现-初稿-第一部分>网站留言评论系统的设计与手动实现-初稿-第一部分</a></li><li><a href=/computer-science/programming/c-language/c-project/comment-system-part2/ rel=bookmark title=网站留言评论系统的设计与手动实现-初稿-第二部分>网站留言评论系统的设计与手动实现-初稿-第二部分</a></li><li><a href=/computer-science/programming/c-language/c-project/comment-system-mid/ rel=bookmark title=网站留言评论系统的设计与手动实现-中稿>网站留言评论系统的设计与手动实现-中稿</a></li></ul></div><div class="overview panel" data-title=站点概览><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img class=image itemprop=image alt=ReverseSacle data-src=/images/avatar.webp><p class=name itemprop=name>ReverseSacle</p><div class=description itemprop=description>知识书库 & 学习点滴</div></div><nav class=state><div class="item posts"><a href=/archives/ ><span class=count>186</span> <span class=name>文章</span></a></div><div class="item categories"><a href=/categories/ ><span class=count>52</span> <span class=name>分类</span></a></div><div class="item tags"><a href=/tags/ ><span class=count>18</span> <span class=name>标签</span></a></div></nav><div class=social><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JldmVyc2VTYWNsZQ==" title=https:&#x2F;&#x2F;github.com&#x2F;ReverseSacle><i class="ic i-github"></i></span><span class="exturl item email" data-url="bWFpbHRvOnByaXZhdGVAcmV2ZXJzZXNhY2xlLmNvbQ==" title=mailto:private@reversesacle.com><i class="ic i-envelope"></i></span></div><ul class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i> 首页</a></li><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-feather"></i> 文章</a><ul class=submenu><li class=item><a href=/archives/ rel=section><i class="ic i-list-alt"></i> 归档</a></li><li class=item><a href=/categories/ rel=section><i class="ic i-th"></i> 分类</a></li><li class=item><a href=/tags/ rel=section><i class="ic i-tags"></i> 标签</a></li></ul></li><li class=item><a href=/about/ rel=section><i class="ic i-user"></i> 关于</a></li><li class=item><a href=/friend-links/ rel=section><i class="ic i-heart"></i> 友链</a></li></ul></div></div></div><ul id=quick><li class="prev pjax"><a href=/computer-science/programming/network-programming/http/ rel=prev title=上一篇><i class="ic i-chevron-left"></i></a></li><li class=up><i class="ic i-arrow-up"></i></li><li class=down><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href=/computer-science/programming/c-language/c-project/comment-system-part2/ rel=next title=下一篇><i class="ic i-chevron-right"></i></a></li><li class=percent></li></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>随机文章</h2><ul><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/dev-tool/ title="分类于 开发工具">开发工具</a></div><span><a href=/computer-science/programming/dev-tool/vcpkg/ title=C&#x2F;C++包管理工具vcpkg>C/C++包管理工具vcpkg</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a></div><span><a href=/computer-science/programming/c-language/c-data-structure/linear-structure/doubly-link-list/ title=C语言-双向链表>C语言-双向链表</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/two-pointer/ title="分类于 双指针">双指针</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/two-pointer/search/ title=双指针-查找>双指针-查找</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/simulation/ title="分类于 模拟">模拟</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/simulation/design/ title=模拟-自定义>模拟-自定义</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/web/ title="分类于 web">web</a></div><span><a href=/computer-science/programming/web/hcpart1/ title=HTML与CSS基础知识-第一部分>HTML与CSS基础知识-第一部分</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/c-data-structure/ title="分类于 C语言数据结构">C语言数据结构</a></div><span><a href=/computer-science/programming/c-language/c-data-structure/queue/ title=线性表之队列>线性表之队列</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/c-project/ title="分类于 C语言项目">C语言项目</a></div><span><a href=/computer-science/programming/c-language/c-project/comment-system-part1/ title=网站留言评论系统的设计与手动实现-初稿-第一部分>网站留言评论系统的设计与手动实现-初稿-第一部分</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/c-data-structure/ title="分类于 C语言数据结构">C语言数据结构</a></div><span><a href=/computer-science/programming/c-language/c-data-structure/linklist/ title=线性表之链表>线性表之链表</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/rust/ title="分类于 Rust">Rust</a></div><span><a href=/computer-science/programming/rust/rust-data-structure/linear-structure/seqqueue/ title=Rust-顺序队列>Rust-顺序队列</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/seqlist/ title="分类于 顺序表">顺序表</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/seqlist/sort/ title=顺序表-序列重组>顺序表-序列重组</a></span></li></ul></div><div><h2>最新评论</h2><ul id=waline-recent></ul></div></div><div class=status><div class=copyright>&copy; 2021 – <span itemprop=copyrightYear>2025</span><span class=with-love><i class="ic i-sakura rotate"></i></span> <span class=author itemprop=copyrightHolder>ReverseSacle @ ReverseSacle-Blog</span></div><div class=count><i class="ic i-clock" aria-hidden=true></i> <span id=time align=center>载入时间中...<script defer>var now=new Date;function createtime(){var n=new Date("2021-11-16 22:30:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("time").innerHTML="已经过 "+dnum+" 天 "+hnum+" 小时 "+mnum+" 分 "+snum+" 秒 "}setInterval("createtime()",250)</script></span><span class=post-meta-item-icon>|&nbsp<i class="ic i-chart-area"></i></span> <span title=站点总字数>2.1m 字</span> <span class=post-meta-item-icon>|&nbsp<i class="ic i-coffee"></i></span> <span title=站点阅读时长>40:40</span></div></div></div></footer></div><script data-config>var LOCAL={path:"computer-science/programming/c-language/c-project/comment-system-part1/",favicon:{show:"ReverseSacle-Blog",hide:"ReverseSacle-Blog"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},waline:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src=https://polyfill.alicdn.com/v3/polyfill.min.js></script><script src=https://cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1.16.0/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js></script><script src=/js/app.js></script></body></html>