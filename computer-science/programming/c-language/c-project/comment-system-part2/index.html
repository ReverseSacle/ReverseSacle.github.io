<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#222><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/ico sizes=48x48 href=/images/favicon.ico><link rel=alternate type=application/rss+xml title=逆转天平 href=https://www.reversesacle.com/rss.xml><link rel=alternate type=application/atom+xml title=逆转天平 href=https://www.reversesacle.com/atom.xml><link rel=alternate type=application/json title=逆转天平 href=https://www.reversesacle.com/feed.json><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=/css/app.css><meta name=description content=开源项目><link rel=canonical href=https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-part2/ ><title>网站留言评论系统的设计与手动实现-初稿-第二部分 - C语言项目 - C语言 - 编程 - 计算机科学 | ReverseSacle-Blog</title><meta name=generator content="Hexo 6.3.0"></head><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=dotloader><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">网站留言评论系统的设计与手动实现-初稿-第二部分</h1><div class=meta><span class=item title="创建时间：2023-09-07 14:58:44"><span class=icon><i class="ic i-calendar"></i></span> <span class=text>发表于</span> <time itemprop="dateCreated datePublished" datetime=2023-09-07T14:58:44+08:00>2023-09-07</time></span><span class=item title=本文字数><span class=icon><i class="ic i-pen"></i></span> <span class=text>本文字数</span> <span>111k</span> <span class=text>字</span></span><span class=item title=阅读时长><span class=icon><i class="ic i-clock"></i></span> <span class=text>阅读时长</span> <span>2:09</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div class=lines role=navigation aria-label=切换导航栏><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>ReverseSacle-Blog</a></li></ul><ul class=right><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id=imgs class=pjax><ul><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg6.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg7.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg16.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg13.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg11.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg10.webp></li></ul></div></header><div id=waves><svg class=waves xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewBox="0 24 150 28" preserveAspectRatio=none shape-rendering=auto><defs><path id=gentle-wave d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352z"/></defs><g class=parallax><use xlink:href=#gentle-wave x=48 y=0 /><use xlink:href=#gentle-wave x=48 y=3 /><use xlink:href=#gentle-wave x=48 y=5 /><use xlink:href=#gentle-wave x=48 y=7 /></g></svg></div><main><div class=inner><div id=main class=pjax><div class="article wrap"><div class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i> <span><a href=/ >首页</a></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/ itemprop=item rel=index title="分类于 计算机科学"><span itemprop=name>计算机科学</span></a><meta itemprop=position content=1></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/ itemprop=item rel=index title="分类于 编程"><span itemprop=name>编程</span></a><meta itemprop=position content=2></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/c-language/ itemprop=item rel=index title="分类于 C语言"><span itemprop=name>C语言</span></a><meta itemprop=position content=3></span><i class="ic i-angle-right"></i> <span class=current itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/c-language/c-project/ itemprop=item rel=index title="分类于 C语言项目"><span itemprop=name>C语言项目</span></a><meta itemprop=position content=4></span></div><article itemscope itemtype=http://schema.org/Article class="post block" lang=zh-CN><link itemprop=mainEntityOfPage href=https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-part2/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.webp><meta itemprop=name content=ReverseSacle><meta itemprop=description content="所见即所得，所思即所行, 知识书库 & 学习点滴"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=逆转天平></span><div class="body md" itemprop=articleBody><h1 id=从0到1的源代码编写的网站留言评论系统-初稿><a class=anchor href=#从0到1的源代码编写的网站留言评论系统-初稿>#</a> 从0到1的源代码编写的网站留言评论系统-初稿</h1><h2 id=适应性评论显示区域样式布局><a class=anchor href=#适应性评论显示区域样式布局>#</a> 适应性评论显示区域样式布局</h2><p>由于之前的前端评论区基本样式的评论显示区域、显示区域内的已经过时间的文本，时间状态竖条线和竖条线结束圆圈标志不能随着评论的数量而发生相应的动态变化，因此需要修改前端评论区基本样式来完成适应性变化处理。</p><p>首先，</p><p>去除了评论显示区域的评论列表(类名为<code>comment-list</code>)，接着为了可实现动态化的效果，为评论区的根源祖先(id为<code>comment-block</code>)的元素标签添加了CSS样式(位置和宽高)，而基本输入区域和评论显示区域则以浮动的形式漂浮在根源祖先内部(看起来就像是一个大盒子包裹两个相邻的小盒子并且留有一定空隙)。</p><p>接着，</p><p>添加JavaScript脚本语言编写的http的GET请求代码，GET请求之后，由后端连接数据库，失败时直接返回；成功后，通过数据库API接口编写的数据库数据请求代码来检查数据库的表中是否有记录，当数据库的表中有记录时，需将记录以一定格式处理后再绑定到后端的200状态响应报文的内容部分，以此将全部记录发送给前端。</p><p>前端接收到后端的响应报文后，通过JavaScript脚本语言解析数据后，通过自定义处理函数的处理并将评论展示在评论显示区域。</p><p>先删除之前用于测试的数据库表中所有数据，在MySQL中输入命令</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">USE</span> CommentSystem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> CommentBlock<span class="token punctuation">;</span></pre></td></tr></table></figure><p>该部分内容包含调试处理与通用源码的标准化，多变量函数的整合处理，自适应样式的编写。</p><h3 id=适应性样式布局预览><a class=anchor href=#适应性样式布局预览>#</a> 适应性样式布局预览</h3><p><img data-src=https://cdn.jsdelivr.net/gh/ReverseSacle/Gallery@latest/programming/project/comment-system/2.webp alt=""></p><h3 id=前端源码><a class=anchor href=#前端源码>#</a> 前端源码</h3><details class=info><summary>index.html</summary><div><p>为了满足当数据库有记录时才显示评论区内容的条件，将<code>comment-list</code>删去，即从默认创建状态转为由JavaScript脚本控制创建的状态。</p><figure class="highlight html"><figcaption data-lang=HTML></figcaption><table><tr><td data-num=1></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./css/comments.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/comments.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=13></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=14></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=15></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nickname<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>19<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> nickname(1~19个字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=16></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>44<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> email(8~44字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=17></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-block<span class="token punctuation">"</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=18></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=19></td><td><pre>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>commit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=20></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=21></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=22></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=23></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=24></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Comentarios<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=25></td><td><pre>            <span class="token comment">&lt;!-- &lt;ul class="comment-list">&lt;/ul> --></span></pre></td></tr><tr><td data-num=26></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></div></details><details class=info><summary>comments.css</summary><div><p>初始化body标签的默认样式。</p><p><code>comment-list</code>设置了默认不显示状态，相较于之前的样式，此处是将其作为透明的背景板框，其高度被用作度量单位，以便达到自适应的视觉效果。</p><p>由于评论显示区域的竖线和结尾圆圈符号是<code>comment-list</code>的伪元素，其只能在CSS中创建和添加属性，无法在JavaScript中修改属性，因此此处通过让竖线的高度，依照<code>comment-list</code>的高度发生动态变化，而结尾圆圈符号是与<code>comment-list</code>的底部呈固定位置，该符号会与竖线呈现视觉上的匹配效果。</p><p>此处的如何动态处理伪元素处理方法，通过搜索引擎查找了好久都没找到什么可行性高的方法，最后还是突然想到改变算法策略才得以解决该自适应的问题。</p><figure class="highlight css"><figcaption data-lang=CSS></figcaption><table><tr><td data-num=1></td><td><pre><span class="token selector">body,</span></pre></td></tr><tr><td data-num=2></td><td><pre>#comment-block,</pre></td></tr><tr><td data-num=3></td><td><pre>#comment-block input,</pre></td></tr><tr><td data-num=4></td><td><pre>#comment-block textarea,</pre></td></tr><tr><td data-num=5></td><td><pre>#comment-block button,</pre></td></tr><tr><td data-num=6></td><td><pre>#comment-block ul,</pre></td></tr><tr><td data-num=7></td><td><pre>#comment-block li <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token property">background</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">,</span> Helvetica<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token selector">#comment-block</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment">/* input area part  start-area*/</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token selector">#comment-block .input-block</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 306px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token selector">#comment-block .input-block .input-area</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token selector">#comment-block .input-block .input-area .nickname</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 161px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token property">border-right</span><span class="token punctuation">:</span> 2px solid #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre><span class="token selector">#comment-block .input-block .input-area .email</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 345px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token property">border-right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token property">padding-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token selector">#comment-block .input-block .input-area .text-block</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 231px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token property">border-top</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>	<span class="token property">padding-top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token property">resize</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre></pre></td></tr><tr><td data-num=72></td><td><pre><span class="token selector">#comment-block .input-block .button-area .commit</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=73></td><td><pre>	<span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token property">background</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>	<span class="token property">border-radius</span><span class="token punctuation">:</span> .3rem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>	<span class="token property">border</span><span class="token punctuation">:</span> 1px solid #eff2f3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token property">margin-top</span><span class="token punctuation">:</span> 2.8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>	<span class="token property">line-height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre></pre></td></tr><tr><td data-num=84></td><td><pre><span class="token comment">/* input area part  end-area*/</span></pre></td></tr><tr><td data-num=85></td><td><pre></pre></td></tr><tr><td data-num=86></td><td><pre></pre></td></tr><tr><td data-num=87></td><td><pre><span class="token comment">/* comment show area */</span></pre></td></tr><tr><td data-num=88></td><td><pre><span class="token selector">#comment-block .comment-container</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>	<span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>	<span class="token property">top</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>	<span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>	<span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=97></td><td><pre></pre></td></tr><tr><td data-num=98></td><td><pre><span class="token selector">#comment-block .comment-container .info</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=99></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>	<span class="token property">font-size</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token property">color</span><span class="token punctuation">:</span> #283035<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>	<span class="token property">font-weight</span><span class="token punctuation">:</span> 400<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=104></td><td><pre></pre></td></tr><tr><td data-num=105></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=106></td><td><pre>	<span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=108></td><td><pre></pre></td></tr><tr><td data-num=109></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::before</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>	<span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 50px<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token property">top</span><span class="token punctuation">:</span> 45px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=118></td><td><pre></pre></td></tr><tr><td data-num=119></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::after</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=120></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>	<span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token property">bottom</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> 27px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>	<span class="token property">border</span><span class="token punctuation">:</span> 3px solid #dee1e3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=130></td><td><pre></pre></td></tr><tr><td data-num=131></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=132></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre>	<span class="token property">margin-bottom</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=136></td><td><pre></pre></td></tr><tr><td data-num=137></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li::after</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>	<span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>	<span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=144></td><td><pre></pre></td></tr><tr><td data-num=145></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level::after</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>	<span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=152></td><td><pre></pre></td></tr><tr><td data-num=153></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>	<span class="token property">border</span><span class="token punctuation">:</span> 3px solid #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>	<span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>	<span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 2px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=162></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=163></td><td><pre></pre></td></tr><tr><td data-num=164></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar .img</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=165></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=168></td><td><pre></pre></td></tr><tr><td data-num=169></td><td><pre><span class="token comment">/* comment box of coment area start-area */</span></pre></td></tr><tr><td data-num=170></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=171></td><td><pre>	<span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 465px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 1px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.15<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=176></td><td><pre></pre></td></tr><tr><td data-num=177></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=178></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=179></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>	<span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>	<span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=196></td><td><pre></pre></td></tr><tr><td data-num=197></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=198></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>	<span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>	<span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=208></td><td><pre>	<span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=210></td><td><pre></pre></td></tr><tr><td data-num=211></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=212></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre>	<span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=216></td><td><pre></pre></td></tr><tr><td data-num=217></td><td><pre><span class="token comment">/* comment box head area start-area */</span></pre></td></tr><tr><td data-num=218></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=219></td><td><pre>	<span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre>	<span class="token property">padding</span><span class="token punctuation">:</span> 10px 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>	<span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #E5E5E5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>	<span class="token property">border-radius</span><span class="token punctuation">:</span> 4px 4px 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre>	<span class="token property">background</span><span class="token punctuation">:</span> #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=224></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=225></td><td><pre></pre></td></tr><tr><td data-num=226></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head .cbauthor-name</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=227></td><td><pre>	<span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=228></td><td><pre>	<span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=229></td><td><pre>	<span class="token property">color</span><span class="token punctuation">:</span> #283035<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=230></td><td><pre>	<span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=231></td><td><pre>	<span class="token property">font-weight</span><span class="token punctuation">:</span> 700<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=233></td><td><pre></pre></td></tr><tr><td data-num=234></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head span</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=235></td><td><pre>	<span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre>	<span class="token property">top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>	<span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=241></td><td><pre></pre></td></tr><tr><td data-num=242></td><td><pre><span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=243></td><td><pre></pre></td></tr><tr><td data-num=244></td><td><pre><span class="token comment">/* comment box content area start-area */</span></pre></td></tr><tr><td data-num=245></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-content</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre>	<span class="token property">padding</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=248></td><td><pre>	<span class="token property">border-radius</span><span class="token punctuation">:</span> 0 0 4px 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>	<span class="token property">font-size</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>	<span class="token property">color</span><span class="token punctuation">:</span> #595959<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>	<span class="token property">background</span><span class="token punctuation">:</span> #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=253></td><td><pre></pre></td></tr><tr><td data-num=254></td><td><pre><span class="token comment">/* comment box content area end-area */</span></pre></td></tr><tr><td data-num=255></td><td><pre></pre></td></tr><tr><td data-num=256></td><td><pre><span class="token comment">/* comment box of coment area end-area */</span></pre></td></tr></table></figure></div></details><details class=info><summary>comments.js</summary><div><p>由于需要实现评论显示区域的自适应变化，之前的JavaScript脚本代码完全不能满足要求，因此需要变更JavaScript脚本的算法逻辑。</p><p>首先是将<strong>评论显示区的设计逻辑转变为</strong> - 先向后端发送对数据库记录的GET请求，倘若有接收到记录，就将所有记录以评论的形式展现在显示区域；倘若没有就不需要处理。当展现完后就开始监听<code>commit</code>的click事件了。</p><p>由于通过JavaScript的fetchAPI的GET请求后获取的是一个Promise，需要使用<code>await</code>关键字来等待处理结果，由于使用了异步的<code>await</code>关键字，还需要在使用了网络请求的函数头处中添加<code>async</code>关键字来使其成为异步函数。异步函数在执行过程中可以暂停并等待异步操作完成，而不会阻塞整个程序的执行。</p><p><strong>完整的修改过程为</strong></p><ul><li>首先，编写了<code>_GetRequest</code>函数，用于向后端发送对数据库记录的GET请求并获取后端发送的数据。由于还需要控制是否进行评论添加操作，返回值就创建了一个包含布尔值和字符串的数组，布尔值用来判断是否需要添加评论操作，而字符串就是经过处理的后端数据了</li><li>接着，将之前的<code>_postRequest</code>函数进行了异步函数化的处理，之后将监听<code>commit</code>的click事件的内容剪贴并用名为<code>buttonClick</code>的函数包裹剪贴的内容</li><li>之后，由于GET请求会获取到数据库的数据，需要将数据库的数据内容以评论的形式在评论显示区域展示。为此，先创建了<code>commentPreShow</code>函数，按照之前提及的格式【<code>nickname:email:content:createat</code>，每个记录之间用<code>,</code>分隔】，先按<code>,</code>号将每条数据分割出来，接着依次对每条数据按照【前三个数据按<code>:</code>号分割，最后一个取剩下所有】的方法提取数据，再通过<code>contentAppend</code>函数来向评论显示区添加评论</li><li>接着，由于之前的<code>contentAppend</code>函数创建的评论里的内容都是已经定好的数据，无法满足自适应的需求了，因此对该函数进行了修改。修改过程非常简单，就是先配合<code>commentPreShow</code>函数将经过处理和分割后的后端数据作为参数传递给<code>contentAppend</code>函数，之后，<code>contentAppend</code>函数里对应固定文本数据改为对应接收参数的变量。但有一例外，就是<code>creatat</code>参数，其用途是用于计算该条评论距离当前时间已经过去多久了(详细看代码)。最后就是评论区背景板和竖线如何跟着评论数量而伸长了，由于CSS样式中已经说明了，此处不再赘述，方法非常简单，就是给定一个偏移值，每当添加一个评论后，<code>comment-block</code>和<code>comment-container</code>区域的高度都会增加一个偏移值，但<code>comment-container</code>会影响竖线，其高度还需减去最原始状态的评论输入区域的高度</li><li>最后，就是评论显示区域出现的时机了，倘若没有评论时，当添加第一个评论时就是评论显示区域的出现时机；倘若有评论时，就在第一个评论的前面插入一个新的评论即可</li></ul><figure class="highlight javascript"><figcaption data-lang=javascript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>_URL<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>            <span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token literal-property property">body</span><span class="token operator">:</span> data<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>_URL<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">function</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span><span class="token parameter">textsLable<span class="token punctuation">,</span> cols</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token keyword">var</span> texts <span class="token operator">=</span> <span class="token punctuation">(</span>textsLable<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r|\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">var</span> textLength <span class="token operator">=</span> texts<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> textLength<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> cache<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token number">0</span> <span class="token operator">===</span> cache<span class="token punctuation">.</span>length <span class="token operator">%</span> cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=30></td><td><pre>            cache <span class="token operator">+=</span> <span class="token string">"&lt;br/>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>        cache <span class="token operator">+=</span> texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token keyword">return</span> cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token keyword">function</span> <span class="token function">contentAppend</span><span class="token punctuation">(</span><span class="token parameter">labels<span class="token punctuation">,</span> nickNameValue<span class="token punctuation">,</span> textsContent<span class="token punctuation">,</span> creatat</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token keyword">var</span> userBlock <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token keyword">var</span> mainUserLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>    mainUserLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"main-level clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token comment">/* avatar area  start-area */</span></pre></td></tr><tr><td data-num=45></td><td><pre>    <span class="token keyword">var</span> avatarLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>    avatarLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"avatar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token keyword">var</span> imgUrl <span class="token operator">=</span> <span class="token string">"./img/img.png"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>    avatarLable<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"&lt;img src=\""</span> <span class="token operator">+</span> imgUrl <span class="token operator">+</span> <span class="token string">"\"alt>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>    mainUserLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>avatarLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token comment">/* avatar area  end-area */</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>    <span class="token keyword">var</span> commentBoxLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre></pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token comment">/* comment box of coment area start-area */</span></pre></td></tr><tr><td data-num=57></td><td><pre>    <span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=58></td><td><pre>    <span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre></pre></td></tr><tr><td data-num=61></td><td><pre>    <span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>    authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>    authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> nickNameValue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre></pre></td></tr><tr><td data-num=65></td><td><pre>    <span class="token keyword">var</span> timeSpend <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>    <span class="token keyword">var</span> oldTimeStamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>creatat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>    <span class="token keyword">var</span> newTimeStamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>    <span class="token keyword">var</span> second <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>newTimeStamp <span class="token operator">-</span> oldTimeStamp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>    <span class="token keyword">var</span> minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>second <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>    <span class="token keyword">var</span> hours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>    <span class="token keyword">var</span> days <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>hours <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> days<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> days <span class="token operator">+</span> <span class="token string">" days ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=73></td><td><pre>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> hours<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> hours <span class="token operator">+</span> <span class="token string">" hours ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=74></td><td><pre>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> minutes <span class="token operator">+</span> <span class="token string">" minutes ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=75></td><td><pre></pre></td></tr><tr><td data-num=76></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>    boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpend<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>    <span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=80></td><td><pre></pre></td></tr><tr><td data-num=81></td><td><pre>    <span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=82></td><td><pre>    <span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>    boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"cbox-conten"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre></pre></td></tr><tr><td data-num=85></td><td><pre>    boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> textsContent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>    commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>    <span class="token comment">/* comment box of coment area end-area */</span></pre></td></tr><tr><td data-num=88></td><td><pre></pre></td></tr><tr><td data-num=89></td><td><pre>    mainUserLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>    userBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre></pre></td></tr><tr><td data-num=92></td><td><pre>    <span class="token comment">/* state stretch */</span></pre></td></tr><tr><td data-num=93></td><td><pre>    <span class="token keyword">var</span> O_CBHeight <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>    <span class="token keyword">var</span> newHeight <span class="token operator">=</span> O_CBHeight <span class="token operator">+</span> <span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre></pre></td></tr><tr><td data-num=96></td><td><pre>    commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre>    commentContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">-</span> <span class="token number">325</span> <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=99></td><td><pre></pre></td></tr><tr><td data-num=100></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">buttonClick</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span> labels</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=101></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>    <span class="token keyword">var</span> inputArea <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>    <span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre></pre></td></tr><tr><td data-num=106></td><td><pre>    <span class="token keyword">var</span> inputs <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>    <span class="token keyword">var</span> nickName <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>    <span class="token keyword">var</span> email <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>    <span class="token keyword">var</span> texts <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"textarea"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre></pre></td></tr><tr><td data-num=111></td><td><pre>    <span class="token keyword">var</span> nickNameValue <span class="token operator">=</span> nickName<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>nickNameValue<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=113></td><td><pre>        <span class="token comment">/* current time */</span></pre></td></tr><tr><td data-num=114></td><td><pre>        <span class="token keyword">var</span> curTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre>        <span class="token keyword">var</span> _year <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>        <span class="token keyword">var</span> _month <span class="token operator">=</span> <span class="token punctuation">(</span>curTime<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>        <span class="token keyword">var</span> _day <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>        <span class="token keyword">var</span> _hours <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>        <span class="token keyword">var</span> _minutes <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>        <span class="token keyword">var</span> _seconds <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>        <span class="token keyword">var</span> timeFormat <span class="token operator">=</span> _year <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> _month <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> _day <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num=122></td><td><pre>            _hours <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> _minutes <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> _seconds<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>        <span class="token comment">/********/</span></pre></td></tr><tr><td data-num=124></td><td><pre></pre></td></tr><tr><td data-num=125></td><td><pre>        <span class="token keyword">var</span> textsContent <span class="token operator">=</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span>texts<span class="token punctuation">,</span> texts<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>        <span class="token keyword">var</span> data <span class="token operator">=</span> nickNameValue <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> email<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> textsContent <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> timeFormat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre></pre></td></tr><tr><td data-num=128></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">==</span> <span class="token keyword">await</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> <span class="token string">"/api"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=129></td><td><pre>            <span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre>            <span class="token keyword">var</span> commentListFirstChild <span class="token operator">=</span> commentList<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre>            <span class="token keyword">var</span> newLabels <span class="token operator">=</span> <span class="token punctuation">[</span>commentContainer<span class="token punctuation">,</span> commentBlock<span class="token punctuation">,</span> userBlock<span class="token punctuation">,</span> commentList<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre></pre></td></tr><tr><td data-num=133></td><td><pre>            <span class="token function">contentAppend</span><span class="token punctuation">(</span>newLabels<span class="token punctuation">,</span> nickNameValue<span class="token punctuation">,</span> textsContent<span class="token punctuation">,</span> timeFormat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> commentListFirstChild<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=135></td><td><pre>                commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>                commentList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=138></td><td><pre>            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> commentList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span> commentListFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=139></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=140></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=141></td><td><pre></pre></td></tr><tr><td data-num=142></td><td><pre>    nickName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre>    email<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=144></td><td><pre>    texts<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=145></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=146></td><td><pre></pre></td></tr><tr><td data-num=147></td><td><pre><span class="token keyword">function</span> <span class="token function">commentPreShow</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> labels</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=148></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>    <span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>    <span class="token keyword">var</span> array <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>    array<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre></pre></td></tr><tr><td data-num=154></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=155></td><td><pre>        <span class="token keyword">var</span> sub <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>        <span class="token keyword">var</span> nickName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>        <span class="token keyword">var</span> email <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>        <span class="token keyword">var</span> textsContent <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>        <span class="token keyword">var</span> createat <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>        <span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token string">':'</span> <span class="token operator">!=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=162></td><td><pre>            nickName <span class="token operator">+=</span> sub<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token operator">++</span>j<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token string">':'</span> <span class="token operator">!=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=164></td><td><pre>            email <span class="token operator">+=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token operator">++</span>j<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token string">':'</span> <span class="token operator">!=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=166></td><td><pre>            textsContent <span class="token operator">+=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token operator">++</span>j<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> createat <span class="token operator">+=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=168></td><td><pre></pre></td></tr><tr><td data-num=169></td><td><pre>        <span class="token comment">/* console.log(nickName + ":" + email + ":" + textsContent + ":" + createat + "\n"); */</span></pre></td></tr><tr><td data-num=170></td><td><pre>        <span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>        <span class="token keyword">var</span> commentListFirstChild <span class="token operator">=</span> commentList<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>        <span class="token keyword">var</span> newLabels <span class="token operator">=</span> <span class="token punctuation">[</span>commentContainer<span class="token punctuation">,</span> commentBlock<span class="token punctuation">,</span> userBlock<span class="token punctuation">,</span> commentList<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre></pre></td></tr><tr><td data-num=174></td><td><pre>        <span class="token function">contentAppend</span><span class="token punctuation">(</span>newLabels<span class="token punctuation">,</span> nickName<span class="token punctuation">,</span> textsContent<span class="token punctuation">,</span> createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> commentListFirstChild<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=176></td><td><pre>            commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre>            commentList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=179></td><td><pre>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> commentList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span> commentListFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=180></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=181></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=182></td><td><pre></pre></td></tr><tr><td data-num=183></td><td><pre>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=184></td><td><pre>    <span class="token keyword">const</span> _host <span class="token operator">=</span> <span class="token string">"192.168.80.131"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>    <span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* class="comment-block" */</span></pre></td></tr><tr><td data-num=186></td><td><pre></pre></td></tr><tr><td data-num=187></td><td><pre>    <span class="token keyword">var</span> inputBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span><span class="token comment">/* class="input-block" */</span></pre></td></tr><tr><td data-num=188></td><td><pre>    <span class="token comment">/* input-block */</span></pre></td></tr><tr><td data-num=189></td><td><pre>    <span class="token keyword">var</span> inputArea <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span><span class="token comment">/* class="input-area" */</span></pre></td></tr><tr><td data-num=190></td><td><pre>    <span class="token keyword">var</span> buttonArea <span class="token operator">=</span> inputArea<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span><span class="token comment">/* class="text-block" */</span></pre></td></tr><tr><td data-num=191></td><td><pre>    <span class="token keyword">var</span> commitButton <span class="token operator">=</span> buttonArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">/* class="commit" */</span></pre></td></tr><tr><td data-num=192></td><td><pre>    <span class="token comment">/***************/</span></pre></td></tr><tr><td data-num=193></td><td><pre>    <span class="token keyword">var</span> commentContainer <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span><span class="token comment">/* class="comment-container" */</span></pre></td></tr><tr><td data-num=194></td><td><pre></pre></td></tr><tr><td data-num=195></td><td><pre>    <span class="token keyword">var</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span> <span class="token string">"/database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=197></td><td><pre></pre></td></tr><tr><td data-num=198></td><td><pre>    <span class="token keyword">var</span> commentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>    commentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>    commentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>    <span class="token function">commentPreShow</span><span class="token punctuation">(</span>responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>commentContainer<span class="token punctuation">,</span> commentBlock<span class="token punctuation">,</span> commentList<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre></pre></td></tr><tr><td data-num=203></td><td><pre>    commitButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=204></td><td><pre>        <span class="token function">buttonClick</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span> <span class="token punctuation">[</span>commentContainer<span class="token punctuation">,</span> commentBlock<span class="token punctuation">,</span> inputArea<span class="token punctuation">,</span> commentList<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><h3 id=后端与数据库源码><a class=anchor href=#后端与数据库源码>#</a> 后端与数据库源码</h3><details class=info><summary>_clibs.h</summary><div><p>将数据库源码和http源码中共用的C源码库头文件剪贴，额外用名为<code>_clibs</code>的头文件包含剪贴内容。</p><p>还包含一些共用的标识符或宏。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i16</span> <span class="token expression"><span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i32</span> <span class="token expression"><span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i64</span> <span class="token expression"><span class="token keyword">long</span></span></span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u16</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u32</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u64</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">long</span></span></span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ROOTDIR</span> <span class="token string">"docs"</span></span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_DEBUG</span></span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> arg1<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>i32 <span class="token function">_pow</span><span class="token punctuation">(</span>i32 n<span class="token punctuation">,</span>i32 m<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>i32 <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>_clibs.c</summary><div><p>头文件的实现代码。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> arg1<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> arg2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"%s%s\n"</span><span class="token punctuation">,</span>arg1<span class="token punctuation">,</span>arg2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>i32 <span class="token function">_pow</span><span class="token punctuation">(</span>i32 n<span class="token punctuation">,</span>i32 m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> m<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> n <span class="token operator">*=</span> n<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre>   <span class="token keyword">return</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre>i32 <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>   i32 left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>   i32 ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>str1<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">++</span>left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre>   right <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span>right <span class="token operator">>=</span> left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=25></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=26></td><td><pre>      i32 t <span class="token operator">=</span> <span class="token punctuation">(</span>str1<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>      ans <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">*</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>      <span class="token operator">--</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre>   <span class="token keyword">return</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>database.h</summary><div><p>额外声明了数据库表插入函数和数据库记录获取的查询函数。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql/mysql.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HOST</span> <span class="token string">"127.0.0.1"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">USER</span> <span class="token string">"root"</span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PASSWORD</span> <span class="token string">"@Killl611"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DBNAME</span> <span class="token string">"CommentSystem"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Element</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">char</span> tablename<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Element</span><span class="token operator">*</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=22></td><td><pre>MYSQL_RES<span class="token operator">*</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>MYSQL_RES<span class="token operator">*</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>database.c</summary><div><p><strong>将查询结果保存到内存中的函数</strong> - <code>MYSQL_RES* mysql_store_result(MYSQL* mysql)</code></p><ul><li><code>MYSQL_RES*</code> - 这是函数的返回类型，表示一个指向结果集的指针，结果集包含了查询返回的数据</li><li><code>MYSQL* mysql</code> - 这是一个指向已连接到MySQL服务器的MySQL对象的指针。需要在调用此函数之前成功地连接到MySQL服务器，并将连接句柄传递给这个函数</li></ul><p><strong>存储查询结果</strong>的结构体变量 - <code>MYSQL_RES* res</code></p><p>提取一个结果集中的<strong>一行</strong>数据 - <code>MYSQL_ROW row</code></p><p><strong>释放通过</strong> <code>mysql_store_result</code> <strong>函数分配的内存</strong> - <code>void mysql_free_result(MYSQL_RES* result)</code></p><ul><li><code>void</code> - 这是函数的返回类型，表示该函数不返回任何值</li><li><code>MYSQL_RES* result</code> - 这是一个指向结果集的指针，你需要将要释放的结果集的指针传递给这个函数</li></ul><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	MYSQL <span class="token operator">*</span>mysql <span class="token operator">=</span> <span class="token function">mysql_init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"DatabaseConnect: mysql_init() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre>	mysql <span class="token operator">=</span> <span class="token function">mysql_real_connect</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span> HOST<span class="token punctuation">,</span> USER<span class="token punctuation">,</span> PASSWORD<span class="token punctuation">,</span> DBNAME<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"DatabaseConnect: mysql_real_connect() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"DatabaseConnect Succeed"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token keyword">return</span> mysql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL <span class="token operator">*</span>mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token function">mysql_close</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"DatabaseConnect Close"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL <span class="token operator">*</span>mysql<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Element</span> <span class="token operator">*</span>el<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"INSERT INTO %s(NickName,Email,Content,CreateAt)\nVALUES('%s','%s','%s','%s')"</span><span class="token punctuation">,</span> el<span class="token operator">-></span>tablename<span class="token punctuation">,</span> el<span class="token operator">-></span>nickname<span class="token punctuation">,</span> el<span class="token operator">-></span>email<span class="token punctuation">,</span> el<span class="token operator">-></span>content<span class="token punctuation">,</span> el<span class="token operator">-></span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Database Query:\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"TableInsert: mysql_query() Error.reason: %s\n"</span><span class="token punctuation">,</span> <span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"TableInsert Succeed\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre>MYSQL_RES <span class="token operator">*</span><span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>MYSQL <span class="token operator">*</span>mysql<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>tableName<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token string">"SELECT * FROM %s ORDER BY CreateAT ASC"</span><span class="token punctuation">,</span> tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"GetTableElement: mysql_query() Error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetTableElement Start"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token keyword">return</span> <span class="token function">mysql_store_result</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>MYSQL_RES <span class="token operator">*</span>res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token function">mysql_free_result</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetTableElement End"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.h</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;netdb.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">FileType</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	_HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>	_CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>	_JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>	_PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestMethod</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	_GET <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=22></td><td><pre>	_POST <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=23></td><td><pre>	_PUT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">int</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.c</summary><div><p>创建了<code>Response200_DB</code>函数，用于响应前端的GET请求，过程就是将数据库的记录一行一行的读取，并用<code>,</code>分隔，直到读完全部记录后，发送带数据的200响应给前端。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>	i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"socketConstruct: server_fd = socket() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	u32 server_addrSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	</pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token comment">/* Initial port */</span></pre></td></tr><tr><td data-num=23></td><td><pre>	i32 opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	u32 optSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>optSize<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"socketConstruct: bind() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"socketConstruct: listen() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	</pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetLine</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>	i32 index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		i32 len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=52></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=54></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=55></td><td><pre>			buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=59></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"GetLine: read failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"client close.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre>			index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=65></td><td><pre>			</pre></td></tr><tr><td data-num=66></td><td><pre>	buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=69></td><td><pre></pre></td></tr><tr><td data-num=70></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=71></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=75></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'O'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'G'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'E'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=78></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'U'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=79></td><td><pre>		<span class="token operator">++</span>method<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetMethodType: POST"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _POST<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetMethodType: GET"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _GET<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetMethodType: PUT"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _PUT<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=86></td><td><pre></pre></td></tr><tr><td data-num=87></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> ostr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=88></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> ch <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token operator">*</span> cache <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>	</pre></td></tr><tr><td data-num=93></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>ostr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">NULL</span> <span class="token operator">!=</span> ch<span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=95></td><td><pre>		cache <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	</pre></td></tr><tr><td data-num=97></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>cache<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=98></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=99></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'H'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'M'</span><span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'L'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=101></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'C'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=102></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'J'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=103></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'N'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'G'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=104></td><td><pre>		<span class="token operator">++</span>cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre></pre></td></tr><tr><td data-num=107></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetFileType: HTML"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _HTML<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=108></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetFileType: CSS"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _CSS<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetFileType: JS"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _JS<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetFileType: PNG"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _PNG<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=113></td><td><pre></pre></td></tr><tr><td data-num=114></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=115></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=119></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response404: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=121></td><td><pre></pre></td></tr><tr><td data-num=122></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=123></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 400 BAD REQUEST\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response400: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=129></td><td><pre></pre></td></tr><tr><td data-num=130></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=131></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=132></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre></pre></td></tr><tr><td data-num=134></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre></pre></td></tr><tr><td data-num=138></td><td><pre>   <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=140></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200_NF: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=142></td><td><pre></pre></td></tr><tr><td data-num=143></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=144></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=145></td><td><pre>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>    <span class="token keyword">char</span> body<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>    <span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>    i32 bodyLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre></pre></td></tr><tr><td data-num=150></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>    <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>    <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>    <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre></pre></td></tr><tr><td data-num=155></td><td><pre>    MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>    MYSQL_RES<span class="token operator">*</span> res <span class="token operator">=</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=158></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=159></td><td><pre>      MYSQL_ROW row<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>row <span class="token operator">=</span> <span class="token function">mysql_fetch_row</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=161></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=162></td><td><pre>            <span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"%s:%s:%s:%s,"</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>         <span class="token function">strcat</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=164></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=165></td><td><pre>      <span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=167></td><td><pre>    <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre></pre></td></tr><tr><td data-num=169></td><td><pre>    bodyLen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>    <span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"Content-Length: %d\r\n\r\n"</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>    <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre></pre></td></tr><tr><td data-num=173></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=175></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=177></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=178></td><td><pre>        <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>body<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=180></td><td><pre>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=182></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=183></td><td><pre></pre></td></tr><tr><td data-num=184></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=185></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>	</pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=191></td><td><pre></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=195></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=196></td><td><pre>		<span class="token keyword">case</span> _HTML<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=197></td><td><pre>		<span class="token keyword">case</span> _CSS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=198></td><td><pre>		<span class="token keyword">case</span> _JS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=199></td><td><pre>		<span class="token keyword">case</span> _PNG<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>	</pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=208></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=210></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=211></td><td><pre>		FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre>		i32 c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre></pre></td></tr><tr><td data-num=214></td><td><pre>		resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=216></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=217></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=218></td><td><pre>				<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error. reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=220></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"I/O error when reading"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=221></td><td><pre>		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"End of file reached successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=222></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre>	<span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=224></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=225></td><td><pre></pre></td></tr><tr><td data-num=226></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=227></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=228></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./docs/database"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=229></td><td><pre>		<span class="token function">Response200_DB</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=230></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./docs/api"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=231></td><td><pre>		<span class="token function">Response200_NF</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response200</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=233></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=234></td><td><pre></pre></td></tr><tr><td data-num=235></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">,</span>i32 i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=236></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=237></td><td><pre>    <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>    <span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>    i32 j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>    u32 urlSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=241></td><td><pre></pre></td></tr><tr><td data-num=242></td><td><pre>    <span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=243></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>urlSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=245></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=246></td><td><pre>        url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre>        <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=248></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=249></td><td><pre>    url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre></pre></td></tr><tr><td data-num=252></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Request Header:"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre>    <span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=254></td><td><pre>    <span class="token keyword">do</span></pre></td></tr><tr><td data-num=255></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=256></td><td><pre>        len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=257></td><td><pre>        <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre></pre></td></tr><tr><td data-num=260></td><td><pre>    <span class="token comment">/* 通过定位?号来处理url */</span></pre></td></tr><tr><td data-num=261></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=262></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=263></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=264></td><td><pre>         <span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=265></td><td><pre>         <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Position ? Request Path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=266></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=267></td><td><pre>    <span class="token function">sprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./%s/%s"</span><span class="token punctuation">,</span>_ROOTDIR<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=268></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Real Path: "</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=269></td><td><pre></pre></td></tr><tr><td data-num=270></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetMethod Response"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre>    <span class="token comment">/* 返回响应报文 */</span></pre></td></tr><tr><td data-num=272></td><td><pre>    <span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=273></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=274></td><td><pre></pre></td></tr><tr><td data-num=275></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=276></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=277></td><td><pre>    i32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=278></td><td><pre>    <span class="token keyword">char</span> contentLength<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=279></td><td><pre></pre></td></tr><tr><td data-num=280></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Request Header:"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre>    <span class="token keyword">do</span></pre></td></tr><tr><td data-num=282></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=283></td><td><pre>        len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>        <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=285></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=286></td><td><pre>            <span class="token function">strcpy</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">strchr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token char">':'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=287></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=288></td><td><pre></pre></td></tr><tr><td data-num=289></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">_stoi</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=290></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=291></td><td><pre>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"PostMethod: GetLine() Error Not have body content\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=292></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=293></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=294></td><td><pre></pre></td></tr><tr><td data-num=295></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"PostMethod Response"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=296></td><td><pre>    <span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=297></td><td><pre>    <span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=298></td><td><pre>    <span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=299></td><td><pre>    <span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=300></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_nickname <span class="token operator">=</span> nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=301></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_email <span class="token operator">=</span> email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=302></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_content <span class="token operator">=</span> content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=303></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_createat <span class="token operator">=</span> createat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=304></td><td><pre></pre></td></tr><tr><td data-num=305></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=306></td><td><pre>    <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=307></td><td><pre>        <span class="token operator">*</span>p_nickname <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=308></td><td><pre>        <span class="token operator">++</span>p_nickname<span class="token punctuation">;</span> <span class="token operator">++</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=309></td><td><pre>    <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=310></td><td><pre></pre></td></tr><tr><td data-num=311></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_email<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=312></td><td><pre>        <span class="token operator">*</span>p_email <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=313></td><td><pre></pre></td></tr><tr><td data-num=314></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_content<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=315></td><td><pre>        <span class="token operator">*</span>p_content <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=316></td><td><pre></pre></td></tr><tr><td data-num=317></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_createat<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=318></td><td><pre>        <span class="token operator">*</span>p_createat <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=319></td><td><pre></pre></td></tr><tr><td data-num=320></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=321></td><td><pre>    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"body: %s:%s:%s:%s\n"</span><span class="token punctuation">,</span>nickname<span class="token punctuation">,</span>email<span class="token punctuation">,</span>content<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=322></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=323></td><td><pre></pre></td></tr><tr><td data-num=324></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">Element</span> el<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=325></td><td><pre>    MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=326></td><td><pre></pre></td></tr><tr><td data-num=327></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>el<span class="token punctuation">,</span><span class="token char">'\0'</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=328></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>tablename<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=329></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>nickname<span class="token punctuation">,</span>nickname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=330></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>email<span class="token punctuation">,</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=331></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>content<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=332></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>createat<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=333></td><td><pre>    <span class="token function">TableInsert</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token operator">&amp;</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=334></td><td><pre>    <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=335></td><td><pre></pre></td></tr><tr><td data-num=336></td><td><pre>    <span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token string">"./docs/api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=337></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=338></td><td><pre></pre></td></tr><tr><td data-num=339></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=340></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=341></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=342></td><td><pre>	<span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=343></td><td><pre>	u32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>bufSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=344></td><td><pre></pre></td></tr><tr><td data-num=345></td><td><pre>	len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=346></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=347></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=348></td><td><pre>		i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=349></td><td><pre>		u32 methodSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=350></td><td><pre></pre></td></tr><tr><td data-num=351></td><td><pre>		<span class="token comment">/* 获取请求的method */</span></pre></td></tr><tr><td data-num=352></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>methodSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=353></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=354></td><td><pre>			method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=355></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=356></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=357></td><td><pre>		method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=358></td><td><pre>		</pre></td></tr><tr><td data-num=359></td><td><pre>		<span class="token comment">/* 处理对应的方法 */</span></pre></td></tr><tr><td data-num=360></td><td><pre>		<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=361></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=362></td><td><pre>			<span class="token keyword">case</span> _GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=363></td><td><pre>			<span class="token keyword">case</span> _POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=364></td><td><pre>			<span class="token keyword">case</span> _PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=365></td><td><pre>			<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=366></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=367></td><td><pre>				<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=368></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"warning! could not accept %s"</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=369></td><td><pre>				<span class="token keyword">do</span></pre></td></tr><tr><td data-num=370></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=371></td><td><pre>					len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=372></td><td><pre>					<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=373></td><td><pre>				<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=374></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=375></td><td><pre>		<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=376></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=377></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response400</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=378></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>httpserver.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	</pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		i32 accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>		i32 socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>		<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=18></td><td><pre>		</pre></td></tr><tr><td data-num=19></td><td><pre>		<span class="token function">HttpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h2 id=服务器进程的多线程模式><a class=anchor href=#服务器进程的多线程模式>#</a> 服务器进程的多线程模式</h2><h3 id=基本多线程模式><a class=anchor href=#基本多线程模式>#</a> 基本多线程模式</h3><p>通过pthead库函数，先建立一个线程节点数组，通过线程创建函数依次循环在数组内依次创建线程。(埋个<strong>坑3</strong>)</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">HttpMain</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    i32 accept_fd <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token function">HttpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>MAXCLIENTS<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    i32 thread_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>        i32 accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>        i32 socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>        <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>        accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>        <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>thread_index<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>HttpMain<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>        thread_index <span class="token operator">=</span> <span class="token punctuation">(</span>thread_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> MAXCLIENTS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> MAXCLIENTS<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">pthread_join</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=线程资源的回收避免僵尸线程><a class=anchor href=#线程资源的回收避免僵尸线程>#</a> 线程资源的回收(避免僵尸线程)</h3><p>当主线程函数终止时，不会释放线程所占用内存和其他资源，这种线程被称为僵尸线程，为了避免僵尸线程，通过调用<code>pthread_attr_setdetachstate</code>函数将线程设置为<code>detached</code>，当线程退出时，系统自动回收线程资源。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">HttpMain</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    i32 accept_fd <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token function">HttpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>MAXCLIENTS<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    i32 thread_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>        i32 accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>        i32 socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>        <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>        accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>        <span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>        <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>        <span class="token function">pthread_attr_setdetachstate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span>PTHREAD_CREATE_DETACHED<span class="token punctuation">)</span><span class="token punctuation">;</span>        </pre></td></tr><tr><td data-num=40></td><td><pre>        <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>thread_index<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>HttpMain<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>        thread_index <span class="token operator">=</span> <span class="token punctuation">(</span>thread_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> MAXCLIENTS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> MAXCLIENTS<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">pthread_join</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=向线程发送退出信号并在退出前执行处理函数><a class=anchor href=#向线程发送退出信号并在退出前执行处理函数>#</a> 向线程发送退出信号并在退出前执行处理函数</h3><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>MAXCLIENTS<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">void</span> <span class="token function">MainExit</span><span class="token punctuation">(</span>i32 sig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"\nMainEixt start"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    </pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> MAXCLIENTS<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">pthread_cancel</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    </pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"\nMainEixt end"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">HttpMain</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    i32 accept_fd <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token function">HttpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>    i32 thread_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//捕获Ctrl c信号</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//捕获kill信号</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre>    server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=38></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>        i32 accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>        i32 socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>        <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>        accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>        <span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>        <span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>        <span class="token function">pthread_attr_setdetachstate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span>PTHREAD_CREATE_DETACHED<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>        <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>thread_index<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>HttpMain<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>        thread_index <span class="token operator">=</span> <span class="token punctuation">(</span>thread_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> MAXCLIENTS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=为数据库的写操作添加锁操作><a class=anchor href=#为数据库的写操作添加锁操作>#</a> 为数据库的写操作添加锁操作</h3><details class=info><summary>http.h</summary><div><p>添加了互斥锁。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;netdb.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;pthread.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXCLIENTS</span> <span class="token expression"><span class="token number">10</span></span></span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">FileType</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	_HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>	_CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=18></td><td><pre>	_JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>	_PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestMethod</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	_GET <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=25></td><td><pre>	_POST <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>	_PUT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token class-name">pthread_mutex_t</span> mutex<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">int</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.c</summary><div><p><code>Response200_DB</code>中添加了锁操作。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>	i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: socket() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	u32 server_addrSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	</pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token comment">/* Initial port */</span></pre></td></tr><tr><td data-num=23></td><td><pre>	i32 opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	u32 optSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>optSize<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: bind() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: listen() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	</pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetLine</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>	i32 index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		i32 len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=52></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=54></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=55></td><td><pre>			buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=59></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"GetLine: read Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"client close.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre>			index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=65></td><td><pre>			</pre></td></tr><tr><td data-num=66></td><td><pre>	buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=69></td><td><pre></pre></td></tr><tr><td data-num=70></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=71></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=75></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'O'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'G'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'E'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=78></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'U'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=79></td><td><pre>		<span class="token operator">++</span>method<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetMethodType: POST"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _POST<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetMethodType: GET"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _GET<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetMethodType: PUT"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _PUT<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=86></td><td><pre></pre></td></tr><tr><td data-num=87></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> ostr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=88></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> ch <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token operator">*</span> cache <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>	</pre></td></tr><tr><td data-num=93></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>ostr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">NULL</span> <span class="token operator">!=</span> ch<span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=95></td><td><pre>		cache <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	</pre></td></tr><tr><td data-num=97></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>cache<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=98></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=99></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'H'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'M'</span><span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'L'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=101></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'C'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=102></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'J'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=103></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'N'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'G'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=104></td><td><pre>		<span class="token operator">++</span>cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=106></td><td><pre></pre></td></tr><tr><td data-num=107></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetFileType: HTML"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _HTML<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=108></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetFileType: CSS"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _CSS<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetFileType: JS"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _JS<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetFileType: PNG"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _PNG<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=111></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=113></td><td><pre></pre></td></tr><tr><td data-num=114></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=115></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=119></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response404: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=121></td><td><pre></pre></td></tr><tr><td data-num=122></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=123></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 400 BAD REQUEST\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response400: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=129></td><td><pre></pre></td></tr><tr><td data-num=130></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=131></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=132></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre></pre></td></tr><tr><td data-num=134></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=137></td><td><pre></pre></td></tr><tr><td data-num=138></td><td><pre>   <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=140></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200_NF: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=142></td><td><pre></pre></td></tr><tr><td data-num=143></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=144></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token keyword">char</span> body<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>	i32 bodyLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre></pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre></pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>	MYSQL_RES<span class="token operator">*</span> res <span class="token operator">=</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>   	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=159></td><td><pre>   	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=160></td><td><pre>      	MYSQL_ROW row<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>      	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>row <span class="token operator">=</span> <span class="token function">mysql_fetch_row</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=162></td><td><pre>	  	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=163></td><td><pre>            <span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"%s:%s:%s:%s,"</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=164></td><td><pre>            <span class="token function">strcat</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>	  	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=166></td><td><pre>      	<span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>   	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=168></td><td><pre>   	<span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre>	<span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>	</pre></td></tr><tr><td data-num=171></td><td><pre>	bodyLen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>   	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"Content-Length: %d\r\n\r\n"</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre></pre></td></tr><tr><td data-num=175></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=176></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=177></td><td><pre>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=179></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=180></td><td><pre>		<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>body<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=182></td><td><pre>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=184></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=185></td><td><pre></pre></td></tr><tr><td data-num=186></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=187></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre>	</pre></td></tr><tr><td data-num=190></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=191></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=197></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=198></td><td><pre>		<span class="token keyword">case</span> _HTML<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=199></td><td><pre>		<span class="token keyword">case</span> _CSS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre>		<span class="token keyword">case</span> _JS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=201></td><td><pre>		<span class="token keyword">case</span> _PNG<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>	</pre></td></tr><tr><td data-num=208></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=210></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=212></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=213></td><td><pre>		FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre>		i32 c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre></pre></td></tr><tr><td data-num=216></td><td><pre>		resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=217></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=218></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=219></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=220></td><td><pre>				<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error. reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=222></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"I/O error when reading"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=223></td><td><pre>		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"End of file reached successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=224></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>	<span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=226></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=227></td><td><pre></pre></td></tr><tr><td data-num=228></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=229></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=230></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./docs/database"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=231></td><td><pre>		<span class="token function">Response200_DB</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./docs/api"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=233></td><td><pre>		<span class="token function">Response200_NF</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=234></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response200</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=235></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=236></td><td><pre></pre></td></tr><tr><td data-num=237></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">,</span>i32 i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=238></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=239></td><td><pre>    <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>    <span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=241></td><td><pre>    i32 j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre>    u32 urlSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre></pre></td></tr><tr><td data-num=244></td><td><pre>    <span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=245></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>urlSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=247></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=248></td><td><pre>        url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>        <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=251></td><td><pre>    url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre></pre></td></tr><tr><td data-num=254></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Request Header:"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>    <span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=256></td><td><pre>    <span class="token keyword">do</span></pre></td></tr><tr><td data-num=257></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=258></td><td><pre>        len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre>        <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=260></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=261></td><td><pre></pre></td></tr><tr><td data-num=262></td><td><pre>    <span class="token comment">/* 通过定位?号来处理url */</span></pre></td></tr><tr><td data-num=263></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=264></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=265></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=266></td><td><pre>        <span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=267></td><td><pre>        <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Position ? Request Path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=268></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=269></td><td><pre>    <span class="token function">sprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./%s/%s"</span><span class="token punctuation">,</span>_ROOTDIR<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=270></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Real Path: "</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre></pre></td></tr><tr><td data-num=272></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"GetMethod Response"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=273></td><td><pre>    <span class="token comment">/* 返回响应报文 */</span></pre></td></tr><tr><td data-num=274></td><td><pre>    <span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=275></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=276></td><td><pre></pre></td></tr><tr><td data-num=277></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=278></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=279></td><td><pre>    i32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=280></td><td><pre>    <span class="token keyword">char</span> contentLength<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre></pre></td></tr><tr><td data-num=282></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"Request Header:"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=283></td><td><pre>    <span class="token keyword">do</span></pre></td></tr><tr><td data-num=284></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=285></td><td><pre>        len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=286></td><td><pre>        <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=287></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=288></td><td><pre>            <span class="token function">strcpy</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">strchr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token char">':'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=289></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=290></td><td><pre></pre></td></tr><tr><td data-num=291></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">_stoi</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=292></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=293></td><td><pre>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"PostMethod: GetLine() Error Not have body content\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=294></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=295></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=296></td><td><pre></pre></td></tr><tr><td data-num=297></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"PostMethod Response"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=298></td><td><pre>    <span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=299></td><td><pre>    <span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=300></td><td><pre>    <span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=301></td><td><pre>    <span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=302></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_nickname <span class="token operator">=</span> nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=303></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_email <span class="token operator">=</span> email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=304></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_content <span class="token operator">=</span> content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=305></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_createat <span class="token operator">=</span> createat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=306></td><td><pre></pre></td></tr><tr><td data-num=307></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=308></td><td><pre>    <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=309></td><td><pre>        <span class="token operator">*</span>p_nickname <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=310></td><td><pre>        <span class="token operator">++</span>p_nickname<span class="token punctuation">;</span> <span class="token operator">++</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=311></td><td><pre>    <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=312></td><td><pre></pre></td></tr><tr><td data-num=313></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_email<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=314></td><td><pre>        <span class="token operator">*</span>p_email <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=315></td><td><pre></pre></td></tr><tr><td data-num=316></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_content<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=317></td><td><pre>        <span class="token operator">*</span>p_content <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=318></td><td><pre></pre></td></tr><tr><td data-num=319></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_createat<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=320></td><td><pre>        <span class="token operator">*</span>p_createat <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=321></td><td><pre></pre></td></tr><tr><td data-num=322></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=323></td><td><pre>    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"body: %s:%s:%s:%s\n"</span><span class="token punctuation">,</span>nickname<span class="token punctuation">,</span>email<span class="token punctuation">,</span>content<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=324></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=325></td><td><pre></pre></td></tr><tr><td data-num=326></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">Element</span> el<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=327></td><td><pre>    MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=328></td><td><pre></pre></td></tr><tr><td data-num=329></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>el<span class="token punctuation">,</span><span class="token char">'\0'</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=330></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>tablename<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=331></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>nickname<span class="token punctuation">,</span>nickname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=332></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>email<span class="token punctuation">,</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=333></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>content<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=334></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>createat<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=335></td><td><pre>    <span class="token function">TableInsert</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token operator">&amp;</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=336></td><td><pre>    <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=337></td><td><pre></pre></td></tr><tr><td data-num=338></td><td><pre>    <span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token string">"./docs/api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=339></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=340></td><td><pre></pre></td></tr><tr><td data-num=341></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=342></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=343></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=344></td><td><pre>	<span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=345></td><td><pre>	u32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>bufSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=346></td><td><pre></pre></td></tr><tr><td data-num=347></td><td><pre>	len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=348></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=349></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=350></td><td><pre>		i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=351></td><td><pre>		u32 methodSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=352></td><td><pre></pre></td></tr><tr><td data-num=353></td><td><pre>		<span class="token comment">/* 获取请求的method */</span></pre></td></tr><tr><td data-num=354></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>methodSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=355></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=356></td><td><pre>			method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=357></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=358></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=359></td><td><pre>		method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=360></td><td><pre>		</pre></td></tr><tr><td data-num=361></td><td><pre>		<span class="token comment">/* 处理对应的方法 */</span></pre></td></tr><tr><td data-num=362></td><td><pre>		<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=363></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=364></td><td><pre>			<span class="token keyword">case</span> _GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=365></td><td><pre>			<span class="token keyword">case</span> _POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=366></td><td><pre>			<span class="token keyword">case</span> _PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=367></td><td><pre>			<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=368></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=369></td><td><pre>				<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=370></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"warning! could not accept %s"</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=371></td><td><pre>				<span class="token keyword">do</span></pre></td></tr><tr><td data-num=372></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=373></td><td><pre>					len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=374></td><td><pre>					<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=375></td><td><pre>				<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=376></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=377></td><td><pre>		<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=378></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=379></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response400</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=380></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>httpserver.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>MAXCLIENTS<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>i32 thread_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">void</span> <span class="token function">MainExit</span><span class="token punctuation">(</span>i32 sig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"\nMainEixt start"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	</pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> thread_index<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">pthread_cancel</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	</pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token string">"MainEixt end"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">HttpMain</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	i32 accept_fd <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token function">HttpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">signal</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=42></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=48></td><td><pre>		i32 accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>		i32 socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre></pre></td></tr><tr><td data-num=52></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>		accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=55></td><td><pre>	</pre></td></tr><tr><td data-num=56></td><td><pre>		<span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		<span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token function">pthread_attr_setdetachstate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span>PTHREAD_CREATE_DETACHED<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>thread_index<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>HttpMain<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>		thread_index <span class="token operator">=</span> <span class="token punctuation">(</span>thread_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> MAXCLIENTS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h2 id=服务器进程的日志监听模式><a class=anchor href=#服务器进程的日志监听模式>#</a> 服务器进程的日志监听模式</h2><p>额外使用了C语言的可变参数列表库来编写日志监听模式，和不干涉最后项目成品的预处理阶段的Debug调试代码的标准化(就是可通过定义标识符让代码可用，当没有标识符时编译预处理阶段会将Debug调试代码全部去除)。</p><h3 id=基本实现与结构优化><a class=anchor href=#基本实现与结构优化>#</a> 基本实现与结构优化</h3><details class=info><summary>_clibs.h</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;signal.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdarg.h></span></span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i16</span> <span class="token expression"><span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i32</span> <span class="token expression"><span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i64</span> <span class="token expression"><span class="token keyword">long</span></span></span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u16</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u32</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u64</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">long</span></span></span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ROOTDIR</span> <span class="token string">"docs"</span></span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_LOGPATH</span> <span class="token string">"./_httpserver.log"</span></span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_DEBUG</span></span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre>i32 <span class="token function">_pow</span><span class="token punctuation">(</span>i32 n<span class="token punctuation">,</span>i32 m<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>i32 <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">void</span> <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> source<span class="token punctuation">,</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>_clibs.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 <span class="token function">_pow</span><span class="token punctuation">(</span>i32 n<span class="token punctuation">,</span>i32 m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> m<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> n <span class="token operator">*=</span> n<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   <span class="token keyword">return</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>i32 <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>   i32 left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>   i32 ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>str1<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">++</span>left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>   right <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span>right <span class="token operator">>=</span> left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=18></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>      i32 t <span class="token operator">=</span> <span class="token punctuation">(</span>str1<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>      ans <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">*</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>      <span class="token operator">--</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>   <span class="token keyword">return</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		va_list args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token keyword">char</span><span class="token operator">*</span> strs <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=38></td><td><pre>			<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>strs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token keyword">void</span> <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> filename<span class="token punctuation">,</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	FILE<span class="token operator">*</span> source <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">"a+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> source<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>	va_list args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token constant">__TIME__</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">":\n"</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token keyword">char</span><span class="token operator">*</span> strs <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>		<span class="token function">fputs</span><span class="token punctuation">(</span>strs<span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token function">fclose</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>database.h</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql/mysql.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HOST</span> <span class="token string">"127.0.0.1"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">USER</span> <span class="token string">"root"</span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PASSWORD</span> <span class="token string">"@Killl611"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DBNAME</span> <span class="token string">"CommentSystem"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Element</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">char</span> tablename<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Element</span><span class="token operator">*</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=22></td><td><pre>MYSQL_RES<span class="token operator">*</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>MYSQL_RES<span class="token operator">*</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>database.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">mysql_init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_init() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_init() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/*		fprintf(stderr,"DatabaseConnect: mysql_init() Error\n"); */</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	</pre></td></tr><tr><td data-num=14></td><td><pre>	mysql <span class="token operator">=</span> <span class="token function">mysql_real_connect</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>HOST<span class="token punctuation">,</span>USER<span class="token punctuation">,</span>PASSWORD<span class="token punctuation">,</span>DBNAME<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_real_connect() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_real_connect() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment">/*		fprintf(stderr,"DatabaseConnect: mysql_real_connect() Error\n"); */</span></pre></td></tr><tr><td data-num=20></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token keyword">return</span> mysql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token function">mysql_close</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Element</span><span class="token operator">*</span> el<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	</pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"INSERT INTO %s(NickName,Email,Content,CreateAt)\nVALUES('%s','%s','%s','%s')"</span><span class="token punctuation">,</span>el<span class="token operator">-></span>tablename<span class="token punctuation">,</span>el<span class="token operator">-></span>nickname<span class="token punctuation">,</span>el<span class="token operator">-></span>email<span class="token punctuation">,</span>el<span class="token operator">-></span>content<span class="token punctuation">,</span>el<span class="token operator">-></span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database Query:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database Query:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"TableInsert: mysql_query() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"TableInsert: mysql_query() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"TableInsert: mysql_query() Error.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TableInsert Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TableInsert Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		</pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre>MYSQL_RES<span class="token operator">*</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> tableName<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"SELECT * FROM %s ORDER BY CreateAT ASC"</span><span class="token punctuation">,</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement: mysql_query() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement: mysql_query() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre><span class="token comment">/*		fprintf(stderr,"GetTableElement: mysql_query() Error"); */</span></pre></td></tr><tr><td data-num=64></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement Start\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement Start...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token keyword">return</span> <span class="token function">mysql_store_result</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre></pre></td></tr><tr><td data-num=72></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>MYSQL_RES<span class="token operator">*</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=73></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token function">mysql_free_result</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement End\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement End\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.h</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;netdb.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;pthread.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXCLIENTS</span> <span class="token expression"><span class="token number">10</span></span></span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">FileType</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	_HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>	_CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=18></td><td><pre>	_JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>	_PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestMethod</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	_GET <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=25></td><td><pre>	_POST <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>	_PUT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token class-name">pthread_mutex_t</span> mutex<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">int</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>	i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: socket() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: socket() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">/*		fprintf(stderr,"SocketConstruct: socket() Error\n"); */</span></pre></td></tr><tr><td data-num=13></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	u32 server_addrSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	</pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token comment">/* Initial port */</span></pre></td></tr><tr><td data-num=25></td><td><pre>	i32 opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	u32 optSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>optSize<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: bind() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: bind() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token comment">/*		fprintf(stderr,"SocketConstruct: bind() Error\n"); */</span></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: listen() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: listen() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token comment">/*		fprintf(stderr,"SocketConstruct: listen() Error\n"); */</span></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	</pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=49></td><td><pre></pre></td></tr><tr><td data-num=50></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetLine</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=51></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	i32 index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>		i32 len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=59></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre>			buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=64></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=65></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=66></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=67></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: read Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: read Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre><span class="token comment">/*				fprintf(stderr,"GetLine: read Error\n"); */</span></pre></td></tr><tr><td data-num=70></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=73></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Client Closed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Client Closed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre><span class="token comment">/*				fprintf(stdout,"Client Closed.\n"); */</span></pre></td></tr><tr><td data-num=76></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre>			index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre>			</pre></td></tr><tr><td data-num=82></td><td><pre>	buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>	<span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=84></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=85></td><td><pre></pre></td></tr><tr><td data-num=86></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=87></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=88></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=91></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'O'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=93></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'G'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'E'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=94></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'U'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=95></td><td><pre>		<span class="token operator">++</span>method<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=97></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=98></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=99></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: POST\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: POST\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=101></td><td><pre>		<span class="token keyword">return</span> _POST<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=102></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=103></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=104></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=105></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=107></td><td><pre>		<span class="token keyword">return</span> _GET<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=108></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=111></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: PUT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: PUT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=113></td><td><pre>		<span class="token keyword">return</span> _PUT<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=117></td><td><pre></pre></td></tr><tr><td data-num=118></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> ostr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=119></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=120></td><td><pre>	<span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> ch <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token operator">*</span> cache <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>	</pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>ostr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">NULL</span> <span class="token operator">!=</span> ch<span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=126></td><td><pre>		cache <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	</pre></td></tr><tr><td data-num=128></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>cache<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=129></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'H'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'M'</span><span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'L'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=132></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'C'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=133></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'J'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=134></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'N'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'G'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=135></td><td><pre>		<span class="token operator">++</span>cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=137></td><td><pre></pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=139></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=140></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: HTML\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: HTML\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=142></td><td><pre>		<span class="token keyword">return</span> _HTML<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=143></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=146></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: CSS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: CSS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=148></td><td><pre>		<span class="token keyword">return</span> _CSS<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=149></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=152></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: JS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=153></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: JS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token keyword">return</span> _JS<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=155></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=158></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: PNG\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: PNG\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=160></td><td><pre>		<span class="token keyword">return</span> _PNG<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=161></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=162></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=164></td><td><pre></pre></td></tr><tr><td data-num=165></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=166></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=169></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=170></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=171></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response404: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response404: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre><span class="token comment">/*		fprintf(stderr,"Response404: send() Error.reason: %s\n",strerror(errno)); */</span></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=175></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=176></td><td><pre></pre></td></tr><tr><td data-num=177></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=178></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=179></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 400 BAD REQUEST\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=182></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response400: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response400: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre><span class="token comment">/*		fprintf(stderr,"Response400: send() Error.reason: %s\n",strerror(errno)); */</span></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=187></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=188></td><td><pre></pre></td></tr><tr><td data-num=189></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=190></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=191></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre></pre></td></tr><tr><td data-num=193></td><td><pre>   <span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre></pre></td></tr><tr><td data-num=197></td><td><pre>   <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=198></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=199></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=200></td><td><pre>	  <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>	  <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre><span class="token comment">/*      fprintf(stderr,"Response200_NF: send() Error.reason: %s\n",strerror(errno)); */</span></pre></td></tr><tr><td data-num=203></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=204></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=205></td><td><pre></pre></td></tr><tr><td data-num=206></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=207></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=208></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>	<span class="token keyword">char</span> body<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=211></td><td><pre>	i32 bodyLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=215></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=216></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=217></td><td><pre></pre></td></tr><tr><td data-num=218></td><td><pre>	<span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre>	MYSQL_RES<span class="token operator">*</span> res <span class="token operator">=</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>   	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=222></td><td><pre>   	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=223></td><td><pre>      	MYSQL_ROW row<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=224></td><td><pre>      	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>row <span class="token operator">=</span> <span class="token function">mysql_fetch_row</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=225></td><td><pre>	  	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=226></td><td><pre>			<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"%s:%s:%s:%s,"</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=227></td><td><pre>      	   	<span class="token function">strcat</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=228></td><td><pre>	  	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=229></td><td><pre>      	<span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=230></td><td><pre>   	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=231></td><td><pre>   	<span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>	<span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=233></td><td><pre>	</pre></td></tr><tr><td data-num=234></td><td><pre>	bodyLen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre>   	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"Content-Length: %d\r\n\r\n"</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=236></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=242></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre><span class="token comment">/*    	fprintf(stderr,"Response200_DB: send() Error.reason: %s\n",strerror(errno)); */</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=246></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=247></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=248></td><td><pre><span class="token comment">/*		strcat(buf,body); */</span></pre></td></tr><tr><td data-num=249></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>body<span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=250></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=251></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre><span class="token comment">/*    		fprintf(stderr,"Response200_DB: send() Error.reason: %s\n",strerror(errno)); */</span></pre></td></tr><tr><td data-num=254></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=255></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=256></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=257></td><td><pre></pre></td></tr><tr><td data-num=258></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=259></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=260></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=261></td><td><pre>	</pre></td></tr><tr><td data-num=262></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=263></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=264></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=265></td><td><pre></pre></td></tr><tr><td data-num=266></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=268></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=269></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=270></td><td><pre>		<span class="token keyword">case</span> _HTML<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=271></td><td><pre>		<span class="token keyword">case</span> _CSS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=272></td><td><pre>		<span class="token keyword">case</span> _JS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=273></td><td><pre>		<span class="token keyword">case</span> _PNG<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=274></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=275></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=276></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=277></td><td><pre>	<span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=278></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=279></td><td><pre>	</pre></td></tr><tr><td data-num=280></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=282></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=283></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=285></td><td><pre><span class="token comment">/*    	fprintf(stderr,"Response200: send() Error.reason: %s\n",strerror(errno)); */</span></pre></td></tr><tr><td data-num=286></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=287></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=288></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=289></td><td><pre>		FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=290></td><td><pre>		i32 c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=291></td><td><pre></pre></td></tr><tr><td data-num=292></td><td><pre>		resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=293></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=294></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=295></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=296></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=297></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=298></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=299></td><td><pre><span class="token comment">/*				fprintf(stderr,"Response200: send() Error. reason: %s\n",strerror(errno)); */</span></pre></td></tr><tr><td data-num=300></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=301></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=302></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=303></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=304></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Response200: I/O error when reading\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=305></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Response200: I/O error when reading\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=306></td><td><pre><span class="token comment">/*			fprintf(stdout,"Response200: I/O error when reading\n"); */</span> </pre></td></tr><tr><td data-num=307></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=308></td><td><pre>		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=309></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=310></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Resopnse200: End of file reached successfully\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=311></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Resopnse200: End of file reached successfully\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=312></td><td><pre><span class="token comment">/*			fprintf(stdout,"Resopnse200: End of file reached successfully"); */</span> </pre></td></tr><tr><td data-num=313></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=314></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=315></td><td><pre>	<span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=316></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=317></td><td><pre></pre></td></tr><tr><td data-num=318></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=319></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=320></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./docs/database"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=321></td><td><pre>		<span class="token function">Response200_DB</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=322></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./docs/api"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=323></td><td><pre>		<span class="token function">Response200_NF</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=324></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response200</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=325></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=326></td><td><pre></pre></td></tr><tr><td data-num=327></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">,</span>i32 i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=328></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=329></td><td><pre>	<span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=330></td><td><pre>	<span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=331></td><td><pre>	i32 j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=332></td><td><pre>	u32 urlSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=333></td><td><pre>	</pre></td></tr><tr><td data-num=334></td><td><pre>   	<span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=335></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=336></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>urlSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=337></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=338></td><td><pre>		url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=339></td><td><pre>		<span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=340></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=341></td><td><pre>   	url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=342></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=343></td><td><pre>   	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=344></td><td><pre></pre></td></tr><tr><td data-num=345></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=346></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=347></td><td><pre>   	<span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=348></td><td><pre>   	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=349></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=350></td><td><pre>		len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=351></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=352></td><td><pre>      	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=353></td><td><pre>   	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=354></td><td><pre></pre></td></tr><tr><td data-num=355></td><td><pre>   	<span class="token comment">/* 通过定位?号来处理url */</span></pre></td></tr><tr><td data-num=356></td><td><pre>   	<span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=357></td><td><pre>   	<span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=358></td><td><pre>   	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=359></td><td><pre>		<span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=360></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Position ? Request Path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=361></td><td><pre>     	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Position ? Request Path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=362></td><td><pre>   	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=363></td><td><pre>   	<span class="token function">sprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./%s/%s"</span><span class="token punctuation">,</span>_ROOTDIR<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=364></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Real Path: "</span><span class="token punctuation">,</span>path<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=365></td><td><pre>   	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Real Path: "</span><span class="token punctuation">,</span>path<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=366></td><td><pre></pre></td></tr><tr><td data-num=367></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethod Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=368></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethod Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=369></td><td><pre>   	<span class="token comment">/* 返回响应报文 */</span></pre></td></tr><tr><td data-num=370></td><td><pre>   	<span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=371></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=372></td><td><pre></pre></td></tr><tr><td data-num=373></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=374></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=375></td><td><pre>    i32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=376></td><td><pre>    <span class="token keyword">char</span> contentLength<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=377></td><td><pre></pre></td></tr><tr><td data-num=378></td><td><pre>    <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=379></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=380></td><td><pre>    <span class="token keyword">do</span></pre></td></tr><tr><td data-num=381></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=382></td><td><pre>        len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=383></td><td><pre>        <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=384></td><td><pre>        <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=385></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=386></td><td><pre>            <span class="token function">strcpy</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">strchr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token char">':'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=387></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=388></td><td><pre></pre></td></tr><tr><td data-num=389></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">_stoi</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=390></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=391></td><td><pre>        <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod: GetLine() Error Not have body content\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=392></td><td><pre>        <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod: GetLine() Error Not have body content\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=393></td><td><pre>    <span class="token comment">/*		fprintf(stderr,"PostMethod: GetLine() Error Not have body content\n"); */</span></pre></td></tr><tr><td data-num=394></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=395></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=396></td><td><pre></pre></td></tr><tr><td data-num=397></td><td><pre>    <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod Response....\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=398></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod Response....\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=399></td><td><pre>    <span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=400></td><td><pre>    <span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=401></td><td><pre>    <span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=402></td><td><pre>    <span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=403></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_nickname <span class="token operator">=</span> nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=404></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_email <span class="token operator">=</span> email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=405></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_content <span class="token operator">=</span> content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=406></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> p_createat <span class="token operator">=</span> createat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=407></td><td><pre></pre></td></tr><tr><td data-num=408></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=409></td><td><pre>    <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=410></td><td><pre>        <span class="token operator">*</span>p_nickname <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=411></td><td><pre>        <span class="token operator">++</span>p_nickname<span class="token punctuation">;</span> <span class="token operator">++</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=412></td><td><pre>    <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=413></td><td><pre></pre></td></tr><tr><td data-num=414></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_email<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=415></td><td><pre>        <span class="token operator">*</span>p_email <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=416></td><td><pre></pre></td></tr><tr><td data-num=417></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_content<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=418></td><td><pre>        <span class="token operator">*</span>p_content <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=419></td><td><pre></pre></td></tr><tr><td data-num=420></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_createat<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=421></td><td><pre>        <span class="token operator">*</span>p_createat <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=422></td><td><pre></pre></td></tr><tr><td data-num=423></td><td><pre>    <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">"body: "</span><span class="token punctuation">,</span>nickname<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>email<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>createat<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=424></td><td><pre>    <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">"body: "</span><span class="token punctuation">,</span>nickname<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>email<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>createat<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=425></td><td><pre></pre></td></tr><tr><td data-num=426></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">Element</span> el<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=427></td><td><pre>    MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=428></td><td><pre></pre></td></tr><tr><td data-num=429></td><td><pre>    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>el<span class="token punctuation">,</span><span class="token char">'\0'</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=430></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>tablename<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=431></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>nickname<span class="token punctuation">,</span>nickname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=432></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>email<span class="token punctuation">,</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=433></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>content<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=434></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>createat<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=435></td><td><pre>    <span class="token function">TableInsert</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token operator">&amp;</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=436></td><td><pre>    <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=437></td><td><pre></pre></td></tr><tr><td data-num=438></td><td><pre>    <span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token string">"./docs/api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=439></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=440></td><td><pre></pre></td></tr><tr><td data-num=441></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=442></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=443></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=444></td><td><pre>	<span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=445></td><td><pre>	u32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>bufSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=446></td><td><pre></pre></td></tr><tr><td data-num=447></td><td><pre>	len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=448></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=449></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=450></td><td><pre>		i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=451></td><td><pre>		u32 methodSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=452></td><td><pre></pre></td></tr><tr><td data-num=453></td><td><pre>		<span class="token comment">/* 获取请求的method */</span></pre></td></tr><tr><td data-num=454></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>methodSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=455></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=456></td><td><pre>			method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=457></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=458></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=459></td><td><pre>		method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=460></td><td><pre>		</pre></td></tr><tr><td data-num=461></td><td><pre>		<span class="token comment">/* 处理对应的方法 */</span></pre></td></tr><tr><td data-num=462></td><td><pre>		<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=463></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=464></td><td><pre>			<span class="token keyword">case</span> _GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=465></td><td><pre>			<span class="token keyword">case</span> _POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=466></td><td><pre>			<span class="token keyword">case</span> _PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=467></td><td><pre>			<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=468></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=469></td><td><pre>				<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=470></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"warning! could not accept "</span><span class="token punctuation">,</span>method<span class="token punctuation">,</span><span class="token string">"method\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=471></td><td><pre>				<span class="token keyword">do</span></pre></td></tr><tr><td data-num=472></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=473></td><td><pre>					len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=474></td><td><pre>					<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=475></td><td><pre>					<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=476></td><td><pre>				<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=477></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=478></td><td><pre>		<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=479></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=480></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response400</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=481></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>httpserver.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>MAXCLIENTS<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>i32 thread_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>FILE<span class="token operator">*</span> source <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">void</span> <span class="token function">MainExit</span><span class="token punctuation">(</span>i32 sig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\nMainEixt start\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\nMainEixt start\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	</pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> thread_index<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">pthread_cancel</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	</pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"MainEixt end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"MainEixt end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">HttpMain</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	i32 accept_fd <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token function">HttpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=40></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=47></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=51></td><td><pre></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>		i32 accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>		i32 socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>		<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre></pre></td></tr><tr><td data-num=61></td><td><pre>		accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	</pre></td></tr><tr><td data-num=65></td><td><pre>		<span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>		<span class="token function">pthread_attr_setdetachstate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span>PTHREAD_CREATE_DETACHED<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>		<span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>thread_index<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>HttpMain<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>		thread_index <span class="token operator">=</span> <span class="token punctuation">(</span>thread_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> MAXCLIENTS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h3 id=为日志写操作添加锁操作><a class=anchor href=#为日志写操作添加锁操作>#</a> 为日志写操作添加锁操作</h3><p>在<code>_clibs.h</code>添加了互斥锁(mutex1)，<code>http.h</code>中的mutex改为了mutex2。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">void</span> <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> filename<span class="token punctuation">,</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    FILE<span class="token operator">*</span> source <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">"a+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> source<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>    va_list args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token constant">__TIME__</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">":\n"</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>        <span class="token keyword">char</span><span class="token operator">*</span> strs <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>        <span class="token function">fputs</span><span class="token punctuation">(</span>strs<span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>        <span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token function">fclose</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=动态库与静态库的制作><a class=anchor href=#动态库与静态库的制作>#</a> 动态库与静态库的制作</h2><p>确保已安装了make编译工具，安装命令 - <code>yum install make</code></p><p>MySQL头文件路径查看 - <code>mysql_config --cflags</code></p><p>MySQL库文件路径查看 - <code>mysql_config --libs</code></p><h3 id=静态库><a class=anchor href=#静态库>#</a> 静态库</h3><figure class="highlight makefile"><figcaption data-lang=makefile><span>makefile</span></figcaption><table><tr><td data-num=1></td><td><pre>OP<span class="token operator">=</span>gcc</pre></td></tr><tr><td data-num=2></td><td><pre>AP1<span class="token operator">=</span>-Wall</pre></td></tr><tr><td data-num=3></td><td><pre>AP2<span class="token operator">=</span>-g</pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token target symbol">all</span><span class="token punctuation">:</span> httpserver</pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">#Static</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token target symbol">httpserver</span><span class="token punctuation">:</span> httpserver.c http.h http.c database.h database.c _clibs.h _clibs.c</pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> -c _clibs.c</pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> -c database.c</pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> -c http.c</pre></td></tr><tr><td data-num=12></td><td><pre>    ar rcs lib_slibs.a _clibs.o database.o http.o</pre></td></tr><tr><td data-num=13></td><td><pre>    rm -rf _clibs.o database.o http.o</pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP2<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>MSPATH<span class="token punctuation">)</span> -pthread httpserver.c lib_slibs.a -o httpserver</pre></td></tr></table></figure><h3 id=动态库><a class=anchor href=#动态库>#</a> 动态库</h3><figure class="highlight makefile"><figcaption data-lang=makefile><span>makefile</span></figcaption><table><tr><td data-num=1></td><td><pre>OP<span class="token operator">=</span>gcc</pre></td></tr><tr><td data-num=2></td><td><pre>AP1<span class="token operator">=</span>-Wall</pre></td></tr><tr><td data-num=3></td><td><pre>AP2<span class="token operator">=</span>-g</pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>MYSQL<span class="token operator">=</span><span class="token variable">$$</span><span class="token punctuation">(</span>mysql_config --cflags --libs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre>LIBPATH<span class="token operator">=</span>-L. -l_slibs</pre></td></tr><tr><td data-num=7></td><td><pre>DM<span class="token operator">=</span>-fPIC -shared</pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token target symbol">all</span><span class="token punctuation">:</span> httpserver</pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">#Dynamic</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token target symbol">httpserver</span><span class="token punctuation">:</span> httpserver.c http.h http.c database.h database.c _clibs.h _clibs.c</pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>DM<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>MYSQL<span class="token punctuation">)</span> http.c database.c _clibs.c -o lib_slibs.so</pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token variable">$</span><span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>AP2<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>LIBPATH<span class="token punctuation">)</span> -pthread httpserver.c -o httpserver</pre></td></tr></table></figure><p>设置完后，返回root根目录后输入指令<code>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/root/httpserver</code></p><h2 id=服务器进程的高性能化处理><a class=anchor href=#服务器进程的高性能化处理>#</a> 服务器进程的高性能化处理</h2><h3 id=埋下的坑2的解决><a class=anchor href=#埋下的坑2的解决>#</a> 埋下的坑2的解决</h3><p>数据库中的时间格式改为时间戳的形式。</p><p>在Linux中的MySQL数据库中</p><ul><li><p><strong>删除原来的表</strong> - <code>DROP TABLE CommentBlock;</code></p></li><li><p><strong>创建新表</strong> - JavaScript中的时间戳通常是13个字符长的整数，包括正负号</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> CommentBlock<span class="token punctuation">(</span></pre></td></tr><tr><td data-num=2></td><td><pre>    NickName <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>    Email <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>    Content <span class="token keyword">TEXT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>    CreateAt <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li></ul><p>在<code>comments.js</code>文件中</p><ul><li><p>contentAppend函数里面的格式化时间的转换代码变为时间戳的转换代码</p><figure class="highlight javascript"><figcaption data-lang=javascript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">var oldTimeStamp = new Date(creatat);</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">var newTimeStamp = new Date(Date.now());</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">var second = Math.floor(Date.now() - creatat) / 1000;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">var minutes = Math.floor(second / 60);</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">var hours = Math.floor(minutes / 60);</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">var days = Math.floor(hours / 60);</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">if(0 != days)&#123; timeSpend.innerText = "" + days + " days ago"; &#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">else if(0 != hours)&#123; timeSpend.innerText = "" + hours + " hours ago"; &#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">else&#123; timeSpend.innerText = "" + minutes + " minutes ago"; &#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">var</span> timeSpace <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> creatat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">var</span> days <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">24</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">var</span> f_days <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">var</span> hours <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">var</span> f_hours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">var</span> minutes <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">var</span> f_minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_days<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_days <span class="token operator">+</span> <span class="token string">" days ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_hours <span class="token operator">+</span> <span class="token string">" hours ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">else</span><span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_minutes <span class="token operator">+</span> <span class="token string">" minutes ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>buttonClick函数里面的时间数据变为时间戳数据</p><figure class="highlight javascript"><figcaption data-lang=javascript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">var curTime = new Date(Date.now());</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">var _year = curTime.getFullYear();</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">var _month = (curTime.getMonth() + 1).toString().padStart(2, '0');</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">var _day = curTime.getDate().toString().padStart(2, '0');</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">var _hours = curTime.getHours().toString().padStart(2, '0');</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">var _minutes = curTime.getMinutes().toString().padStart(2, '0');</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">var _seconds = curTime.getSeconds().toString().padStart(2, '0');</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">var timeFormat = _year + "-" + _month + "-" + _day + " " +</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">                    _hours + ":" + _minutes + ":" + _seconds;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">var</span> textsContent <span class="token operator">=</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span>texts<span class="token punctuation">,</span>texts<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">var</span> curTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">/*	var data = nickNameValue + ":" + email.value + ":" + textsContent + ":" + timeFormat; */</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">var</span> data <span class="token operator">=</span> nickNameValue <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> email<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> textsContent <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> curTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">/*******************/</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token function">contentAppend</span><span class="token punctuation">(</span>newLabels<span class="token punctuation">,</span>nickNameValue<span class="token punctuation">,</span>textsContent<span class="token punctuation">,</span>curTime<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li></ul><h3 id=埋下的坑1的解决><a class=anchor href=#埋下的坑1的解决>#</a> 埋下的坑1的解决</h3><details class=info><summary>_clibs.c</summary><div><p>额外进行了变量名/函数名，变量类型/函数类型/参数类型的修正。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 <span class="token function">_pow</span><span class="token punctuation">(</span>i32 n<span class="token punctuation">,</span>i32 m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> m<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> n <span class="token operator">*=</span> n<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token keyword">return</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>i32 <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	i32 left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	i32 ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">++</span>left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>	right <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>right <span class="token operator">>=</span> left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		i32 t <span class="token operator">=</span> <span class="token punctuation">(</span>strs<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		ans <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">*</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token operator">--</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">return</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		va_list args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token keyword">char</span><span class="token operator">*</span> strs <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=38></td><td><pre>			<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>strs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token keyword">void</span> <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> filename<span class="token punctuation">,</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	FILE<span class="token operator">*</span> source <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">"a+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> source<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre>	va_list args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>	i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token constant">__TIME__</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">":\n"</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>		<span class="token keyword">char</span><span class="token operator">*</span> strs <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token function">fputs</span><span class="token punctuation">(</span>strs<span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>		<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token function">fclose</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>	<span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>database.c</summary><div><p>额外进行了变量名/函数名，变量类型/函数类型/参数类型的修正。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">mysql_init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_init() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_init() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	</pre></td></tr><tr><td data-num=13></td><td><pre>	mysql <span class="token operator">=</span> <span class="token function">mysql_real_connect</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>HOST<span class="token punctuation">,</span>USER<span class="token punctuation">,</span>PASSWORD<span class="token punctuation">,</span>DBNAME<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_real_connect() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_real_connect() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">return</span> mysql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token function">mysql_close</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Close\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Close\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Element</span><span class="token operator">*</span> el<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>	</pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"INSERT INTO %s(NickName,Email,Content,CreateAt)\nVALUES('%s','%s','%s','%s')"</span><span class="token punctuation">,</span>el<span class="token operator">-></span>tablename<span class="token punctuation">,</span>el<span class="token operator">-></span>nickname<span class="token punctuation">,</span>el<span class="token operator">-></span>email<span class="token punctuation">,</span>el<span class="token operator">-></span>content<span class="token punctuation">,</span>el<span class="token operator">-></span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database Query:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database Query:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"TableInsert: mysql_query() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"TableInsert: mysql_query() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TableInsert Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TableInsert Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		</pre></td></tr><tr><td data-num=49></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=50></td><td><pre></pre></td></tr><tr><td data-num=51></td><td><pre>MYSQL_RES<span class="token operator">*</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> tableName<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"SELECT * FROM %s ORDER BY CreateAT ASC"</span><span class="token punctuation">,</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement: mysql_query() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement: mysql_query() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement Start\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement Start...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token keyword">return</span> <span class="token function">mysql_store_result</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=67></td><td><pre></pre></td></tr><tr><td data-num=68></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>MYSQL_RES<span class="token operator">*</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=69></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token function">mysql_free_result</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement End\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement End\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.c</summary><div><p>添加了<code>GetRequestPath</code>函数，用于将不同前端请求分隔开。</p><p>还额外进行了变量名/函数名，变量类型/函数类型/参数类型的修正，以及部分函数方法的算法逻辑优化。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token keyword">const</span> u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>	i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: socket() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: socket() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	u32 server_addrSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	</pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token comment">/* Initial port */</span></pre></td></tr><tr><td data-num=24></td><td><pre>	i32 opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	u32 optSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>optSize<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: bind() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: bind() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: listen() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: listen() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetLine</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	i32 index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=52></td><td><pre>		i32 len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=54></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=55></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre>			buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=63></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: recv() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: recv() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=67></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=68></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: Client Closed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: Client Closed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre>			index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=75></td><td><pre>	buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=78></td><td><pre></pre></td></tr><tr><td data-num=79></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=80></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=81></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=83></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=84></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'O'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'G'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'E'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=87></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'U'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=88></td><td><pre>		<span class="token operator">++</span>method<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=91></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=92></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: POST\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: POST\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=94></td><td><pre>		<span class="token keyword">return</span> _POST<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=95></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=97></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=98></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=100></td><td><pre>		<span class="token keyword">return</span> _GET<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=102></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=103></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=104></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: PUT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: PUT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token keyword">return</span> _PUT<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=107></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=108></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=112></td><td><pre></pre></td></tr><tr><td data-num=113></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> ostr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=114></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> ch <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token operator">*</span> cache <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>	</pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>ostr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">NULL</span> <span class="token operator">!=</span> ch<span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=121></td><td><pre>		cache <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	</pre></td></tr><tr><td data-num=123></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>cache<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=125></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'H'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'M'</span><span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'L'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'C'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=128></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'J'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=129></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'N'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'G'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token operator">++</span>cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=132></td><td><pre></pre></td></tr><tr><td data-num=133></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=135></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: HTML\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: HTML\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token keyword">return</span> _HTML<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=139></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=141></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: CSS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: CSS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=143></td><td><pre>		<span class="token keyword">return</span> _CSS<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=147></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: JS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: JS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=149></td><td><pre>		<span class="token keyword">return</span> _JS<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=152></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=153></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: PNG\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: PNG\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=155></td><td><pre>		<span class="token keyword">return</span> _PNG<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=159></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre></pre></td></tr><tr><td data-num=162></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetRequestPath</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=163></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=164></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> pd <span class="token operator">=</span> <span class="token string">"DATABASE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> pa <span class="token operator">=</span> <span class="token string">"API"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=169></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>strs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>pd <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>pd<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=171></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>pa <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>pa<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token operator">++</span>strs<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>pd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=175></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=176></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: DATABASE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: DATABASE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>		<span class="token keyword">return</span> _DATABASE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=180></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>pa<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: API\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: API\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>		<span class="token keyword">return</span> _API<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	 </pre></td></tr><tr><td data-num=189></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=192></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=196></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=197></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response404: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=198></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response404: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=201></td><td><pre></pre></td></tr><tr><td data-num=202></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=203></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 400 BAD REQUEST\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=207></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=208></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response400: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response400: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=211></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=212></td><td><pre></pre></td></tr><tr><td data-num=213></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=214></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=215></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=216></td><td><pre></pre></td></tr><tr><td data-num=217></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=218></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre></pre></td></tr><tr><td data-num=221></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=223></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=224></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_NF: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_NF: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=226></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=227></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=228></td><td><pre></pre></td></tr><tr><td data-num=229></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=230></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=231></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>	<span class="token keyword">char</span> body<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=233></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=234></td><td><pre>	i32 bodyLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre></pre></td></tr><tr><td data-num=236></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre></pre></td></tr><tr><td data-num=241></td><td><pre>	<span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre>	MYSQL_RES<span class="token operator">*</span> res <span class="token operator">=</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=244></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=245></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=246></td><td><pre>		MYSQL_ROW row<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>row <span class="token operator">=</span> <span class="token function">mysql_fetch_row</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=248></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=249></td><td><pre>			<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"%s:%s:%s:%s,"</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>			<span class="token function">strcat</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=252></td><td><pre>		<span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=253></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=254></td><td><pre>	<span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=255></td><td><pre>	<span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=256></td><td><pre>	</pre></td></tr><tr><td data-num=257></td><td><pre>	bodyLen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"Content-Length: %d\r\n\r\n"</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=259></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=260></td><td><pre></pre></td></tr><tr><td data-num=261></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=262></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=263></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=264></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=265></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=266></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=268></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=269></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=270></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>body<span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=271></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=272></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=273></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=274></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=275></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=276></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=277></td><td><pre></pre></td></tr><tr><td data-num=278></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=279></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=280></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=281></td><td><pre>	</pre></td></tr><tr><td data-num=282></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=283></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=284></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=285></td><td><pre></pre></td></tr><tr><td data-num=286></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=287></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=288></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=289></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=290></td><td><pre>		<span class="token keyword">case</span> _HTML<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=291></td><td><pre>		<span class="token keyword">case</span> _CSS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=292></td><td><pre>		<span class="token keyword">case</span> _JS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=293></td><td><pre>		<span class="token keyword">case</span> _PNG<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=294></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=295></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=296></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=297></td><td><pre>	<span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=298></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=299></td><td><pre>	</pre></td></tr><tr><td data-num=300></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=301></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=302></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=303></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=304></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=305></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=306></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=307></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=308></td><td><pre>		FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=309></td><td><pre>		i32 c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=310></td><td><pre></pre></td></tr><tr><td data-num=311></td><td><pre>		resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=312></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=313></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=314></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=315></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=316></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=317></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=318></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=319></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=320></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=321></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=322></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Response200: I/O error when reading\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=323></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Response200: I/O error when reading\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=324></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=325></td><td><pre>		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=326></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=327></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Resopnse200: End of file reached successfully\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=328></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Resopnse200: End of file reached successfully\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=329></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=330></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=331></td><td><pre>	<span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=332></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=333></td><td><pre></pre></td></tr><tr><td data-num=334></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=335></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=336></td><td><pre>	i32 path <span class="token operator">=</span> <span class="token function">GetRequestPath</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=337></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>_DATABASE <span class="token operator">==</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=338></td><td><pre>		<span class="token function">Response200_DB</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=339></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>_API <span class="token operator">==</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=340></td><td><pre>		<span class="token function">Response200_NF</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=341></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=342></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=343></td><td><pre>		<span class="token keyword">char</span> realPath<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=344></td><td><pre>		<span class="token function">sprintf</span><span class="token punctuation">(</span>realPath<span class="token punctuation">,</span><span class="token string">"./%s/%s"</span><span class="token punctuation">,</span>_ROOTDIR<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=345></td><td><pre></pre></td></tr><tr><td data-num=346></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Real Path: "</span><span class="token punctuation">,</span>realPath<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=347></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Real Path: "</span><span class="token punctuation">,</span>realPath<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=348></td><td><pre></pre></td></tr><tr><td data-num=349></td><td><pre>		<span class="token function">Response200</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>realPath<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=350></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=351></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=352></td><td><pre></pre></td></tr><tr><td data-num=353></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">,</span>i32 i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=354></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=355></td><td><pre><span class="token comment">/*	char path[64] = &#123;'\0'&#125;; */</span></pre></td></tr><tr><td data-num=356></td><td><pre>	<span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=357></td><td><pre>	i32 j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=358></td><td><pre>	u32 urlSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=359></td><td><pre>	</pre></td></tr><tr><td data-num=360></td><td><pre>	<span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=361></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=362></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>urlSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=363></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=364></td><td><pre>		url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=365></td><td><pre>		<span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=366></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=367></td><td><pre></pre></td></tr><tr><td data-num=368></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=369></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=370></td><td><pre></pre></td></tr><tr><td data-num=371></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=372></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=373></td><td><pre></pre></td></tr><tr><td data-num=374></td><td><pre>	<span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=375></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=376></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=377></td><td><pre>		len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=378></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=379></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=380></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=381></td><td><pre></pre></td></tr><tr><td data-num=382></td><td><pre>	<span class="token comment">/* 通过定位?号来处理url */</span></pre></td></tr><tr><td data-num=383></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=384></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=385></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=386></td><td><pre>		<span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=387></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Position ? Request Path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=388></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Position ? Request Path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=389></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=390></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num=391></td><td><pre><span class="token comment">	sprintf(path,"./%s/%s",_ROOTDIR,url);</span></pre></td></tr><tr><td data-num=392></td><td><pre><span class="token comment">	_LogFileWrite(_LOGPATH,3,"GetMethod: Real Path: ",path,"\n");</span></pre></td></tr><tr><td data-num=393></td><td><pre><span class="token comment">	_CallDebug(3,"GetMethod: Real Path: ",path,"\n");</span></pre></td></tr><tr><td data-num=394></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=395></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethod Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=396></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethod Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=397></td><td><pre></pre></td></tr><tr><td data-num=398></td><td><pre>	<span class="token comment">/* 返回响应报文 */</span></pre></td></tr><tr><td data-num=399></td><td><pre><span class="token comment">/*	HttpResponse(sockfd,path); */</span></pre></td></tr><tr><td data-num=400></td><td><pre>	<span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=401></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=402></td><td><pre></pre></td></tr><tr><td data-num=403></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=404></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=405></td><td><pre>	i32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=406></td><td><pre>	<span class="token keyword">char</span> contentLength<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=407></td><td><pre></pre></td></tr><tr><td data-num=408></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=409></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=410></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=411></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=412></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=413></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=414></td><td><pre></pre></td></tr><tr><td data-num=415></td><td><pre>		len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=416></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=417></td><td><pre>			<span class="token function">strcpy</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">strchr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token char">':'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=418></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=419></td><td><pre></pre></td></tr><tr><td data-num=420></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">_stoi</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=421></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=422></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod: GetLine() Error Not have body content\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=423></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod: GetLine() Error Not have body content\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=424></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=425></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=426></td><td><pre></pre></td></tr><tr><td data-num=427></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod Response....\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=428></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod Response....\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=429></td><td><pre></pre></td></tr><tr><td data-num=430></td><td><pre>	<span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=431></td><td><pre>	<span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=432></td><td><pre>	<span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=433></td><td><pre>	<span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=434></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_nickname <span class="token operator">=</span> nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=435></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_email <span class="token operator">=</span> email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=436></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_content <span class="token operator">=</span> content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=437></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_createat <span class="token operator">=</span> createat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=438></td><td><pre>	</pre></td></tr><tr><td data-num=439></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=440></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=441></td><td><pre>		<span class="token operator">*</span>p_nickname <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=442></td><td><pre>		<span class="token operator">++</span>p_nickname<span class="token punctuation">;</span> <span class="token operator">++</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=443></td><td><pre>	<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=444></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_email<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=445></td><td><pre>		<span class="token operator">*</span>p_email <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=446></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_content<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=447></td><td><pre>		<span class="token operator">*</span>p_content <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=448></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_createat<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=449></td><td><pre>		<span class="token operator">*</span>p_createat <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=450></td><td><pre></pre></td></tr><tr><td data-num=451></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">"PostMethod: Recv Body: "</span><span class="token punctuation">,</span>nickname<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>email<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>createat<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=452></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">"PostMethod: Recv Body: "</span><span class="token punctuation">,</span>nickname<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>email<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>createat<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=453></td><td><pre></pre></td></tr><tr><td data-num=454></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">Element</span> el<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=455></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=456></td><td><pre>  </pre></td></tr><tr><td data-num=457></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>el<span class="token punctuation">,</span><span class="token char">'\0'</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=458></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>tablename<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=459></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>nickname<span class="token punctuation">,</span>nickname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=460></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>email<span class="token punctuation">,</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=461></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>content<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=462></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>createat<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=463></td><td><pre>	<span class="token function">TableInsert</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token operator">&amp;</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=464></td><td><pre>	<span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=465></td><td><pre></pre></td></tr><tr><td data-num=466></td><td><pre>	<span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token string">"api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=467></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=468></td><td><pre></pre></td></tr><tr><td data-num=469></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=470></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=471></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=472></td><td><pre>	<span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=473></td><td><pre>	i32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=474></td><td><pre>	u32 bufSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=475></td><td><pre></pre></td></tr><tr><td data-num=476></td><td><pre>	len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=477></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=478></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=479></td><td><pre>		i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=480></td><td><pre>		u32 methodSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=481></td><td><pre></pre></td></tr><tr><td data-num=482></td><td><pre>		<span class="token comment">/* 获取请求的method */</span></pre></td></tr><tr><td data-num=483></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>methodSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=484></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=485></td><td><pre>			method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=486></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=487></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=488></td><td><pre>		</pre></td></tr><tr><td data-num=489></td><td><pre>		<span class="token comment">/* 处理对应的方法 */</span></pre></td></tr><tr><td data-num=490></td><td><pre>		<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=491></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=492></td><td><pre>			<span class="token keyword">case</span> _GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=493></td><td><pre>			<span class="token keyword">case</span> _POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=494></td><td><pre>			<span class="token keyword">case</span> _PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=495></td><td><pre>			<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=496></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=497></td><td><pre>				<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=498></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"warning! could not accept "</span><span class="token punctuation">,</span>method<span class="token punctuation">,</span><span class="token string">"method\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=499></td><td><pre>				<span class="token keyword">do</span></pre></td></tr><tr><td data-num=500></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=501></td><td><pre>					<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=502></td><td><pre>					<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=503></td><td><pre>					len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=504></td><td><pre>				<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=505></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=506></td><td><pre>		<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=507></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=508></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response400</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=509></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>httpserver.c</summary><div><p>额外进行了变量名/函数名，变量类型/函数类型/参数类型的修正。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>i32 thread_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token class-name">pthread_t</span> threads<span class="token punctuation">[</span>MAXCLIENTS<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>FILE<span class="token operator">*</span> source <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">void</span> <span class="token function">MainExit</span><span class="token punctuation">(</span>i32 sig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\nMainEixt start...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\nMainEixt start...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>	i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	</pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> thread_index<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">pthread_cancel</span><span class="token punctuation">(</span>threads<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	</pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token function">pthread_mutex_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"MainEixt end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"MainEixt end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">HttpMain</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	i32 accept_fd <span class="token operator">=</span> <span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpMain: server connected...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"HttpMain: server connected...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token function">HttpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">signal</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex1<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	<span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex2<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=54></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=55></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=59></td><td><pre></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>		i32 accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>		u32 sockSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>		<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre></pre></td></tr><tr><td data-num=66></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre></pre></td></tr><tr><td data-num=69></td><td><pre>		accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>sockSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>	</pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token class-name">pthread_attr_t</span> attr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>		<span class="token function">pthread_attr_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>		<span class="token function">pthread_attr_setdetachstate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>attr<span class="token punctuation">,</span>PTHREAD_CREATE_DETACHED<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>		<span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>threads<span class="token punctuation">[</span>thread_index<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span>HttpMain<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i64<span class="token punctuation">)</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		thread_index <span class="token operator">=</span> <span class="token punctuation">(</span>thread_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> MAXCLIENTS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h3 id=埋下的坑3的解决与io复用模式><a class=anchor href=#埋下的坑3的解决与io复用模式>#</a> 埋下的坑3的解决与I/O复用模式</h3><details class=info><summary>httpserver.c</summary><div><p>去除了多线程模式，并采用高性能的I/O复用模式的epoll模式。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>i32 epoll_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>FILE<span class="token operator">*</span> source <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">void</span> <span class="token function">MainExit</span><span class="token punctuation">(</span>i32 sig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\nMainEixt start\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\nMainEixt start\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"MainEixt end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"MainEixt end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">signal</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>	epoll_fd <span class="token operator">=</span> <span class="token function">epoll_create</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> ev<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	u32 epoll_eventSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">epoll_event</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre></pre></td></tr><tr><td data-num=40></td><td><pre>	ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd <span class="token operator">=</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>	ev<span class="token punctuation">.</span>events <span class="token operator">=</span> EPOLLIN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token function">epoll_ctl</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">,</span>EPOLL_CTL_ADD<span class="token punctuation">,</span>server_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>		<span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> events<span class="token punctuation">[</span>MAXCLIENTS<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		i32 eventNums <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>		</pre></td></tr><tr><td data-num=52></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>eventNums <span class="token operator">=</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">,</span>events<span class="token punctuation">,</span>MAXCLIENTS<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: epoll_wait() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: epoll_wait() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> eventNums<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>server_fd <span class="token operator">==</span> events<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>events<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">&amp;</span> EPOLLIN<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token punctuation">&#123;</span>		</pre></td></tr><tr><td data-num=63></td><td><pre>				i32 socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>				<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>				i32 accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>				</pre></td></tr><tr><td data-num=67></td><td><pre>				<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ev<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>epoll_eventSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>				ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd <span class="token operator">=</span> accept_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>				ev<span class="token punctuation">.</span>events <span class="token operator">=</span> EPOLLIN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>				<span class="token function">epoll_ctl</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">,</span>EPOLL_CTL_ADD<span class="token punctuation">,</span>accept_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=73></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=74></td><td><pre>				<span class="token function">HttpAccept</span><span class="token punctuation">(</span>events<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>				<span class="token function">close</span><span class="token punctuation">(</span>events<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=78></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>	</pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h2 id=完整初稿最终源码><a class=anchor href=#完整初稿最终源码>#</a> 完整初稿最终源码</h2><h3 id=前端源码-2><a class=anchor href=#前端源码-2>#</a> 前端源码</h3><details class=info><summary>index.html</summary><div><figure class="highlight html"><figcaption data-lang=HTML></figcaption><table><tr><td data-num=1></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./css/comments.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/comments.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=13></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-block<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=14></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=15></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>nickname<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>19<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> nickname(1~19个字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=16></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>44<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> email(8~44字符)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=17></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text-block<span class="token punctuation">"</span></span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> <span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=18></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-area clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=19></td><td><pre>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>commit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=20></td><td><pre>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=21></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=22></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=23></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=24></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Comentarios<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=25></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure></div></details><details class=info><summary>comments.css</summary><div><figure class="highlight css"><figcaption data-lang=CSS></figcaption><table><tr><td data-num=1></td><td><pre><span class="token selector">body,</span></pre></td></tr><tr><td data-num=2></td><td><pre>#comment-block,</pre></td></tr><tr><td data-num=3></td><td><pre>#comment-block input,</pre></td></tr><tr><td data-num=4></td><td><pre>#comment-block textarea,</pre></td></tr><tr><td data-num=5></td><td><pre>#comment-block button,</pre></td></tr><tr><td data-num=6></td><td><pre>#comment-block ul,</pre></td></tr><tr><td data-num=7></td><td><pre>#comment-block li<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token property">outline</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">,</span>Helvetica<span class="token punctuation">,</span>sans-serif<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token selector">#comment-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment">/* input area part  start-area*/</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token selector">#comment-block .input-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 306px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #f7f7f7<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 .625rem 1.875rem -.9375rem <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token selector">#comment-block .input-block .input-area</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token selector">#comment-block .input-block .input-area .nickname</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=48></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 161px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 2px solid #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre><span class="token selector">#comment-block .input-block .input-area .email</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=55></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 345px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>    <span class="token property">border-right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>    <span class="token property">padding-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=61></td><td><pre></pre></td></tr><tr><td data-num=62></td><td><pre><span class="token selector">#comment-block .input-block .input-area .text-block</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=63></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 520px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 231px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token property">border-top</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 2px dashed #ccc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>    <span class="token property">padding-top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>    <span class="token property">resize</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre></pre></td></tr><tr><td data-num=72></td><td><pre><span class="token selector">#comment-block .input-block .button-area .commit</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=73></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 31px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> .3rem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #eff2f3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token property">margin-top</span><span class="token punctuation">:</span> 2.8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>    <span class="token property">line-height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token comment">/* input area part  end-area*/</span></pre></td></tr><tr><td data-num=84></td><td><pre></pre></td></tr><tr><td data-num=85></td><td><pre></pre></td></tr><tr><td data-num=86></td><td><pre><span class="token comment">/* comment show area */</span></pre></td></tr><tr><td data-num=87></td><td><pre><span class="token selector">#comment-block .comment-container</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=88></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 546px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=92></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=96></td><td><pre></pre></td></tr><tr><td data-num=97></td><td><pre><span class="token selector">#comment-block .comment-container .info</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=98></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 36px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #283035<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>    <span class="token property">font-weight</span><span class="token punctuation">:</span> 400<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=103></td><td><pre></pre></td></tr><tr><td data-num=104></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=105></td><td><pre>	<span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=106></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=107></td><td><pre></pre></td></tr><tr><td data-num=108></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 50px<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>	<span class="token property">top</span><span class="token punctuation">:</span> 45px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=117></td><td><pre></pre></td></tr><tr><td data-num=118></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list::after</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>	<span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>	<span class="token property">bottom</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> 27px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=123></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=125></td><td><pre>	<span class="token property">border</span><span class="token punctuation">:</span> 3px solid #dee1e3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>	<span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>	<span class="token property">background</span><span class="token punctuation">:</span> #c7cacb<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=129></td><td><pre></pre></td></tr><tr><td data-num=130></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=131></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=132></td><td><pre>    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=133></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=135></td><td><pre></pre></td></tr><tr><td data-num=136></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list li::after</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=137></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=138></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=139></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=143></td><td><pre></pre></td></tr><tr><td data-num=144></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level::after</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=145></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=151></td><td><pre></pre></td></tr><tr><td data-num=152></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=153></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=155></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 54px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>    <span class="token property">border</span><span class="token punctuation">:</span> 3px solid #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 2px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=162></td><td><pre></pre></td></tr><tr><td data-num=163></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .avatar .img</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=164></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=167></td><td><pre></pre></td></tr><tr><td data-num=168></td><td><pre><span class="token comment">/* comment box of coment area start-area */</span></pre></td></tr><tr><td data-num=169></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=170></td><td><pre>	<span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 465px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 1px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.15<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=175></td><td><pre></pre></td></tr><tr><td data-num=176></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=177></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=178></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=182></td><td><pre>    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>    <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=189></td><td><pre></pre></td></tr><tr><td data-num=190></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=191></td><td><pre>    <span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>    <span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=193></td><td><pre>    <span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=195></td><td><pre></pre></td></tr><tr><td data-num=196></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before,</span></pre></td></tr><tr><td data-num=197></td><td><pre>#comment-block .comment-container .comment-list .main-level .comment-box::after<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=198></td><td><pre>	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>	<span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre>	<span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token property">border-width</span><span class="token punctuation">:</span> 10px 12px 10px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token property">border-color</span><span class="token punctuation">:</span> transparent #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre>	<span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=208></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=209></td><td><pre></pre></td></tr><tr><td data-num=210></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box::before</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=211></td><td><pre>	<span class="token property">left</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=212></td><td><pre>	<span class="token property">border-width</span><span class="token punctuation">:</span> 11px 13px 11px 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=213></td><td><pre>	<span class="token property">border-color</span><span class="token punctuation">:</span> transparent <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0.05<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=214></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=215></td><td><pre></pre></td></tr><tr><td data-num=216></td><td><pre><span class="token comment">/* comment box head area start-area */</span></pre></td></tr><tr><td data-num=217></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=218></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 10px 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre>    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 1px solid #E5E5E5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=221></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px 4px 0 0<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #FCFCFC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=223></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=224></td><td><pre></pre></td></tr><tr><td data-num=225></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=226></td><td><pre>.cbauthor-name<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=227></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=228></td><td><pre>    <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=229></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #283035<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=230></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=231></td><td><pre>    <span class="token property">font-weight</span><span class="token punctuation">:</span> 700<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=233></td><td><pre></pre></td></tr><tr><td data-num=234></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-head</span></pre></td></tr><tr><td data-num=235></td><td><pre>span<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=236></td><td><pre>    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre>    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>    <span class="token property">top</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=241></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=242></td><td><pre><span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=243></td><td><pre></pre></td></tr><tr><td data-num=244></td><td><pre><span class="token comment">/* comment box content area start-area */</span></pre></td></tr><tr><td data-num=245></td><td><pre><span class="token selector">#comment-block .comment-container .comment-list .main-level .comment-box .cbox-content</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=246></td><td><pre>    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=247></td><td><pre>    <span class="token property">padding</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=248></td><td><pre>    <span class="token property">border-radius</span><span class="token punctuation">:</span> 0 0 4px 4px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>    <span class="token property">font-size</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>    <span class="token property">color</span><span class="token punctuation">:</span> #595959<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=251></td><td><pre>    <span class="token property">background</span><span class="token punctuation">:</span> #FFF<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=253></td><td><pre><span class="token comment">/* comment box content area end-area */</span></pre></td></tr><tr><td data-num=254></td><td><pre><span class="token comment">/* comment box of coment area end-area */</span></pre></td></tr></table></figure></div></details><details class=info><summary>comments.js</summary><div><figure class="highlight javascript"><figcaption data-lang=javascript></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>url<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>	<span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>	<span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>_URL<span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>		<span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>		<span class="token literal-property property">headers</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>			<span class="token string-property property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>		<span class="token literal-property property">body</span><span class="token operator">:</span> data<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>url</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">const</span> _URL <span class="token operator">=</span> <span class="token string">"http://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>_URL<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    </pre></td></tr><tr><td data-num=20></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=21></td><td><pre>    </pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">function</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span><span class="token parameter">textsLable<span class="token punctuation">,</span>cols</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>	<span class="token keyword">var</span> texts <span class="token operator">=</span> <span class="token punctuation">(</span>textsLable<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\r|\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">var</span> textLength <span class="token operator">=</span> texts<span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> textLength<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> cache<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token number">0</span> <span class="token operator">===</span> cache<span class="token punctuation">.</span>length <span class="token operator">%</span> cols<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=32></td><td><pre>			cache <span class="token operator">+=</span> <span class="token string">"&lt;br/>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>		cache <span class="token operator">+=</span> texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">return</span> cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token keyword">function</span> <span class="token function">contentAppend</span><span class="token punctuation">(</span><span class="token parameter">labels<span class="token punctuation">,</span>nickNameValue<span class="token punctuation">,</span>textsContent<span class="token punctuation">,</span>creatat</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token keyword">var</span> userBlock <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token keyword">var</span> mainUserLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	mainUserLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"main-level clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token comment">/* avatar area  start-area */</span></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token keyword">var</span> avatarLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	avatarLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"avatar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token keyword">var</span> imgUrl <span class="token operator">=</span> <span class="token string">"./img/img.png"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	avatarLable<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"&lt;img src=\""</span> <span class="token operator">+</span> imgUrl <span class="token operator">+</span> <span class="token string">"\"alt>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>	mainUserLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>avatarLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token comment">/* avatar area  end-area */</span></pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token keyword">var</span> commentBoxLable <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token comment">/* comment box of coment area start-area */</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token comment">/* comment box head area star-area */</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token keyword">var</span> boxHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-head clearfix"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token keyword">var</span> authorName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	authorName<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbauthor-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	authorName<span class="token punctuation">.</span>innerText <span class="token operator">=</span> nickNameValue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre></pre></td></tr><tr><td data-num=67></td><td><pre>	<span class="token keyword">var</span> timeSpend <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>	<span class="token keyword">var</span> timeSpace <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> creatat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>	<span class="token keyword">var</span> days <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">24</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token keyword">var</span> f_days <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token keyword">var</span> hours <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>	<span class="token keyword">var</span> f_hours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>	<span class="token keyword">var</span> minutes <span class="token operator">=</span> timeSpace <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> f_days<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token keyword">var</span> f_minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_days<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_days <span class="token operator">+</span> <span class="token string">" days ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> f_hours<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_hours <span class="token operator">+</span> <span class="token string">" hours ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=78></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> timeSpend<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">""</span> <span class="token operator">+</span> f_minutes <span class="token operator">+</span> <span class="token string">" minutes ago"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=79></td><td><pre></pre></td></tr><tr><td data-num=80></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>authorName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>	boxHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>timeSpend<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxHead<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>	<span class="token comment">/* comment box head area end-area */</span></pre></td></tr><tr><td data-num=84></td><td><pre></pre></td></tr><tr><td data-num=85></td><td><pre>	<span class="token comment">/* coment box content area start-area */</span></pre></td></tr><tr><td data-num=86></td><td><pre>	<span class="token keyword">var</span> boxContent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>	boxContent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"cbox-conten"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=88></td><td><pre></pre></td></tr><tr><td data-num=89></td><td><pre>	boxContent<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> textsContent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	commentBoxLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>boxContent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=91></td><td><pre>	<span class="token comment">/* comment box of coment area end-area */</span></pre></td></tr><tr><td data-num=92></td><td><pre></pre></td></tr><tr><td data-num=93></td><td><pre>	mainUserLable<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentBoxLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>	userBlock<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mainUserLable<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre></pre></td></tr><tr><td data-num=96></td><td><pre>	<span class="token comment">/* state stretch */</span></pre></td></tr><tr><td data-num=97></td><td><pre>	<span class="token keyword">var</span> O_CBHeight <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre>	<span class="token keyword">var</span> newHeight <span class="token operator">=</span> O_CBHeight <span class="token operator">+</span> <span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre></pre></td></tr><tr><td data-num=100></td><td><pre>	commentBlock<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>	commentContainer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> newHeight <span class="token operator">-</span> <span class="token number">325</span> <span class="token operator">+</span>  <span class="token string">"px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=103></td><td><pre></pre></td></tr><tr><td data-num=104></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">buttonClick</span><span class="token punctuation">(</span><span class="token parameter">host<span class="token punctuation">,</span>labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=105></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=106></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=108></td><td><pre>	<span class="token keyword">var</span> inputArea <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=110></td><td><pre></pre></td></tr><tr><td data-num=111></td><td><pre>	<span class="token keyword">var</span> inputs <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>	<span class="token keyword">var</span> nickName <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre>	<span class="token keyword">var</span> email <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=114></td><td><pre>	<span class="token keyword">var</span> texts <span class="token operator">=</span> inputArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"textarea"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=115></td><td><pre></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token keyword">var</span> nickNameValue <span class="token operator">=</span> nickName<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>nickNameValue<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=118></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=119></td><td><pre>		<span class="token comment">/* current time */</span></pre></td></tr><tr><td data-num=120></td><td><pre>		<span class="token keyword">var</span> textsContent <span class="token operator">=</span> <span class="token function">textareaBeautify</span><span class="token punctuation">(</span>texts<span class="token punctuation">,</span>texts<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=121></td><td><pre>		<span class="token keyword">var</span> curTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>		<span class="token keyword">var</span> data <span class="token operator">=</span> nickNameValue <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> email<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> textsContent <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> curTime<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=123></td><td><pre></pre></td></tr><tr><td data-num=124></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">==</span>  <span class="token keyword">await</span> <span class="token function">_PostRequest</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token string">"/api"</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=125></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=126></td><td><pre>			<span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=127></td><td><pre>			<span class="token keyword">var</span> commentListFirstChild <span class="token operator">=</span> commentList<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=128></td><td><pre>			<span class="token keyword">var</span> newLabels <span class="token operator">=</span> <span class="token punctuation">[</span>commentContainer<span class="token punctuation">,</span>commentBlock<span class="token punctuation">,</span>userBlock<span class="token punctuation">,</span>commentList<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=129></td><td><pre></pre></td></tr><tr><td data-num=130></td><td><pre>			<span class="token function">contentAppend</span><span class="token punctuation">(</span>newLabels<span class="token punctuation">,</span>nickNameValue<span class="token punctuation">,</span>textsContent<span class="token punctuation">,</span>curTime<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> commentListFirstChild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=132></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=133></td><td><pre>				commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=134></td><td><pre>				commentList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=136></td><td><pre>			<span class="token keyword">else</span><span class="token punctuation">&#123;</span> commentList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>commentListFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=139></td><td><pre></pre></td></tr><tr><td data-num=140></td><td><pre>	nickName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=141></td><td><pre>	email<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>	texts<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=143></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=144></td><td><pre></pre></td></tr><tr><td data-num=145></td><td><pre><span class="token keyword">function</span> <span class="token function">commentPreShow</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>labels</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=146></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=147></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> labels<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token keyword">var</span> array <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=151></td><td><pre>	array<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=152></td><td><pre></pre></td></tr><tr><td data-num=153></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=154></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=155></td><td><pre>		<span class="token keyword">var</span> sub <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=156></td><td><pre>		<span class="token keyword">var</span> nickName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>		<span class="token keyword">var</span> email <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>		<span class="token keyword">var</span> textsContent <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=159></td><td><pre>		<span class="token keyword">var</span> createat <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>		<span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token string">':'</span> <span class="token operator">!=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=162></td><td><pre>			nickName <span class="token operator">+=</span> sub<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=163></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>j<span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token string">':'</span> <span class="token operator">!=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=164></td><td><pre>			email <span class="token operator">+=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>j<span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token string">':'</span> <span class="token operator">!=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=166></td><td><pre>			textsContent <span class="token operator">+=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>j<span class="token punctuation">;</span>j <span class="token operator">&lt;</span> sub<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> createat <span class="token operator">+=</span> sub<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=168></td><td><pre></pre></td></tr><tr><td data-num=169></td><td><pre><span class="token comment">/*	console.log(nickName + ":" + email + ":" + textsContent + ":" + createat + "\n"); */</span></pre></td></tr><tr><td data-num=170></td><td><pre>		<span class="token keyword">var</span> userBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>		<span class="token keyword">var</span> commentListFirstChild <span class="token operator">=</span> commentList<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token keyword">var</span> newLabels <span class="token operator">=</span> <span class="token punctuation">[</span>commentContainer<span class="token punctuation">,</span>commentBlock<span class="token punctuation">,</span>userBlock<span class="token punctuation">,</span>commentList<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre></pre></td></tr><tr><td data-num=174></td><td><pre>		<span class="token function">contentAppend</span><span class="token punctuation">(</span>newLabels<span class="token punctuation">,</span>nickName<span class="token punctuation">,</span>textsContent<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> commentListFirstChild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=176></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=177></td><td><pre>			commentList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>			commentList<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=180></td><td><pre>		<span class="token keyword">else</span><span class="token punctuation">&#123;</span> commentList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>userBlock<span class="token punctuation">,</span>commentListFirstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=182></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=183></td><td><pre></pre></td></tr><tr><td data-num=184></td><td><pre>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=185></td><td><pre>	<span class="token keyword">const</span> _host <span class="token operator">=</span> <span class="token string">"192.168.80.131"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token keyword">var</span> commentBlock <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comment-block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* class="comment-block" */</span></pre></td></tr><tr><td data-num=187></td><td><pre></pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token keyword">var</span> inputBlock <span class="token operator">=</span> commentBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span><span class="token comment">/* class="input-block" */</span></pre></td></tr><tr><td data-num=189></td><td><pre>	<span class="token comment">/* input-block */</span></pre></td></tr><tr><td data-num=190></td><td><pre>	<span class="token keyword">var</span> inputArea <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span><span class="token comment">/* class="input-area" */</span></pre></td></tr><tr><td data-num=191></td><td><pre>	<span class="token keyword">var</span> buttonArea <span class="token operator">=</span> inputArea<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span><span class="token comment">/* class="text-block" */</span></pre></td></tr><tr><td data-num=192></td><td><pre>	<span class="token keyword">var</span> commitButton <span class="token operator">=</span> buttonArea<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">/* class="commit" */</span></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token comment">/***************/</span></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token keyword">var</span> commentContainer <span class="token operator">=</span> inputBlock<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span><span class="token comment">/* class="comment-container" */</span></pre></td></tr><tr><td data-num=195></td><td><pre></pre></td></tr><tr><td data-num=196></td><td><pre>	<span class="token keyword">var</span> responseData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_GetRequest</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span><span class="token string">"/database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=197></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> responseData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=198></td><td><pre></pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token keyword">var</span> commentList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>	commentList<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span><span class="token string">"comment-list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>	commentContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>commentList<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=202></td><td><pre>	<span class="token function">commentPreShow</span><span class="token punctuation">(</span>responseData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>commentContainer<span class="token punctuation">,</span>commentBlock<span class="token punctuation">,</span>commentList<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=203></td><td><pre></pre></td></tr><tr><td data-num=204></td><td><pre>	commitButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=205></td><td><pre>		<span class="token function">buttonClick</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span><span class="token punctuation">[</span>commentContainer<span class="token punctuation">,</span>commentBlock<span class="token punctuation">,</span>inputArea<span class="token punctuation">,</span>commentList<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=207></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><h3 id=后端与数据库源码-2><a class=anchor href=#后端与数据库源码-2>#</a> 后端与数据库源码</h3><details class=info><summary>_clibs.h</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;signal.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdarg.h></span></span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i16</span> <span class="token expression"><span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i32</span> <span class="token expression"><span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">i64</span> <span class="token expression"><span class="token keyword">long</span></span></span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u16</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u32</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u64</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">long</span></span></span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ROOTDIR</span> <span class="token string">"docs"</span></span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_LOGPATH</span> <span class="token string">"./_httpserver.log"</span></span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_DEBUG</span></span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>i32 <span class="token function">_pow</span><span class="token punctuation">(</span>i32 n<span class="token punctuation">,</span>i32 m<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>i32 <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">void</span> <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> source<span class="token punctuation">,</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>_clibs.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 <span class="token function">_pow</span><span class="token punctuation">(</span>i32 n<span class="token punctuation">,</span>i32 m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> m<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">--</span>m<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> n <span class="token operator">*=</span> n<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token keyword">return</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>i32 <span class="token function">_stoi</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	i32 left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	i32 ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">++</span>left<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>	right <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>right <span class="token operator">>=</span> left<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>		i32 t <span class="token operator">=</span> <span class="token punctuation">(</span>strs<span class="token punctuation">[</span>right<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>		ans <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">*</span> <span class="token function">_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>		<span class="token operator">--</span>right<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">return</span> ans<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_DEBUG</span></span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		va_list args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre></pre></td></tr><tr><td data-num=34></td><td><pre>		<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>			<span class="token keyword">char</span><span class="token operator">*</span> strs <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=38></td><td><pre>			<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>strs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token keyword">void</span> <span class="token function">_LogFileWrite</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> filename<span class="token punctuation">,</span><span class="token keyword">const</span> i32 num<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	FILE<span class="token operator">*</span> source <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">"a+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> source<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=52></td><td><pre></pre></td></tr><tr><td data-num=53></td><td><pre>	va_list args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>	i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token constant">__TIME__</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">":\n"</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>	<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=60></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>		<span class="token keyword">char</span><span class="token operator">*</span> strs <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>		<span class="token function">fputs</span><span class="token punctuation">(</span>strs<span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre>		<span class="token operator">++</span>i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>	<span class="token function">fclose</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>database.h</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;mysql/mysql.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HOST</span> <span class="token string">"127.0.0.1"</span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">USER</span> <span class="token string">"root"</span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PASSWORD</span> <span class="token string">"@Killl611"</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DBNAME</span> <span class="token string">"CommentSystem"</span></span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Element</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">char</span> tablename<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Element</span><span class="token operator">*</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=22></td><td><pre>MYSQL_RES<span class="token operator">*</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>MYSQL_RES<span class="token operator">*</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>database.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>MYSQL<span class="token operator">*</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">mysql_init</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_init() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_init() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	</pre></td></tr><tr><td data-num=13></td><td><pre>	mysql <span class="token operator">=</span> <span class="token function">mysql_real_connect</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>HOST<span class="token punctuation">,</span>USER<span class="token punctuation">,</span>PASSWORD<span class="token punctuation">,</span>DBNAME<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_real_connect() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect: mysql_real_connect() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token keyword">return</span> mysql<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token function">mysql_close</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Close\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"DatabaseConnect Close\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token keyword">void</span> <span class="token function">TableInsert</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">Element</span><span class="token operator">*</span> el<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=35></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>	</pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"INSERT INTO %s(NickName,Email,Content,CreateAt)\nVALUES('%s','%s','%s','%s')"</span><span class="token punctuation">,</span>el<span class="token operator">-></span>tablename<span class="token punctuation">,</span>el<span class="token operator">-></span>nickname<span class="token punctuation">,</span>el<span class="token operator">-></span>email<span class="token punctuation">,</span>el<span class="token operator">-></span>content<span class="token punctuation">,</span>el<span class="token operator">-></span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database Query:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Database Query:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=43></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"TableInsert: mysql_query() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"TableInsert: mysql_query() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">mysql_error</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TableInsert Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"TableInsert Succeed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		</pre></td></tr><tr><td data-num=49></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=50></td><td><pre></pre></td></tr><tr><td data-num=51></td><td><pre>MYSQL_RES<span class="token operator">*</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>MYSQL<span class="token operator">*</span> mysql<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> tableName<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"SELECT * FROM %s ORDER BY CreateAT ASC"</span><span class="token punctuation">,</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=57></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement: mysql_query() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement: mysql_query() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=62></td><td><pre></pre></td></tr><tr><td data-num=63></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement Start\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement Start...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>	<span class="token keyword">return</span> <span class="token function">mysql_store_result</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=67></td><td><pre></pre></td></tr><tr><td data-num=68></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>MYSQL_RES<span class="token operator">*</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=69></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=70></td><td><pre>	<span class="token function">mysql_free_result</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement End\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetTableElement End\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.h</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;netdb.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/epoll.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"_clibs.h"</span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"database.h"</span></span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXCLIENTS</span> <span class="token expression"><span class="token number">200</span></span></span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">FileType</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	_HTML <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>	_CSS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=18></td><td><pre>	_JS <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>	_PNG <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestMethod</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>	_GET <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=25></td><td><pre>	_POST <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>	_PUT <span class="token operator">=</span> <span class="token number">3</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token keyword">enum</span> <span class="token class-name">RequestURL</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>    _DATABASE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=32></td><td><pre>    _API <span class="token operator">=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token keyword">int</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token keyword">const</span> u16 port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token keyword">const</span> u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>	i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: socket() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: socket() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	u32 server_addrSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>	server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	</pre></td></tr><tr><td data-num=23></td><td><pre>	<span class="token comment">/* Initial port */</span></pre></td></tr><tr><td data-num=24></td><td><pre>	i32 opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	u32 optSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>optSize<span class="token punctuation">)</span><span class="token punctuation">;</span>	</pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span>server_addrSize<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: bind() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: bind() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=38></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: listen() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"SocketConstruct: listen() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre>	<span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetLine</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=49></td><td><pre>	i32 index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=51></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=52></td><td><pre>		i32 len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=54></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=55></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=56></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre>			buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token keyword">else</span> </pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=63></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: recv() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: recv() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=67></td><td><pre>			<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=68></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: Client Closed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetLine: Client Closed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=71></td><td><pre>			index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=74></td><td><pre>	<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=75></td><td><pre>	buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>	<span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=77></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=78></td><td><pre></pre></td></tr><tr><td data-num=79></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetMethodType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=80></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=81></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=83></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=84></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'O'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=86></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'G'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'E'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=87></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'U'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=88></td><td><pre>		<span class="token operator">++</span>method<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=90></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=91></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=92></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: POST\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: POST\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=94></td><td><pre>		<span class="token keyword">return</span> _POST<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=95></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=96></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=97></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=98></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=99></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=100></td><td><pre>		<span class="token keyword">return</span> _GET<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=101></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=102></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=103></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=104></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: PUT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: PUT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=106></td><td><pre>		<span class="token keyword">return</span> _PUT<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=107></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=108></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethodType: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=110></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=111></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=112></td><td><pre></pre></td></tr><tr><td data-num=113></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> ostr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=114></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=115></td><td><pre>	<span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=116></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> ch <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token operator">*</span> cache <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=117></td><td><pre>	i32 select<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>	</pre></td></tr><tr><td data-num=119></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>ostr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=120></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">NULL</span> <span class="token operator">!=</span> ch<span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=121></td><td><pre>		cache <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=122></td><td><pre>	</pre></td></tr><tr><td data-num=123></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>cache<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=124></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=125></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=126></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'H'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'T'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'M'</span><span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'L'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=127></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'C'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=128></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'J'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'S'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=129></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'P'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'N'</span> <span class="token operator">==</span> c <span class="token operator">||</span> <span class="token char">'G'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=130></td><td><pre>		<span class="token operator">++</span>cache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=131></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=132></td><td><pre></pre></td></tr><tr><td data-num=133></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=134></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=135></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: HTML\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=136></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: HTML\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=137></td><td><pre>		<span class="token keyword">return</span> _HTML<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=138></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=139></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=140></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=141></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: CSS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=142></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: CSS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=143></td><td><pre>		<span class="token keyword">return</span> _CSS<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=144></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=145></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=146></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=147></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: JS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: JS\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=149></td><td><pre>		<span class="token keyword">return</span> _JS<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=150></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=151></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> select<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=152></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=153></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: PNG\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: PNG\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=155></td><td><pre>		<span class="token keyword">return</span> _PNG<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=156></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=157></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetFileType: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=159></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=161></td><td><pre></pre></td></tr><tr><td data-num=162></td><td><pre><span class="token keyword">static</span> i32 <span class="token function">GetRequestPath</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=163></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=164></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> pd <span class="token operator">=</span> <span class="token string">"DATABASE"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> pa <span class="token operator">=</span> <span class="token string">"API"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=166></td><td><pre></pre></td></tr><tr><td data-num=167></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>strs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=168></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=169></td><td><pre>		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>strs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=170></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>pd <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>pd<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=171></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>pa <span class="token operator">==</span> c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token operator">++</span>pa<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=172></td><td><pre>		<span class="token operator">++</span>strs<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=173></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=174></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>pd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=175></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=176></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: DATABASE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=177></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: DATABASE\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=178></td><td><pre>		<span class="token keyword">return</span> _DATABASE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=180></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">==</span> <span class="token operator">*</span>pa<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=181></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=182></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: API\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: API\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=184></td><td><pre>		<span class="token keyword">return</span> _API<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=185></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=186></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetRequestPath: UNKNOW\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=188></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	 </pre></td></tr><tr><td data-num=189></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response404</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=192></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=193></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=194></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=195></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=196></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=197></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response404: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=198></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response404: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=200></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=201></td><td><pre></pre></td></tr><tr><td data-num=202></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response400</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=203></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=204></td><td><pre>	<span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=205></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 400 BAD REQUEST\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=206></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=207></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=208></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response400: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=209></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response400: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=210></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=211></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=212></td><td><pre></pre></td></tr><tr><td data-num=213></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_NF</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=214></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=215></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=216></td><td><pre></pre></td></tr><tr><td data-num=217></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=218></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=219></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=220></td><td><pre></pre></td></tr><tr><td data-num=221></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=222></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=223></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=224></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_NF: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=225></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_NF: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=226></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=227></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=228></td><td><pre></pre></td></tr><tr><td data-num=229></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200_DB</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=230></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=231></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=232></td><td><pre>	<span class="token keyword">char</span> body<span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=233></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=234></td><td><pre>	i32 bodyLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=235></td><td><pre></pre></td></tr><tr><td data-num=236></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=237></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=238></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=239></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=240></td><td><pre></pre></td></tr><tr><td data-num=241></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=242></td><td><pre>	MYSQL_RES<span class="token operator">*</span> res <span class="token operator">=</span> <span class="token function">GetTableElementStart</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=243></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=244></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=245></td><td><pre>		MYSQL_ROW row<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=246></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>row <span class="token operator">=</span> <span class="token function">mysql_fetch_row</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=247></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=248></td><td><pre>			<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"%s:%s:%s:%s,"</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=249></td><td><pre>			<span class="token function">strcat</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=250></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=251></td><td><pre>		<span class="token function">GetTableElementEnd</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=252></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=253></td><td><pre>	<span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=254></td><td><pre>	</pre></td></tr><tr><td data-num=255></td><td><pre>	bodyLen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=256></td><td><pre>	<span class="token function">sprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token string">"Content-Length: %d\r\n\r\n"</span><span class="token punctuation">,</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=257></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=258></td><td><pre></pre></td></tr><tr><td data-num=259></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=260></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=261></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=262></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=263></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=264></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=265></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=266></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> bodyLen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=267></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=268></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>body<span class="token punctuation">,</span>bodyLen<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=269></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=270></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=271></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200_DB: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=272></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=273></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=274></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=275></td><td><pre></pre></td></tr><tr><td data-num=276></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Response200</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=277></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=278></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=279></td><td><pre>	</pre></td></tr><tr><td data-num=280></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">Response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=281></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=282></td><td><pre>	<span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=283></td><td><pre></pre></td></tr><tr><td data-num=284></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=285></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=286></td><td><pre>	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=287></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=288></td><td><pre>		<span class="token keyword">case</span> _HTML<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=289></td><td><pre>		<span class="token keyword">case</span> _CSS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/css\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=290></td><td><pre>		<span class="token keyword">case</span> _JS<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/javascript\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=291></td><td><pre>		<span class="token keyword">case</span> _PNG<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: image/png\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=292></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/plain\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=293></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=294></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=295></td><td><pre>	<span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=296></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=297></td><td><pre>	</pre></td></tr><tr><td data-num=298></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Response Header:\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=299></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=300></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=301></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=302></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=303></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=304></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=305></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=306></td><td><pre>		FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=307></td><td><pre>		i32 c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=308></td><td><pre></pre></td></tr><tr><td data-num=309></td><td><pre>		resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=310></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">EOF</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=311></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=312></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>c<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=313></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=314></td><td><pre>				<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=315></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Response200: send() Error.reason: "</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=316></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=317></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=318></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=319></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=320></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Response200: I/O error when reading\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=321></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Response200: I/O error when reading\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=322></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=323></td><td><pre>		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=324></td><td><pre>		<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=325></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Resopnse200: End of file reached successfully\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=326></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Resopnse200: End of file reached successfully\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=327></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=328></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=329></td><td><pre>	<span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=330></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=331></td><td><pre></pre></td></tr><tr><td data-num=332></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=333></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=334></td><td><pre>	i32 path <span class="token operator">=</span> <span class="token function">GetRequestPath</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=335></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>_DATABASE <span class="token operator">==</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=336></td><td><pre>		<span class="token function">Response200_DB</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=337></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>_API <span class="token operator">==</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=338></td><td><pre>		<span class="token function">Response200_NF</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=339></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num=340></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=341></td><td><pre>		<span class="token keyword">char</span> realPath<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=342></td><td><pre>		<span class="token function">sprintf</span><span class="token punctuation">(</span>realPath<span class="token punctuation">,</span><span class="token string">"./%s/%s"</span><span class="token punctuation">,</span>_ROOTDIR<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=343></td><td><pre></pre></td></tr><tr><td data-num=344></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Real Path: "</span><span class="token punctuation">,</span>realPath<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=345></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Real Path: "</span><span class="token punctuation">,</span>realPath<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=346></td><td><pre></pre></td></tr><tr><td data-num=347></td><td><pre>		<span class="token function">Response200</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>realPath<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=348></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=349></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=350></td><td><pre></pre></td></tr><tr><td data-num=351></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">,</span>i32 i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=352></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=353></td><td><pre><span class="token comment">/*	char path[64] = &#123;'\0'&#125;; */</span></pre></td></tr><tr><td data-num=354></td><td><pre>	<span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=355></td><td><pre>	i32 j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=356></td><td><pre>	u32 urlSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=357></td><td><pre>	</pre></td></tr><tr><td data-num=358></td><td><pre>	<span class="token comment">/* 获取请求路径 */</span></pre></td></tr><tr><td data-num=359></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=360></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>urlSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=361></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=362></td><td><pre>		url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=363></td><td><pre>		<span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=364></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=365></td><td><pre></pre></td></tr><tr><td data-num=366></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=367></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Request URL: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=368></td><td><pre></pre></td></tr><tr><td data-num=369></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=370></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=371></td><td><pre></pre></td></tr><tr><td data-num=372></td><td><pre>	<span class="token comment">/* 读取剩下的header报文 */</span></pre></td></tr><tr><td data-num=373></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=374></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=375></td><td><pre>		len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=376></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=377></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=378></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=379></td><td><pre></pre></td></tr><tr><td data-num=380></td><td><pre>	<span class="token comment">/* 通过定位?号来处理url */</span></pre></td></tr><tr><td data-num=381></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=382></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=383></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=384></td><td><pre>		<span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=385></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Position ? Request Path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=386></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"GetMethod: Position ? Request Path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=387></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=388></td><td><pre></pre></td></tr><tr><td data-num=389></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethod Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=390></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"GetMethod Response...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=391></td><td><pre></pre></td></tr><tr><td data-num=392></td><td><pre>	<span class="token comment">/* 返回响应报文 */</span></pre></td></tr><tr><td data-num=393></td><td><pre>	<span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=394></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=395></td><td><pre></pre></td></tr><tr><td data-num=396></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 bufSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=397></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=398></td><td><pre>	i32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=399></td><td><pre>	<span class="token keyword">char</span> contentLength<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=400></td><td><pre></pre></td></tr><tr><td data-num=401></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=402></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Request Header:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=403></td><td><pre>	<span class="token keyword">do</span></pre></td></tr><tr><td data-num=404></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=405></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=406></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=407></td><td><pre></pre></td></tr><tr><td data-num=408></td><td><pre>		len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=409></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=410></td><td><pre>			<span class="token function">strcpy</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">strchr</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token char">':'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=411></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=412></td><td><pre></pre></td></tr><tr><td data-num=413></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">_stoi</span><span class="token punctuation">(</span>contentLength<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=414></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=415></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod: GetLine() Error Not have body content\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=416></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod: GetLine() Error Not have body content\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=417></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=418></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=419></td><td><pre></pre></td></tr><tr><td data-num=420></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod Response....\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=421></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"PostMethod Response....\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=422></td><td><pre></pre></td></tr><tr><td data-num=423></td><td><pre>	<span class="token keyword">char</span> nickname<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=424></td><td><pre>	<span class="token keyword">char</span> email<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=425></td><td><pre>	<span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=426></td><td><pre>	<span class="token keyword">char</span> createat<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=427></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_nickname <span class="token operator">=</span> nickname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=428></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_email <span class="token operator">=</span> email<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=429></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_content <span class="token operator">=</span> content<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=430></td><td><pre>	<span class="token keyword">char</span><span class="token operator">*</span> p_createat <span class="token operator">=</span> createat<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=431></td><td><pre>	</pre></td></tr><tr><td data-num=432></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=433></td><td><pre>	<span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num=434></td><td><pre>		<span class="token operator">*</span>p_nickname <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=435></td><td><pre>		<span class="token operator">++</span>p_nickname<span class="token punctuation">;</span> <span class="token operator">++</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=436></td><td><pre>	<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num=437></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_email<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=438></td><td><pre>		<span class="token operator">*</span>p_email <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=439></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf <span class="token operator">&amp;&amp;</span> <span class="token char">':'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_content<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=440></td><td><pre>		<span class="token operator">*</span>p_content <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=441></td><td><pre>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token operator">++</span>buf<span class="token punctuation">;</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span><span class="token operator">++</span>p_createat<span class="token punctuation">,</span><span class="token operator">++</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=442></td><td><pre>		<span class="token operator">*</span>p_createat <span class="token operator">=</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=443></td><td><pre></pre></td></tr><tr><td data-num=444></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">"PostMethod: Recv Body: "</span><span class="token punctuation">,</span>nickname<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>email<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>createat<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=445></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">"PostMethod: Recv Body: "</span><span class="token punctuation">,</span>nickname<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>email<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>createat<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=446></td><td><pre></pre></td></tr><tr><td data-num=447></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">Element</span> el<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=448></td><td><pre>	MYSQL<span class="token operator">*</span> mysql <span class="token operator">=</span> <span class="token function">DatabaseConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=449></td><td><pre>  </pre></td></tr><tr><td data-num=450></td><td><pre>	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>el<span class="token punctuation">,</span><span class="token char">'\0'</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=451></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>tablename<span class="token punctuation">,</span><span class="token string">"CommentBlock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=452></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>nickname<span class="token punctuation">,</span>nickname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=453></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>email<span class="token punctuation">,</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=454></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>content<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=455></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>createat<span class="token punctuation">,</span>createat<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=456></td><td><pre>	<span class="token function">TableInsert</span><span class="token punctuation">(</span>mysql<span class="token punctuation">,</span><span class="token operator">&amp;</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=457></td><td><pre>	<span class="token function">DatabaseConnectClose</span><span class="token punctuation">(</span>mysql<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=458></td><td><pre></pre></td></tr><tr><td data-num=459></td><td><pre>	<span class="token function">HttpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token string">"api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=460></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=461></td><td><pre></pre></td></tr><tr><td data-num=462></td><td><pre><span class="token keyword">void</span> <span class="token function">HttpAccept</span><span class="token punctuation">(</span>i32 sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=463></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=464></td><td><pre>	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=465></td><td><pre>	<span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=466></td><td><pre>	i32 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=467></td><td><pre>	u32 bufSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=468></td><td><pre></pre></td></tr><tr><td data-num=469></td><td><pre>	len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=470></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=471></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=472></td><td><pre>		i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=473></td><td><pre>		u32 methodSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=474></td><td><pre></pre></td></tr><tr><td data-num=475></td><td><pre>		<span class="token comment">/* 获取请求的method */</span></pre></td></tr><tr><td data-num=476></td><td><pre>		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>methodSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=477></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=478></td><td><pre>			method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=479></td><td><pre>			<span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=480></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=481></td><td><pre>		</pre></td></tr><tr><td data-num=482></td><td><pre>		<span class="token comment">/* 处理对应的方法 */</span></pre></td></tr><tr><td data-num=483></td><td><pre>		<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token function">GetMethodType</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=484></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=485></td><td><pre>			<span class="token keyword">case</span> _GET<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">GetMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=486></td><td><pre>			<span class="token keyword">case</span> _POST<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token function">PostMethod</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=487></td><td><pre>			<span class="token keyword">case</span> _PUT<span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=488></td><td><pre>			<span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num=489></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=490></td><td><pre>				<span class="token comment">/* 不支持的请求方法 */</span></pre></td></tr><tr><td data-num=491></td><td><pre>				<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"warning! could not accept "</span><span class="token punctuation">,</span>method<span class="token punctuation">,</span><span class="token string">"method\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=492></td><td><pre>				<span class="token keyword">do</span></pre></td></tr><tr><td data-num=493></td><td><pre>				<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=494></td><td><pre>					<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=495></td><td><pre>					<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=496></td><td><pre>					len <span class="token operator">=</span> <span class="token function">GetLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>bufSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=497></td><td><pre>				<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=498></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=499></td><td><pre>		<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=500></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=501></td><td><pre>	<span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">Response400</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>					</pre></td></tr><tr><td data-num=502></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>httpserver.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre>i32 server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>i32 epoll_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>FILE<span class="token operator">*</span> source <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">void</span> <span class="token function">MainExit</span><span class="token punctuation">(</span>i32 sig<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\nMainEixt start\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"\nMainEixt start\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"MainEixt end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"MainEixt end\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>	i32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">signal</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>	<span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>MainExit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">ServerSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=29></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>		<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>		<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: ServerSocketConstruct() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>	epoll_fd <span class="token operator">=</span> <span class="token function">epoll_create</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>	<span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> ev<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>	u32 epoll_eventSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">epoll_event</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre></pre></td></tr><tr><td data-num=40></td><td><pre>	ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd <span class="token operator">=</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>	ev<span class="token punctuation">.</span>events <span class="token operator">=</span> EPOLLIN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>	<span class="token function">epoll_ctl</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">,</span>EPOLL_CTL_ADD<span class="token punctuation">,</span>server_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre>	<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre>	<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>		<span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> events<span class="token punctuation">[</span>MAXCLIENTS<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>		i32 eventNums <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>		</pre></td></tr><tr><td data-num=52></td><td><pre>		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>eventNums <span class="token operator">=</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">,</span>events<span class="token punctuation">,</span>MAXCLIENTS<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=53></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=54></td><td><pre>			<span class="token function">_LogFileWrite</span><span class="token punctuation">(</span>_LOGPATH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: epoll_wait() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>			<span class="token function">_CallDebug</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"main: epoll_wait() Error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre></pre></td></tr><tr><td data-num=59></td><td><pre>		<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> eventNums<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=60></td><td><pre>		<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=61></td><td><pre>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>server_fd <span class="token operator">==</span> events<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>events<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">&amp;</span> EPOLLIN<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=62></td><td><pre>			<span class="token punctuation">&#123;</span>		</pre></td></tr><tr><td data-num=63></td><td><pre>				i32 socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>				<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>				i32 accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>				</pre></td></tr><tr><td data-num=67></td><td><pre>				<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ev<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>epoll_eventSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>				ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd <span class="token operator">=</span> accept_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=69></td><td><pre>				ev<span class="token punctuation">.</span>events <span class="token operator">=</span> EPOLLIN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=70></td><td><pre>				<span class="token function">epoll_ctl</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">,</span>EPOLL_CTL_ADD<span class="token punctuation">,</span>accept_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre>			<span class="token keyword">else</span></pre></td></tr><tr><td data-num=73></td><td><pre>			<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=74></td><td><pre>				<span class="token function">HttpAccept</span><span class="token punctuation">(</span>events<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>				<span class="token function">close</span><span class="token punctuation">(</span>events<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=76></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=77></td><td><pre>		<span class="token punctuation">&#125;</span>		</pre></td></tr><tr><td data-num=78></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=79></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>epoll_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=81></td><td><pre>	</pre></td></tr><tr><td data-num=82></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h3 id=makefile><a class=anchor href=#makefile>#</a> makefile</h3><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre>OP<span class="token operator">=</span>gcc</pre></td></tr><tr><td data-num=2></td><td><pre>AP1<span class="token operator">=</span><span class="token operator">-</span>Wall</pre></td></tr><tr><td data-num=3></td><td><pre>AP2<span class="token operator">=</span><span class="token operator">-</span>g</pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>MYSQL<span class="token operator">=</span>$$<span class="token punctuation">(</span>mysql_config <span class="token operator">--</span>cflags <span class="token operator">--</span>libs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre>MSPATH<span class="token operator">=</span><span class="token operator">-</span>L<span class="token operator">/</span>usr<span class="token operator">/</span>lib64<span class="token operator">/</span>mysql <span class="token operator">-</span>lmysqlclient </pre></td></tr><tr><td data-num=7></td><td><pre>LIBPATH<span class="token operator">=</span><span class="token operator">-</span>L<span class="token punctuation">.</span> <span class="token operator">-</span>l_slibs</pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre>DM<span class="token operator">=</span><span class="token operator">-</span>fPIC <span class="token operator">-</span>shared</pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>all<span class="token operator">:</span> httpserver</pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">Product</span></span></pre></td></tr><tr><td data-num=14></td><td><pre>httpserver<span class="token operator">:</span> httpserver<span class="token punctuation">.</span>c http<span class="token punctuation">.</span>h http<span class="token punctuation">.</span>c database<span class="token punctuation">.</span>h database<span class="token punctuation">.</span>c _clibs<span class="token punctuation">.</span>h _clibs<span class="token punctuation">.</span>c</pre></td></tr><tr><td data-num=15></td><td><pre>	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token operator">-</span>c _clibs<span class="token punctuation">.</span>c</pre></td></tr><tr><td data-num=16></td><td><pre>	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token operator">-</span>c database<span class="token punctuation">.</span>c </pre></td></tr><tr><td data-num=17></td><td><pre>	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token operator">-</span>c http<span class="token punctuation">.</span>c</pre></td></tr><tr><td data-num=18></td><td><pre>	ar rcs lib_slibs<span class="token punctuation">.</span>a _clibs<span class="token punctuation">.</span>o database<span class="token punctuation">.</span>o http<span class="token punctuation">.</span>o</pre></td></tr><tr><td data-num=19></td><td><pre>	rm <span class="token operator">-</span>rf _clibs<span class="token punctuation">.</span>o database<span class="token punctuation">.</span>o http<span class="token punctuation">.</span>o</pre></td></tr><tr><td data-num=20></td><td><pre>	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> $<span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> <span class="token operator">-</span>O2 $<span class="token punctuation">(</span>MSPATH<span class="token punctuation">)</span> httpserver<span class="token punctuation">.</span>c lib_slibs<span class="token punctuation">.</span>a <span class="token operator">-</span>o httpserver </pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">Static</span></span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">httpserver</span><span class="token expression"><span class="token operator">:</span> httpserver<span class="token punctuation">.</span>c http<span class="token punctuation">.</span>h http<span class="token punctuation">.</span>c database<span class="token punctuation">.</span>h database<span class="token punctuation">.</span>c _clibs<span class="token punctuation">.</span>h _clibs<span class="token punctuation">.</span>c</span></span></pre></td></tr><tr><td data-num=24></td><td><pre>#	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token operator">-</span>c _clibs<span class="token punctuation">.</span>c</pre></td></tr><tr><td data-num=25></td><td><pre>#	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token operator">-</span>c database<span class="token punctuation">.</span>c </pre></td></tr><tr><td data-num=26></td><td><pre>#	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> <span class="token operator">-</span>c http<span class="token punctuation">.</span>c</pre></td></tr><tr><td data-num=27></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>	<span class="token directive keyword">ar</span> <span class="token expression">rcs lib_slibs<span class="token punctuation">.</span>a _clibs<span class="token punctuation">.</span>o database<span class="token punctuation">.</span>o http<span class="token punctuation">.</span>o</span></span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>	<span class="token directive keyword">rm</span> <span class="token expression"><span class="token operator">-</span>rf _clibs<span class="token punctuation">.</span>o database<span class="token punctuation">.</span>o http<span class="token punctuation">.</span>o</span></span></pre></td></tr><tr><td data-num=29></td><td><pre>#	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> $<span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> $<span class="token punctuation">(</span>AP2<span class="token punctuation">)</span> $<span class="token punctuation">(</span>MSPATH<span class="token punctuation">)</span> <span class="token operator">-</span>pthread httpserver<span class="token punctuation">.</span>c lib_slibs<span class="token punctuation">.</span>a <span class="token operator">-</span>o httpserver </pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">Dynamic</span></span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">httpserver</span><span class="token expression"><span class="token operator">:</span> httpserver<span class="token punctuation">.</span>c http<span class="token punctuation">.</span>h http<span class="token punctuation">.</span>c database<span class="token punctuation">.</span>h database<span class="token punctuation">.</span>c _clibs<span class="token punctuation">.</span>h _clibs<span class="token punctuation">.</span>c</span></span></pre></td></tr><tr><td data-num=33></td><td><pre>#	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> $<span class="token punctuation">(</span>DM<span class="token punctuation">)</span> $<span class="token punctuation">(</span>MYSQL<span class="token punctuation">)</span> http<span class="token punctuation">.</span>c database<span class="token punctuation">.</span>c _clibs<span class="token punctuation">.</span>c <span class="token operator">-</span>o lib_slibs<span class="token punctuation">.</span>so</pre></td></tr><tr><td data-num=34></td><td><pre>#	$<span class="token punctuation">(</span>OP<span class="token punctuation">)</span> $<span class="token punctuation">(</span>AP1<span class="token punctuation">)</span> $<span class="token punctuation">(</span>AP2<span class="token punctuation">)</span> $<span class="token punctuation">(</span>LIBPATH<span class="token punctuation">)</span> <span class="token operator">-</span>pthread httpserver<span class="token punctuation">.</span>c <span class="token operator">-</span>o httpserver </pre></td></tr><tr><td data-num=35></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>	<span class="token directive keyword">export</span> <span class="token expression">LD_LIBRARY_PATH<span class="token operator">=</span>$$LD_LIBRARY_PATH<span class="token operator">:</span><span class="token operator">/</span>root<span class="token operator">/</span>httpserver</span></span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>clean<span class="token operator">:</span></pre></td></tr><tr><td data-num=38></td><td><pre>	rm <span class="token operator">-</span>rf httpserver <span class="token operator">*</span><span class="token punctuation">.</span>a <span class="token operator">*</span><span class="token punctuation">.</span>log <span class="token operator">*</span><span class="token punctuation">.</span>so</pre></td></tr></table></figure><h2 id=源码使用流程详解><a class=anchor href=#源码使用流程详解>#</a> 源码使用流程详解</h2><p><strong>目录结构</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>httpserver</pre></td></tr><tr><td data-num=2></td><td><pre>├── docs</pre></td></tr><tr><td data-num=3></td><td><pre>│   ├── css</pre></td></tr><tr><td data-num=4></td><td><pre>│   │   └── comments.css</pre></td></tr><tr><td data-num=5></td><td><pre>│   ├── img</pre></td></tr><tr><td data-num=6></td><td><pre>│   │   └── img.png</pre></td></tr><tr><td data-num=7></td><td><pre>│   ├── index.html</pre></td></tr><tr><td data-num=8></td><td><pre>│   └── js</pre></td></tr><tr><td data-num=9></td><td><pre>│       └── comments.js</pre></td></tr><tr><td data-num=10></td><td><pre>├── _clibs.h</pre></td></tr><tr><td data-num=11></td><td><pre>├── _clibs.c</pre></td></tr><tr><td data-num=12></td><td><pre>├── database.h</pre></td></tr><tr><td data-num=13></td><td><pre>├── database.c</pre></td></tr><tr><td data-num=14></td><td><pre>├── http.h</pre></td></tr><tr><td data-num=15></td><td><pre>├── http.c</pre></td></tr><tr><td data-num=16></td><td><pre>├── httpserver.c</pre></td></tr><tr><td data-num=17></td><td><pre>└── makefile</pre></td></tr></table></figure><p>(<strong>info</strong>) 阅览<a href=https://www.reversesacle.com/computer-science/programming/c-language/network-programming/Linux-basic/ >→Linux(CentOS 7)</a>，从<strong>准备条件</strong>部分到<strong>通过客户端连接服务器</strong>部分，以及额外的<strong>客户端(SFTP)命令</strong>部分。<code>SecureCRT</code>软件连接Linux虚拟机环境，连接之后在顶栏标签处右键选<code>Connect SFTP Session</code>，之后可通过SFTP命令向Linux虚拟机环境传输或获取文件。SFTP可用<span class=exturl data-url=aHR0cHM6Ly9maWxlemlsbGEtcHJvamVjdC5vcmcv>FileZilla</span>代替。</p><p>(<strong>info</strong>) 需在Linux环境下安装MySQL，详细看该篇文章第一部分的<strong>Linux服务器处理进程的数据库链接</strong>内容。</p><p>确保Linux虚拟机环境中安装了make工具，倘若没有可使用安装命令 - <code>yum -y install make</code></p><p>此外，还需修改<code>comments.js</code>文件<code>window.onload</code>开头的<code>_host</code>变量的值，改为<code>SecureCRT</code>连接的IP地址。</p><p>最后，在<code>httpserver</code>根目录中执行命令<code>make</code>，接着执行<code>./httpserver</code>即可启动服务端进程，之后在浏览器中的输入栏输入<code>http://(SecureCRT连接的IP地址)/index.html</code>，回车即可看到评论系统的前端界面。</p><div class=tags><a href=/tags/osp/ rel=tag><i class="ic i-tag"></i> 开源项目</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span> <span class=text>更新于</span> <time title="修改时间：2025-09-19 22:24:59" itemprop=dateModified datetime=2025-09-19T22:24:59+08:00>2025-09-19</time></span><span class=item data-path=/computer-science/programming/c-language/c-project/comment-system-part2/ title=阅读次数><span class=icon><i class="ic i-eye"></i></span> <span class=text>阅读次数</span><span class=waline-pageview-count></span> <span class=text>次</span></span></div><div id=copyright><ul><li class=author><strong>本文作者：</strong> ReverseSacle <i class="ic i-at"><em>@</em></i>逆转天平</li><li class=link><strong>本文链接：</strong> <a href=https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-part2/ title=网站留言评论系统的设计与手动实现-初稿-第二部分>https://www.reversesacle.com/computer-science/programming/c-language/c-project/comment-system-part2/</a></li><li class=license><strong>版权声明：</strong> 本站所有文章除特别声明外，均采用 <span class=exturl data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class=post-nav><div class="item left"><a href=/computer-science/programming/c-language/c-project/comment-system-part1/ itemprop=url rel=prev data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg12.webp title=网站留言评论系统的设计与手动实现-初稿-第一部分><span class=type>上一篇</span><span class=category><i class="ic i-flag"></i> C语言项目</span><h3>网站留言评论系统的设计与手动实现-初稿-第一部分</h3></a></div><div class="item right"><a href=/computer-science/programming/c-language/c-project/comment-system-mid/ itemprop=url rel=next data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg13.webp title=网站留言评论系统的设计与手动实现-中稿><span class=type>下一篇</span><span class=category><i class="ic i-flag"></i> C语言项目</span><h3>网站留言评论系统的设计与手动实现-中稿</h3></a></div></div><div class=wrap id=comments><div id=waline-comment></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=文章目录><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#%E4%BB%8E0%E5%88%B01%E7%9A%84%E6%BA%90%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E7%9A%84%E7%BD%91%E7%AB%99%E7%95%99%E8%A8%80%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F-%E5%88%9D%E7%A8%BF><span class=toc-number>1.</span> <span class=toc-text>从0到1的源代码编写的网站留言评论系统-初稿</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%80%82%E5%BA%94%E6%80%A7%E8%AF%84%E8%AE%BA%E6%98%BE%E7%A4%BA%E5%8C%BA%E5%9F%9F%E6%A0%B7%E5%BC%8F%E5%B8%83%E5%B1%80><span class=toc-number>1.1.</span> <span class=toc-text>适应性评论显示区域样式布局</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%80%82%E5%BA%94%E6%80%A7%E6%A0%B7%E5%BC%8F%E5%B8%83%E5%B1%80%E9%A2%84%E8%A7%88><span class=toc-number>1.1.1.</span> <span class=toc-text>适应性样式布局预览</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%89%8D%E7%AB%AF%E6%BA%90%E7%A0%81><span class=toc-number>1.1.2.</span> <span class=toc-text>前端源码</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%90%8E%E7%AB%AF%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%BA%90%E7%A0%81><span class=toc-number>1.1.3.</span> <span class=toc-text>后端与数据库源码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%BC%8F><span class=toc-number>1.2.</span> <span class=toc-text>服务器进程的多线程模式</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%BA%E6%9C%AC%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%BC%8F><span class=toc-number>1.2.1.</span> <span class=toc-text>基本多线程模式</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BA%BF%E7%A8%8B%E8%B5%84%E6%BA%90%E7%9A%84%E5%9B%9E%E6%94%B6%E9%81%BF%E5%85%8D%E5%83%B5%E5%B0%B8%E7%BA%BF%E7%A8%8B><span class=toc-number>1.2.2.</span> <span class=toc-text>线程资源的回收(避免僵尸线程)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%90%91%E7%BA%BF%E7%A8%8B%E5%8F%91%E9%80%81%E9%80%80%E5%87%BA%E4%BF%A1%E5%8F%B7%E5%B9%B6%E5%9C%A8%E9%80%80%E5%87%BA%E5%89%8D%E6%89%A7%E8%A1%8C%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0><span class=toc-number>1.2.3.</span> <span class=toc-text>向线程发送退出信号并在退出前执行处理函数</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%86%99%E6%93%8D%E4%BD%9C%E6%B7%BB%E5%8A%A0%E9%94%81%E6%93%8D%E4%BD%9C><span class=toc-number>1.2.4.</span> <span class=toc-text>为数据库的写操作添加锁操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%97%A5%E5%BF%97%E7%9B%91%E5%90%AC%E6%A8%A1%E5%BC%8F><span class=toc-number>1.3.</span> <span class=toc-text>服务器进程的日志监听模式</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0%E4%B8%8E%E7%BB%93%E6%9E%84%E4%BC%98%E5%8C%96><span class=toc-number>1.3.1.</span> <span class=toc-text>基本实现与结构优化</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%BA%E6%97%A5%E5%BF%97%E5%86%99%E6%93%8D%E4%BD%9C%E6%B7%BB%E5%8A%A0%E9%94%81%E6%93%8D%E4%BD%9C><span class=toc-number>1.3.2.</span> <span class=toc-text>为日志写操作添加锁操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8A%A8%E6%80%81%E5%BA%93%E4%B8%8E%E9%9D%99%E6%80%81%E5%BA%93%E7%9A%84%E5%88%B6%E4%BD%9C><span class=toc-number>1.4.</span> <span class=toc-text>动态库与静态库的制作</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%9D%99%E6%80%81%E5%BA%93><span class=toc-number>1.4.1.</span> <span class=toc-text>静态库</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8A%A8%E6%80%81%E5%BA%93><span class=toc-number>1.4.2.</span> <span class=toc-text>动态库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9B%E7%A8%8B%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E5%8C%96%E5%A4%84%E7%90%86><span class=toc-number>1.5.</span> <span class=toc-text>服务器进程的高性能化处理</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%8B%E4%B8%8B%E7%9A%84%E5%9D%912%E7%9A%84%E8%A7%A3%E5%86%B3><span class=toc-number>1.5.1.</span> <span class=toc-text>埋下的坑2的解决</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%8B%E4%B8%8B%E7%9A%84%E5%9D%911%E7%9A%84%E8%A7%A3%E5%86%B3><span class=toc-number>1.5.2.</span> <span class=toc-text>埋下的坑1的解决</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%8B%E4%B8%8B%E7%9A%84%E5%9D%913%E7%9A%84%E8%A7%A3%E5%86%B3%E4%B8%8Eio%E5%A4%8D%E7%94%A8%E6%A8%A1%E5%BC%8F><span class=toc-number>1.5.3.</span> <span class=toc-text>埋下的坑3的解决与I&#x2F;O复用模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%8C%E6%95%B4%E5%88%9D%E7%A8%BF%E6%9C%80%E7%BB%88%E6%BA%90%E7%A0%81><span class=toc-number>1.6.</span> <span class=toc-text>完整初稿最终源码</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%89%8D%E7%AB%AF%E6%BA%90%E7%A0%81-2><span class=toc-number>1.6.1.</span> <span class=toc-text>前端源码</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%90%8E%E7%AB%AF%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%BA%90%E7%A0%81-2><span class=toc-number>1.6.2.</span> <span class=toc-text>后端与数据库源码</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#makefile><span class=toc-number>1.6.3.</span> <span class=toc-text>makefile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%BA%90%E7%A0%81%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3><span class=toc-number>1.7.</span> <span class=toc-text>源码使用流程详解</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title=系列文章><ul><li><a href=/computer-science/programming/c-language/c-project/comment-system-part1/ rel=bookmark title=网站留言评论系统的设计与手动实现-初稿-第一部分>网站留言评论系统的设计与手动实现-初稿-第一部分</a></li><li class=active><a href=/computer-science/programming/c-language/c-project/comment-system-part2/ rel=bookmark title=网站留言评论系统的设计与手动实现-初稿-第二部分>网站留言评论系统的设计与手动实现-初稿-第二部分</a></li><li><a href=/computer-science/programming/c-language/c-project/comment-system-mid/ rel=bookmark title=网站留言评论系统的设计与手动实现-中稿>网站留言评论系统的设计与手动实现-中稿</a></li></ul></div><div class="overview panel" data-title=站点概览><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img class=image itemprop=image alt=ReverseSacle data-src=/images/avatar.webp><p class=name itemprop=name>ReverseSacle</p><div class=description itemprop=description>知识书库 & 学习点滴</div></div><nav class=state><div class="item posts"><a href=/archives/ ><span class=count>186</span> <span class=name>文章</span></a></div><div class="item categories"><a href=/categories/ ><span class=count>52</span> <span class=name>分类</span></a></div><div class="item tags"><a href=/tags/ ><span class=count>18</span> <span class=name>标签</span></a></div></nav><div class=social><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JldmVyc2VTYWNsZQ==" title=https:&#x2F;&#x2F;github.com&#x2F;ReverseSacle><i class="ic i-github"></i></span><span class="exturl item email" data-url="bWFpbHRvOnByaXZhdGVAcmV2ZXJzZXNhY2xlLmNvbQ==" title=mailto:private@reversesacle.com><i class="ic i-envelope"></i></span></div><ul class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i> 首页</a></li><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-feather"></i> 文章</a><ul class=submenu><li class=item><a href=/archives/ rel=section><i class="ic i-list-alt"></i> 归档</a></li><li class=item><a href=/categories/ rel=section><i class="ic i-th"></i> 分类</a></li><li class=item><a href=/tags/ rel=section><i class="ic i-tags"></i> 标签</a></li></ul></li><li class=item><a href=/about/ rel=section><i class="ic i-user"></i> 关于</a></li><li class=item><a href=/friend-links/ rel=section><i class="ic i-heart"></i> 友链</a></li></ul></div></div></div><ul id=quick><li class="prev pjax"><a href=/computer-science/programming/c-language/c-project/comment-system-part1/ rel=prev title=上一篇><i class="ic i-chevron-left"></i></a></li><li class=up><i class="ic i-arrow-up"></i></li><li class=down><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href=/computer-science/programming/c-language/c-project/comment-system-mid/ rel=next title=下一篇><i class="ic i-chevron-right"></i></a></li><li class=percent></li></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>随机文章</h2><ul><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/binary-tree/ title="分类于 二叉树">二叉树</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/binary-tree/sort/ title=二叉树-序列重组>二叉树-序列重组</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/stack/ title="分类于 栈">栈</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/stack/derivatives/ title=栈问题派生>栈问题派生</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/dev-tool/ title="分类于 开发工具">开发工具</a></div><span><a href=/computer-science/programming/dev-tool/git/ title=分布式版本控制系统Git>分布式版本控制系统Git</a></span></li><li class=item><div class=breadcrumb><a href=/categories/general-science-and-technology/ title="分类于 通用科学技术">通用科学技术</a><i class="ic i-angle-right"></i> <a href=/categories/general-science-and-technology/pc/ title="分类于 通用技术之PC端">通用技术之PC端</a><i class="ic i-angle-right"></i> <a href=/categories/general-science-and-technology/pc/laptop/ title="分类于 笔记本">笔记本</a></div><span><a href=/general-science-and-technology/pc/laptop/laptop-clean/ title=笔记本的清洁>笔记本的清洁</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/dynamic-program/ title="分类于 动态规划">动态规划</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/dynamic-program/link/ title=动态规划-链路>动态规划-链路</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/binary-tree/ title="分类于 二叉树">二叉树</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/binary-tree/sum/ title=二叉树-求和>二叉树-求和</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/computer-basic/ title="分类于 计算机基础">计算机基础</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/computer-basic/computer-composition-principles/ title="分类于 计算机组成原理">计算机组成原理</a></div><span><a href=/computer-science/computer-basic/composition/ccppart2/ title=计算机组成原理-CSAPP-第二部分>计算机组成原理-CSAPP-第二部分</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/string/ title="分类于 字符串">字符串</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/string/derivatives/ title=字符串问题派生>字符串问题派生</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/python/ title="分类于 Python">Python</a></div><span><a href=/computer-science/programming/python/pyinstaller/ title=Pyinstaller打包工具>Pyinstaller打包工具</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a></div><span><a href=/computer-science/programming/c-language/c-data-structure/nonlinear-structure/binary-tree/ title=C语言-二叉树(二叉链表)>C语言-二叉树(二叉链表)</a></span></li></ul></div><div><h2>最新评论</h2><ul id=waline-recent></ul></div></div><div class=status><div class=copyright>&copy; 2021 – <span itemprop=copyrightYear>2025</span><span class=with-love><i class="ic i-sakura rotate"></i></span> <span class=author itemprop=copyrightHolder>ReverseSacle @ ReverseSacle-Blog</span></div><div class=count><i class="ic i-clock" aria-hidden=true></i> <span id=time align=center>载入时间中...<script defer>var now=new Date;function createtime(){var n=new Date("2021-11-16 22:30:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("time").innerHTML="已经过 "+dnum+" 天 "+hnum+" 小时 "+mnum+" 分 "+snum+" 秒 "}setInterval("createtime()",250)</script></span><span class=post-meta-item-icon>|&nbsp<i class="ic i-chart-area"></i></span> <span title=站点总字数>2.1m 字</span> <span class=post-meta-item-icon>|&nbsp<i class="ic i-coffee"></i></span> <span title=站点阅读时长>40:40</span></div></div></div></footer></div><script data-config>var LOCAL={path:"computer-science/programming/c-language/c-project/comment-system-part2/",favicon:{show:"ReverseSacle-Blog",hide:"ReverseSacle-Blog"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},waline:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src=https://polyfill.alicdn.com/v3/polyfill.min.js></script><script src=https://cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1.16.0/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js></script><script src=/js/app.js></script></body></html>