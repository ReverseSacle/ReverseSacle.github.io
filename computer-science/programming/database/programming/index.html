<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#222><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/ico sizes=48x48 href=/images/favicon.ico><link rel=alternate type=application/rss+xml title=逆转天平 href=https://www.reversesacle.com/rss.xml><link rel=alternate type=application/atom+xml title=逆转天平 href=https://www.reversesacle.com/atom.xml><link rel=alternate type=application/json title=逆转天平 href=https://www.reversesacle.com/feed.json><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=/css/app.css><meta name=description content=数据库><link rel=canonical href=https://www.reversesacle.com/computer-science/programming/database/programming/ ><title>数据库编程基础 - 数据库 - 编程 - 计算机科学 | ReverseSacle-Blog</title><meta name=generator content="Hexo 6.3.0"></head><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=dotloader><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">数据库编程基础</h1><div class=meta><span class=item title="创建时间：2023-08-14 14:28:22"><span class=icon><i class="ic i-calendar"></i></span> <span class=text>发表于</span> <time itemprop="dateCreated datePublished" datetime=2023-08-14T14:28:22+08:00>2023-08-14</time></span><span class=item title=本文字数><span class=icon><i class="ic i-pen"></i></span> <span class=text>本文字数</span> <span>12k</span> <span class=text>字</span></span><span class=item title=阅读时长><span class=icon><i class="ic i-clock"></i></span> <span class=text>阅读时长</span> <span>14 分钟</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div class=lines role=navigation aria-label=切换导航栏><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>ReverseSacle-Blog</a></li></ul><ul class=right><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id=imgs class=pjax><ul><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg3.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg14.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg4.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg13.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg7.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg10.webp></li></ul></div></header><div id=waves><svg class=waves xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewBox="0 24 150 28" preserveAspectRatio=none shape-rendering=auto><defs><path id=gentle-wave d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352z"/></defs><g class=parallax><use xlink:href=#gentle-wave x=48 y=0 /><use xlink:href=#gentle-wave x=48 y=3 /><use xlink:href=#gentle-wave x=48 y=5 /><use xlink:href=#gentle-wave x=48 y=7 /></g></svg></div><main><div class=inner><div id=main class=pjax><div class="article wrap"><div class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i> <span><a href=/ >首页</a></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/ itemprop=item rel=index title="分类于 计算机科学"><span itemprop=name>计算机科学</span></a><meta itemprop=position content=1></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/ itemprop=item rel=index title="分类于 编程"><span itemprop=name>编程</span></a><meta itemprop=position content=2></span><i class="ic i-angle-right"></i> <span class=current itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/database/ itemprop=item rel=index title="分类于 数据库"><span itemprop=name>数据库</span></a><meta itemprop=position content=3></span></div><article itemscope itemtype=http://schema.org/Article class="post block" lang=zh-CN><link itemprop=mainEntityOfPage href=https://www.reversesacle.com/computer-science/programming/database/programming/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.webp><meta itemprop=name content=ReverseSacle><meta itemprop=description content="所见即所得，所思即所行, 知识书库 & 学习点滴"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=逆转天平></span><div class="body md" itemprop=articleBody><h2 id=概述><a class=anchor href=#概述>#</a> 概述</h2><p>SQL编程语言计算可以有效克服SQL语言实现复杂应用方面的不足，提高应用系统的数据库管理系统间的相互操作。</p><p>SQL编程访问和管理数据库的方式有嵌入式SQL，过程化SQL，存储过程和定义函数，开放数据库互连，OLE OB，java数据库连接等编程方式。</p><p><strong>嵌入式SQL</strong></p><p>SQL语言的特点之一是交互式和嵌入式两种不同的使用方式下，SQL的语法结构基本一致，在程序设计的环境下，SQL语句要做某些必要的扩充。</p><p>主语言，嵌入式SQL是将SQL语句嵌入程序设计语言中，被嵌入的程序设计语言，如C, C++, Java，称为宿主语言，简称主语言。</p><p>嵌入式SQL前缀，为了区分SQL语句与主语言语句，所有SQL语句必须加前缀。</p><p>主语言为C语言时，语句格式为 <code>EXEC SQL SQL语句</code></p><p><strong>嵌入式SQL处理过程的预编译方法</strong></p><p>含嵌入式SQL语句的主语言程序 → 关系数据库管理系统预处理程序转换嵌入式SQL语句为函数调用 →</p><p>转换后的主语言程序 → 主语言编译程序编译处理 → 目标语言程序</p><h2 id=嵌入式sql语句与主语言之间的通信><a class=anchor href=#嵌入式sql语句与主语言之间的通信>#</a> 嵌入式SQL语句与主语言之间的通信</h2><p>嵌入式SQL语句中会含有两种不同计算模型的语句，SQL语句负责操纵数据库，高级语言负责控制逻辑流程。</p><p>数据库工作单元与源程序工作单位之间的通信</p><ul><li>向主语言传递SQL语句的执行状态信息，使主语言能够依据此控制程序流程，主要用SQL通信区(SQLCA: SQL Communication Area)实现</li><li>主语言向SQL语句提供参数，主要用主变量(host variable)实现</li><li>将SQL语句查询数据库的结果交主语言处理，主要用主变量和游标(cursor)实现</li></ul><h3 id=sql通信区><a class=anchor href=#sql通信区>#</a> SQL通信区</h3><p>SQLCA的用途，SQL语句执行后，系统将描述当前工作状态的数据和描述运行环境的数据送到SQL通信区中，应用程序从SQL通信区中取出这些状态信息，据此决定接下来执行的语句。</p><p>定义SQLCA格式<code>EXEC SQL INCLUDE SOLCA</code></p><p>SQLCA中设置变量SQLCODE，存放每次执行SQL语句后返回代码。</p><p>当SQLCODE等于SUCCESS，表示SQL语句成功，否则出错。</p><p>应用程序每执行完一条SQL语句都应该测试一下SQLCODE的值以了解该SQL语句执行情况并做相关处理。</p><h3 id=主变量><a class=anchor href=#主变量>#</a> 主变量</h3><p>嵌入式SQL语句中可以使用主语言的程序变量来输入输出数据，在SQL语句中使用的主语言程序变量，简称主变量。</p><p>输入主变量 → 由应用程序对其赋值，SQL语句引用</p><p>输出主变量 → 由SQL语句对其赋值或设置状态信息，返回给应用程序</p><p>指示变量 → 是一个整型变量，一个主变量可以附带一个指示变量，用来指示所指主变量的值或条件，例如指示变量的用途，指示输入主变量是否为空值，检测输出变量是否为空值，值是否被截断等</p><p>定义的主变量可以在SQL语句中任何一个能使用表达式的地方出现。</p><p>为了与数据库对象名(表名，视图名，列名等)区别，SQL语句中的主变量名前要加冒号<code>:</code>作为标志。</p><p>指示变量必须紧跟在所指主变量之后，指示变量前也必须加冒号标志。</p><p>在SQL语句之外(主语言语句中)，可以直接引用主变量和指示变量，不必加冒号。</p><h3 id=游标><a class=anchor href=#游标>#</a> 游标</h3><p>SQL语言是面向集合的，一条SQL语句原则上可以产生或处理多条记录。主语言是面向记录的，一组主变量一次只能存放一条记录。仅使用主变量并不能完全满足SQL语句向应用程序输出数据的要求。嵌入式SQL引入了游标的概念，用来协调这两种不同的处理方式。</p><p>游标是系统为用户开设的一个数据缓冲区，存放SQL语句的执行结果，每个游标区都有一个名字，用户可以用SQL语句逐一从游标中获取记录，并赋给主变量，交由主语言进一步处理。</p><h3 id=建立和关闭数据库连接><a class=anchor href=#建立和关闭数据库连接>#</a> 建立和关闭数据库连接</h3><p><strong>建立数据库连接</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>EXEC SQL CONNECT TO target<span class="token punctuation">[</span>AS Connection-name<span class="token punctuation">]</span><span class="token punctuation">[</span>USER user-name<span class="token punctuation">]</span>;</pre></td></tr></table></figure><p>target是要连接的数据库服务器，常见的如包含服务器表示的SQL串常量，<code>&lt;dbname&gt;@&lt;hostname&gt;:&lt;port&gt;</code>，DEFAULT。</p><p>connection-name指定的连接名。连接名必须是一个有效的标识符。如果在整个程序内只有一个连接时可以不指定连接名。</p><p>程序运行过程中可以用以下语句修改当前连接</p><ul><li><code>EXEC SQL SET CONNECTIN connection-name | DEFAULT</code></li></ul><p><strong>关闭数据库</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>EXEC SQL DISCONNECT <span class="token punctuation">[</span>connection<span class="token punctuation">]</span>;</pre></td></tr></table></figure><p>connection是用<code>EXEC SQL CONNECT</code>所建立的数据库连接。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">//依次检查学生记录，交互式更新某些学生年龄</span></pre></td></tr><tr><td data-num=2></td><td><pre>EXEC SQL BEGIN DECLARE SECTION<span class="token punctuation">;</span><span class="token comment">//主变量说明开始</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">char</span> Deptname<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">char</span> HSno<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">char</span> HSname<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">char</span> HSsex<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">int</span> HSage<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">int</span> NEWAGE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>EXEC SQL END DECLARE SECION<span class="token punctuation">;</span><span class="token comment">//主变量说明结束</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">long</span> SQLCODE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>EXEC SQL INCLUDE SQLCA<span class="token punctuation">;</span><span class="token comment">//定义SQL通信区</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token keyword">char</span> yn<span class="token punctuation">;</span><span class="token comment">//变量yn代表yes或no</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please choose the department name(CS/MA/IS):"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>Deptname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//为主变量Deptname赋值</span></pre></td></tr><tr><td data-num=19></td><td><pre>    EXEC SQL CONNECT TO TEST@localhost<span class="token operator">:</span><span class="token number">54321</span> USER \</pre></td></tr><tr><td data-num=20></td><td><pre>        			<span class="token string">"SYSTEM"</span><span class="token operator">/</span> <span class="token string">"MANAGER"</span><span class="token punctuation">;</span><span class="token comment">//连接数据库TEST</span></pre></td></tr><tr><td data-num=21></td><td><pre>    EXEC SQL DECLARE SX CURSOR FOR <span class="token comment">//定义游标SX</span></pre></td></tr><tr><td data-num=22></td><td><pre>        SELECT Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Ssex<span class="token punctuation">,</span>Sage <span class="token comment">//SX对应的语句</span></pre></td></tr><tr><td data-num=23></td><td><pre>        FROM Student</pre></td></tr><tr><td data-num=24></td><td><pre>        WHERE SDept <span class="token operator">=</span><span class="token operator">:</span>Deptname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    EXEC SQL OPEN SX<span class="token punctuation">;</span><span class="token comment">//打开游标SX,指向查询结果的第一行</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token comment">//用循环结构逐条处理结果集中的记录</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>        EXEC SQL FETCH SX INTO \</pre></td></tr><tr><td data-num=29></td><td><pre>            <span class="token operator">:</span>HSno<span class="token punctuation">,</span><span class="token operator">:</span>HSname<span class="token punctuation">,</span><span class="token operator">:</span>HSsex<span class="token punctuation">,</span><span class="token operator">:</span>HSage<span class="token punctuation">;</span><span class="token comment">//推进游标，将当前数据放入主变量</span></pre></td></tr><tr><td data-num=30></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> SQLCA<span class="token punctuation">.</span>SQLCODE<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//如果表示操作不成功退出循环</span></pre></td></tr><tr><td data-num=31></td><td><pre>        </pre></td></tr><tr><td data-num=32></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token operator">++</span>count<span class="token punctuation">)</span><span class="token comment">//如果是第一行，先输出行头</span></pre></td></tr><tr><td data-num=33></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%-10s %-20s %-10s %-10s"</span><span class="token punctuation">,</span><span class="token string">"Sno"</span><span class="token punctuation">,</span><span class="token string">"Sname"</span><span class="token punctuation">,</span><span class="token string">"Sex"</span><span class="token punctuation">,</span><span class="token string">"Sage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n%-10s %-20s %-10s %-10s"</span><span class="token punctuation">,</span>HSno<span class="token punctuation">,</span>HSname<span class="token punctuation">,</span>HSex<span class="token punctuation">,</span>HSage<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打印查询结果</span></pre></td></tr><tr><td data-num=35></td><td><pre>        </pre></td></tr><tr><td data-num=36></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"UPDATE AGE(y/n)? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//询问用户是否要更新该学生的年龄</span></pre></td></tr><tr><td data-num=37></td><td><pre>        <span class="token keyword">do</span></pre></td></tr><tr><td data-num=38></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>yn<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'N'</span> <span class="token operator">!=</span> yn <span class="token operator">&amp;&amp;</span> <span class="token char">'n'</span> <span class="token operator">!=</span> yn <span class="token operator">&amp;&amp;</span> <span class="token char">'Y'</span> <span class="token operator">!=</span> yn <span class="token operator">&amp;&amp;</span> <span class="token char">'y'</span> <span class="token operator">!=</span> yn<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'y'</span> <span class="token operator">==</span> yn <span class="token operator">||</span> <span class="token char">'Y'</span> <span class="token operator">==</span> yn<span class="token punctuation">)</span><span class="token comment">//如果选择更新操作</span></pre></td></tr><tr><td data-num=42></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=43></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"INPUT NEW AGE:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>NEWAGE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//用户输入新年龄到主变量</span></pre></td></tr><tr><td data-num=45></td><td><pre>            EXEC SQL UPDATE Stuednt SET Sage <span class="token operator">=</span><span class="token operator">:</span>NEWAGE \<span class="token comment">//嵌入式SQL更新语句</span></pre></td></tr><tr><td data-num=46></td><td><pre>                WHERE CURRENT OF SX<span class="token punctuation">;</span><span class="token comment">//更新当前游标指向的学生年龄</span></pre></td></tr><tr><td data-num=47></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=48></td><td><pre>        </pre></td></tr><tr><td data-num=49></td><td><pre>        EXEC SQL CLOSE SX<span class="token punctuation">;</span><span class="token comment">//关闭游标SX，不再和查询结果对应</span></pre></td></tr><tr><td data-num=50></td><td><pre>        EXEC SQL COMMIT WORK<span class="token punctuation">;</span><span class="token comment">//提交更新</span></pre></td></tr><tr><td data-num=51></td><td><pre>        EXEC SQL DISCONNECT TEST<span class="token punctuation">;</span><span class="token comment">//断开数据库连接</span></pre></td></tr><tr><td data-num=52></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=不用游标的sql语句><a class=anchor href=#不用游标的sql语句>#</a> 不用游标的SQL语句</h3><p>当SQL语句为以下几种时，可以不用游标</p><ul><li>说明性语句</li><li>数据定义语句</li><li>数据控制语句</li><li>查询结果为单记录的SELECT语句</li><li>非CURRENT形式的增删改语句</li></ul><h4 id=查询结果为单记录的select语句><a class=anchor href=#查询结果为单记录的select语句>#</a> 查询结果为单记录的SELECT语句</h4><p>这类语句不需要使用游标，中需要用INTO子句指定存放查询结果的主变量。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">//根据学生号码查询学生信息</span></pre></td></tr><tr><td data-num=2></td><td><pre>EXEC SQL SELECT Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Ssex<span class="token punctuation">,</span>Sage<span class="token punctuation">,</span>Sdept \</pre></td></tr><tr><td data-num=3></td><td><pre>    INTO <span class="token operator">:</span>Hsno<span class="token punctuation">,</span><span class="token operator">:</span>Hname<span class="token punctuation">,</span><span class="token operator">:</span>Hsex<span class="token punctuation">,</span><span class="token operator">:</span>Hage<span class="token punctuation">,</span><span class="token operator">:</span>Hdept \</pre></td></tr><tr><td data-num=4></td><td><pre>        FRROM Student \</pre></td></tr><tr><td data-num=5></td><td><pre>        WHERE Sno <span class="token operator">=</span> <span class="token operator">:</span>givensno<span class="token punctuation">;</span></pre></td></tr></table></figure><p>INTO子句，WHERE子句和HAVING短语的条件表达式均可以使用主变量。</p><p>查询结果的列为空值NULL，系统会自动将主变量后的指示变量设置为负值，当指示变量为负值时，不管主变量为什么值，系统均认为主变量为NULL。</p><p>如果查询结果实际上是多条记录，则程序出错，关系数据库管理系统会在SQLCA中返回错误信息。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">查询某个学生选修某门课程的成绩。假设已经把将要查询的学生的学号赋予给了主变量givenso，</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">将课程号赋予给了主变量givencno。</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>EXEC SQL SELECT Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">,</span>Grade \</pre></td></tr><tr><td data-num=7></td><td><pre>    INTO <span class="token operator">:</span>Hsno<span class="token punctuation">,</span><span class="token operator">:</span>Hcno<span class="token punctuation">,</span><span class="token operator">:</span>Hgrade<span class="token operator">:</span>Gradeid \<span class="token comment">//指示变量Gradeid</span></pre></td></tr><tr><td data-num=8></td><td><pre>        FROM SC \</pre></td></tr><tr><td data-num=9></td><td><pre>        WHERE Sno <span class="token operator">=</span><span class="token operator">:</span>givensno AND Cno <span class="token operator">=</span><span class="token operator">:</span>givencno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/* 如果Gradeid &lt; 0，不论Hgrade为什么值，均认为该学生成绩为空值 */</span></pre></td></tr></table></figure><h4 id=非current形式的增删改语句><a class=anchor href=#非current形式的增删改语句>#</a> 非CURRENT形式的增删改语句</h4><p>在UPDATE的SET子句和WHERE子句中可以使用主变量，SET子句还可以使用指示变量。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 修改某个学生选修1号课程的成绩 */</span></pre></td></tr><tr><td data-num=2></td><td><pre>EXEC SQL UPDATE SC \</pre></td></tr><tr><td data-num=3></td><td><pre>    SET Grade <span class="token operator">=</span> <span class="token operator">:</span>newgrad \</pre></td></tr><tr><td data-num=4></td><td><pre>        WHERE Sno <span class="token operator">=</span> <span class="token operator">:</span>givensno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">某个学生新选修了某门课程，将有关记录插入SC表中。假设插入的学号已赋给主变量stdno，</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">课程号已赋给主变量couno。</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>gradeid <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//gradeid为指示变量，赋为负值</span></pre></td></tr><tr><td data-num=12></td><td><pre>EXEC SQL INSERT \</pre></td></tr><tr><td data-num=13></td><td><pre>    INTO <span class="token function">SC</span><span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">,</span>Grade<span class="token punctuation">)</span> \</pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token function">VALUES</span><span class="token punctuation">(</span><span class="token operator">:</span>stdno<span class="token punctuation">,</span><span class="token operator">:</span>couno<span class="token punctuation">,</span><span class="token operator">:</span>gr<span class="token operator">:</span>gradeid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">//由于该学生刚选修课程，成绩应该为空，所以要把指示变量赋为负值。</span></pre></td></tr></table></figure><h3 id=使用游标的sql语句><a class=anchor href=#使用游标的sql语句>#</a> 使用游标的SQL语句</h3><p>必须使用游标的SQL语句有</p><ul><li>查询结果为多条记录的SELECT语句</li><li>CURRENT形式的UPDATE语句</li><li>CURRENT形式的DELETE语句</li></ul><h4 id=查询结果为多条记录的select语句><a class=anchor href=#查询结果为多条记录的select语句>#</a> 查询结果为多条记录的SELECT语句</h4><p>使用游标的步骤，说明游标 → 打开游标 → 推进游标指针并取得当前记录 → 关闭游标</p><p><strong>说明游标</strong></p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre>EXEC SQL DECLARE 游标名 CURSOR FRO SELECT语句<span class="token punctuation">;</span></pre></td></tr></table></figure><p>该语句是一条说明性语句，这时关系数据库管理系统并不执行SELECT语句。</p><p><strong>打开游标</strong></p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre>EXEC SQL OPEN 游标名<span class="token punctuation">;</span></pre></td></tr></table></figure><p>执行相应的SELECT语句，把查询结果取到缓冲区中，这时游标处于活动状态，指针指向查询结果集中的第一条记录。</p><p><strong>推进游标指针并取得当前记录</strong></p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre>EXEC SQL FETCH 游标名 \</pre></td></tr><tr><td data-num=2></td><td><pre>    INTO 主变量<span class="token punctuation">;</span></pre></td></tr></table></figure><p>指定方向推动游标指针，同时将缓冲区中的当前记录取出来送至主变量供主语言进一步处理。</p><p><strong>关闭游标</strong></p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre>EXEC SQL CLOSE 游标名<span class="token punctuation">;</span></pre></td></tr></table></figure><p>关闭游标，释放结果集占用的缓冲区及其他资源。</p><p>游标被关闭后，就不再和原来的查询结果集相联系。</p><p>被关闭的游标可以再次被打开，与新的查询结果相联系。</p><h4 id=current形式的update语句和delete语句><a class=anchor href=#current形式的update语句和delete语句>#</a> CURRENT形式的UPDATE语句和DELETE语句</h4><p>如修改或删除某个记录，用带游标的SELECT语句查出满足条件的集合，从中进一步找出要修改或删除的记录，用CURRENT形式的UPDATE语句和DELETE语句修改或删除。</p><p>UPDATE语句和DELETE语句中要用子句<code>WHERE CURRENT OF 游标名</code>，表示修改或删除游标指针指向的记录。</p><p>游标定义中的SELECT语句带有UNION或ORDER BY子句，或该SELECT语句相当于定义了一个不可更新的视图，则不能使用CURRENT形式的UPDATE语句和DELETE语句。</p><h3 id=动态嵌入式sql><a class=anchor href=#动态嵌入式sql>#</a> 动态嵌入式SQL</h3><p><strong>静态嵌入式SQL</strong></p><p>静态嵌入式SQL语句能够满足一般要求，无法满足要到执行时才能够确定要提交的SQL语句，查询的条件。</p><p><strong>动态嵌入式SQL</strong></p><p>在程序运行过程中可临时组装SQL语句，支持动态组装SQL语句和动态参数两种形式。</p><h4 id=使用sql语句的主变量><a class=anchor href=#使用sql语句的主变量>#</a> 使用SQL语句的主变量</h4><p><strong>SQL语句主变量</strong></p><p>程序主变量包含的内容是SQL语句的内容，而不是原来保存数据的输入或输出变量。</p><p>SQL语句主变量在程序执行期间可以设定不同的SQL语句，然后立即执行。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">//创建基本表TEST</span></pre></td></tr><tr><td data-num=2></td><td><pre>EXEC SQL BEGIN DECLARE SECTION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> stmt <span class="token operator">=</span> <span class="token string">"CREATE TABLE test(a int)"</span><span class="token punctuation">;</span><span class="token comment">//SQL语句主变量</span></pre></td></tr><tr><td data-num=4></td><td><pre>EXEC SQL END DECLARE SECTION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">//..........</span></pre></td></tr><tr><td data-num=6></td><td><pre>EXEC SQL EXECUTE IMMEDIATE<span class="token operator">:</span>stmt<span class="token punctuation">;</span><span class="token comment">//执行动态SQL语句</span></pre></td></tr></table></figure><h4 id=动态参数><a class=anchor href=#动态参数>#</a> 动态参数</h4><p>动态参数是SQL语句中的可变元素，使用参数符合<code>(?)</code>表示该位置的数据在运行时设定。</p><p>与主变量不同动态参数的输入不是编译时完成绑定，而是通过<strong>PREPARE</strong>语句准备主变量和执行语句<strong>EXECUTE</strong>绑定数据或主变量来完成。</p><p><strong>使用动态参数的步骤</strong></p><p>声明SQL语句主变量(SQL主变量的值包含动态参数<code>(?)</code>) →</p><p>准备SQL语句(PREPARE) →</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre>EXEC SQL PREPARE 语句名 FROM SQL语句主变量</pre></td></tr></table></figure><p>执行准备号的语句(EXECUTE)</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre>EXEC SQL EXECUTE 语句名 \</pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token punctuation">[</span>INTO 主变量表<span class="token punctuation">]</span><span class="token punctuation">[</span>USING 主变量或常量<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">//向TEST插入元组</span></pre></td></tr><tr><td data-num=2></td><td><pre>EXEC SQL BEGIN DECLARE SECTION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> stmt <span class="token operator">=</span> <span class="token string">"INSERT INTO test VALUES(?)"</span><span class="token punctuation">;</span><span class="token comment">//声明SQL主变量内容是INSERT语句</span></pre></td></tr><tr><td data-num=4></td><td><pre>EXEC SQL END DECLARE SECTION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">//....................</span></pre></td></tr><tr><td data-num=6></td><td><pre>EXEC SQL PREPARE mystmt FROM <span class="token operator">:</span>stmt<span class="token punctuation">;</span><span class="token comment">//准备语句</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">//................</span></pre></td></tr><tr><td data-num=8></td><td><pre>EXEC SQL EXECUTE mystmt USING <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>EXEC SQL EXECUTE mystmt USING <span class="token number">200</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id=过程化sql><a class=anchor href=#过程化sql>#</a> 过程化SQL</h2><p>过程化SQL是SQL的扩展，增加了过程化语句功能，基本结构是块，每个块完成一个逻辑操作，块之间可以互相嵌套。</p><h3 id=过程化sql块的基本结构><a class=anchor href=#过程化sql块的基本结构>#</a> 过程化SQL块的基本结构</h3><p><strong>定义部分</strong></p><p>DECLARE → 定义的变量，常量等只能在该基本块中使用</p><p>变量，常量，游标，异常等 → 当基本块执行结束时，定义就不再存在</p><p><strong>执行部分</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>BEGIN</pre></td></tr><tr><td data-num=2></td><td><pre>	SQL语句，过程化SQL的流程控制语句 //块</pre></td></tr><tr><td data-num=3></td><td><pre>EXCEPTION</pre></td></tr><tr><td data-num=4></td><td><pre>	异常处理部分  //块</pre></td></tr><tr><td data-num=5></td><td><pre>END;</pre></td></tr></table></figure><h3 id=变量和常量的定义><a class=anchor href=#变量和常量的定义>#</a> 变量和常量的定义</h3><p><strong>变量定义</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>变量名 数据类型 <span class="token punctuation">[</span><span class="token punctuation">[</span>NOT NULL<span class="token punctuation">]</span> := 初值表达式<span class="token punctuation">]</span></pre></td></tr><tr><td data-num=2></td><td><pre>或</pre></td></tr><tr><td data-num=3></td><td><pre>变量名 数据类型 <span class="token punctuation">[</span><span class="token punctuation">[</span>NOT NULL<span class="token punctuation">]</span> 初值表达式<span class="token punctuation">]</span></pre></td></tr></table></figure><p><strong>常量定义</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>常量名 数据类型 CONSTANT := 常量表达式</pre></td></tr></table></figure><p>常量必须要给一个值，并且该值在存在期间或常量的作用域内不能改变。如果试图修改它，过程化SQL将返回一个异常。</p><p><strong>赋值语句</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>变量名称 := 表达式</pre></td></tr></table></figure><h3 id=流程控制><a class=anchor href=#流程控制>#</a> 流程控制</h3><p>过程化SQL主要提供了条件控制语句，循环控制语句等流程控制语句，这些语句的语法，语义和一般高级语言类似。</p><p><strong>条件控制语句</strong></p><p>IF-THEN，IF-THEN-ELSE，嵌套的IF语句</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>//IF语句格式</pre></td></tr><tr><td data-num=2></td><td><pre>IF 条件 THEN</pre></td></tr><tr><td data-num=3></td><td><pre>	语句;</pre></td></tr><tr><td data-num=4></td><td><pre>END IF;</pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>//IF-THEN-ELSE语句格式</pre></td></tr><tr><td data-num=7></td><td><pre>IF 条件 THEN</pre></td></tr><tr><td data-num=8></td><td><pre>	条件为真时执行语句;</pre></td></tr><tr><td data-num=9></td><td><pre>ELSE</pre></td></tr><tr><td data-num=10></td><td><pre>	条件为假或NULL时执行</pre></td></tr><tr><td data-num=11></td><td><pre>END IF;</pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>//嵌套的IF语句</pre></td></tr><tr><td data-num=14></td><td><pre>在THEN和ELSE子句中还可以包含IF语句，即IF语句可以嵌套</pre></td></tr></table></figure><p><strong>循环控制语句</strong></p><p>主要有LOOP，WHILE-LOOP和FOR-LOOP三类</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>//简单的循环语句LOOP格式</pre></td></tr><tr><td data-num=2></td><td><pre>LOOP</pre></td></tr><tr><td data-num=3></td><td><pre>	循环执行的语句;</pre></td></tr><tr><td data-num=4></td><td><pre>END LOOP;</pre></td></tr></table></figure><p>多数数据库服务器的过程化SQL都提供EXIT，BREAK或LEAVE等循环结束语句，保证LOOP语句块能够结束。</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>//WHILE-LOOP循环格式</pre></td></tr><tr><td data-num=2></td><td><pre>WHILE 条件 LOOP</pre></td></tr><tr><td data-num=3></td><td><pre>	条件为真时执行的语句;</pre></td></tr><tr><td data-num=4></td><td><pre>END LOOP;</pre></td></tr></table></figure><p>每次执行循环体语句之前，首先对条件进行求值，如果条件为真，则执行循环体内的语句序列，如果条件为假，则跳过循环并把控制传递给下一个语句。</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>//FOR-LOOP循环</pre></td></tr><tr><td data-num=2></td><td><pre>FOR 循环变量 IN <span class="token punctuation">[</span>REVERSE<span class="token punctuation">]</span> bound1...bound2 LOOP</pre></td></tr><tr><td data-num=3></td><td><pre>	循环语句;</pre></td></tr><tr><td data-num=4></td><td><pre>END LOOP;</pre></td></tr></table></figure><p>执行过程，循环遍历设置为下界bound1，检查循环变量是否小于上界bound2，如果是执行循环体，循环变量加1，如果否，退出循环。当设置REVERSE，表示bound1为上界，bound2为下界，循环变量减1。</p><h3 id=错误处理><a class=anchor href=#错误处理>#</a> 错误处理</h3><p>如果过程化SQL在执行时出现异常，则应该让程序在产生异常的语句处停下来，根据异常类型去执行异常处理语句。</p><p>SQL标准对数据库服务器提供什么样的异常处理做出了建议，要求过程化SQL管理器提供完善的异常处理机制。</p><h3 id=存储过程和函数><a class=anchor href=#存储过程和函数>#</a> 存储过程和函数</h3><p>过程化SQL块分为匿名块和命名块两类。</p><p><strong>匿名块</strong> → 每次执行时都要进行编译，它不能被存储到数据库中，也不能在其他过程化SQL块中调用</p><p><strong>命名块</strong> → 编译后保存在数据库中，可以反复调用，运行速度较快，过程和函数是命名块</p><h4 id=存储过程><a class=anchor href=#存储过程>#</a> 存储过程</h4><p>由过程化SQL语句书写的过程，经编译和优化后存储在数据库服务器中，使用时只要调用即可。</p><p>存储过程的优点</p><ul><li>运行效率高</li><li>降低了客户机和服务器之间的通信量</li><li>方便实施企业规则</li></ul><h4 id=存储过程的用户接口><a class=anchor href=#存储过程的用户接口>#</a> 存储过程的用户接口</h4><p>创建存储过程格式</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CREATE OF REPLACE PROCEDURE 过程名(<span class="token punctuation">[</span>参数<span class="token punctuation">]</span>)</pre></td></tr><tr><td data-num=2></td><td><pre>AS 过程化SQL块;</pre></td></tr></table></figure><p><strong>过程名</strong>指数据库服务器合法的对象标识。</p><p><strong>参数列表</strong>指用名字来标识调用时给出的参数值，必须指定值的数据类型。参数也可以定义输入参数，输出参数或输入/输出参数，默认为输入参数。</p><p><strong>过程体</strong>是一个过程化SQL块，包括声明部分和可执行语句部分。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 利用存储过程来实现从账号1转指定数额的款项到账号2中 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 定义存储过程TRANSFER，参数为转入账户，转出账户，转账额度 */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span></pre></td></tr><tr><td data-num=4></td><td><pre>TRANSFER<span class="token punctuation">(</span>inAccount <span class="token keyword">INT</span><span class="token punctuation">,</span>outAccount <span class="token keyword">INT</span><span class="token punctuation">,</span>amount <span class="token keyword">FLOAT</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">AS</span> <span class="token keyword">DECLARE</span>		<span class="token comment">/* 定义变量 */</span></pre></td></tr><tr><td data-num=6></td><td><pre>     totalDepositOut <span class="token keyword">Float</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>     totalDepositIn <span class="token keyword">Float</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>     inAccountnum <span class="token keyword">INT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">BEGIN</span> <span class="token comment">/* 检查转出账户的余额 */</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">SELECT</span> Total <span class="token keyword">INTO</span> totalDepositOut <span class="token keyword">FROM</span> Account</pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">WHERE</span> accountnum <span class="token operator">=</span> outAccount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">IF</span> total DepositOut <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span> <span class="token comment">/* 如果转出账户不存在或账户中没有存款 */</span></pre></td></tr><tr><td data-num=13></td><td><pre>		<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span><span class="token comment">/* 回滚事物 */</span></pre></td></tr><tr><td data-num=14></td><td><pre>		<span class="token keyword">RETURN</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    </pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token keyword">IF</span> totalDepositOut <span class="token operator">&lt;</span> amout <span class="token keyword">THEN</span> <span class="token comment">/* 账户存款不足 */</span></pre></td></tr><tr><td data-num=18></td><td><pre>    	<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    	<span class="token keyword">RETURN</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>    </pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token keyword">SELECT</span> Accountnum <span class="token keyword">INTO</span> inAccountnum <span class="token keyword">FROM</span> Account</pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token keyword">WHERE</span> accountnum <span class="token operator">=</span> inAccount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    </pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token keyword">IF</span> inAccount <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span> <span class="token comment">/* 转入账户不存在 */</span></pre></td></tr><tr><td data-num=26></td><td><pre>    	<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>    	<span class="token keyword">RETURN</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token comment">/* 修改转出账户余额，减去转出额 */</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token keyword">UPDATE</span> Account <span class="token keyword">SET</span> total <span class="token operator">=</span> total <span class="token operator">-</span> amount</pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token keyword">WHERE</span> accountnum <span class="token operator">=</span> outAccount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token comment">/* 修改转入账户余额，增加转入额 */</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token keyword">UPDATE</span> Account <span class="token keyword">SET</span> total <span class="token operator">=</span> total <span class="token operator">+</span> amount</pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token keyword">WHERE</span> accountnum <span class="token operator">=</span> inAccount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    </pre></td></tr><tr><td data-num=36></td><td><pre>    <span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span class="token comment">/* 提交转账事物 */</span></pre></td></tr><tr><td data-num=37></td><td><pre><span class="token keyword">END</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>执行存储过程</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CALL/PERFORM PROCEDURE 过程名(<span class="token punctuation">[</span>参数<span class="token punctuation">]</span>);</pre></td></tr></table></figure><p>使用CALL或PERFORM等方式激活存储过程的执行，在SQL中，数据库服务器支持在过程体中调用其他存储过程。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 从账户01003815868转10000元到01003813828账户中 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CALL</span> <span class="token keyword">PROCEDURE</span> TRANSFER<span class="token punctuation">(</span><span class="token number">01003815868</span><span class="token punctuation">,</span><span class="token number">01003813828</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>修改存储过程</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>ALTER PROCEDURE 过程名1 RENAME TO 过程名2;</pre></td></tr></table></figure><p><strong>删除存储过程</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>DROP PROCEDURE 过程名();</pre></td></tr></table></figure><h4 id=函数><a class=anchor href=#函数>#</a> 函数</h4><p>该函数为用户自定义函数，函数和存储过程类似都是持久性存储模块，不同的是函数必须指定返回的类型。</p><p><strong>函数的定义语句格式</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CREATE OR REPLACE FUNCTION 函数名(<span class="token punctuation">[</span>参数<span class="token punctuation">]</span>)</pre></td></tr><tr><td data-num=2></td><td><pre>RETURNS 类型 AS 过程化SQL块;</pre></td></tr></table></figure><p><strong>函数的执行语句格式</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CALL/SELECT 函数名(<span class="token punctuation">[</span>参数<span class="token punctuation">]</span>);</pre></td></tr></table></figure><p><strong>修改函数</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>//重命名</pre></td></tr><tr><td data-num=2></td><td><pre>ALTER FUNCTION 函数名1 RENAME TO 函数名2;</pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre>//重新编译</pre></td></tr><tr><td data-num=5></td><td><pre>ALTER FUNCTION 函数名 COMPILE;</pre></td></tr></table></figure><h3 id=过程化sql中的游标><a class=anchor href=#过程化sql中的游标>#</a> 过程化SQL中的游标</h3><p>在过程化SQL中如果查询返回多条记录时，就要使用游标对结果集进行处理，在存储过程中可以定义普通游标，REFCURSOR类型游标，带参数游标等。</p><p>定义存储过程，多次打开游标并获取游标当前记录。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> pro_cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">AS</span> <span class="token keyword">DECLARE</span></pre></td></tr><tr><td data-num=3></td><td><pre>	cno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>	cname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">CURSOR</span> mycursor<span class="token punctuation">(</span>leaderno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">FOR</span> <span class="token comment">/* 说明带参数游标mycursor */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> Ino<span class="token punctuation">,</span>Iname <span class="token keyword">FROM</span> leader</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHERE</span> Ino <span class="token operator">=</span> leaderno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num=9></td><td><pre>	<span class="token comment">/* mycursor能检索leader表中具有参数leaderno的记录 */</span></pre></td></tr><tr><td data-num=10></td><td><pre>	<span class="token keyword">OPEN</span> mycursor<span class="token punctuation">(</span><span class="token string">'L01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* 使用参数L01打开游标 */</span></pre></td></tr><tr><td data-num=11></td><td><pre>	<span class="token keyword">FETCH</span> mycursor <span class="token keyword">INTO</span> cno<span class="token punctuation">,</span>cname<span class="token punctuation">;</span><span class="token comment">/* 获取lno = 'L01'的游标元组 */</span></pre></td></tr><tr><td data-num=12></td><td><pre>	<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">temp</span><span class="token punctuation">(</span>Ino<span class="token punctuation">,</span>Iname<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>cno<span class="token punctuation">,</span>cname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* 将游标元组插入临时表中 */</span></pre></td></tr><tr><td data-num=13></td><td><pre>	<span class="token keyword">CLOSE</span> mycursor<span class="token punctuation">;</span><span class="token comment">/* 关闭游标 */</span></pre></td></tr><tr><td data-num=14></td><td><pre>	<span class="token keyword">OPEN</span> mycursor<span class="token punctuation">(</span><span class="token string">'L02'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* 使用新的参数L02重新打开游标 */</span></pre></td></tr><tr><td data-num=15></td><td><pre>	<span class="token keyword">FETCH</span> mycursor <span class="token keyword">INTO</span> cno<span class="token punctuation">,</span>cname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>	<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">temp</span><span class="token punctuation">(</span>Ino<span class="token punctuation">,</span>Iname<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>cno<span class="token punctuation">,</span>cname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>	<span class="token keyword">CLOSE</span> mycursor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">END</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id=odbc编程><a class=anchor href=#odbc编程>#</a> ODBC编程</h2><h3 id=概述-2><a class=anchor href=#概述-2>#</a> 概述</h3><p>使用ODBC编写的应用程序可移植性好，能同时访问不同的数据库，共享多个数据资源。</p><p>ODBC是微软公司开放服务体系中有关数据库的一个组成部分，它提供了一组访问数据库的应用程序编程接口(API)。</p><p>主要作用是规范应用开发和规范关系数据库管理系统应用接口。</p><p>ODBC应用系统的体系结构包括，用户应用程序，ODBC驱动程序管理器，数据库驱动程序，数据源。</p><h3 id=用户应用程序><a class=anchor href=#用户应用程序>#</a> 用户应用程序</h3><p>包括</p><ul><li>请求连接数据库</li><li>向数据源发送SQL语句</li><li>为SQL语句执行结果分配存储空间，定义读取的数据格式</li><li>获取数据库操作结果或处理错误</li><li>进行数据处理并向用户提交处理结果</li><li>请求事务的提交和回滚操作</li><li>断开与数据源的连接</li></ul><h3 id=odbc驱动程序管理器><a class=anchor href=#odbc驱动程序管理器>#</a> ODBC驱动程序管理器</h3><p>驱动程序管理器包含在<code>ODBC32.DLL</code>中，对用户透明，管理应用程序和驱动程序之间的通信。</p><p>主要功能</p><ul><li>装载ODBC驱动程序</li><li>选择和连接正确的驱动程序</li><li>管理数据源</li><li>检查ODBC调用参数的合法性</li><li>记录ODBC函数的调用</li></ul><h3 id=数据库驱动程序><a class=anchor href=#数据库驱动程序>#</a> 数据库驱动程序</h3><p>ODBC通过驱动程序来提供应用系统与数据库平台的独立性，</p><p>ODBC应用程序不能直接存取数据库，各种操作由驱动程序提交给DBMS的ODBC驱动程序，调用驱动程序支持的函数来存取数据库。</p><p><strong>ODBC驱动程序类型</strong></p><p><strong>单束</strong></p><p>数据源和应用程序在同一台机器上，驱动程序直接完成对数据文件的I/O操作，驱动程序相当于数据管理器。</p><p><strong>多束</strong></p><p>支持客户机-服务器，客户机-应用服务器/数据库服务器等网络环境下的数据访问，由驱动程序完成数据库访问请求的提交和结果集接收，应用程序使用驱动程序提供的结果集管理接口操作执行后的结果数据。</p><h3 id=odbc数据源管理><a class=anchor href=#odbc数据源管理>#</a> ODBC数据源管理</h3><p><strong>数据源</strong>是最终用户需要访问的数据，包含了数据库位置和数据库类型等信息，是一种数据连接的抽象。</p><p>ODBC给每个被访问的数据源指定唯一的数据源名(Data Source Name，简称DSN)，并映射到所有必要的，用来存取数据的低层软件。</p><p>在连接中，用数据源名来代表用户名，服务器名，所连接的数据库名等。用户无需知道数据库管理系统或其他数据管理软件，网络以及有关ODBC驱动程序的细节。</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>假设某个学校在SQL Server和KingbaseES上创建了两个数据库</pre></td></tr><tr><td data-num=2></td><td><pre>学校人事数据库和教学科研数据库。</pre></td></tr><tr><td data-num=3></td><td><pre>学校的信息系统要从这两个数据库中存取数据，为了方便与两个数据库连接，</pre></td></tr><tr><td data-num=4></td><td><pre>为学校人事数据库创建一个数据源名PERSON,</pre></td></tr><tr><td data-num=5></td><td><pre>为学科研数据库创建一个名为EDU的数据源。当要访问每一个数据库时，</pre></td></tr><tr><td data-num=6></td><td><pre>只要与PERSON和EDU连接，不需要记住使用的驱动程序，服务器名称，数据库名</pre></td></tr></table></figure><h3 id=api基础><a class=anchor href=#api基础>#</a> API基础</h3><p>ODBC应用程序编程接口的一致性是指API一致性和语法一致性</p><p><strong>函数</strong></p><p>ODBC3.0标准提供了76个函数接口，大致分为</p><ul><li>分配和释放环境句柄，连接句柄，语句句柄</li><li>连接函数(SQLDriverconnect等)</li><li>与信息相关的函数(SQLGetinfo，SQLGetFuction等)</li><li>事务处理函数(如SQLEndTran)</li><li>执行相关函数(SQLExecdirect，SQLExecute等)</li><li>编目函数，提供了11个编目函数(如SQLTables，SQLColumn等)</li></ul><p><strong>句柄及其属性</strong></p><p>句柄是32位整数值，代表一个指针。ODBC3.0中句柄分为环境句柄，连接句柄，语句句柄，描述符句柄。</p><p>每个ODBC应用程序需要建立一个ODBC环境，分配一个环境句柄，存取数据的全局背景，如环境状态，当前环境状态诊断，当前在环境上分配的连接句柄等。</p><p>一个环境句柄可以建立多个连接句柄，每一个连接句柄实现与一个数据源之间的连接。</p><p>在一个连接中可以建立多个语句句柄，它不只是一个SQL语句，还包括SQL语句产生的结果集以及相关的信息等。</p><p>在ODBC3.0中又提出了描述符句柄的概念，它是描述SQL语句的参数，结果集列的元数据集合。</p><p><strong>数据类型</strong></p><p>ODBC数据类型，SQL数据类型用于数据源；C数据类型用于应用程序的C代码。</p><p>应用程序可以通过SQLGetTypeInfo接口来获取不同的驱动程序对于数据类型的支持情况</p><p>SQL数据类型和C数据类型之间的转换规则</p><table><thead><tr><th></th><th>SQL数据类型</th><th>C数据类型</th></tr></thead><tbody><tr><td>SQL数据类型</td><td>数据源之间转换</td><td>应用程序变量传送到语句参数(SQLBindparameter)</td></tr><tr><td>C数据类型</td><td>从结果集列中返回到应用程序变量(SQLBindcol)</td><td>应用程序变量之间的转换</td></tr></tbody></table><h3 id=odbc的工作流程><a class=anchor href=#odbc的工作流程>#</a> ODBC的工作流程</h3><p>配置数据源(动态配置数据源) → 初始化环境 → 建立连接 → 分配语句句柄 → 执行SQL语句 →</p><p>当有结果集时循环执行( 分配语句句柄 → 执行SQL语句 →)过程</p><p>当无结果集时 → 结果集处理 → 中止</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>将KingbaseES数据库中Student表的数据备份到SQLServer数据库中。</pre></td></tr><tr><td data-num=2></td><td><pre>该应用涉及两个不同的关系数据库管理系统中的数据源，使用ODBC来开发应用程序，</pre></td></tr><tr><td data-num=3></td><td><pre>只要改变应用程序中连接函数(SQLConnect)的参数，</pre></td></tr><tr><td data-num=4></td><td><pre>就可以连接不同关系数据库管理系统的驱动程序，连接两个数据源。</pre></td></tr></table></figure><p><strong>配置数据源</strong></p><p>有两种方法</p><p>一是运行数据源管理工具来进行配置；二是使用Driver Manager提供的ConfigDsn函数来增加，修改或删除数据源。</p><p>之前的例子中，采用第一种方法创建数据源。因为要同时用到KingbaseES和SQL Server，所以分别建立两个数据源，将其取名为KingbaseES ODBC和SQL Server。</p><p><strong>初始化环境</strong></p><p>没有和具体的驱动程序相关联，由Driver Manager来进行控制，并配置环境属性。应用程序通过调用连接函数和某个数据源进行连接后，Driver Manager才调用所连接的驱动程序中的SQLAllocHandle来真正分配环境句柄的数据结构。</p><p><strong>建立连接</strong></p><p>应用程序调用SQLAllocHandle分配连接句柄，通过SQLconnect，SQLDriverConnect或SQLBrowseConnect与数据源连接。</p><p><strong>分配语句句柄</strong></p><p>处理任何SQL语句之前，应用程序还需要首先分配一个语句句柄，语句句柄含有具体的SQL语句以及输出的结果集等信息。</p><p><strong>执行SQL语句</strong></p><p>处理SQL语句的两种方式有预处理(SQLPrepare,SQLExecute，适用于语句的多次执行)和直接执行(SQLExecdirect</p><p>应用程序根据语句类型进行的处理</p><ul><li>有结果集的语句则进行结果处理</li><li>没有结果集的函数，可以直接利用本语句句柄继续执行新的语句或是获取行计数(本次执行所影响的行数)之后继续执行</li></ul><p><strong>结果集处理</strong></p><p>应用程序可以通过SQLNumResultCols来获取结果集中的列数，通过SQL DescribeCol或是SQLColAttribute函数来获取结果集每列的名称，数据类型，精度和范围。</p><p>ODBC中使用游标来处理结果集数据，ODBC中游标类型有</p><ul><li>Forward-only游标(ODBC的默认游标类型)，只能在结果集中向前滚动</li><li>可滚动(Scroll)游标，静态，动态，码集驱动，混合型</li></ul><p><strong>中止处理</strong></p><p>处理结束后，应用程序首先释放语句句柄，然后释放数据库连接并与数据库服务器断开，最后释放ODBC环境。</p><div class=tags><a href=/tags/database/ rel=tag><i class="ic i-tag"></i> 数据库</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span> <span class=text>更新于</span> <time title="修改时间：2024-07-24 12:31:48" itemprop=dateModified datetime=2024-07-24T12:31:48+08:00>2024-07-24</time></span><span class=item data-path=/computer-science/programming/database/programming/ title=阅读次数><span class=icon><i class="ic i-eye"></i></span> <span class=text>阅读次数</span><span class=waline-pageview-count></span> <span class=text>次</span></span></div><div id=copyright><ul><li class=author><strong>本文作者：</strong> ReverseSacle <i class="ic i-at"><em>@</em></i>逆转天平</li><li class=link><strong>本文链接：</strong> <a href=https://www.reversesacle.com/computer-science/programming/database/programming/ title=数据库编程基础>https://www.reversesacle.com/computer-science/programming/database/programming/</a></li><li class=license><strong>版权声明：</strong> 本站所有文章除特别声明外，均采用 <span class=exturl data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class=post-nav><div class="item left"><a href=/computer-science/programming/database/sql/ itemprop=url rel=prev data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg13.webp title=关系数据库标准语言SQL><span class=type>上一篇</span><span class=category><i class="ic i-flag"></i> 数据库</span><h3>关系数据库标准语言SQL</h3></a></div><div class="item right"><a href=/computer-science/programming/database/mysql/mspart1/ itemprop=url rel=next data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg18.webp title=MySQL数据库基础-第一部分><span class=type>下一篇</span><span class=category><i class="ic i-flag"></i> MySQL</span><h3>MySQL数据库基础-第一部分</h3></a></div></div><div class=wrap id=comments><div id=waline-comment></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=文章目录><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A6%82%E8%BF%B0><span class=toc-number>1.</span> <span class=toc-text>概述</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%B5%8C%E5%85%A5%E5%BC%8Fsql%E8%AF%AD%E5%8F%A5%E4%B8%8E%E4%B8%BB%E8%AF%AD%E8%A8%80%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1><span class=toc-number>2.</span> <span class=toc-text>嵌入式SQL语句与主语言之间的通信</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#sql%E9%80%9A%E4%BF%A1%E5%8C%BA><span class=toc-number>2.1.</span> <span class=toc-text>SQL通信区</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%BB%E5%8F%98%E9%87%8F><span class=toc-number>2.2.</span> <span class=toc-text>主变量</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%B8%B8%E6%A0%87><span class=toc-number>2.3.</span> <span class=toc-text>游标</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%BB%BA%E7%AB%8B%E5%92%8C%E5%85%B3%E9%97%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5><span class=toc-number>2.4.</span> <span class=toc-text>建立和关闭数据库连接</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%8D%E7%94%A8%E6%B8%B8%E6%A0%87%E7%9A%84sql%E8%AF%AD%E5%8F%A5><span class=toc-number>2.5.</span> <span class=toc-text>不用游标的SQL语句</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E4%B8%BA%E5%8D%95%E8%AE%B0%E5%BD%95%E7%9A%84select%E8%AF%AD%E5%8F%A5><span class=toc-number>2.5.1.</span> <span class=toc-text>查询结果为单记录的SELECT语句</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E9%9D%9Ecurrent%E5%BD%A2%E5%BC%8F%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E8%AF%AD%E5%8F%A5><span class=toc-number>2.5.2.</span> <span class=toc-text>非CURRENT形式的增删改语句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87%E7%9A%84sql%E8%AF%AD%E5%8F%A5><span class=toc-number>2.6.</span> <span class=toc-text>使用游标的SQL语句</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E4%B8%BA%E5%A4%9A%E6%9D%A1%E8%AE%B0%E5%BD%95%E7%9A%84select%E8%AF%AD%E5%8F%A5><span class=toc-number>2.6.1.</span> <span class=toc-text>查询结果为多条记录的SELECT语句</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#current%E5%BD%A2%E5%BC%8F%E7%9A%84update%E8%AF%AD%E5%8F%A5%E5%92%8Cdelete%E8%AF%AD%E5%8F%A5><span class=toc-number>2.6.2.</span> <span class=toc-text>CURRENT形式的UPDATE语句和DELETE语句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8A%A8%E6%80%81%E5%B5%8C%E5%85%A5%E5%BC%8Fsql><span class=toc-number>2.7.</span> <span class=toc-text>动态嵌入式SQL</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E4%BD%BF%E7%94%A8sql%E8%AF%AD%E5%8F%A5%E7%9A%84%E4%B8%BB%E5%8F%98%E9%87%8F><span class=toc-number>2.7.1.</span> <span class=toc-text>使用SQL语句的主变量</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%8A%A8%E6%80%81%E5%8F%82%E6%95%B0><span class=toc-number>2.7.2.</span> <span class=toc-text>动态参数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%BF%87%E7%A8%8B%E5%8C%96sql><span class=toc-number>3.</span> <span class=toc-text>过程化SQL</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BF%87%E7%A8%8B%E5%8C%96sql%E5%9D%97%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84><span class=toc-number>3.1.</span> <span class=toc-text>过程化SQL块的基本结构</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F%E7%9A%84%E5%AE%9A%E4%B9%89><span class=toc-number>3.2.</span> <span class=toc-text>变量和常量的定义</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6><span class=toc-number>3.3.</span> <span class=toc-text>流程控制</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86><span class=toc-number>3.4.</span> <span class=toc-text>错误处理</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0><span class=toc-number>3.5.</span> <span class=toc-text>存储过程和函数</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B><span class=toc-number>3.5.1.</span> <span class=toc-text>存储过程</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E7%94%A8%E6%88%B7%E6%8E%A5%E5%8F%A3><span class=toc-number>3.5.2.</span> <span class=toc-text>存储过程的用户接口</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%87%BD%E6%95%B0><span class=toc-number>3.5.3.</span> <span class=toc-text>函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BF%87%E7%A8%8B%E5%8C%96sql%E4%B8%AD%E7%9A%84%E6%B8%B8%E6%A0%87><span class=toc-number>3.6.</span> <span class=toc-text>过程化SQL中的游标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#odbc%E7%BC%96%E7%A8%8B><span class=toc-number>4.</span> <span class=toc-text>ODBC编程</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A6%82%E8%BF%B0-2><span class=toc-number>4.1.</span> <span class=toc-text>概述</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%94%A8%E6%88%B7%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F><span class=toc-number>4.2.</span> <span class=toc-text>用户应用程序</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#odbc%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E7%AE%A1%E7%90%86%E5%99%A8><span class=toc-number>4.3.</span> <span class=toc-text>ODBC驱动程序管理器</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F><span class=toc-number>4.4.</span> <span class=toc-text>数据库驱动程序</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#odbc%E6%95%B0%E6%8D%AE%E6%BA%90%E7%AE%A1%E7%90%86><span class=toc-number>4.5.</span> <span class=toc-text>ODBC数据源管理</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#api%E5%9F%BA%E7%A1%80><span class=toc-number>4.6.</span> <span class=toc-text>API基础</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#odbc%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B><span class=toc-number>4.7.</span> <span class=toc-text>ODBC的工作流程</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title=系列文章><ul><li><a href=/computer-science/programming/database/theory/ rel=bookmark title=数据库基础理论>数据库基础理论</a></li><li><a href=/computer-science/programming/database/sql/ rel=bookmark title=关系数据库标准语言SQL>关系数据库标准语言SQL</a></li><li class=active><a href=/computer-science/programming/database/programming/ rel=bookmark title=数据库编程基础>数据库编程基础</a></li><li><a href=/computer-science/programming/database/mysql/mspart1/ rel=bookmark title=MySQL数据库基础-第一部分>MySQL数据库基础-第一部分</a></li><li><a href=/computer-science/programming/database/mysql/mspart2/ rel=bookmark title=MySQL数据库基础-第二部分>MySQL数据库基础-第二部分</a></li></ul></div><div class="overview panel" data-title=站点概览><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img class=image itemprop=image alt=ReverseSacle data-src=/images/avatar.webp><p class=name itemprop=name>ReverseSacle</p><div class=description itemprop=description>知识书库 & 学习点滴</div></div><nav class=state><div class="item posts"><a href=/archives/ ><span class=count>186</span> <span class=name>文章</span></a></div><div class="item categories"><a href=/categories/ ><span class=count>52</span> <span class=name>分类</span></a></div><div class="item tags"><a href=/tags/ ><span class=count>18</span> <span class=name>标签</span></a></div></nav><div class=social><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JldmVyc2VTYWNsZQ==" title=https:&#x2F;&#x2F;github.com&#x2F;ReverseSacle><i class="ic i-github"></i></span><span class="exturl item email" data-url="bWFpbHRvOnByaXZhdGVAcmV2ZXJzZXNhY2xlLmNvbQ==" title=mailto:private@reversesacle.com><i class="ic i-envelope"></i></span></div><ul class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i> 首页</a></li><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-feather"></i> 文章</a><ul class=submenu><li class=item><a href=/archives/ rel=section><i class="ic i-list-alt"></i> 归档</a></li><li class=item><a href=/categories/ rel=section><i class="ic i-th"></i> 分类</a></li><li class=item><a href=/tags/ rel=section><i class="ic i-tags"></i> 标签</a></li></ul></li><li class=item><a href=/about/ rel=section><i class="ic i-user"></i> 关于</a></li><li class=item><a href=/friend-links/ rel=section><i class="ic i-heart"></i> 友链</a></li></ul></div></div></div><ul id=quick><li class="prev pjax"><a href=/computer-science/programming/database/sql/ rel=prev title=上一篇><i class="ic i-chevron-left"></i></a></li><li class=up><i class="ic i-arrow-up"></i></li><li class=down><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href=/computer-science/programming/database/mysql/mspart1/ rel=next title=下一篇><i class="ic i-chevron-right"></i></a></li><li class=percent></li></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>随机文章</h2><ul><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/dynamic-program/ title="分类于 动态规划">动态规划</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/dynamic-program/combination/ title=动态规划-组合>动态规划-组合</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/database/ title="分类于 数据库">数据库</a></div><span><a href=/computer-science/programming/database/theory/ title=数据库基础理论>数据库基础理论</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/network-programming/ title="分类于 网络编程">网络编程</a></div><span><a href=/computer-science/programming/network-programming/multiprocessing/ title=Linux多进程>Linux多进程</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/graph/ title="分类于 图">图</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/graph/trick/ title=图相关技巧>图相关技巧</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/network-programming/ title="分类于 网络编程">网络编程</a></div><span><a href=/computer-science/programming/network-programming/programming/ title=C&#x2F;C++网络编程>C/C++网络编程</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/string/ title="分类于 字符串">字符串</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/string/nums/ title=字符串-数理>字符串-数理</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/cpp-basic/ title="分类于 C++基础">C++基础</a></div><span><a href=/computer-science/programming/c-language/basis/c++/cpppart3/ title=C++基础知识-第三部分-C++11标准>C++基础知识-第三部分-C++11标准</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/rust/ title="分类于 Rust">Rust</a></div><span><a href=/computer-science/programming/rust/rust-data-structure/linear-structure/seqstack/ title=Rust-顺序栈>Rust-顺序栈</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/shoka-theme/ title="分类于 Shoka主题">Shoka主题</a></div><span><a href=/computer-science/shoka-theme/supplement-for-shoka-theme/ title=Hexo-Shoka主题功能介绍补充点>Hexo-Shoka主题功能介绍补充点</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a></div><span><a href=/computer-science/programming/c-language/c-data-structure/nonlinear-structure/threaded-binary-tree/ title=C语言-二叉树线索化(线索链表)>C语言-二叉树线索化(线索链表)</a></span></li></ul></div><div><h2>最新评论</h2><ul id=waline-recent></ul></div></div><div class=status><div class=copyright>&copy; 2021 – <span itemprop=copyrightYear>2025</span><span class=with-love><i class="ic i-sakura rotate"></i></span> <span class=author itemprop=copyrightHolder>ReverseSacle @ ReverseSacle-Blog</span></div><div class=count><i class="ic i-clock" aria-hidden=true></i> <span id=time align=center>载入时间中...<script defer>var now=new Date;function createtime(){var n=new Date("2021-11-16 22:30:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("time").innerHTML="已经过 "+dnum+" 天 "+hnum+" 小时 "+mnum+" 分 "+snum+" 秒 "}setInterval("createtime()",250)</script></span><span class=post-meta-item-icon>|&nbsp<i class="ic i-chart-area"></i></span> <span title=站点总字数>2.1m 字</span> <span class=post-meta-item-icon>|&nbsp<i class="ic i-coffee"></i></span> <span title=站点阅读时长>40:40</span></div></div></div></footer></div><script data-config>var LOCAL={path:"computer-science/programming/database/programming/",favicon:{show:"ReverseSacle-Blog",hide:"ReverseSacle-Blog"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},waline:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src=https://polyfill.alicdn.com/v3/polyfill.min.js></script><script src=https://cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1.16.0/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js></script><script src=/js/app.js></script></body></html>