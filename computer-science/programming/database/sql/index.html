<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#222><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/ico sizes=48x48 href=/images/favicon.ico><link rel=alternate type=application/rss+xml title=逆转天平 href=https://www.reversesacle.com/rss.xml><link rel=alternate type=application/atom+xml title=逆转天平 href=https://www.reversesacle.com/atom.xml><link rel=alternate type=application/json title=逆转天平 href=https://www.reversesacle.com/feed.json><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=/css/app.css><meta name=description content=数据库><link rel=canonical href=https://www.reversesacle.com/computer-science/programming/database/sql/ ><title>关系数据库标准语言SQL - 数据库 - 编程 - 计算机科学 | ReverseSacle-Blog</title><meta name=generator content="Hexo 6.3.0"></head><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=dotloader><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">关系数据库标准语言SQL</h1><div class=meta><span class=item title="创建时间：2023-08-12 14:28:22"><span class=icon><i class="ic i-calendar"></i></span> <span class=text>发表于</span> <time itemprop="dateCreated datePublished" datetime=2023-08-12T14:28:22+08:00>2023-08-12</time></span><span class=item title=本文字数><span class=icon><i class="ic i-pen"></i></span> <span class=text>本文字数</span> <span>45k</span> <span class=text>字</span></span><span class=item title=阅读时长><span class=icon><i class="ic i-clock"></i></span> <span class=text>阅读时长</span> <span>52 分钟</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div class=lines role=navigation aria-label=切换导航栏><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>ReverseSacle-Blog</a></li></ul><ul class=right><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id=imgs class=pjax><ul><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg13.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg9.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg20.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg11.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg18.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg15.webp></li></ul></div></header><div id=waves><svg class=waves xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewBox="0 24 150 28" preserveAspectRatio=none shape-rendering=auto><defs><path id=gentle-wave d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352z"/></defs><g class=parallax><use xlink:href=#gentle-wave x=48 y=0 /><use xlink:href=#gentle-wave x=48 y=3 /><use xlink:href=#gentle-wave x=48 y=5 /><use xlink:href=#gentle-wave x=48 y=7 /></g></svg></div><main><div class=inner><div id=main class=pjax><div class="article wrap"><div class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i> <span><a href=/ >首页</a></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/ itemprop=item rel=index title="分类于 计算机科学"><span itemprop=name>计算机科学</span></a><meta itemprop=position content=1></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/ itemprop=item rel=index title="分类于 编程"><span itemprop=name>编程</span></a><meta itemprop=position content=2></span><i class="ic i-angle-right"></i> <span class=current itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/database/ itemprop=item rel=index title="分类于 数据库"><span itemprop=name>数据库</span></a><meta itemprop=position content=3></span></div><article itemscope itemtype=http://schema.org/Article class="post block" lang=zh-CN><link itemprop=mainEntityOfPage href=https://www.reversesacle.com/computer-science/programming/database/sql/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.webp><meta itemprop=name content=ReverseSacle><meta itemprop=description content="所见即所得，所思即所行, 知识书库 & 学习点滴"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=逆转天平></span><div class="body md" itemprop=articleBody><h2 id=概述><a class=anchor href=#概述>#</a> 概述</h2><p>1974年由Boyce和Chanmber提出。</p><p>1975 ~ 1979年由IBM的San Jose研究室在System R上首次实现，称为</p><p>Sequel(Structured English QUEry Language) - SQL(Structured Query Language)</p><p>ANSI/ISO推出SQL标准</p><ul><li>1986年 - SQL-86</li><li>1989年 - SQL-89</li><li>1992年 - SQL-92(SQL2)</li><li>1999年 - SQL-99(SQL3)</li><li>SQL 2003；SQL 2006；SQL 2008</li></ul><p>SQL还有一个标准<code>SQL X/Open</code>标准，主要强调各厂商产品的可移植性，只包含被各厂商广泛认可的操作。</p><p>是结构化查询语言，是一个通用，功能极强的关系数据库语言。</p><p>主流数据库当中，当进行查询时，主要用的都是SQL语句，其可以在数据库中直接执行查询，插入，删除，修改等操作，另外，它还可以嵌入到程序语言中来执行与数据库相关的操作。</p><h2 id=sql基础概述><a class=anchor href=#sql基础概述>#</a> !SQL基础概述</h2><h3 id=基本概念><a class=anchor href=#基本概念>#</a> 基本概念</h3><ul><li><p>基本表(关系)</p><ul><li><p>是独立存在的表，SQL中一个关系对应一个基本表</p></li><li><p>一个或多个基本表可对应一个存储文件，一个表可以带若干个索引</p></li></ul></li><li><p>存储文件</p><ul><li><p>由逻辑结构组成的关系数据库的内模式(存储文件格式)</p></li><li><p>物理结构是任意的，对用户透明</p></li></ul></li><li><p>视图</p><ul><li><p>是一个虚表，从一个或多个基本表导出的表</p></li><li><p>数据库中只存放视图的定义而不存放视图对应的数据</p></li><li><p>用户可以在视图上再定义视图</p></li></ul></li><li><p>数据库术语</p><ul><li><p><code>数据库(database)</code> - 保存有组织的数据的容器(通常是一个文件或一组文件)</p></li><li><p><code>数据表(table)</code> - 某种特定类型数据的结构化清单</p></li><li><p><code>模式(schema)</code> - 关于数据库和表的布局及特性的信息。模式定义了数据在表中如何存储，包含存储什么样的数据，数据如何分解，各部分信息如何命名等信息。数据库和表都有模式</p></li><li><p><code>列(column)</code> - 表中的一个字段。所有表都是由一个或多个列组成的</p></li><li><p><code>行(row)</code> - 表中的一个记录</p></li><li><p><code>主键(primary key)</code> - 一列(或一组列)，其值能够唯一标识表中每一行</p></li></ul></li></ul><p><strong>什么是SQL？</strong></p><p>SQL是一种结构化查询语言(Structured Query Language)，专门用来与数据库打交道，目的是提供一种从数据库中读写数据的简单有效的方法。</p><p>几乎所有的主流关系数据库都支持 SQL ，适用性非常强。并且，一些非关系型数据库也兼容 SQL 或者使用的是类似于 SQL 的查询语言。</p><p>SQL可以</p><ul><li>新建数据库、数据表、字段</li><li>在数据库中增加，删除，修改，查询数据</li><li>新建视图、函数、存储过程</li><li>对数据库中的数据进行简单的数据分析</li><li>搭配Hive，Spark SQL做大数据</li><li>搭配SQLFlow做机器学习</li></ul><h3 id=sql的特点><a class=anchor href=#sql的特点>#</a> SQL的特点</h3><ul><li>集数据定义语言(DDL)，数据操作语言(DML)与数据控制语言(DCL)一体化</li><li>可以独立完成数据库生命周期中的全部活动，如定义关系模式，建立数据库，对数据的插入，查询，删除和更新，以及数据库重构与维护等</li><li>数据库投入运行后，可根据需求随时逐步修改模式，并且不影响数据的运行</li><li>数据操作符统一，采用集合的操作方式</li><li>只要提出做什么，无需了解存取路径。存取路径的选择以及SQL的操作过程全部由系统自动完成</li><li>即是独立的语言，能够独立地用于联机交互的使用方式；又是嵌入式语言，能够嵌入到高级语言中，供开发者设计程序时使用</li></ul><h3 id=核心功能操作><a class=anchor href=#核心功能操作>#</a> 核心功能操作</h3><table><thead><tr><th style=text-align:left>SQL功能</th><th>动词</th></tr></thead><tbody><tr><td style=text-align:left>数据查询</td><td><strong>SELECT</strong></td></tr><tr><td style=text-align:left>数据定义</td><td><strong>CREATE, DROP, ALTER</strong></td></tr><tr><td style=text-align:left>数据操作</td><td><strong>INSERT, UPDATE, DELETE</strong></td></tr><tr><td style=text-align:left>数据控制</td><td><strong>GRANT, REVOKE</strong></td></tr></tbody></table><p>SQL支持关系数据库三级模式机构。</p><ul><li><p><strong>外模式</strong> - 应用程序在访问数据库里面的数据时，数据是以<strong>视图</strong>的形式展现。视图是一个虚拟的表，数据来源于不同的表格，可以把多个表里面的数据以一个表的形式展现</p></li><li><p><strong>模式</strong> - 在数据库里面存储不同的<strong>二维表格</strong></p></li><li><p><strong>内模式</strong> - 数据库中存储的表格在硬盘中用<strong>存储文</strong>件的形式来存储</p></li></ul><h3 id=sql分类><a class=anchor href=#sql分类>#</a> SQL分类</h3><p><strong>数据定义语言</strong>(Data Definition Language - DDL)</p><ul><li><p>数据定义语言是SQL语言集中负责数据结构定义与数据库对象定义的语言</p></li><li><p>DDL的主要功能是<strong>定义数据库对象</strong></p></li><li><p>DDL的核心指令是 <code>CREATE</code>、<code>ALTER</code>、<code>DROP</code></p></li></ul><p><strong>数据操纵语言</strong>(Data Manipulation Language - DML)</p><ul><li><p>数据操纵语言是用于数据库操作，对数据库其中的对象和数据运行访问工作的编程语句</p></li><li><p>DML的主要功能是<strong>访问数据</strong>，因此其语法都是以<strong>读写数据库</strong>为主</p></li><li><p>DML的核心指令是<code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>、<code>SELECT</code>。这四个指令合称CRUD(Create, Read, Update, Delete)，即增删改查</p></li></ul><p><strong>事务控制语言</strong>(Transaction Control Language - TCL)</p><ul><li><p>事务控制语言用于<strong>管理数据库中的事务</strong>。这些用于管理由DML语句所做的更改，还允许将语句分组为逻辑事务</p></li><li><p>TCL的核心指令是 <code>COMMIT</code>、<code>ROLLBACK</code></p></li></ul><p><strong>数据控制语言</strong>(Data Control Language - DCL)</p><ul><li><p>数据控制语言是一种可对数据访问权进行控制的指令，它可以控制特定用户账户对数据表、查看表、预存程序、用户自定义函数等数据库对象的控制权</p></li><li><p>DCL的核心指令是 <code>GRANT</code>、<code>REVOKE</code></p></li><li><p>DCL以<strong>控制用户的访问权限</strong>为主，因此其指令作法并不复杂，可利用DCL控制的权限有<code>CONNECT</code>、<code>SELECT</code>、<code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>、<code>EXECUTE</code>、<code>USAGE</code>、<code>REFERENCES</code>。根据不同的DBMS以及不同的安全性实体，其支持的权限控制也有所不同</p></li></ul><h3 id=sql语法><a class=anchor href=#sql语法>#</a> SQL语法</h3><p>SQL的标准是由ANSI标准委员会管理，称为<code>ANSI SQL</code>。各个DBMS都有自己的实现，如PL/SQL、Transact-SQL等。</p><p><strong>SQL语法结构</strong></p><p><img data-src=https://cdn.jsdelivr.net/gh/ReverseSacle/Gallery@latest/programming/database/2.webp alt=""></p><ul><li><p><strong><code>子句</code></strong> - 是语句和查询的组成成分(在某些情况下都是可选的)</p></li><li><p><strong><code>表达式</code></strong> - 可以产生任何标量值，或由列和行的数据库表</p></li><li><p><strong><code>谓词</code></strong> - 给需要评估的 SQL 三值逻辑(3VL)(true/false/unknown)或布尔真值指定条件，并限制语句和查询的效果，或改变程序流程</p></li><li><p><strong><code>查询</code></strong> - 基于特定条件检索数据。这是SQL的一个重要组成部分</p></li><li><p><strong><code>语句</code></strong> - 可以持久地影响纲要和数据，也可以控制数据库事务、程序流程、连接、会话或诊断</p></li></ul><p><strong>SQL语法要点</strong></p><ul><li><p>SQL语句不区分大小写，但是数据库表名、列名和值是否区分，依赖于具体的DBMS以及配置</p></li><li><p>多条SQL语句必须以分号(<code>;</code>)分隔</p></li><li><p>处理SQL语句时，所有空格都被忽略</p></li><li><p>SQL支持三种注释，语句可以写成一行，也可以分写为多行</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">## 注释1</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">-- 注释2</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/* 注释3 */</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 一行SQL语句 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">UPDATE</span> <span class="token keyword">user</span> <span class="token keyword">SET</span> username<span class="token operator">=</span><span class="token string">'robot'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'robot'</span> <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">/* 多行SQL语句 */</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">UPDATE</span> <span class="token keyword">user</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">SET</span> username<span class="token operator">=</span><span class="token string">'robot'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'robot'</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li></ul><h2 id=数据的定义><a class=anchor href=#数据的定义>#</a> 数据的定义</h2><table><thead><tr><th style=text-align:left>操作对象</th><th style=text-align:left>创建</th><th style=text-align:left>删除</th><th style=text-align:left>修改</th></tr></thead><tbody><tr><td style=text-align:left>模式</td><td style=text-align:left>CREATE SCHEMA</td><td style=text-align:left>DROP SCHEMA</td><td style=text-align:left></td></tr><tr><td style=text-align:left>表</td><td style=text-align:left>CREATE TABLE</td><td style=text-align:left>DROP TABLE</td><td style=text-align:left>ALTER TABLE</td></tr><tr><td style=text-align:left>视图</td><td style=text-align:left>CREATE VIEW</td><td style=text-align:left>DROP VIEW</td><td style=text-align:left></td></tr><tr><td style=text-align:left>索引</td><td style=text-align:left>CREATE INDEX</td><td style=text-align:left>DROP INDEX</td><td style=text-align:left>ALTER INDEX</td></tr></tbody></table><p>在执行创建模式语句时，必须拥有DBA权限，或者DBA授予<code>CREATE SCHEMA</code>的权限。可以在创建模式的时候进行授权操作。</p><p>注释操作 - <code>/*......*/</code></p><p>一个<code>;</code>号表示一个语句的结束，语句可以分行写。</p><h2 id=数据类型><a class=anchor href=#数据类型>#</a> 数据类型</h2><table><thead><tr><th style=text-align:left>数据类型</th><th style=text-align:left>含义</th></tr></thead><tbody><tr><td style=text-align:left>CHAR(N)</td><td style=text-align:left>长度为N的定长字符串，长度固定为N</td></tr><tr><td style=text-align:left>VARCHAR(N)</td><td style=text-align:left>最大长度为N的变长字符串，会根据实际存放的位数来改变长度</td></tr><tr><td style=text-align:left>INT</td><td style=text-align:left>长整型(也可写为INTEGER)</td></tr><tr><td style=text-align:left>SMALLINT</td><td style=text-align:left>短整型</td></tr><tr><td style=text-align:left>NUMERIC(P,D)</td><td style=text-align:left>定点数，由P位数字(不包括符号与小数点)组成，小数后面有D位数字</td></tr><tr><td style=text-align:left>REAL</td><td style=text-align:left>取决于机器精度的浮点数</td></tr><tr><td style=text-align:left>Double Precision</td><td style=text-align:left>取决于机器精度的双精度浮点数</td></tr><tr><td style=text-align:left>FLOAT(N)</td><td style=text-align:left>浮点数，精度至少为N位数字</td></tr><tr><td style=text-align:left>DATE</td><td style=text-align:left>日期，包括年，月，日，格式为<code>YYYY-MM-DD</code></td></tr><tr><td style=text-align:left>TIME</td><td style=text-align:left>时间，包含一天的时，分，秒，格式为<code>HH:MM:SS</code></td></tr></tbody></table><p>凡是字符类型的数据语句中需要加单引号。</p><h2 id=定义模式><a class=anchor href=#定义模式>#</a> 定义模式</h2><p>模式 - 统一行为或定义或属性的集合</p><p><strong>创建</strong></p><p>为用户定义一个模式 - <code>CREATE SCHEMA 模式名 AUTHORIZATION 用户名</code></p><p>为用户定义一个模式，模式名与用户名一致 - <code>CREATE SCHEMA AUTHORIZATION 用户名</code></p><p>在<strong>CREATE SCHEMA</strong>中可以接受<strong>CREATE TABLE</strong>，<strong>CREATE VIEW</strong>和<strong>GRANT</strong>子句。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 例如，为用户ZHANG创建了一个模式TEST，并在其中定义一个表TAB1。(TAB1表属于TEST模式) */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> TEST <span class="token keyword">AUTHORIZATION</span> ZHANG</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TAB1<span class="token punctuation">(</span>COL1 <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                   COL2 <span class="token keyword">INT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                   COL3 <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                   COL4 <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">10.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>                   COL5 <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">5.2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre>                   <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>删除</strong></p><p>语句 - <code>DROP SCHEMA 模式名 CASCADE | RESTRICT</code></p><p><strong>CASCADE</strong>与<strong>RESTRICT</strong>二选一。</p><p><strong>CASCADE(级联)</strong> - 删除模式的同时把该模式中所有数据库对象全部删除</p><p><strong>RESTRICT(限制)</strong> - 如果该模式中包含了额外的数据库对象(如表，视图)，则拒绝该删除语句的操作；不包含时正常执行操作。</p><h2 id=定义基本表table><a class=anchor href=#定义基本表table>#</a> !定义基本表(TABLE)</h2><figure class="highlight sql"><figcaption data-lang=SQL><span>语句</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名<span class="token punctuation">(</span>列名<span class="token number">1</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=2></td><td><pre>                  列名<span class="token number">2</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>                  列名<span class="token number">3</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                  列名<span class="token number">4</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                  列名<span class="token number">5</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num=7></td><td><pre>                  列名N 数据类型 列级完整性约束条件</pre></td></tr><tr><td data-num=8></td><td><pre>                  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>如果完整性约束条件涉及到该表的多个属性列，则必须定义在表级上，否则既可以定义在列级也可以定义在表级。</p><p>建表的时候，一定要设置主码(主键)，主码不能为空值。</p><p><strong>例子</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 建立一个学生表Student，学号是主码，姓名取值唯一(不能重名) */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>                      Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                      Ssex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                      Sage <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                      Sdept <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>                      <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>CHAR(N)</strong> - 表示字符类型，字符的最大长度是<strong>N位</strong></p><p><strong>PRIMARY KEY</strong> - 列级完整性约束条件，设置该属性(列名)为主码(主键)</p><p><strong>UNIQUE</strong> - 列级完整性约束条件，表示唯一，列名的域下的值不能重复</p><p><strong>SMALLINT</strong> - 表示为短整数类型，最大可存放数值约(<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msup><mn>2</mn><mn>8</mn></msup></mrow><annotation encoding=application/x-tex>2^8</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141079999999999em;vertical-align:0></span><span class=mord><span class=mord>2</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141079999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span></span></span></span>)</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 建立一个课程表Course */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Course<span class="token punctuation">(</span>Cno CHAAR<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>                     Cname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                     Cpno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                     Ccredit <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                     <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Cpno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Course<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>                     <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>FOREIGN KEY(属性名) REFERENCES 表名(属性名)</strong> - 表级完整性约束条件，设置外码(外键)，参考表名中的某个列名，以此将属性名设置为外键，外键与主键应该是相对应的。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 建立一个学生选课表SC */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>                 Cno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                 Grade <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                 <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>                <span class="token comment">/* 参考Student表中的Sno属性，将该表的Sno属性设置为外码 */</span></pre></td></tr><tr><td data-num=8></td><td><pre>                 <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Cno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Course<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre>                <span class="token comment">/* 参考Course表中的Cno属性，将该表的Cno属性设置为外码 */</span></pre></td></tr><tr><td data-num=10></td><td><pre>                 <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>主码由Sno与Cno两个属性构成，必须作为表级完整性进行定义。Sno来自表Student，Cno来自表Course。</p><h2 id=约束constraint><a class=anchor href=#约束constraint>#</a> 约束(CONSTRAINT)</h2><p>SQL 约束用于规定表中的数据规则。</p><p>如果存在违反约束的数据行为，行为会被约束终止。</p><p>约束可以在创建表时规定(通过 CREATE TABLE 语句)，或者在表创建之后规定(通过 ALTER TABLE 语句)。</p><p><strong>约束类型</strong></p><ul><li><code>NOT NULL</code> - 指示某列不能存储 NULL 值</li><li><code>UNIQUE</code> - 保证某列的每行必须有唯一的值</li><li><code>PRIMARY KEY</code> - NOT NULL 和 UNIQUE 的结合。确保某列(或两个列多个列的结合)有唯一标识，有助于更容易更快速地找到表中的一个特定的记录</li><li><code>FOREIGN KEY</code> - 保证一个表中的数据匹配另一个表中的值的参照完整性</li><li><code>CHECK</code> - 保证列中的值符合指定的条件</li><li><code>DEFAULT</code> - 规定没有给列赋值时的默认值</li></ul><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Users <span class="token punctuation">(</span></pre></td></tr><tr><td data-num=2></td><td><pre>  Id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'自增Id'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>  Username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">DEFAULT</span> <span class="token string">'default'</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>  Password <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'default'</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>  Email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'default'</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱地址'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>  Enabled <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'是否有效'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Id<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'用户表'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id=模式与表><a class=anchor href=#模式与表>#</a> !模式与表</h2><p>每一个基本表都属于某一个模式，一个模式包含多个基本表。</p><h3 id=创建基本表><a class=anchor href=#创建基本表>#</a> 创建基本表</h3><p>创建基本表(其他数据库对象也一样)时，若没有指定模式，系统会根据<strong>搜索路径</strong>来确定该对象所属的模式。</p><p><strong>相关命令</strong></p><ul><li><p>显示当前的搜索路径 - <code>SHOW search_path</code></p></li><li><p>查看当前搜索路径的默认值 - <code>$user, PUBLIC</code></p></li><li><p>DBA用户可以设置搜索路径 - <code>SET search_path TO 模式名, PUBLIC</code></p></li></ul><p>使用DBA用户设置搜索路径后，每次建表都会自动归为DBA用户设置搜索路径的模式下。</p><p>如果搜索路径中的模式名不存在，系统将报错。</p><p>如果搜索路径中的模式名存在，RDBMS会使用模式列表中的第一个模式作为数据库对象的模式名</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 模式名已存在，在创建表时指定所属模式 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">"S-T"</span> Student<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 在创建模式的时候，一起创建表，该表会属于该模式 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> 模式名 <span class="token keyword">AUTHORIZATION</span> 用户名</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名<span class="token punctuation">(</span>列名<span class="token number">1</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                   列名<span class="token number">2</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                   列名<span class="token number">3</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                   列名<span class="token number">4</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>                   列名<span class="token number">5</span> 数据类型 列级完整性约束条件<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>                   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num=9></td><td><pre>                   列名N 数据类型 列级完整性约束条件</pre></td></tr><tr><td data-num=10></td><td><pre>                   <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=修改基本表><a class=anchor href=#修改基本表>#</a> 修改基本表</h3><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>ALTER TABLE 表名 ADD COLUMN 列名 新列名 数据类型 列级完整性约束条件</pre></td></tr><tr><td data-num=2></td><td><pre>                ADD 表级完整性约束条件</pre></td></tr><tr><td data-num=3></td><td><pre>                DROP COLUMN 列名 CASCADE | RESTRICT</pre></td></tr><tr><td data-num=4></td><td><pre>                DROP CONSTRAINT 完整性约束名 CASCADE | RESTRICT</pre></td></tr><tr><td data-num=5></td><td><pre>                ALTER COLUMN 列名 数据类型</pre></td></tr></table></figure><p><code>ADD</code> - 用于增加新列或新的列级完整性约束条件和表级完整性约束条件</p><p><code>DROP COLUMN</code> - 用于删除表中的列</p><p>如果指定了<strong>CASCADE</strong>短语，则自动删除引用该列的其他对象。</p><p>如果指定了<strong>RESTRICT</strong>短语，则当该列被其他对象引用时，数据库管理系统会拒绝该删除操作。</p><p><code>DROP CONSTRAINT</code> - 用于删除指定的完整性约束条件</p><p><code>ALTER COLUMN</code> - 用于修改原有的列定义，包括修改列名和数据类型</p><p><strong>例子</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 向Student表中增加入学时间列，其数据类型为日期类型 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STudent <span class="token keyword">ADD</span> S_entrance <span class="token keyword">DATE</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>无论基本表中原来是否由数据，新增加的列一律为空值(表示不存在，不知道如何表示，无意义)。</p><p>不能用于增加主码，因为主码不能为空值。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 将年龄的数据类型由字符型改为整数类型 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> Sage <span class="token keyword">INT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* 增加课程名称必须取唯一值这个约束条件 */</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Course <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">(</span>Cname<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=删除基本表><a class=anchor href=#删除基本表>#</a> 删除基本表</h3><p>语句 - <code>DROP TABLE 表名 CASCADE | RESTRICT</code></p><p>如果指定了<strong>CASCADE</strong>短语，删除该表是没有限制的，再删除基本表的同时，相关的依赖对象会被一起删除。</p><p>如果指定了<strong>RESTRICT</strong>短语，删除该表是有限制的，删除的基本表不能被其他表的约束所引用。如果存在依赖该表的对象，该表不能被删除。</p><p>当基本表定义被删除时，数据被删除，表上建立的索引，视图，触发器等一般都会被删除。</p><p><strong>例子</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">删除Student表，若表上有视图，选择RESTRICT时表不能被删除，</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">选择CASCADE时可以删除表，视图也自动被删除。</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> IS_Student</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">AS</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sage</pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'IS'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> Student <span class="token keyword">RESTRICT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">/* --ERROR: cannot drop table Student because other objects depend on it*/</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> Student <span class="token keyword">CASCADE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">/* --NOTICE: drop cascades to view IS_Student */</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> IS_Student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">/* --ERROR: relation "IS_Student" does not exist */</span></pre></td></tr></table></figure><p><strong>为什么不推荐使用外键与级联？</strong></p><p>可能的原因</p><ul><li><p><strong>增加了复杂性</strong></p><ul><li>每次做DELETE或者UPDATE都必须考虑外键约束，会导致开发的时候很痛苦，测试数据极为不方便</li><li>外键的主从关系是定的，假如那天需求有变化，数据库中的这个字段根本不需要和其他表有关联的话就会增加很多麻烦</li></ul></li><li><p><strong>增加了额外工作</strong> - 数据库需要增加维护外键的工作，比如当做一些涉及外键字段的增，删，更新操作之后，需要触发相关操作去检查，保证数据的的一致性和正确性，这样会不得不消耗资源</p></li><li><p><strong>对分库分表不友好</strong> - 因为分库分表下外键是无法生效的</p></li></ul><p>外键的好处</p><ul><li><p>保证了数据库数据的一致性和完整性</p></li><li><p>级联操作方便，减轻了程序代码量</p></li></ul><p><strong>drop、delete 与 truncate 区别？</strong></p><p><strong>用法不同</strong></p><ul><li><code>drop</code> - <code>drop table 表名</code>，用于丢弃数据，直接将表都删除掉，在删除表的时候使用</li><li><code>truncate</code> - <code>truncate table 表名</code>，用于清空数据，只删除表中的数据，再插入数据的时候自增长 id 又从 1 开始，在清空表中数据的时候使用</li><li><code>delete</code> - <code>delete from 表名 WHERE 列名=值</code>，用于删除数据，删除某一行的数据，如果不加<code>WHERE</code>子句和<code>truncate table 表名</code>作用类似</li></ul><p><code>truncate</code>与不带<code>WHERE</code>子句的 <code>delete</code>、以及<code>drop</code>都会删除表内的数据，但是<code>truncate</code>和<code>delete</code>只删除数据不删除表的结构(定义)，执行<code>drop</code>语句，此表的结构也会删除，也就是执行<code>drop</code>之后对应的表不复存在。</p><p><strong>属于不同的数据库语言</strong></p><ul><li><code>truncate</code>和<code>drop</code> - 属于DDL(数据定义语言)语句，操作立即生效，原数据不放到<code>rollback segment</code>中，不能回滚，操作不触发trigger</li><li><code>delete</code> - 属于DML(数据库操作语言)语句，操作会放到<code>rollback segment</code>中，事务提交之后才生效</li><li><strong>DML 语句和 DDL 语句区别</strong><ul><li>DML(Data Manipulation Language) - 数据库操作语言，是指对数据库中表记录的操作，主要包括表记录的插入、更新、删除和查询，是开发人员日常使用最频繁的操作</li><li>DDL(Data Definition Language) - 数据定义语言，简单来说，就是对数据库内部的对象进行创建、删除、修改的操作语言。它和DML语言的最大区别是DML只是对表内部数据的操作，而不涉及到表的定义、结构的修改，更不会涉及到其他对象。DDL语句更多的被数据库管理员(DBA)所使用，一般的开发人员很少使用</li></ul></li></ul><p>另外，由于<code>SELECT</code>不会对表进行破坏，所以有的地方也会把<code>SELECT</code>单独区分开叫做数据库查询语言DQL(Data Query Language)。</p><p><strong>执行速度不同</strong></p><p>一般来说 - <code>drop</code> &gt; <code>truncate</code> &gt; <code>delete</code></p><ul><li><code>delete</code>命令执行的时候会产生数据库的<code>binlog</code>日志，而日志记录是需要消耗时间的，但是也方便数据回滚恢复</li><li><code>truncate</code>命令执行的时候不会产生数据库日志，因此比<code>delete</code>要快。此外，还会把表的自增值重置和索引恢复到初始大小等</li><li><code>drop</code>命令会把表占用的空间全部释放掉</li></ul><h2 id=索引index><a class=anchor href=#索引index>#</a> !索引(INDEX)</h2><p>索引是一种用于快速查询和检索数据的数据结构，其本质可以看成是一种排序好的数据结构。</p><p>索引相当于现实书本的目录，用于加快查询速度。</p><p>只有数据库管理员(DBA)或表的所属对象(建表时指定的用户)可以建立索引。</p><p>DBMS一般会自动建立<code>PRIMARY KEY</code>，<code>UNIQUE</code>的索引。</p><p>DBMS会自动完成对索引的维护。</p><p>DBMS会自动选择是否使用索引以及使用哪些索引。</p><p>RDBMS中索引的结构一般采用B+树，HASH索引来实现。B+树索引具有动态平衡的优点，HASH索引具有查找速度快的有点。采用B+树还是HASH索引具体由RDBMS来决定。</p><p>索引是关系数据库内部的实现技术，属于内模式的范围。</p><p>使用<code>CREATE INDEX</code>语句定义索引时，可以定义的索引类型有唯一索引，非唯一索引和聚簇索引。</p><p><strong>索引的优点和缺点？</strong></p><p><strong>优点</strong></p><ul><li><p>使用索引可以大大加快数据的检索速度(大大减少检索的数据量), 这也是创建索引的最主要的原因</p></li><li><p>通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性</p></li><li><p><strong>提高查询速度</strong> - 索引可以极大地加快数据检索的速度。这是通过使用快速的查找算法(如二进制搜索、B树和散列)来实现的，这些算法比全表扫描要快得多</p></li><li><p><strong>排序数据记录</strong> - 索引可以在数据库中为数据记录进行排序，从而减少了排序操作(ORDER BY)的需要，同时也加快了排序查询的响应时间</p></li><li><p><strong>唯一性约束</strong> - 唯一索引可以保证每一行数据的唯一性。这经常用于主键索引以确保主键不重复</p></li><li><p><strong>更有效的数据访问计划</strong> - 对于复杂的查询语句，包含多个连接(JOINS)和条件子句(WHERE)的查询，数据库优化器能够利用索引来创建一个更有效的数据访问策略</p></li><li><p><strong>支持索引的SQL语句</strong> - 通过使用索引，可以快速完成许多SQL操作，如COUNT, MIN, MAX等</p></li></ul><p><strong>缺点</strong></p><ul><li><p>创建索引和维护索引需要耗费许多时间。当对表中的数据进行增删改的时候，如果数据有索引，那么索引也需要动态的修改，会降低SQL执行效率</p></li><li><p>索引需要使用物理文件存储，也会耗费一定空间</p></li><li><p><strong>增加写操作的成本</strong> - 每次对数据库表的插入或更新操作时，索引也必须更新。这使得写操作比没有索引时更加昂贵和慢</p></li><li><p><strong>占用更多的存储空间</strong> - 索引需要额外的磁盘空间。对于拥有大量索引的数据库，这可能会成为问题，因为它们不仅会使用更多的磁盘空间，还可能导致内存中缓存的数据页更少</p></li><li><p><strong>管理开销</strong> - 索引需要维护。随着数据的变更，索引可能会变得碎片化，这需要定期的维护以保持性能，例如通过重建或重新组织索引</p></li><li><p><strong>索引设计</strong> - 确定哪些列应该被索引并不总是直接明了的。过多或错误的索引设计可能会损害性能，尤其是在选择错误的索引类型或创建与查询模式不匹配的索引时</p></li><li><p><strong>影响优化器</strong> - 错误的索引可能会误导数据库查询优化器，导致选择了非最佳的查询计划</p></li></ul><p><strong>使用索引一定能提高查询性能吗？</strong></p><p>大多数情况下，索引查询都是比全表扫描要快的。但是如果数据库的数据量不大，那么使用索引也不一定能够带来很大提升。</p><p><strong>谈谈数据库中索引的理解，索引和主键区别？</strong></p><p>数据库索引是一种数据结构，它可以提高数据库查询的速度。就像图书的目录一样，索引能够帮助数据库管理系统快速定位到表中的数据，而不需要扫描整个表。索引通常是基于一个或多个列(字段)构建的，并且能够大幅减少数据查找时间。</p><p><strong>索引的主要作用有</strong></p><ul><li>提升查询效率 - 通过索引，可以快速访问到数据库表中的特定信息，无需遍历全表</li><li>保持数据排序 - 某些类型的索引还可以保证数据行的物理顺序与索引顺序相同，如聚簇索引</li><li>唯一性检验 - 通过创建唯一性索引，可以确保某一列或列组合的值是唯一的，避免重复数据</li></ul><p>索引通常使用B树、哈希表、R树等数据结构实现，取决于具体的应用场景和DBMS。</p><p><strong>主键和索引之间有以下区别</strong></p><p><strong>主键</strong></p><ul><li>是数据库表中的一个特殊约束，它唯一标识表中的每条记录</li><li>一个表中只能有一个主键</li><li>主键的值必须是唯一的，不能为NULL</li><li>主键本身就是一个索引(通常是聚簇索引)，DBMS自动为主键创建索引</li></ul><p><strong>索引</strong></p><ul><li>可以是任何普通的数据库表列，它们没有主键的约束条件</li><li>一个表中可以有多个索引，用于加速各种查询操作</li><li>索引可以是唯一的(保证列值的唯一性)，也可以是非唯一的(允许列值重复)</li><li>创建索引并不改变数据本身的物理存储，除非它是聚簇索引</li></ul><p>总结来说，主键是表中用于唯一标识记录的特殊列，通常会伴随一个自动创建的索引，而索引是为了加速查询而对一个或多个列进行优化的数据结构。主键是表级约束的一部分，而索引是性能优化的工具。</p><h3 id=建立索引><a class=anchor href=#建立索引>#</a> 建立索引</h3><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CREATE <span class="token punctuation">[</span>UNIQUE<span class="token punctuation">]</span> <span class="token punctuation">[</span>CLUSTER<span class="token punctuation">]</span> INDEX 索引名 ON 表名(列名 次序...);</pre></td></tr></table></figure><p><strong>例子</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 建立唯一索引Stusno，通过Student表中的Sno列来建立索引*/</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> Stusno <span class="token keyword">ON</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/* 建立唯一索引Coucno，通过Course表中的Cno列来建立索引*/</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> Coucno <span class="token keyword">ON</span> Course<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 建立唯一索引SCno，通过SC表中的Sno列与Cno列来建立索引*/</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> SCno <span class="token keyword">ON</span> SC<span class="token punctuation">(</span>Sno <span class="token keyword">ASC</span><span class="token punctuation">,</span>Cno <span class="token keyword">DESC</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">Student表按学号升序建立唯一索引。</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">Course表按课程升序建立唯一索引。</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">SC表按学号升序(ASC)和课程降序(DESC建议唯一索引。</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">*/</span></pre></td></tr></table></figure><p><code>CLUSTER</code>表示要建立的索引是聚簇索引。</p><p>聚簇索引是指索引顺序与表中记录的物理顺序一致的索引组织，即表示对物理硬盘当中实际数据的存储的位置进行变动。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 在Student表的Sname列上建立一个聚簇索引 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> CLUSTER <span class="token keyword">INDEX</span> Stusname <span class="token keyword">ON</span> Student<span class="token punctuation">(</span>Sanme<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>可在经常查询的列上建立聚簇索引以提高查询效率。</p><p>一个基本表上最多只能建立一个聚簇索引。</p><p>经常更新的列不适合建立聚簇索引。</p><h3 id=删除索引><a class=anchor href=#删除索引>#</a> 删除索引</h3><p>语句 - <code>DROP INDEX 索引名</code></p><p>删除索引时，系统会从数据字典中删除有关该索引的描述。</p><h2 id=数据字典><a class=anchor href=#数据字典>#</a> 数据字典</h2><p>数据字典是关系数据库管理系统内部的一组系统表。</p><p>数据字典记录了数据库中所有的定义信息，包括模式定义，视图定义，索引定义，完整性约束定义，各类用户对数据库的操作权限，统计信息等。</p><p>RDBMS执行SQL数据定义时，实际就是更新数据字典。</p><h2 id=数据查询><a class=anchor href=#数据查询>#</a> !数据查询</h2><p><code>SELECT</code>语句用于从数据库中查询数据。</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>SELECT <span class="token punctuation">[</span>ALL | DISTINCT<span class="token punctuation">]</span> 目标列表达式</pre></td></tr><tr><td data-num=2></td><td><pre>FROM 表名或视图名</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">[</span>WHERE 条件表达式<span class="token punctuation">]</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">[</span>GROUP BY 列名 HAVING 条件表达式<span class="token punctuation">]</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">[</span>ORDER BY 列名 <span class="token punctuation">[</span>ASC | DESC<span class="token punctuation">]</span><span class="token punctuation">]</span>;</pre></td></tr></table></figure><ul><li><p><code>SELECT</code> - 表示要选择并显示出的信息</p></li><li><p><code>DISTINCT</code> - 用于返回唯一不同的值。它作用于所有列，也就是说所有列的值都相同才算相同</p></li><li><p><code>FROM</code> - 指定从哪去查找信息</p></li><li><p><code>WHERE</code> - 可选，约束语句，以条件来限制查询的内容</p><ul><li><p>用于过滤记录，即缩小访问数据的范围</p></li><li><p>后跟一个返回 <code>true</code> 或 <code>false</code> 的条件</p></li><li><p>可以与 <code>SELECT</code>，<code>UPDATE</code> 和 <code>DELETE</code> 一起使用</p></li><li><p>可以使用的操作符</p><table><thead><tr><th style=text-align:left>运算符</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left>=</td><td style=text-align:left>等于</td></tr><tr><td style=text-align:left>&lt;&gt;</td><td style=text-align:left>不等于。注释：在 SQL 的一些版本中，该操作符可被写成 !=</td></tr><tr><td style=text-align:left>&gt;</td><td style=text-align:left>大于</td></tr><tr><td style=text-align:left>&lt;</td><td style=text-align:left>小于</td></tr><tr><td style=text-align:left>&gt;=</td><td style=text-align:left>大于等于</td></tr><tr><td style=text-align:left>&lt;=</td><td style=text-align:left>小于等于</td></tr><tr><td style=text-align:left>BETWEEN</td><td style=text-align:left>在某个范围内</td></tr><tr><td style=text-align:left>LIKE</td><td style=text-align:left>搜索某种模式</td></tr><tr><td style=text-align:left>IN</td><td style=text-align:left>指定针对某个列的多个可能值</td></tr></tbody></table></li></ul></li><li><p><code>GROUP BY</code> - 可选，分组</p></li><li><p><code>ORDER BY</code> - 可选，排序</p></li><li><p><code>ASC</code> - 升序(默认)</p></li><li><p><code>DESC</code> - 降序</p></li></ul><p>语句中的字母不分大小写，语句中的标点符号都为英文状态下的半角字符。</p><p><code>[]</code>中的内容，不是语句必须的内容，只有为了实现某些功能时才添加。</p><h3 id=单表查询><a class=anchor href=#单表查询>#</a> 单表查询</h3><p>对一个表的内容进行查询。</p><h4 id=选择表中的若干列><a class=anchor href=#选择表中的若干列>#</a> 选择表中的若干列</h4><p><strong>查询指定列</strong></p><p>语句 - <code>SELECT 列名1,列名2..列名N FROM 表名</code></p><p>查询后只显示填入的列名的数据。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询全体学生的学号和姓名 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname <span class="token keyword">FROM</span> Student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* 查询全体学生的姓名，学号，所在系 */</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sno<span class="token punctuation">,</span>Sdept <span class="token keyword">FROM</span> Student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">/* 返回前 5 行 */</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student <span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/* 返回第 3 ~ 5 行 */</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student <span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>LIMIT</code>限制返回的行数，有两个参数，第一个参数为起始行，从0开始，第二个参数为返回的总行数。</p><p><strong>查询全部列</strong></p><p>语句 - <code>SELECT * FROM 表名</code></p><p><strong>查询并经过计算的值</strong></p><p>选出表中指定的属性列，并经过计算后输出显示。</p><p>语句 - <code>SELECT 子句的目标列表达式</code></p><ul><li>算术表达式</li><li>字符串常量</li><li>函数名</li><li>列别名</li></ul><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询全体学生的姓名及其出生年份 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span><span class="token number">2004</span><span class="token operator">-</span>Sage <span class="token keyword">FROM</span> Student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/* 2004-Sage为算术表达式，结果显示的列名为2004-sage */</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 查询全体学生的姓名，出生年份和所在系，要求用小写字母表示所有系名 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span><span class="token string">'Year of Birth: '</span><span class="token punctuation">,</span><span class="token number">2004</span><span class="token operator">-</span>Sage<span class="token punctuation">,</span>LOWER<span class="token punctuation">(</span>Sdept<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Student<span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>'Year of Birth'</code> - 为字符串常量，显示结果时，属性名和值都是该常量字符串</p><p><code>LOWER()</code> - 将字符类型的数据从大写变为小写</p><p>使用别名改变查询结果的列名。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span><span class="token string">'Year of Birth: '</span> BIRTH<span class="token punctuation">,</span><span class="token number">2004</span><span class="token operator">-</span>Sage<span class="token punctuation">,</span>LOWER<span class="token punctuation">(</span>Sdept<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Student<span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>'Year of Birth: ' BIRTH</code> - 使用了<code>BIRTH</code>别名来覆盖显示结果对应的列名</p><h4 id=选择表中的若干元组行><a class=anchor href=#选择表中的若干元组行>#</a> 选择表中的若干元组(行)</h4><p><strong>取消值重复的行</strong></p><p>如果没有指定<code>DISTINCT</code>关键字，则缺省为<code>ALL</code>。</p><p>指定<code>DISTINCT</code>关键字即可去除显示结果表中的重复行。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询选修了课程的学生学号 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/* 等价于 */</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">SELECT</span> <span class="token keyword">ALL</span> Sno <span class="token keyword">FROM</span> SC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* 取消重复行 */</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> Sno <span class="token keyword">FROM</span> SC<span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=查询满足条件的元组><a class=anchor href=#查询满足条件的元组>#</a> 查询满足条件的元组</h4><p>查询满足条件的元组可以通过<code>WHERE</code>语句来实现，<code>WHERE</code>常用的查询条件有</p><table><thead><tr><th>查询条件</th><th>谓词</th></tr></thead><tbody><tr><td>比较</td><td>=, &gt;, &lt;, &gt;=, &lt;=, !=, &lt;&gt;, !&gt;, !&lt;；NOT + 左边描述的比较运算符</td></tr><tr><td>确定范围</td><td>BETWEEN .. AND .., NOT BETWEEN .. AND ..</td></tr><tr><td>确定集合</td><td>IN, NOT IN</td></tr><tr><td>字符匹配</td><td>LIKE 匹配串, NOT LIKE 匹配串</td></tr><tr><td>空值</td><td>IS NULL, IS NOT NULL</td></tr><tr><td>多重条件(逻辑运算)</td><td>AND, OR, NOT</td></tr></tbody></table><p><code>&lt;&gt;</code> - 不等于</p><p>查询时，可按照三段论的方法来写SELECT语句</p><ul><li>首先，根据题目的要求找出最后显示的内容信息，将该内容信息放在<strong>SELECT</strong>关键字的后面</li><li>然后，根据语句分析出查询时会涉及到哪些表，将表的信息放在<strong>FROM</strong>关键字的后面</li><li>最后，根据语句分析查询条件的内容，将查询条件的内容放在<strong>WHERE</strong>关键字后面</li></ul><p><strong>IN和BETWEEN</strong></p><ul><li><code>IN</code>操作符在<code>WHERE</code>子句中使用，作用是在指定的几个特定值中任选一个值</li><li><code>BETWEEN</code>操作符在<code>WHERE</code>子句中使用，作用是选取介于某个范围内的值</li></ul><p><strong>AND、OR、NOT</strong></p><ul><li><code>AND</code>、<code>OR</code>、<code>NOT</code> 是用于对过滤条件的逻辑处理指令</li><li><code>AND</code>优先级高于<code>OR</code>，为了明确处理顺序，可以使用 <code>()</code></li><li><code>AND</code>操作符表示左右条件都要满足</li><li><code>OR</code>操作符表示左右条件满足任意一个即可</li><li><code>NOT</code>操作符用于否定一个条件</li></ul><p><strong>LIKE</strong></p><ul><li><code>LIKE</code>操作符在<code>WHERE</code>子句中使用，作用是确定字符串是否匹配模式</li><li>只有字段是文本值时才使用<code>LIKE</code></li><li><code>LIKE</code>支持两个通配符匹配选项：<code>%</code> 和 <code>_</code></li><li>不要滥用通配符，通配符位于开头处匹配会非常慢</li><li><code>%</code>表示任何字符出现任意次数</li><li><code>_</code>表示任何字符出现一次</li></ul><p><strong>比较大小</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询计算机科学系全体学生的名字 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sname <span class="token keyword">FROM</span> Student </pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 查询所有年龄在20岁以下的学生姓名及年龄 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student </pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/* 查询考试成绩有不及格的学生的学号 */</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">WHERE</span> Grade <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>确定范围</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询年龄在20 ~ 23岁(包括20和23岁)之间的学生的姓名，系别和年龄 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sdepet<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">BETWEEN</span> <span class="token number">20</span> <span class="token operator">AND</span> <span class="token number">23</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sdepet<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/* 查询年龄不在20 ~ 23岁之间的学生姓名，系别和年龄 */</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sdepet<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">NOT</span> <span class="token operator">BETWEEN</span> <span class="token number">20</span> <span class="token operator">AND</span> <span class="token number">23</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sdepet<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">NOT</span> <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>确定集合</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询信息系(IS)，数学系(MA)和计算机科学系(CS)学生的姓名和性别 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Ssex <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'IS'</span><span class="token punctuation">,</span><span class="token string">'MA'</span><span class="token punctuation">,</span><span class="token string">'CS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 查询不是信息系(IS)，数学系(MA)和计算机科学系(CS)学生的姓名和性别 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Ssex <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">NOT</span> <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'IS'</span><span class="token punctuation">,</span><span class="token string">'MA'</span><span class="token punctuation">,</span><span class="token string">'CS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>字符匹配</strong></p><p>匹配串包含通配符的字符串。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询学号为200215121的学生的详细情况 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">LIKE</span> <span class="token string">'200215121'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 等价于 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> <span class="token string">'200215121'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/* 查询所有姓刘学生的姓名，学号和性别 */</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sno<span class="token punctuation">,</span>Ssex <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">WHERE</span> Sname <span class="token operator">LIKE</span> <span class="token string">'刘%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">/* 查询姓欧阳且全名为三个汉字的学生的姓名 */</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">SELECT</span> Sname <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">WHERE</span> Sname <span class="token operator">LIKE</span> <span class="token string">'欧阳_'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment">/* 查询名字中第二个字为阳字的学生的姓名和学号 */</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sno <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">WHERE</span> Sname <span class="token operator">LIKE</span> <span class="token string">'_阳%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token comment">/* 查询所有不姓刘的学生姓名，学号和性别 */</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sno<span class="token punctuation">,</span>Ssex <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">WHERE</span> Sname <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token string">'阳%'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>使用换码字符(转义字符)将通配符转义为普通字符。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询DB_Design课程的课程号和学分 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Cno<span class="token punctuation">,</span>Ccredit <span class="token keyword">FROM</span> Course</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Cname <span class="token operator">LIKE</span> <span class="token string">'DB\_Design'</span> <span class="token keyword">ESCAPE</span> <span class="token string">'\';</span></pre></td></tr><tr><td data-num=4></td><td><pre>/* ESCAPE '\'表示<span class="token identifier"><span class="token punctuation">`</span>\`为换码字符 */</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>/* 查询以<span class="token punctuation">`</span>DB_<span class="token punctuation">`</span>开头，且倒数第三个字符为i的课程的详细信息 <span class="token operator">*</span><span class="token operator">/</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Course</pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">WHERE</span> Cname <span class="token operator">LIKE</span> <span class="token string">'DB\_%i__'</span> <span class="token keyword">ESCAPE</span> '\'<span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>涉及空值的查询</strong></p><p>涉及空值时，<code>IS</code>不能用<code>=</code>代替。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">某些学生选修课程后没有参加考试，所以有选课记录但没有考试成绩。</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">查询缺少成绩学生的学号和相应的课程号。</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Cno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> Grade <span class="token operator">is</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">/* 查询所有有成绩的学生学号和课程号 */</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Cno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">WHERE</span> Grade <span class="token operator">is</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=多重条件查询><a class=anchor href=#多重条件查询>#</a> 多重条件查询</h4><p>用逻辑运算符AND和OR来联结多个查询条件，AND的优先级高于OR，可以用括号改变优先级。</p><p>可用来实现多种其他谓词。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询计算机系年龄在20岁以下的学生姓名 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sname <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span> <span class="token operator">AND</span> Sage <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 查询信息系(IS)，数据系(MA)和计算机科学系(CS)学生的姓名和性别 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Ssex <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'IS'</span><span class="token punctuation">,</span><span class="token string">'MA'</span><span class="token punctuation">,</span><span class="token string">'CS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/* 改写为 */</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Ssex <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'IS'</span> <span class="token operator">OR</span> Sdept <span class="token operator">=</span> <span class="token string">'MA'</span> <span class="token operator">OR</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=order-by子句><a class=anchor href=#order-by子句>#</a> ORDER BY子句</h4><p><strong>ORDER BY</strong>子句可以按一个或多个属性列排序。</p><p>升序用<strong>ASC</strong>，降序用<strong>DESC</strong>，缺省值为升序。</p><p>当排序列含空值时</p><ul><li>空值默认为最大值</li><li><strong>ASC</strong> - 排序列为空值的元组最后显示</li><li><strong>DESC</strong> - 排序列为空值的元组最先显示</li></ul><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询选修了3号课程的学生的学号及其成绩，查询结果按分数降序排序 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Grade <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Cno <span class="token operator">=</span> <span class="token string">'3'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Grade <span class="token keyword">DESC</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 查询全体学生情况，查询结果按所在系的系号升序排序，同一系中的学生按年龄降序排序 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Sdept<span class="token punctuation">,</span>Sage <span class="token keyword">DESC</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=聚集函数><a class=anchor href=#聚集函数>#</a> 聚集函数</h4><p><strong>COUNT([DISTINCT | <ins>ALL</ins>] *)</strong> - 统计元组个数</p><p><strong>COUNT([DISTINCT | <ins>ALL</ins>] 列名)</strong> - 统计一列中值的个数</p><p><strong>SUM([DISTINCT | <ins>ALL</ins>] 列名)</strong> - 计算一列值的总和(该列数据类型必须是数值类型)</p><p><strong>AVG([DISTINCT | <ins>ALL</ins>] 列名)</strong> - 计算一列值的平均值(该列数据类型必须是数值类型)</p><p><strong>MAX([DISTINCT | <ins>ALL</ins>] 列名)</strong> - 求一列值得最大值</p><p><strong>MIN([DISTINCT | <ins>ALL</ins>] 列名)</strong> - 求一列值得最小值</p><p><code>DISTINCT</code> - 去除重复值。</p><p><code>ALL</code>为缺省值。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询学生总人数 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> Student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* 查询选修了课程得学生人数 */</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> Sno<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">/* 查询学生200215012选修课程得总学分数 */</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>Ccredit<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC<span class="token punctuation">,</span>Course</pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">WHERE</span> <span class="token string">'200215012'</span> <span class="token operator">AND</span> SC<span class="token punctuation">.</span>Cno <span class="token operator">=</span> Course<span class="token punctuation">.</span>Cno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">/* 计算1号课程得学生平均成绩 */</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>Grade<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">WHERE</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">/* 查询选修1号课程得学生最高学分 */</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>Grade<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">WHERE</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=group-by子句><a class=anchor href=#group-by子句>#</a> GROUP BY子句</h4><p>用于按指定得一列或多列值分组，值相等得为一组，来细化聚集函数得作用对象。</p><p>未对查询结果分组，聚集函数将作用于整个查询结果。</p><p>对查询结果分组后，聚集函数将分别作用于每个组。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 求每个课程号及相应得选课人数 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Cno<span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Cno<span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>GROUP BY</strong>子句分组后，可以使用<strong>HAVING</strong>短语指定筛选条件，不能用<strong>WHERE</strong>关键字。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询选修了3门以上课程得学生学号 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Sno <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>HAVING</strong>短语</p><ul><li>用于对汇总的<code>GROUP BY</code>结果进行过滤</li><li>一般都是和<code>GROUP BY</code> 连用</li><li><code>WHERE</code>和<code>HAVING</code>可以在相同的查询中</li></ul><p><strong>HAVING短语与WHERE子句的区别</strong></p><p>作用对象不同，WHERE子句作用于基本表或视图，从中选择满足条件的元组，即作用于查询结果；HAVING短语作用于组，从中选择满足条件，需与<strong>GROUP BY</strong>配合使用，即作用于查询过程中。</p><p>WHERE子句中不能使用聚集函数作为条件表达式。</p><ul><li><p><code>WHERE</code> - 过滤过滤指定的行，后面不能加聚合函数(分组函数)。<code>WHERE</code>在<code>GROUP BY</code>前。</p></li><li><p><code>HAVING</code> - 过滤分组，一般都是和<code>GROUP BY</code>连用，不能单独使用。<code>HAVING</code>在<code>GROUP BY</code>之后。</p></li></ul><h3 id=连接查询><a class=anchor href=#连接查询>#</a> 连接查询</h3><h4 id=等值与非等值连接查询><a class=anchor href=#等值与非等值连接查询>#</a> 等值与非等值连接查询</h4><p>连接查询的WHERE子句中用来连接两个表的条件称为连接条件或连接谓词，其一般格式为</p><p><strong>格式一</strong> - <code>表名1.列名 比较运算符 表名2.列名</code></p><p><strong>格式二</strong> - <code>表名1.列名 BETWEEN 表名2.列名 AND 表名3.列名</code></p><p>当连接运算符为<code>=</code>号时被称为<strong>等值连接</strong>，为其他运算符时被称为<strong>非等值连接</strong>。</p><p>连接谓词中的列名称为连接字段，并且各连接字段类型必须是可比的，但名字不必是相同的。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询每个学生及其选修课程的情况 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>SC<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> Student<span class="token punctuation">,</span>SC</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno<span class="token punctuation">;</span></pre></td></tr></table></figure><p>连接操作的一种执行方法 - <strong>嵌套循环法(NESTED-LOOP)</strong></p><p>首先，在表1中找到第一个元组，然后从头开始扫描表2，逐一查找满足连接条件的元组，找到后就将表1中的第一个元组与该元组拼接起来，形成结果表中一个元组。</p><p>表2全部查找完成后，再找表1中第二个元组，然后再从头开始扫描表2，逐一查找满足连接条件的元组，找到后就将表1中的第二个元组与该元组拼接起来，形成结果表中一个元组。</p><p>重复以上操作，直到表1中的全部元组都处理完毕。</p><p><strong>自然连接</strong></p><p>倘若在等值连接中把目标列中重复的属性列去掉则为自然连接。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询每个学生及其选修课程的情况 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Ssex<span class="token punctuation">,</span>Sage<span class="token punctuation">,</span>Sdept<span class="token punctuation">,</span>Sage<span class="token punctuation">,</span>Grade </pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">FROM</span> Student<span class="token punctuation">,</span>SC</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">WHERE</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* 规范化 */</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>Student<span class="token punctuation">.</span>Sname<span class="token punctuation">,</span>Student<span class="token punctuation">.</span>Ssex<span class="token punctuation">,</span>Student<span class="token punctuation">.</span>Sage<span class="token punctuation">,</span>Student<span class="token punctuation">.</span>Sdept<span class="token punctuation">,</span>SC<span class="token punctuation">.</span>Sage<span class="token punctuation">,</span>SC<span class="token punctuation">.</span>Grade </pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">FROM</span> Student<span class="token punctuation">,</span>SC</pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">WHERE</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno<span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=自身连接><a class=anchor href=#自身连接>#</a> 自身连接</h4><p>一个表与其自己进行连接。</p><p>为了区别表，需要给表起别名。由于所有属性名都是同名属性，因此必须使用别名前缀。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">查询每一门课的间接先修课，即先修课的先修课。</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">为Course表取两个别名，一个是FIRST，另一个是SECOND。</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> <span class="token keyword">FIRST</span><span class="token punctuation">.</span>Cno<span class="token punctuation">,</span><span class="token keyword">SECOND</span><span class="token punctuation">.</span>Cpno</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">FROM</span> Course <span class="token keyword">FIRST</span><span class="token punctuation">,</span>Course <span class="token keyword">SECOND</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHERE</span> <span class="token keyword">FIRST</span><span class="token punctuation">.</span>Cpno <span class="token operator">=</span> <span class="token keyword">SECOND</span><span class="token punctuation">.</span>Cno<span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=外连接><a class=anchor href=#外连接>#</a> 外连接</h4><p>普通连接与外连接的区别</p><ul><li><p>普通连接操作只输出满足连接条件的元组。</p></li><li><p>外连接操作以指定表为连接主体，将主体表中不满足连接条件的元组一并输出。</p></li></ul><p>外连接分为</p><p>左外连接-<code>LEFT OUT JOIN SC ON</code> - 列出左边关系中所有的元组。</p><p>右外连接-<code>RIGHT OUT JOIN SC ON</code> - 列出右边关系中所有的元组。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询每个学生及其选修课程的情况 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Ssex<span class="token punctuation">,</span>Sage<span class="token punctuation">,</span>Sdept<span class="token punctuation">,</span>Sage<span class="token punctuation">,</span>Grade </pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">FROM</span> Student<span class="token punctuation">,</span>SC</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">WHERE</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* 用外连接查询可改为 */</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Ssex<span class="token punctuation">,</span>Sage<span class="token punctuation">,</span>Sdept<span class="token punctuation">,</span>Sage<span class="token punctuation">,</span>Grade </pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">FROM</span> Student<span class="token punctuation">,</span>SC <span class="token keyword">LEFT</span> <span class="token keyword">OUT</span> <span class="token keyword">JOIN</span> SC <span class="token keyword">ON</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>JOIN是连接的意思，顾名思义，<code>SQL JOIN</code>子句用于将两个或者多个表联合起来进行查询。</p><p>连接表时需要在每个表中选择一个字段，并对这些字段的值进行比较，值相同的两条记录将合并为一条。连接表的本质就是将不同表的记录合并起来，形成一张新表。当然，这张新表只是临时的，它仅存在于本次查询期间。</p><p><strong>ON和WHERE的区别</strong></p><ul><li>连接表时，SQL 会根据连接条件生成一张新的临时表。ON 就是连接条件，它决定临时表的生成。</li><li><code>WHERE</code>是在临时表生成以后，再对临时表中的数据进行过滤，生成最终的结果集，这个时候已经没有JOIN-ON了</li></ul><h4 id=多表连接><a class=anchor href=#多表连接>#</a> 多表连接</h4><p>连接操作是两个以上的表进行连接。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询每个学生的学号，姓名，选修的课程名及成绩 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Cname<span class="token punctuation">,</span>Grade</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">FROM</span> Student<span class="token punctuation">,</span>SC<span class="token punctuation">,</span>Course</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">WHERE</span> Student<span class="token punctuation">.</span>Sn0 <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno <span class="token operator">AND</span> SC<span class="token punctuation">.</span>Cno <span class="token operator">=</span> Course<span class="token punctuation">.</span>Cno<span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=嵌套查询><a class=anchor href=#嵌套查询>#</a> 嵌套查询</h3><p>一个<code>SELECT-FROM-WHERE</code>语句称为一个查询块。</p><p>嵌套查询定义 - 指将一个查询块嵌套在另一个查询块的<strong>WHERE</strong>子句或<strong>HAVING</strong>短语的条件中的查询。</p><p>子查询中不能使用<strong>ORDER BY</strong>子句。</p><p>层层嵌套方式反映了SQL语言的结构化。</p><p>有些嵌套查询可以用连接运算符代替。</p><p>外层查询(父查询)，内层查询(子查询)。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">SELECT</span> Sname <span class="token keyword">FROM</span> Student <span class="token comment">/* 外层查询/父查询 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">IN</span><span class="token punctuation">(</span>			</pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC		<span class="token comment">/* 内存查询/子查询 */</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">WHERE</span> Cno <span class="token operator">=</span> <span class="token string">'xx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>MySQL数据库从4.1版本才开始支持子查询，早期版本是不支持的。</p><p>子查询是嵌套在较大查询中的SQL查询，也称内部查询或内部选择，包含子查询的语句也称为外部查询或外部选择。简单来说，子查询就是指将一个<code>SELECT</code> 查询(子查询)的结果作为另一个 SQL 语句(主查询)的数据来源或者判断条件。</p><p>子查询可以嵌入 <code>SELECT</code>、<code>INSERT</code>、<code>UPDATE</code>和<code>DELETE</code>语句中，也可以和<code>=</code>、<code>&lt;</code>、<code>&gt;</code>、<code>IN</code>、<code>BETWEEN</code>、<code>EXISTS</code>等运算符一起使用。</p><p>子查询需要放在括号<code>( )</code>内。</p><h4 id=带有in谓词的子查询><a class=anchor href=#带有in谓词的子查询>#</a> 带有IN谓词的子查询</h4><p>在嵌套查询中，子查询的结果往往是个集合，用IN谓词表示父查询的条件在子查询结果的集合中。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 确定与刘从在同一个系学习的学生 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 方法一，分步查找 */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">SELECT</span> Sdept <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">WHERE</span> Sname <span class="token operator">=</span> <span class="token string">'刘从'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 结果为 CS */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sdept <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/* 方法二，嵌套查询 */</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sdept <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">IN</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token keyword">SELECT</span> Sdept <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token keyword">WHERE</span> Sname <span class="token operator">=</span> <span class="token string">'刘从'</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment">/* 方法三，使用自身连接实现 */</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">SELECT</span> S1<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>S1<span class="token punctuation">.</span>Sname<span class="token punctuation">,</span>S1<span class="token punctuation">.</span>Sdept <span class="token keyword">FROM</span> Student S1<span class="token punctuation">,</span>Student S2</pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">WHERE</span> S1<span class="token punctuation">.</span>Sdept <span class="token operator">=</span> S2<span class="token punctuation">.</span>Sdept <span class="token operator">AND</span> S2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'刘从'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询选修了课程名为信息系统的学生学号和姓名 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 方法一，嵌套查询 */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">IN</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">WHERE</span> Cno <span class="token operator">IN</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token keyword">SELECT</span> Cno <span class="token keyword">FROM</span> Course</pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token keyword">WHERE</span> Cname <span class="token operator">=</span> <span class="token string">'信息系统'</span></pre></td></tr><tr><td data-num=9></td><td><pre>        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">/* 方法三，使用连接查询实现 */</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname <span class="token keyword">FROM</span> Student<span class="token punctuation">,</span>SC<span class="token punctuation">,</span>Course</pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">WHERE</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno </pre></td></tr><tr><td data-num=15></td><td><pre><span class="token operator">AND</span> SC<span class="token punctuation">.</span>Cno <span class="token operator">=</span> Course<span class="token punctuation">.</span>Cno</pre></td></tr><tr><td data-num=16></td><td><pre><span class="token operator">AND</span> Course<span class="token punctuation">.</span>Cname <span class="token operator">=</span> <span class="token string">'信息系统'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>不相关子查询 - 子查询的查询条件不依赖于父查询</p><p>相关子查询 - 子查询的查询条件依赖于父查询，整个查询语句称为嵌套查询</p><h4 id=带有比较运算符的子查询><a class=anchor href=#带有比较运算符的子查询>#</a> 带有比较运算符的子查询</h4><p>当能确切知道内层查询返回单值时，可用比较运算符。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 确定与刘从在同一个系学习的学生 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sdept <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">IN</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">SELECT</span> Sdept <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">WHERE</span> Sname <span class="token operator">=</span> <span class="token string">'刘从'</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">/* 相当于 */</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sdept <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">SELECT</span> Sdept <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token keyword">WHERE</span> Sname <span class="token operator">=</span> <span class="token string">'刘从'</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 找出每个学生超过他选修课程平均成绩的课程号 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Cno <span class="token keyword">FROM</span> SC x</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Grade <span class="token operator">>=</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>Grade<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC y</pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">WHERE</span> x<span class="token punctuation">.</span>Sno <span class="token operator">=</span> y<span class="token punctuation">.</span>Sno</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>可能的执行过程</strong></p><p>从外层查询中取SC的一个元组x，将元组x的值Sno值(200215121)传送给内层查询。</p><p><code>SELECT AVG(Grade) FROM SC y</code> -</p><p>执行内层查询，得到88(近似值)，代替内层查询，得到外层查询 -</p><p><code>SELECT Sno,Cno FROM SC x WHERE Grade &gt;= 88;</code> -</p><p>执行这个查询得到相应结果。</p><p>外层查询取出下一个元组重复做上述的步骤，直到外层的SC元组全部处理完成。</p><h4 id=带有anysome或all谓词的子查询><a class=anchor href=#带有anysome或all谓词的子查询>#</a> 带有ANY(SOME)或ALL谓词的子查询</h4><p><strong>谓词</strong></p><p><strong>ANY</strong> - 任意一个值</p><p><strong>ALL</strong> - 所有值</p><p><strong>需要配合使用比较运算符</strong></p><table><thead><tr><th>结合形式</th><th>含义</th></tr></thead><tbody><tr><td>&gt; ANY</td><td>大于子查询结果中的某个值</td></tr><tr><td>&gt; ALL</td><td>大于子查询结果中的所有值</td></tr><tr><td>&lt; ANY</td><td>小于子查询结果中的某个值</td></tr><tr><td>&lt; ALL</td><td>小于子查询结果中的所有值</td></tr><tr><td>&gt;= ANY</td><td>大于或等于子查询结果中的某个值</td></tr><tr><td>&gt;= ALL</td><td>大于或等于子查询结果中的所有值</td></tr><tr><td>&lt;= ANY</td><td>小于或等于子查询结果中的某个值</td></tr><tr><td>&lt;= ALL</td><td>小于或等于子查询结果中的所有值</td></tr><tr><td>= ANY</td><td>等于子查询结果中的某个值</td></tr><tr><td>= ALL</td><td>等于子查询结果中的所有值(通常没有实际意义)</td></tr><tr><td>!=(或&lt;&gt;) ANY</td><td>不等于子查询结果中的某个值</td></tr><tr><td>!=(或&lt;&gt;) ALL</td><td>不等于子查询结果中的所有值</td></tr></tbody></table><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询非计算机科学系中比计算机科学系任意一个学生年龄小的学生姓名和年龄 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">&lt;</span> <span class="token keyword">ANY</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">SELECT</span> Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">)</span> <span class="token operator">AND</span> Sdept <span class="token operator">&lt;></span> <span class="token string">'CS'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>执行过程</strong></p><p>RDBMS执行此查询时，首先处理子查询，找出CS系中所有学生的年龄，构成一个集合。</p><p>接着处理父查询，找不是CS系且年龄小于20或19的学生。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">使用聚集函数实现，</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">查询非计算机科学系中比计算机科学系任意一个学生年龄小的学生姓名和年龄。</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">&lt;</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>Sage<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">)</span> <span class="token operator">AND</span> Sdept <span class="token operator">&lt;></span> <span class="token string">'CS'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">/* 查询非计算机科学系中比计算机科学系所有学生年龄都小的学生姓名及年龄 */</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">/* 方法一，使用ALL谓词 */</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">&lt;</span> <span class="token keyword">ALL</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token keyword">SELECT</span> Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">)</span> <span class="token operator">AND</span> Sdept <span class="token operator">&lt;></span> <span class="token string">'CS'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment">/* 方式二，使用聚集函数实现 */</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">&lt;</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>Sage<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">)</span> <span class="token operator">AND</span> Sdept <span class="token operator">&lt;></span> <span class="token string">'CS'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>用聚集函数实现子查询要比直接用ANY，ALL谓词的效率更高。ANY，ALL谓词与聚集函数，IN谓词的等价转换关系如下</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center>=</th><th style=text-align:center>&lt;&gt;或!=</th><th style=text-align:center>&lt;</th><th style=text-align:center>&lt;=</th><th style=text-align:center>&gt;</th><th style=text-align:center>&gt;=</th></tr></thead><tbody><tr><td style=text-align:center>ANY</td><td style=text-align:center>IN</td><td style=text-align:center></td><td style=text-align:center>&lt; MAX</td><td style=text-align:center>&lt;= MAX</td><td style=text-align:center>&gt; MIN</td><td style=text-align:center>&gt;= MIN</td></tr><tr><td style=text-align:center>ALL</td><td style=text-align:center></td><td style=text-align:center>NOT IN</td><td style=text-align:center>&lt; MIN</td><td style=text-align:center>&lt;= MIN</td><td style=text-align:center>&gt; MAX</td><td style=text-align:center>&gt;= MAX</td></tr></tbody></table><h4 id=带有exists谓词的子查询><a class=anchor href=#带有exists谓词的子查询>#</a> 带有EXISTS谓词的子查询</h4><p><strong>EXISTS</strong>谓词代表存在量词<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=normal>∃</mi></mrow><annotation encoding=application/x-tex>\exists</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.69444em;vertical-align:0></span><span class=mord>∃</span></span></span></span>，带有<strong>EXISTS</strong>谓词的子查询只返回逻辑真值<code>true</code>或逻辑假值<code>false</code>。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询所有选修了1号课程的学生姓名 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 方法一，用连接查询 */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">SELECT</span> Sname <span class="token keyword">FROM</span> Student<span class="token punctuation">.</span>SC</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">WHERE</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno <span class="token operator">AND</span> SC<span class="token punctuation">.</span>Cno <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* 方法二，用嵌套查询 */</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">SELECT</span> Sname <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">WHERE</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token keyword">SELECT</span><span class="token operator">*</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">AND</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>使用存在量词EXISTS后，若内层查询结果非空，则外层的WHERE子句返回真值；否则返回假值。</p><p>由EXISTS引出的子查询目标列表都用<code>*</code>，因为带EXISTS的子查询只返回真值或假值，给出列名无实际意义。</p><p><strong>NOT EXISTS谓词</strong></p><p>若内层查询结果非空，则外层的WHERE子句返回假值。</p><p>若内层查询结果为空，则外层的WHERE子句返回真值。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询没有选修了1号课程的学生姓名 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sname <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">SELECT</span><span class="token operator">*</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">AND</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>不同形式的查询间的替换</strong></p><p>一些带EXISTS或NOT EXISTS谓词的子查询不能被其他形式的子查询等价替换。</p><p>所有带IN谓词，比较运算符，ANY和ALL谓词的子查询都能用带EXISTS谓词的子查询等价替换。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询与刘晨在同一个系学习的学生。用带EXISTS谓词的子查询替换 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sdept <span class="token keyword">FROM</span> Student S1</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student S2</pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">WHERE</span> S2<span class="token punctuation">.</span>Sdept <span class="token operator">=</span> S1<span class="token punctuation">.</span>Sdept <span class="token operator">AND</span> S2<span class="token punctuation">.</span>Sname <span class="token operator">=</span> <span class="token string">'刘晨'</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>用EXISTS/NOT EXISTS实现全称量词</strong></p><p>SQL语言中没有全称量词<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=normal>∀</mi></mrow><annotation encoding=application/x-tex>\forall</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.69444em;vertical-align:0></span><span class=mord>∀</span></span></span></span>(For all)。可以把带有全称量词的谓词转化为等价的带有存在量词的谓词</p><p>|<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mo stretchy=false>(</mo><msub><mi mathvariant=normal>∀</mi><mi>x</mi></msub><mo stretchy=false>)</mo><mi>P</mi><mo>=</mo><mi mathvariant=normal>¬</mi><mo stretchy=false>(</mo><msub><mi mathvariant=normal>∃</mi><mi>x</mi></msub><mo stretchy=false>(</mo><mi mathvariant=normal>¬</mi><mi>P</mi><mo stretchy=false>)</mo><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>(\forall_x)P = \neg(\exists_x(\neg P))</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=mord><span class=mord>∀</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class="mord mathnormal" style=margin-right:.13889em>P</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>¬</span><span class=mopen>(</span><span class=mord><span class=mord>∃</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class=mord>¬</span><span class="mord mathnormal" style=margin-right:.13889em>P</span><span class=mclose>)</span><span class=mclose>)</span></span></span></span> |</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">查询选修了全部课程的学生姓名。 </span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">等价于没有一门课是他不选修的。</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> Sname <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Course</pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=9></td><td><pre>        <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=10></td><td><pre>        <span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">AND</span> Cno <span class="token operator">=</span> Course<span class="token punctuation">.</span>Cno</pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>用EXISTS/NOT EXISTS实现逻辑蕴涵</strong></p><p>SQL语言中没有蕴涵(Implication)逻辑运算，可以利用谓词演示将逻辑蕴涵谓词等价转换为</p><p>|<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>p</mi><mo>→</mo><mi>q</mi><mo>≡</mo><mi mathvariant=normal>¬</mi><mi>p</mi><mo>∨</mo><mi>q</mi></mrow><annotation encoding=application/x-tex>p \rightarrow q \equiv \neg p \vee q</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.19444em></span><span class="mord mathnormal">p</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>→</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.65819em;vertical-align:-.19444em></span><span class="mord mathnormal" style=margin-right:.03588em>q</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>≡</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.75em;vertical-align:-.19444em></span><span class=mord>¬</span><span class="mord mathnormal">p</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>∨</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.625em;vertical-align:-.19444em></span><span class="mord mathnormal" style=margin-right:.03588em>q</span></span></span></span> |(p可以推出q，但q不能推出p)</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">查询至少选修了学生201215122选修的全部课程的学生学号。 </span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">等价于，不存在这样的课程y，学生2012215122选修了y，而学生x没有选。</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> Sno <span class="token keyword">FROM</span> SC SCX</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SC SCY</pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">WHERE</span> SCY<span class="token punctuation">.</span>Sno <span class="token operator">=</span> <span class="token string">'2012215122'</span> </pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token operator">AND</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=10></td><td><pre>        <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SC SCZ</pre></td></tr><tr><td data-num=11></td><td><pre>        <span class="token keyword">WHERE</span> ESCZ<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SCX<span class="token punctuation">.</span>Sno</pre></td></tr><tr><td data-num=12></td><td><pre>        <span class="token operator">AND</span> SCZ<span class="token punctuation">.</span>Cno <span class="token operator">=</span> SCX<span class="token punctuation">.</span>Cno</pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=集合查询><a class=anchor href=#集合查询>#</a> 集合查询</h3><p>集合操作的种类有并操作，交操作，差操作。</p><h4 id=并操作union相当于or><a class=anchor href=#并操作union相当于or>#</a> !并操作UNION(相当于OR)</h4><p><code>UNION</code>运算符将两个或更多查询的结果组合起来，并生成一个结果集，其中包含来自<code>UNION</code>中参与查询的提取行。</p><p><code>UNION</code>基本规则</p><ul><li>所有查询的列数和列顺序必须相同</li><li>每个查询中涉及表的列的数据类型必须相同或兼容</li><li>通常返回的列名取自第一个查询</li></ul><p>默认地，UNION操作符选取不同的值。如果允许重复的值，需使用<code>UNION ALL</code>。</p><p><code>UNION</code>结果集中的列名总是等于<code>UNION</code>中第一个<code>SELECT</code>语句中的列名。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询计算机科学系的学生及年龄不大于19岁的学生 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 方法一 */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">UNION</span> </pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">&lt;=</span> <span class="token number">19</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/* 方法二 */</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span> <span class="token operator">OR</span> Sage <span class="token operator">&lt;=</span> <span class="token number">19</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>UNION</strong> - 将多个查询结果合并起来，系统自动去除重复元组。</p><p><strong>UNION ALL</strong> - 将多个查询结果合并起来，保留重复元组。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询选修了课程1或选修了课程2的学生 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">UNION</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> Cno <span class="token operator">=</span> <span class="token string">'2'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>JOIN与UNION的区别</strong></p><p><strong>UNION</strong></p><ul><li>作用 - <code>UNION</code>操作用于合并两个或多个SELECT语句的结果集，并消除重复行</li><li>特点<ul><li>参与<code>UNION</code>操作的每个SELECT语句都必须拥有相同数量的列，且对应列的数据类型也需相似，以便可以进行合并</li><li>结果中的每一列的数据类型是由所有查询中对应列的数据类型兼容得出的数据类型(通常取其共同超类)</li><li>默认情况下，<code>UNION</code>对合并结果进行去重处理(相当于执行了<code>DISTINCT</code>)，只返回不重复的记录</li><li>如果想要包含所有的重复记录，可以使用<code>UNION ALL</code>，这样可以提高查询效率，因为不需要进行去重操作</li></ul></li></ul><p><strong>JOIN</strong></p><ul><li>作用 - <code>JOIN</code>操作用于根据两个表中的共同字段，将这些表中的行组合起来形成一个新的结果集</li><li>特点<ul><li><code>JOIN</code>操作可以是内连接(<code>INNER JOIN</code>)、左连接(<code>LEFT JOIN</code>)、右连接(<code>RIGHT JOIN</code>)、全连接(<code>FULL JOIN</code>)等，根据不同的需求组合表中的数据</li><li>在进行<code>JOIN</code>时，通常需要在<code>ON</code>子句中指定连接条件，即定义如何匹配来自连接表的行</li><li><code>JOIN</code>操作不仅可以合并行，还能从两个表中选择所需的列，创建一个由这些列组成的新结果集</li></ul></li></ul><p><strong>区别</strong></p><ul><li><code>JOIN</code>中连接表的列可能不同，但在<code>UNION</code>中，所有查询的列数和列顺序必须相同</li><li><code>UNION</code>将查询之后的行放在一起(垂直放置)，但<code>JOIN</code>将查询之后的列放在一起(水平放置)，即它构成一个笛卡尔积</li></ul><p>总结而言，<code>UNION</code>主要用于垂直地合并相似结构表的数据，而<code>JOIN</code>主要用于水平地合并不同表中相关联的行。二者都是数据库查询时非常有用的工具，但适用于不同的情境和需求。</p><h4 id=交操作intersect相当于and><a class=anchor href=#交操作intersect相当于and>#</a> 交操作INTERSECT(相当于AND)</h4><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询计算机科学系的学生与年龄不大于19岁的学生的交集 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">INTERSECT</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">&lt;=</span> <span class="token number">19</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">/* 相当于 */</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span> <span class="token operator">AND</span> Sage <span class="token operator">&lt;=</span> <span class="token number">19</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=差操作except><a class=anchor href=#差操作except>#</a> 差操作EXCEPT</h4><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询计算机科学系的学生与年龄不大于19岁的学生的差集 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">EXCEPT</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">&lt;=</span> <span class="token number">19</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">/* 相当于 */</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span> <span class="token operator">AND</span> Sage <span class="token operator">></span> <span class="token number">19</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=基于派生表的查询><a class=anchor href=#基于派生表的查询>#</a> 基于派生表的查询</h3><p>子查询不仅可以出现在WHERE子句中，还可以出现在FROM子句中，这时子查询生成的临时派生表(derived table)成为主查询的查询对象。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 找出每个学生超过他自己选修课程平均成绩的课程号 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Cno <span class="token keyword">FROM</span> SC<span class="token punctuation">,</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>Grade<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC </pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Sno<span class="token punctuation">)</span> <span class="token keyword">AS</span> Avg_sc<span class="token punctuation">(</span>avg_sno<span class="token punctuation">,</span>avg_grade<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">WHERE</span> SC<span class="token punctuation">.</span>Sno <span class="token operator">=</span> Avg_sc<span class="token punctuation">.</span>avg_sno <span class="token operator">AND</span> SC<span class="token punctuation">.</span>Grade <span class="token operator">>=</span> Avg_sc<span class="token punctuation">.</span>avg_grade<span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>AS</code> - 用于给临时表起别名</p><p>如果子查询中没有聚集函数，派生表可以不指定属性列，子查询SELECT子句后面的列名为其默认属性。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 查询所有选修了1号课程的学生姓名 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sname <span class="token keyword">FROM</span> Student<span class="token punctuation">,</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">WHERE</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> SC1</pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">WHERE</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC1<span class="token punctuation">.</span>Sno<span class="token punctuation">;</span></pre></td></tr></table></figure><p>通过FROM子句生成派生表，AS关键字可以忽略，但必须为派生关系指定一个别名。而对于基本表，别名是可选项。</p><h2 id=数据更新><a class=anchor href=#数据更新>#</a> !数据更新</h2><h3 id=插入数据><a class=anchor href=#插入数据>#</a> 插入数据</h3><p><code>INSERT INTO</code>语句用于向表中插入新记录。</p><h4 id=插入元组><a class=anchor href=#插入元组>#</a> 插入元组</h4><p>将心元组插入指定表中。</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>INSERT INTO 表名 <span class="token punctuation">[</span>(属性列,属性列...)<span class="token punctuation">]</span></pre></td></tr><tr><td data-num=2></td><td><pre>VALUES(常量1....);</pre></td></tr></table></figure><p>INTO子句 - 属性列的顺序可与表中的顺序不一致，没有指定属性列的默认插入全部</p><p>VALUES子句 - 提供的值必须与INTO子句匹配，值与属性列的个数和值的类型要一致</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">将一个新学生元组(学号：200215128；姓名：陈冬；性别：男；所在系：IS；年龄18)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">插入到Student表中</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Ssex<span class="token punctuation">,</span>Sdept<span class="token punctuation">,</span>Sage<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'200215128'</span><span class="token punctuation">,</span><span class="token string">'陈冬'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'IS'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">/* 将学生张成明的信息插入到Student表中 */</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Student</pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'200215126'</span><span class="token punctuation">,</span><span class="token string">'张成明'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">'CS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">/* 依照表列依次序赋值 */</span></pre></td></tr></table></figure><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 插入一条选课记录('200215128','1') */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SC<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'200215128'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* RDBMS将在新插入记录的Grade列上自动地赋空值,即 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SC</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'200215128'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=插入子查询结果><a class=anchor href=#插入子查询结果>#</a> 插入子查询结果</h4><p>将子查询结果插入指定表中。</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>INSERT INTO 表名<span class="token punctuation">[</span>(属性列...)<span class="token punctuation">]</span>;</pre></td></tr><tr><td data-num=2></td><td><pre>子查询；</pre></td></tr></table></figure><p>SELECT子句目标列必须与INTO子句匹配，值得个数，类型都要一致。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 对每一个系，求学生得平均年龄，并把结果存入数据库 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 建表 */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Dept_age<span class="token punctuation">(</span>Sdept <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                      Avg_age <span class="token keyword">SMALLINT</span></pre></td></tr><tr><td data-num=5></td><td><pre>                      <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* 插入数据 */</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Dept_age<span class="token punctuation">(</span>Sdept<span class="token punctuation">,</span>Avg_age<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">SELECT</span> Sdept<span class="token punctuation">.</span><span class="token function">AVG</span><span class="token punctuation">(</span>Gage<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Sdept<span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=修改数据><a class=anchor href=#修改数据>#</a> 修改数据</h3><p><code>UPDATE</code>语句用于更新表中的记录。</p><p>修改指定表中满足WHERE子句条件得元组。</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>UPDATE 表名</pre></td></tr><tr><td data-num=2></td><td><pre>SET 列名 = 表达式<span class="token punctuation">[</span>列名 = 表达式<span class="token punctuation">]</span><span class="token punctuation">[</span>WHERE<span class="token punctuation">]</span>;</pre></td></tr></table></figure><p><strong>SET</strong>子句 - 指定修改方式，修改得列，修改后取值</p><p><strong>WHERE</strong>子句 - 指定要修改得元组，缺省表示修改所有元组</p><p>在执行修改语句时会检查修改操作是否破坏表上已定义得完整性规则。</p><ul><li><p><strong>修改一个元组的值</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 将学生200215121的年龄改为22岁 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">UPDATE</span> Student <span class="token keyword">SET</span> Sage <span class="token operator">=</span> <span class="token number">22</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> <span class="token string">'200215121'</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p><strong>修改多个元组的值</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 将所有学生的年龄增加1 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">UPDATE</span> Student <span class="token keyword">SET</span> Sage <span class="token operator">=</span> Sage <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p><strong>带子查询的修改语句</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 将计算机科学系全体学生的成绩置零 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">UPDATE</span> SC <span class="token keyword">SET</span> Grade <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">IN</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li></ul><h3 id=删除数据><a class=anchor href=#删除数据>#</a> 删除数据</h3><p><code>DELETE</code>语句用于删除表中的记录。</p><p><code>TRUNCATE TABLE</code>可以清空表，也就是删除所有行。</p><p>删除指定表中满足WHERE子句条件的元组。</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>DELETE FROM 表名</pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">[</span>WHERE 条件<span class="token punctuation">]</span>;</pre></td></tr></table></figure><p>WHERE子句 - 指定要删除的元组，缺省表示要删除表中的全部元组，表的定义仍在。</p><ul><li><p><strong>删除某一个元组的值</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 删除学号为200215128的学生记录 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> <span class="token string">'200215128'</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p><strong>删除多个元组的值</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 删除所有的学生选课记录 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> SC<span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p><strong>带子查询的删除语句</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 删除计算机科学系所有学生的选课记录 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">IN</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p><strong>清空表中的数据</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">user</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li></ul><h2 id=空值的处理><a class=anchor href=#空值的处理>#</a> 空值的处理</h2><p>空值的存在是因为取值有不确定性，对关系运算带来特殊的问题，所以需要做特殊的处理。</p><p>SQL语言中允许某些元组的某些属性取空值，一般有以下几种情况</p><ul><li>该属性有值，但当前不知道它的具体值</li><li>该属性不应该有值</li><li>由于某种原因不便于填写</li></ul><h3 id=空值的产生><a class=anchor href=#空值的产生>#</a> 空值的产生</h3><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 向SC表中插入一个元组，学生号是'201215126'，课程号是'1'，成绩为空 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SC<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">,</span>Grade<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'200215128'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=空值的判断><a class=anchor href=#空值的判断>#</a> 空值的判断</h3><p>判断一个属性的值是否为空值，用IS NULL或IS NOT NULL 来表示。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 从Student表中找出漏填了数据的学生信息 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sname <span class="token operator">IS</span> <span class="token boolean">NULL</span> </pre></td></tr><tr><td data-num=4></td><td><pre><span class="token operator">OR</span> Ssex <span class="token operator">IS</span> <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token operator">OR</span> Sage <span class="token operator">IS</span> <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token operator">OR</span> Sdept <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=空值的约束条件><a class=anchor href=#空值的约束条件>#</a> 空值的约束条件</h3><p>属性定义(或域定义)中<strong>NOT NULL</strong>约束条件的不能取空。</p><p>加了UNIQUE限制的属性不能取空值。</p><p>码属性不能取空值。</p><h3 id=空值的算术比较逻辑运算><a class=anchor href=#空值的算术比较逻辑运算>#</a> 空值的算术/比较/逻辑运算</h3><p>算术运算 - 空值与另一个值(包括另一个空值)的算术运算的结果为空值</p><p>比较运算 - 空值与另一个值(包括另一个空值)的比较运算的结果为<strong>UNKNOWN</strong></p><p>逻辑运算 - 与，或，非，结果为TRUE或FALSE</p><p>当比较双方有UNKNOWN时结果为UNKNOWN</p><table><thead><tr><th>XY</th><th>X AND Y</th><th>X OR Y</th><th>NOT X</th></tr></thead><tbody><tr><td>TU</td><td>U</td><td>T</td><td>F</td></tr><tr><td>UT</td><td>U</td><td>T</td><td>U</td></tr><tr><td>UU</td><td>U</td><td>U</td><td>U</td></tr><tr><td>UF</td><td>F</td><td>U</td><td>U</td></tr><tr><td>FU</td><td>F</td><td>U</td><td>T</td></tr></tbody></table><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 找出选修1号课程的不及格的学生 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Grade <span class="token operator">&lt;</span> <span class="token number">60</span> <span class="token operator">AND</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">以上查询不及格的学生不包括缺考学生，</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">因此前者使条件Grade &lt; 60为True，后者使条件值为UNKNOWN。</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/* 修正 */</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">WHERE</span> Grade <span class="token operator">&lt;</span> <span class="token number">60</span> <span class="token operator">AND</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">OR</span> Grade <span class="token operator">is</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">/* 查找选修1号课程的不及格的学生以及缺考的学生 */</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">WHERE</span> Grade <span class="token operator">&lt;</span> <span class="token number">60</span> <span class="token operator">AND</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">UNION</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">WHERE</span> Grade <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token operator">AND</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment">/* 或者 */</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">SELECT</span> Sno <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">WHERE</span> Cno <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">AND</span><span class="token punctuation">(</span>Grade <span class="token operator">&lt;</span> <span class="token number">60</span> <span class="token operator">OR</span> Grade <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id=定义视图view><a class=anchor href=#定义视图view>#</a> 定义视图(VIEW)</h2><h3 id=概述-2><a class=anchor href=#概述-2>#</a> !概述</h3><p>视图是基于SQL语句的结果集的可视化的表。</p><p>视图是虚表，是从一个或几个基本表(或视图)导出的，本身不包含数据，也就不能对其进行索引操作，对视图的操作和对普通表的操作一样。</p><p>只存放视图的定义，不存放视图对应得数据。</p><p>表中得数据发生变化，视图中查询出得数据也随之改变。</p><p>基于视图的操作有查询，删除，受限更新，定义基于该视图的新视图。</p><h3 id=建立视图><a class=anchor href=#建立视图>#</a> !建立视图</h3><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CREATE VIEW 视图名<span class="token punctuation">[</span>列名...<span class="token punctuation">]</span> AS 子查询<span class="token punctuation">[</span>WITH CHECK OPTION<span class="token punctuation">]</span>;</pre></td></tr></table></figure><p>组成视图的属性列名，全部省略或全部指定。</p><p>子查询<strong>不允许</strong>含有<strong>ORDER BY</strong>子句和<strong>DISTINCT</strong>短语。(因为视图是虚表，这两个属于实际表)</p><p>RDBMS执行<strong>CREATE VIEW</strong>语句时只是把视图定义存入数据字典，并不执行其中的SELECT语句。</p><p>在对视图查询时，按视图的定义从基本表中将数据查出。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 建立信息系学生视图 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> IS_Student <span class="token keyword">AS</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sage ROM Student</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'IS'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">建立信息系学生的视图，并要求进行修改和插入操作时，</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">仍需保证该视图只有信息系的学生。 </span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> IS_Student <span class="token keyword">AS</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'IS'</span> <span class="token keyword">WITH</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>上面例子加入<strong>WITH CHECK OPTION</strong>，所有DBMS对IS_Student视图的更新操作</p><p>修改操作 - 自动加上Sdept = 'IS'的条件</p><p>删除操作 - 自动加上Sdept = 'IS'的条件</p><p>插入操作 - 自动检查Sdept属性值时否为<code>'IS'</code>，如果不是则拒绝该插入操作，如果没有提供Sdept属性值，则自动定义Sdept为<code>'IS'</code></p><ul><li><p><strong>基于多个基表的视图</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 建立信息系选修了1号课程的学生视图 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> IS_S1<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Grade<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">AS</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Grade <span class="token keyword">FROM</span> Student<span class="token punctuation">,</span>SC</pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'IS'</span> </pre></td></tr><tr><td data-num=6></td><td><pre><span class="token operator">AND</span> Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno <span class="token operator">AND</span> SC<span class="token punctuation">.</span>Cno <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p><strong>基于视图的视图</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">建立信息系选修了1号课程且成绩在90分以上的学生的视图</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">IS_S1为上例的视图</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> IS_S2 <span class="token keyword">AS</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Grade <span class="token keyword">FROM</span> IS_S1</pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">WHERE</span> Grade <span class="token operator">>=</span> <span class="token number">90</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p><strong>带表达式的视图</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 定义一个反映学生出生年份的视图 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> BT_S<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sbirth<span class="token punctuation">)</span> <span class="token keyword">AS</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span><span class="token number">2000</span><span class="token operator">-</span>Sage <span class="token keyword">FROM</span> Student<span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p><strong>分组视图</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 将学生的学号以及他的平均成绩定义为一个视图 */</span></pre></td></tr><tr><td data-num=2></td><td><pre>CREAT <span class="token keyword">VIEW</span> S_G<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Gavg<span class="token punctuation">)</span> <span class="token keyword">AS</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>Grade<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Sno<span class="token punctuation">;</span></pre></td></tr></table></figure></li><li><p><strong>不指定属性列</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 将Student表中所有女生记录定义为一个视图 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> F_Student<span class="token punctuation">(</span>F_Sno<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>age<span class="token punctuation">,</span>dept<span class="token punctuation">)</span> <span class="token keyword">AS</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">WHERE</span> Ssex <span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">本例中修改基表Student的结构后，</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">Student表与F_Student视图的映像关系被破坏，导致该视图不能正确工作</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">*/</span></pre></td></tr></table></figure></li></ul><h3 id=删除视图><a class=anchor href=#删除视图>#</a> 删除视图</h3><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>DROP VIEW 视图<span class="token punctuation">[</span>CASCADE<span class="token punctuation">]</span>;</pre></td></tr></table></figure><p>该语句从数据字典中删除指定的视图定义。</p><p>如果该视图上还导出了其他视图，使用CASCADE级联删除语句，把该视图和由它导出的所有视图一起删除。</p><p>删除基本表时，由该基表导出的所有视图定义都必须显示地使用<strong>DROP VIEW</strong>语句删除。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 删除视图BT_S */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> BT_S<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">删除视图IS_S1,</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">IS_S1视图还导出了IS_S2</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> IS_S1 <span class="token keyword">CASCADE</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=视图查询><a class=anchor href=#视图查询>#</a> 视图查询</h3><p>视图定义后，用户就可以像基本表一样对视图进行查询了。</p><h4 id=rdbms实现视图查询的方法-视图消解法><a class=anchor href=#rdbms实现视图查询的方法-视图消解法>#</a> RDBMS实现视图查询的方法 - 视图消解法</h4><ul><li>先进行有效性检查</li><li>再转换成等价的对基本表的查询</li><li>最后执行修正后的查询</li></ul><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">在信息系学生的视图中找出年龄小于20岁的学生</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">IS_Student为定义的视图</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> IS_Student</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> Sage <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">/* 采用视图消解转换后的查询语句为 */</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sage <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=10></td><td><pre>WHEREE Sdept <span class="token operator">=</span> <span class="token string">'IS'</span> <span class="token operator">and</span> Sage <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">/* 查询选修了1号课程的信息系学生 */</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">SELECT</span> IS_Stuedent<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>Sname <span class="token keyword">FROM</span> IS_Student<span class="token punctuation">,</span>SC</pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">WHERE</span> IS_Student<span class="token punctuation">.</span>Sno <span class="token operator">=</span> SC<span class="token punctuation">.</span>Sno <span class="token operator">AND</span> SC<span class="token punctuation">.</span>Cno <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id=视图消解法的局限><a class=anchor href=#视图消解法的局限>#</a> 视图消解法的局限</h4><p>视图消解法有些情况下，视图消解法不能生成正确查询。</p><p>错误例子</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 在S_G视图中查询平均成绩在90分以上的学生学号和平均成绩 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> S_G</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Gavg <span class="token operator">>=</span> <span class="token number">90</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* S_G视图的子查询如下 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>Grade<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Sno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/* 结合后形成下列查询语句,错误的转换 */</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>Grade<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">WHERE</span> <span class="token function">AVG</span><span class="token punctuation">(</span>Grage<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">90</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Sno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">/* 正确的转换 */</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>Grage<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Sno</pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">HAVING</span> <span class="token function">AVG</span><span class="token punctuation">(</span>Grage<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">90</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=视图更新><a class=anchor href=#视图更新>#</a> 视图更新</h3><p>更新视图是指通过视图来插入，删除和修改数据，因为视图不适合存储数据，因此对视图的更新操作将通过视图消解法，转化为对实际表的更新操作。</p><p>为防止在更新视图时出错，定义视图时要加上<strong>WITH CHECK OPTION</strong>子句。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 将信息系学生视图IS_Student中学号200215122的学生姓名改为刘成 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">UPDATE</span> IS_Student <span class="token keyword">SET</span> Sname <span class="token operator">=</span> <span class="token string">'刘成'</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> <span class="token string">'200215122'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 转换后的语句 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">UPDATE</span> Student <span class="token keyword">SET</span> Sname <span class="token operator">=</span> <span class="token string">'刘成'</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> <span class="token string">'200215122'</span> <span class="token operator">AND</span> Sdept <span class="token operator">=</span> <span class="token string">'IS'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 向信息系学生视图中插入一个新的学生记录：200215129，赵新，20岁 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> IS_Student <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'200215129'</span><span class="token punctuation">,</span><span class="token string">'赵新'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* 转换为对基本表的更新 */</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Sage<span class="token punctuation">,</span>Sdept<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'200215129'</span><span class="token punctuation">,</span><span class="token string">'赵新'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">'IS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 删除信息系学生视图IS_Student中学号为200215129的记录 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> IS_Student <span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> <span class="token string">'200215129'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* 转换为对基表表的更新 */</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> <span class="token string">'200215129'</span> <span class="token operator">AND</span> Sdept <span class="token operator">=</span> <span class="token string">'IS'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>更新视图的限制</strong></p><p>一些视图是不可更新的，因为对这些视图的更新不能唯一地有意义地转换成对相应基本表的更新。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 对视图S_G中学号为200215121学生的平均成绩改为90分 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 建立视图S_G */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> S_G<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Gavg<span class="token punctuation">)</span> <span class="token keyword">AS</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>Grade<span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">GROUP</span> <span class="token keyword">By</span> Sno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">/* 更新视图S_G */</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">UPDATE</span> S_G <span class="token keyword">SET</span> Gavg <span class="token operator">=</span> <span class="token number">90</span> <span class="token keyword">WHERE</span> Sno <span class="token operator">=</span> <span class="token string">'200215121'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>该更新视图无法转换成对基表表SC的更新，因为平均成绩是计算得出得，系统无法修改各科成绩，使平均成绩到90分。</p><h3 id=视图的作用><a class=anchor href=#视图的作用>#</a> !视图的作用</h3><p>视图能够简化复杂的SQL操作，比如复杂的联结，以此简化用户的操作。</p><p>视图使用户能以多种角度看待同一数据。</p><p>视图对重构数据库提供了一定程度的逻辑独立性。</p><p>视图通过只给用户访问视图的权限，保证数据的安全性，能够对机密数据提供安全保护。</p><p>适当的利用视图可更清晰的表达查询。</p><h2 id=存储过程><a class=anchor href=#存储过程>#</a> !存储过程</h2><p>存储过程可以看成是对一系列SQL操作的批处理。存储过程可以由触发器，其他存储过程以及Java， Python，PHP等应用程序调用。</p><p><strong>使用存储过程的好处</strong></p><ul><li>代码封装，保证了一定的安全性</li><li>代码复用</li><li>由于是预先编译，因此具有很高的性能</li></ul><p><strong>创建存储过程</strong></p><ul><li>命令行中创建存储过程需要自定义分隔符，因为命令行是以 <code>;</code> 为结束符，而存储过程中也包含了分号，因此会错误把这部分分号当成是结束符，造成语法错误</li><li>包含<code>in</code>、<code>out</code>和<code>inout</code>三种参数</li><li>给变量赋值都需要用<code>select into</code>语句</li><li>每次只能给一个变量赋值，不支持集合的操作</li></ul><p><strong>什么是存储过程?</strong></p><p>可以把存储过程看成是一些SQL语句的集合，中间加了点逻辑控制语句。</p><p>存储过程在业务比较复杂的时候是非常实用的，比如很多时候完成一个操作可能需要写一大串SQL语句，这时候就可以写一个存储过程，这样方便了下一次的调用。存储过程一旦调试完成通过后就能稳定运行，另外，使用存储过程比单纯SQL语句执行要快，因为存储过程是预编译过的。</p><p>存储过程在互联网公司应用不多，因为存储过程难以调试和扩展，而且没有移植性，还会消耗数据库资源。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 创建存储过程 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>proc_adder<span class="token punctuation">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">DEFINER</span><span class="token operator">=</span><span class="token identifier"><span class="token punctuation">`</span>root<span class="token punctuation">`</span></span><span class="token variable">@`localhost`</span> <span class="token keyword">PROCEDURE</span> <span class="token identifier"><span class="token punctuation">`</span>proc_adder<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token operator">IN</span> a <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token operator">IN</span> b <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">OUT</span> sum <span class="token keyword">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">DECLARE</span> c <span class="token keyword">int</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">if</span> a <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token keyword">then</span> <span class="token keyword">set</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">if</span> b <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token keyword">then</span> <span class="token keyword">set</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token keyword">set</span> sum  <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">END</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment">/* 使用存储过程 */</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">set</span> <span class="token variable">@b</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">call</span> proc_adder<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token variable">@b</span><span class="token punctuation">,</span><span class="token variable">@s</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">select</span> <span class="token variable">@s</span> <span class="token keyword">as</span> sum<span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id=游标cursor><a class=anchor href=#游标cursor>#</a> !游标(cursor)</h2><p>游标是一个存储在DBMS服务器上的数据库查询，它不是一条 <code>SELECT</code> 语句，而是被该语句检索出来的结果集。</p><p>在存储过程中使用游标可以对一个结果集进行移动遍历。</p><p>游标主要用于交互式应用，其中用户需要滚动屏幕上的数据，并对数据进行浏览或做出更改。</p><p><strong>使用游标的几个明确步骤</strong></p><ul><li>在使用游标前，必须声明(定义)它。这个过程实际上没有检索数据， 它只是定义要使用的<code>SELECT</code>语句和游标选项</li><li>一旦声明，就必须打开游标以供使用。这个过程用前面定义的 SELECT 语句把数据实际检索出来</li><li>对于填有数据的游标，根据需要取出(检索)各行</li><li>在结束游标使用时，必须关闭游标，可能的话，释放游标(有赖于具体的DBMS)</li></ul><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">DELIMITER</span> $</pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span>  <span class="token keyword">PROCEDURE</span> getTotal<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">DECLARE</span> total <span class="token keyword">INT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token comment">/* 创建接收游标数据的变量 */</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">DECLARE</span> sid <span class="token keyword">INT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">DECLARE</span> sname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token comment">/* 创建总数变量 */</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token keyword">DECLARE</span> sage <span class="token keyword">INT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token comment">/* 创建结束标志变量 */</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">DECLARE</span> done <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token comment">/* 创建游标 */</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token keyword">DECLARE</span> cur <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>age <span class="token keyword">from</span> cursor_table <span class="token keyword">where</span> age<span class="token operator">></span><span class="token number">30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token comment">/* 指定游标循环结束时的返回值 */</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> <span class="token operator">NOT</span> FOUND <span class="token keyword">SET</span> done <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token keyword">SET</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token keyword">OPEN</span> cur<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token keyword">FETCH</span> cur <span class="token keyword">INTO</span> sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> sage<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token keyword">WHILE</span><span class="token punctuation">(</span><span class="token operator">NOT</span> done<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token keyword">DO</span></pre></td></tr><tr><td data-num=21></td><td><pre>        <span class="token keyword">SET</span> total <span class="token operator">=</span> total <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>        <span class="token keyword">FETCH</span> cur <span class="token keyword">INTO</span> sid<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> sage<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token keyword">CLOSE</span> cur<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">SELECT</span> total<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token keyword">END</span> $</pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token comment">/* 调用存储过程 */</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">call</span> getTotal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id=数库安全性><a class=anchor href=#数库安全性>#</a> 数库安全性</h2><p>数据库的安全性是指保护数据库以防止不合法使用所造成的数据泄漏，更改或破坏。</p><p>系统安全保护措施是否有效是数据库系统主要的性能指标之一。</p><h3 id=数据库的不安全因素><a class=anchor href=#数据库的不安全因素>#</a> 数据库的不安全因素</h3><p><strong>非授权用户对数据库的恶意存取和破坏</strong></p><p>一些黑客(Hacker)和犯罪分子在用户存取数据库时获取用户名和用户口令，然后假冒合法用户偷取，修改甚至破坏用户数据。</p><p>数据库管理系统提供的安全措施主要包括用户身份鉴别，存取控制和视图等技术。</p><p><strong>数据库中重要或敏感的数据被泄漏</strong></p><p>黑客和敌对分子盗窃数据库中的重要数据，一些机密信息被泄漏。</p><p>数据库管理系统提供的主要技术有强制存取控制，数据加密存储和加密传输等。</p><p>安全要求较高的系统提供审计日志分析。对潜在的威胁提前采取措施加以防范。</p><p><strong>安全环境的脆弱性</strong></p><p>数据库的安全性与计算机系统的安全性紧密连接，主要包括计算机硬件，操作系统，网络系统等的安全性。</p><p>在计算机安全方面需要建立一套可信(Trusted)计算机系统的概念和标准。</p><h3 id=数据库安全性控制><a class=anchor href=#数据库安全性控制>#</a> 数据库安全性控制</h3><p><strong>非法使用数据库的情况</strong></p><p>编写合法程序绕过数据库管理系统及授权机制。</p><p>直接或编写应用程序执行非授权操作。</p><p>通过多次合法查询数据库从中推导出一些保密数据。</p><p><strong>计算机系统的安全模型</strong></p><p>计算机系统的安全措施是一级一级层层设置。</p><p>用户(用户标识和鉴别) ↔ DBMS(数据库安全保护) ↔ OS(操作系统安全保护) ↔ DB(数据密码存储)</p><p><strong>数据库有关的安全性</strong></p><p>数据库安全性主要包括，用户身份验证，多层存取控制，审计，视图，数据加密等安全技术。</p><h3 id=授权授予与回收><a class=anchor href=#授权授予与回收>#</a> 授权(授予与回收)</h3><p>SQL标准的通过GRANT语句和REVOKE语句实现自主存取控制。</p><p><strong>用户权限</strong></p><p>定义用户存取权限就是定义用户可以在哪些数据库对象上进行哪些类型的操作。定义存取权限称为授权。</p><p><strong>用户权限组成</strong></p><p>数据对象，操作类型</p><p><strong>关系数据库系统中存取控制对象</strong></p><p>对象类型</p><p>SQL通过GRANT和REVOKE语句实现向用户授予或收回对数据的操作权限。</p><p><strong>GRANT</strong> - 对指定操作对象的指定操作权限授予指定的用户</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>GRANT 权限</pre></td></tr><tr><td data-num=2></td><td><pre>ON 对象类型 对象名</pre></td></tr><tr><td data-num=3></td><td><pre>TO 用户</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">[</span>WITH GRANT OPTION<span class="token punctuation">]</span>;</pre></td></tr></table></figure><p>发出GRANT(法人)可以是数据库管理员，数据库对象创建者(Owner)，拥有该权限的用户。</p><p>接受权限的用户可以是一个或多个具体用户，PUBLIC(即全体用户)。</p><p><strong>WITH GRANT OPTION</strong>子句 - 表示该权限可以再授予其他用户。没有，表示该权限不可以再授予其他用户。</p><p>SQL标准不允许循环授权。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 把查询Student表权限授予给用户U1 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">ON</span> <span class="token keyword">TABLE</span> Student</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">TO</span> U1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* 把对表SC的查询权限授予给全体用户 */</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC</pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">TO</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">/* 把查询Student表和修改学生学号的权限授予给用户U4 */</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">GRANT</span> <span class="token keyword">UPDATE</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">ON</span> TABHLE Student</pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">TO</span> U4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">/* 对属性列的授权时必须明确指出相应属性列名 */</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">/* 把对表SC的INSERT权限授予U5用户，并允许他再将此权限授予其他用户 */</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">GRANT</span> <span class="token keyword">INSERT</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC</pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">TO</span> U5</pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token comment">/* 执行完U5的授权后，U5不仅拥有了对表SC的INSERT权限，还可以传播此权限 */</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">GRANT</span> <span class="token keyword">INSERT</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC</pre></td></tr><tr><td data-num=26></td><td><pre><span class="token keyword">TO</span> U6</pre></td></tr><tr><td data-num=27></td><td><pre><span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token comment">/* U6还可以将此权限授予给其他用户 */</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token keyword">GRANT</span> <span class="token keyword">INSERT</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC</pre></td></tr><tr><td data-num=32></td><td><pre><span class="token keyword">TO</span> U7<span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>REVOKE</strong> - 授予的权限可以由数据库管理员或其他授权者用REVOKE语句回收</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>REVOKE 权限</pre></td></tr><tr><td data-num=2></td><td><pre>ON 对象类型 对象名</pre></td></tr><tr><td data-num=3></td><td><pre>FROM 用户 <span class="token punctuation">[</span>CASCADE | RESTRICT<span class="token punctuation">]</span>;</pre></td></tr></table></figure><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 把用户U4修改学生学号的权限收回 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">REVOKE</span> <span class="token keyword">UPDATE</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">ON</span> <span class="token keyword">TABLE</span> Student</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">FROM</span> U4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* 收回所有用户对表SC的查询权限 */</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC</pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">FROM</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">/* 把用户U5对SC表的INSERT权限收回 */</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">REVOKE</span> <span class="token keyword">INSERT</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC</pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">FROM</span> U5 <span class="token keyword">CASCADE</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>将用户U5的INSERT权限收回的时候应该使用CASCADE，否则该操作将被拒绝。</p><p>如果U6或U7还从其他用户处获得对SC表的INSERT权限，则它们仍具有此权限，系统只回收直接或间接从U5处获得的权限。</p><p><strong>数据库管理员的授权</strong></p><p>拥有所有对象的所有权限</p><p>根据实际情况不同大的权限授予不同的用户。</p><p><strong>用户的授权</strong></p><p>拥有自己建立的对象的全部的操作权限。</p><p>可以使用GRANT语句把权限授予其他用户。</p><p><strong>被授权用户的授权</strong></p><p>如果具有继续授权的许可，可以把获得的权限继续授予给其他用户</p><p>所有授予出去的权限在必要时又都可以用REVOKE语句回收。</p><h3 id=创建数据库模式的权限><a class=anchor href=#创建数据库模式的权限>#</a> 创建数据库模式的权限</h3><p>数据库管理员在创建用户时实现对创建数据库模式的权限</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CREATE USER 用户名</pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">[</span>WITH<span class="token punctuation">]</span> <span class="token punctuation">[</span>DBA | RESOURCE | CONNECT<span class="token punctuation">]</span>;</pre></td></tr></table></figure><p>只有系统的超级用户才有权创建一个新的数据库用户。</p><p>新创建的数据库用户有三种权限，CONNECT，RESOURCE和DBA。</p><p>如果没有指定创建的新用户的权限，默认该用户拥有CONNECT权限。拥有CONNECT权限的用户不能创建新用户，不能创建模式，也不能创建基本表，只能登录数据库。</p><p>拥有RESOURCE权限的用户能创建基本表和视图，成为所创建对象的属主。但不能创建模式，不能创建新用户。</p><p>拥有DBA权限的用户是系统中的超级用户，可以创建新的用户，创建模式，创建基本表和视图等；DBA拥有对所有数据库对象的存取权限，还可以把这些权限授予一般用户。</p><h3 id=数据库角色><a class=anchor href=#数据库角色>#</a> 数据库角色</h3><p>数据库角色是指被命名的一组与数据库操作相关的权限，角色是权限的集合。</p><p>可以为一组具有相同权限的用户创建一个角色，简化授权的过程。</p><p>SQL中首先用CREATE ROLE语句创建角色，然后用GRANT语句授权，用REVOKE收回授予角色的权限。</p><p><strong>角色创建</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CREATE ROLE 角色名</pre></td></tr></table></figure><p><strong>给角色授权</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>GRANT 权限</pre></td></tr><tr><td data-num=2></td><td><pre>ON 对象类型 对象名</pre></td></tr><tr><td data-num=3></td><td><pre>TO 角色</pre></td></tr></table></figure><p><strong>将一个角色授予其他的角色或用户</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>GRANT 角色</pre></td></tr><tr><td data-num=2></td><td><pre>TO 角色</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">[</span>WITH ADMIN OPTION<span class="token punctuation">]</span>;</pre></td></tr></table></figure><p>该语句把角色授予某用户，或授予另一个角色。</p><p>授予者是角色创建者或拥有这个角色上的<strong>ADMIN OPTION</strong>。</p><p>制定了<strong>WITH ADMIN OPTION</strong>则获得某种权限的角色或用户还可以把这种权限授予给其他角色。</p><p><strong>角色权限的回收</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>REVOKE 权限</pre></td></tr><tr><td data-num=2></td><td><pre>ON 对象类型 对象名</pre></td></tr><tr><td data-num=3></td><td><pre>FROM 角色</pre></td></tr></table></figure><p>用户可以回收角色的权限，从而修改角色拥有的权限。</p><p>REVOKE执行者是，角色的创建者，拥有在这个(些)角色上的ADMIN OPTION。</p><p><strong>例子</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 通过角色来实现一组权限授予一个用户 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 创建角色R1 */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CREATE</span> ROLE R1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 使用GRANT语句，授予角色R1拥有Student的SELECT,UPDATAE,INSERT权限 */</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">INSERT</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">ON</span> <span class="token keyword">TABLE</span> Student</pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">TO</span> R1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/* 将这个角色授予给王平，张明，赵琳。使他们具有角色R1所包含的全部权限 */</span></pre></td></tr><tr><td data-num=11></td><td><pre>GRANAT R1</pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">TO</span> 王平<span class="token punctuation">,</span>张明<span class="token punctuation">,</span>赵琳<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">/* 可以一次性通过R1来回收授予王平的权限 */</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">REVOKE</span> R1</pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">FROM</span> 王平<span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=视图机制><a class=anchor href=#视图机制>#</a> 视图机制</h3><p>视图对数据库安全的作用</p><p>把要保密的数据对无权存取这些数据的用户隐藏起来，数据提供一定程度的安全保护。</p><p>间接地实现支持存取谓词的用户权限定义。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 建立计算机系学生的视图，把对该视图的SELECT权限授予王平，把该视图上的所有操作权限授予张明 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 建立计算机系学生的视图CS_Student */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> CS_Student <span class="token keyword">AS</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Student</pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">WHERE</span> Sdept <span class="token operator">=</span> <span class="token string">'CS'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">/* 在视图上给王平老师授予检索计算机系学生信息的权限 */</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">ON</span> CS_Student</pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">TO</span> 王平<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">/* 在视图上所有的权限授予系主任张明 */</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> PRIVILIGES</pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">ON</span> CS_Student</pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">TO</span> 张明<span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=审计audit><a class=anchor href=#审计audit>#</a> 审计(Audit)</h3><p>审计日志(Audit Log) - 启用一个专用的审计日志，将用户对数据库的所有操作记录在上面</p><p>审计员 - 审计员利用审计日志监控数据库中的各种行为，找出非法存取数据的人，时间和内容</p><p>C2以上安全级别的DBMS必须具有审计功能。</p><p>审计很费时间和空间。</p><p>DBA可以根据应用对安全性的要求，灵活地打开或关闭审计功能。</p><p>审计功能主要用于安全性要求较高的部门。</p><p><strong>审计事件</strong></p><p>服务器事件 - 审计数据库服务器发生的事件</p><p>系统权限 - 对系统拥有的结构或模式对象进行操作的审计，要求该操作的权限是通过系统权限获得的</p><p>语句事件 - 对SQL语句，如DDL，DML,DQL,DCL语句的审计</p><p>模式对象事件 - 对特定模式对象上进行的SELECT或DML操作的审计</p><p><strong>审计功能</strong></p><p>基本功能 - 提供多种审计查阅方式</p><p>多套审计规则 - 一般在初始化设定</p><p>提供审计分析和报告</p><p>审计日志管理功能</p><ul><li>防止审计员误删审计记录，审计日志必须先转储后删除</li><li>对转储的审计记录文件提供完整性和表面性保护</li><li>只允许审计员查阅和转储审计记录，不允许任何用户新增和修改审计记录等</li></ul><p>提供查询审计设置及审计记录信息的专门视图</p><p><strong>审计分类</strong></p><p>用户级审计 - 任何用户可设置审计，主要是用户针对自己创建的数据库表和视图进行审计</p><p>系统级审计 - 只能由数据库管理员设置，监测成功或失败的登录要求，监测授权和收回操作以及其他数据库级权限下的操作</p><p><strong>AUDIT语句和NOAUDIT语句</strong></p><p>AUDIT语句用于设置审计功能，NOAUDIT语句用于取消审计功能。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 对修改SC表结构或修改SC表数据的操作进行审计 */</span></pre></td></tr><tr><td data-num=2></td><td><pre>AUDIT <span class="token keyword">ALTER</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">ON</span> SC<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* 取消对SC表的一切审计 */</span></pre></td></tr><tr><td data-num=6></td><td><pre>NOAUDIT <span class="token keyword">ALTER</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">ON</span> SC<span class="token punctuation">;</span></pre></td></tr></table></figure><p>审计设置和审计日志一般存储在数据字典中。</p><p>必须打开审计开关，系统参数audit_trail设为true，才能在系统表SYS_AUDITTAII中看到审计信息。</p><p>数据库安全审计系统提供一种事后检查的安全机制。</p><h3 id=数据加密><a class=anchor href=#数据加密>#</a> 数据加密</h3><p>数据加密是防止数据库中数据在存储和传输中失密的有效手段。</p><p>加密的基本思想是根据一定的算法将原始数据-明文(plain text)变换为不可直接识别的格式-密文(Cipher text)。</p><p>数据加密包括存储加密和传输加密。</p><h4 id=存储加密><a class=anchor href=#存储加密>#</a> 存储加密</h4><p><strong>透明存储加密</strong></p><p>内核级加密保护方式，对用户完全透明。</p><p>将数据在写到磁盘时对数据进行加密，授权用户读取数据时再对其进行加密。</p><p>数据库的应用程序不需要做任何修改，只需再创建表语句中说明需加密的字段即可。</p><p>内核级加密方法的性能较好，安全完备性较高。</p><p><strong>非透明存储加密</strong></p><p>通过多个加密函数实现。</p><h4 id=传输加密><a class=anchor href=#传输加密>#</a> 传输加密</h4><p><strong>链路加密</strong></p><p>在链路层进行加密。</p><p>传输信息由报头和报文两部分组成，报文和报头均加密。</p><p><strong>端到端加密</strong></p><p>在发送端加密，接收端加密。</p><p>只加密报文不加密报头。</p><p>所需密码设备数量相对较小，容易被非法监听者发现并从中获取敏感信息。</p><h4 id=数据库管理系统可信传输><a class=anchor href=#数据库管理系统可信传输>#</a> 数据库管理系统可信传输</h4><p><strong>确认通信双方端点的可靠性</strong></p><p>采用基于数字证书的服务器和客户端认证方式。通信时均首先向对方提供己方证书，然后使用本地的证书(CA)信任列表和证书撤销列表对接收到的对方证书进行验证</p><p><strong>协商加密算法和密钥</strong></p><p>确认双方端点的可靠性后，通信双方协商本次会话的加密算法与密钥。</p><p><strong>可信数据传输</strong></p><p>数据在被发送前用某一组特定的密钥进行加密和消息摘要计算，以密文形式在网络上传输。数据被接收的时候，需用相同一组特定的密钥进行解密和摘要计算。</p><h3 id=其他安全性保护><a class=anchor href=#其他安全性保护>#</a> 其他安全性保护</h3><p><strong>推理控制</strong></p><p>处理强制存取控制未解决的问题，避免用户利用能够访问的数据推知更高密级的数据。</p><p>常用方法，基于函数依赖的推理控制，基于敏感关联的推理控制。</p><p><strong>隐蔽信道</strong></p><p>处理强制存取控制未解决的问题。</p><p><strong>数据隐式保护</strong></p><p>描述个人控制其不愿他人知道或他人不便知道的个人数据的能力。主要用于数据收集存储处理和数据发布等各个阶段。</p><h2 id=数据库完整性><a class=anchor href=#数据库完整性>#</a> 数据库完整性</h2><p>数据库的完整性是指数据的正确性和相容性。</p><p>数据的正确性是指数据是符合现实世界语义，反映了当前实际状况的。</p><p>数据的相容性是指数据库同一对象在不同关系表中的数据是符合逻辑的。</p><p><strong>数据的完整性</strong></p><p>防止数据库中存在不符合语义的数据，也就是防止数据库中存在不正确的数据。</p><p>防范对象是不合语义的，不正确的数据</p><p><strong>数据的安全性</strong></p><p>保护数据库防止恶意的破坏合非法的存取。</p><p>防范对象是非法用户和非法操作。</p><h3 id=数据库在完整性方面应具备的功能><a class=anchor href=#数据库在完整性方面应具备的功能>#</a> !数据库在完整性方面应具备的功能</h3><p><strong>提供定义完整性约束条件的机制</strong></p><p>完整性约束条件也称未完整性规则，是数据库中的数据必须满足的语义约束条件。SQL标准通过数据定义语言来描述完整性，包括关系模型的实体完整性，参照完整性和用户定义完整性。</p><p><strong>提供完整性检查的方法</strong></p><p>数据库管理系统中检查数据是否满足完整性约束条件的机制称为完整性检查。一般在INSERT，UPDATE，DELETE语句执行后开始检查，也可以在事务提交时检查。</p><p><strong>违约处理</strong></p><p>数据库管理系统若发现用户的操作违背了完整性约束条件，就采取拒绝(NO ACTION)执行该操作或级联(CASCADE)执行其他操作等方式保证完整性。</p><p><strong>数据库设计通常分为哪几步?</strong></p><ol><li><strong>需求分析</strong> - 分析用户的需求，包括数据、功能和性能需求</li><li><strong>概念结构设计</strong> - 主要采用E-R模型进行设计，包括画E-R图</li><li><strong>逻辑结构设计</strong> - 通过将E-R图转换成表，实现从E-R模型到关系模型的转换</li><li><strong>物理结构设计</strong> - 主要是为所设计的数据库选择合适的存储结构和存取路径</li><li><strong>数据库实施</strong> - 包括编程、测试和试运行</li><li><strong>数据库的运行和维护</strong> - 系统的运行与数据库的日常维护</li></ol><h3 id=实体完整性定义><a class=anchor href=#实体完整性定义>#</a> 实体完整性定义</h3><p><strong>关系模型的实体完整性</strong></p><p>设置主码，让每条记录是相互可区分的，SQL中在CREATE TABLE中用PRIMARY KEY定义。</p><p><strong>主码是单属性构成的有两种说明方法</strong></p><p>定义为列级约束条件</p><p>定义为表级约束条件</p><p><strong>主码是多属性的只能有一种说明方法</strong></p><p>定义表级约束条件</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 将Student表中的Sno属性定义为主码 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 在列级定义主码 */</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                     Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                     Ssex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                     Sage <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>                     Sdept <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre>                     <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre> </pre></td></tr><tr><td data-num=10></td><td><pre> <span class="token comment">/* 在表级定义主码 */</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=12></td><td><pre>                     Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>                     Ssex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>                     Sage <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>                     Sdept <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>                     <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=17></td><td><pre>                     <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>                     </pre></td></tr><tr><td data-num=19></td><td><pre> <span class="token comment">/* 当单个属性无法区别时，只能在表级定义主码 */</span></pre></td></tr><tr><td data-num=20></td><td><pre> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=21></td><td><pre>                 Cno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=22></td><td><pre>                 Grade <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=23></td><td><pre>                 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=24></td><td><pre>                 <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>完整性检查的内容</strong></p><p>关系数据库管理系统按照实体完整性规则自动进行检查。检查主要内容包括</p><ul><li>检查主码值是否唯一，如果不唯一则拒绝插入或修改</li><li>检查主码的各个属性是否为空，只要有一个为空就拒绝插入或修改</li></ul><p><strong>检查主码值方法</strong></p><p>检查记录中主码值是否唯一的一种方法是进行全表扫描。即依次判断表中每一条记录的主码值与插入记录上的主码值(或修改的新主码值)是否相同。</p><p>全表扫描的缺点是十分耗时。</p><p>为避免对基本表进行全表扫描，RDBMS核心一般都在主码上自动建立一个索引。(如.B+树索引)</p><h3 id=参照完整性><a class=anchor href=#参照完整性>#</a> 参照完整性</h3><p>参照完整性的定义是，在CREATE TABLE中用FOREIGN KEY定义哪些列为外码，用REFERENCES短语指明这些外码参照哪些表的主码。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 定义SC中的参照完整性 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>                Cno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                Grade <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>                <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Cno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Course<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre>                <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>一个参照完整性将两个表中的相应元组联系起来，对被参照表和参照表进行增删改操作时都有可能破坏参照完整性，必须进行完整性检查。</p><p>参照完整性违约处理规则</p><ul><li>拒绝(NO ACTION)执行。不允许该操作执行，该策略一般设置为默认策略</li><li>级联(CASCADE)操作。当删除或修改被参照表(Student)的一个元组造成了与参照表(SC)的不一致，则删除或修改参照表中的所有造成不一致的元组</li><li>设置为空值(SET-NULL)。当删除或修改被参照表的一个元组时造成了不一致，则将参照表中的所有造成不一致的元组的对应属性设置为空值</li></ul><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">倘若有两个关系</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">学生(学号，姓名，性别，专业号，年龄)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">专业(专业号，专业名)</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">假设专业表中专业号为12的元组被删除，按照设置为空的策略，就要把学生表</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">中专业号为12的所有元组的专业号设置为空值。</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">对应语义，某个专业删除了，该专业的所有学生专业未定，等待重新分配专业</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/* 显示说明参照完整性的违约处理示例 */</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=12></td><td><pre>                Cno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>                Grade <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>                <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>                <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>                <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span></pre></td></tr><tr><td data-num=17></td><td><pre>                <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=18></td><td><pre>                </pre></td></tr><tr><td data-num=19></td><td><pre>                <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Cno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Course<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=20></td><td><pre>                <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">NO</span> <span class="token keyword">ACTION</span></pre></td></tr><tr><td data-num=21></td><td><pre>                <span class="token comment">/* 当删除course表中的元组造成了与SC表不一致时拒绝删除 */</span></pre></td></tr><tr><td data-num=22></td><td><pre>                <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span></pre></td></tr><tr><td data-num=23></td><td><pre>                <span class="token comment">/* 当更新course表中的cno时，级联更新SC表中相应的元组 */</span></pre></td></tr><tr><td data-num=24></td><td><pre>                <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=用户定义的完整性><a class=anchor href=#用户定义的完整性>#</a> 用户定义的完整性</h3><p>用户定义的完整性，针对某一具体应用的数据必须满足的语义要求。用户定义的完整性由关系数据库管理系统提供了定义和检验用户定义完整性的机制，不必由应用程序承担。</p><h3 id=属性上的约束条件><a class=anchor href=#属性上的约束条件>#</a> 属性上的约束条件</h3><p><strong>属性上的约束条件定义</strong></p><p>CREATE TABLE时定义属性上的约束条件包括，列值非空(NOT NULL)，列值唯一(UNIQUE)，检查列值是否满足一个条件表达式(CHECK)。</p><p><strong>不允许取空值</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 在定义SC表时说明Sno,Cno,Grade属性不允许空值 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>                Cno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                Grade <span class="token keyword">SMALLINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num=7></td><td><pre>                <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>列值唯一</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 建立部门表DEPT,要求部门名称Dname列取值唯一，部门编号Deptno列为主码 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DEPT<span class="token punctuation">(</span>Deptno <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>                  Dname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                  <span class="token comment">/* 要求Dname列值唯一，并且不能取空值 */</span></pre></td></tr><tr><td data-num=5></td><td><pre>                  Location <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Deptno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>                  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>用CHECK短语指定列值应满足的条件</strong></p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* Student表的Ssex只允许取男或女 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>                     Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                     Ssex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">CHECK</span><span class="token punctuation">(</span>Ssex <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                     Sage <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                     Sdept <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>                     <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>                     </pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/* SC表的Grade的值应该在0和100之间 */</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>                Cno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=12></td><td><pre>                Grade <span class="token keyword">SMALLINT</span> <span class="token keyword">CHECK</span><span class="token punctuation">(</span>Grade <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">AND</span> Grade <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>                <span class="token comment">/* Grade的取值范围是0到100 */</span></pre></td></tr><tr><td data-num=14></td><td><pre>                <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>                <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>                <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Cno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Course<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=17></td><td><pre>                <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>插入元组或修改属性的值时，关系数据库管理系统检查属性上的约束条件是否被满足，如果不满足则操作被拒绝执行。</p><h3 id=元组上约束条件><a class=anchor href=#元组上约束条件>#</a> 元组上约束条件</h3><p>在CREATE TABLE时可以用CHECK短语定义元组上的约束条件，即元组级的限制。</p><p>元组级的限制可以设置不同属性之间的取值的相互约束条件。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 当学生的姓名是男是，其名字不能以Ms.开头 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>                     Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>                     Ssex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>                     Sage <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>                     Sdept <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>                     <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>                     <span class="token keyword">CHECK</span><span class="token punctuation">(</span>Ssex <span class="token operator">=</span> <span class="token string">'女'</span> <span class="token operator">OR</span> Sname <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token string">'Ms.%'</span></pre></td></tr><tr><td data-num=9></td><td><pre>                     <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=完整性约束命名子句><a class=anchor href=#完整性约束命名子句>#</a> 完整性约束命名子句</h3><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CONSTRAINT 完整性约束条件名 完整性约束条件</pre></td></tr></table></figure><p>完整性约束条件包括NOT NULL，UNIQUE，PRIMARY KEY短语，FOREIGN　KEY短语，CHECK短语等。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">建立学生登记表Student，要求学号在90000~99999之间，</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">姓名不能取空值，年龄小于30，性别只能是男或女 </span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student<span class="token punctuation">(</span>Sno <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre>                     <span class="token keyword">CONSTRAINT</span> C1 <span class="token keyword">CHECK</span><span class="token punctuation">(</span>Sno <span class="token operator">BETWEEN</span> <span class="token number">90000</span> <span class="token operator">AND</span> <span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>                     Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CONSTRAINT</span> C2 <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>                     Sage NUMERICE<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">CONSTRAINT</span> C3 <span class="token keyword">CHECK</span><span class="token punctuation">(</span>Sage <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>                     Ssex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=10></td><td><pre>                     <span class="token keyword">CONSTRAINT</span> C4 <span class="token keyword">CHECK</span><span class="token punctuation">(</span>Ssex <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>                     <span class="token keyword">CONSTRAINT</span> StudentKey <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=12></td><td><pre>                     <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre> <span class="token comment">/* </span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment"> 在Student表上建立了5个约束条件，</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment"> 包括主码约束(命名为StudentKey)以及C1，C2，C3，C4四个列级约束</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"> */</span></pre></td></tr></table></figure><h3 id=修改表中的完整性限制><a class=anchor href=#修改表中的完整性限制>#</a> 修改表中的完整性限制</h3><p>使用ALTER TABLE语句修改表中额完整性限制。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 去掉例题中对性别的限制 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> C4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">修改表Student中的约束条件，要求学号改为在900000~999999之间，</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">年龄由小于30改为小于40。</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">可以先删除原来的约束条件，再增加新的约束条件</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student</pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> C1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student</pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> C1 <span class="token keyword">CHECK</span><span class="token punctuation">(</span>Sno <span class="token operator">BETWEEN</span> <span class="token number">900000</span> <span class="token operator">AND</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student</pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> C3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Student</pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> C3 <span class="token keyword">CHECK</span><span class="token punctuation">(</span>Sage <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=域中的完整性限制><a class=anchor href=#域中的完整性限制>#</a> 域中的完整性限制</h3><p>域是一组具有相同数据类型的值的集合，即属性的取值范围。SQL可以用CREATE DOMAIN语句建立一个域以及域应该满足的完整性约束条件，然后用域定义属性。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 建立一个性别域，并声明性别域的取值范围 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> DOMAIN GenderDomain <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CHECK</span><span class="token punctuation">(</span><span class="token keyword">VALUE</span> <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* 可以用GenderDomain定义性别属性Ssex GenderDomain */</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/* 建立一个性别域GenderDomain，并对其中的限制命名 */</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">CREATE</span> DOMAIN GenderDomain <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">CONSTRAINT</span> GD <span class="token keyword">CHECK</span><span class="token punctuation">(</span><span class="token keyword">VALUE</span> <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/* 删除域GenderDomain的限制条件GD */</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">ALTER</span> DOMAIN GenderDomain</pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> GD<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">/* 在域GenderDomain上增加性别的限制条件GDD */</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">ALTER</span> DOMAIN GenderDomain</pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> GDD <span class="token keyword">CHECK</span><span class="token punctuation">(</span><span class="token keyword">VALUE</span> <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">/* 通过以上两个例子可以把属性的取值范围由('男'，’女‘)改为('1','0') */</span></pre></td></tr></table></figure><h3 id=创建断言的语句格式><a class=anchor href=#创建断言的语句格式>#</a> 创建断言的语句格式</h3><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CREATE ASSERTION 断言名 CHECK 子句</pre></td></tr></table></figure><p>每个断言都被赋予一个名字，<strong>CHECK 子句</strong>中的约束条件与<strong>WHERE子句</strong>的条件表达式类似。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 限制数据库课程最多60名学生选修 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> ASSERTION ASSE_SC_DB_NUM</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">CHECK</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">>=</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* 此断言的谓词涉及聚集操作COUNT的SQL语句 */</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> Course<span class="token punctuation">,</span>SC</pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">WHERE</span> SC<span class="token punctuation">.</span>Cno <span class="token operator">=</span> Course<span class="token punctuation">.</span>Cno <span class="token operator">and</span> Course<span class="token punctuation">.</span>Cname <span class="token operator">=</span> <span class="token string">'数据库'</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/* 限制每一门课程最多60名学生选修 */</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">CREATE</span> ASSERTION ASSE_SC_CNUM1</pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">CHECK</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">>=</span> <span class="token keyword">ALL</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Cno</pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">/* 此断言的谓词，涉及聚集操作COUNT和分组函数GROUP BY的SQL语句 */</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment">/* 限制每个学期每一门课程最多60名学生选修 */</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment">/* 首先需要修改SC表的模式，增加一个学期(TERM)属性 */</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> SC <span class="token keyword">ADD</span> TERM <span class="token keyword">DATE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token comment">/* 然后，定义断言 */</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">CREATE</span> ASSERTION ASSE_SC_CNUM2</pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">CHECK</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">>=</span> <span class="token keyword">ALL</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> SC</pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Cno<span class="token punctuation">,</span>TERM</pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>删除断言</strong></p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>DROP ASSERTION 断言名;</pre></td></tr></table></figure><p>如果断言很复杂，则系统在检测和维护断言的开销较高，这是在使用断言时应该注意的。</p><h3 id=触发器trigger><a class=anchor href=#触发器trigger>#</a> !触发器(Trigger)</h3><p>触发器是一种与表操作有关的数据库对象，当触发器所在表上出现指定事件时，将调用该对象，即表的操作事件触发表上的触发器的执行。可以使用触发器来进行审计跟踪，把修改记录到另外一张表中。</p><p>触发器定义 - 触发器是用户定义在关系表上的一类由事件驱动的特殊过程。</p><p>触发器保存在数据库服务器中，任何用户对表的增，删，改操作均由服务器自动激活相应的触发器。</p><p>触发器可以实施更为复杂的检查和操作，具有更精细和更强大的数据控制能力。</p><p><strong>使用触发器的优点</strong></p><ul><li>SQL触发器提供了另一种检查数据完整性的方法</li><li>SQL触发器可以捕获数据库层中业务逻辑中的错误</li><li>SQL触发器提供了另一种运行计划任务的方法。通过使用 SQL 触发器，您不必等待运行计划任务，因为在对表中的数据进行更改之前或之后会自动调用触发器</li><li>SQL触发器对于审计表中数据的更改非常有用</li></ul><p><strong>使用触发器的缺点</strong></p><ul><li>SQL触发器只能提供扩展验证，并且不能替换所有验证。必须在应用程序层中完成一些简单的验证。例如，您可以使用JavaScript在客户端验证用户的输入，或者使用服务器端脚本语言(如 JSP, PHP, <code>ASP.NETopen in new window</code>，Perl)在服务器端验证用户的输入</li><li>从客户端应用程序调用和执行SQL触发器是不可见的，因此很难弄清楚数据库层中发生了什么</li><li>SQL触发器可能会增加数据库服务器的开销</li></ul><h4 id=定义触发器><a class=anchor href=#定义触发器>#</a> 定义触发器</h4><p>触发器又叫事件-条件-动作(event-condition-action)规则。</p><p>当特定的系统事件发生时，对规则的条件进行检查，如果条件成立则执行规则中成立则执行规则中动作，否则不执行该动作。规则中的动作体可以很复杂，通常是一段SQL存储过程。</p><p>表的拥有者才可以在表上创建触发器。</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>CREATE TRIGGER 触发器名</pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span>BEFORE | AFTER<span class="token punctuation">&#125;</span> 触发事件 ON　表名</pre></td></tr><tr><td data-num=3></td><td><pre>REFERENCING NEW | OLD ROW AS 变量</pre></td></tr><tr><td data-num=4></td><td><pre>FOR EACH<span class="token punctuation">&#123;</span>ROW | STATEMENT<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">[</span>WHEN 触发条件<span class="token punctuation">]</span> 触发动作体</pre></td></tr></table></figure><ul><li><p><strong>触发器名</strong> - 触发器名可以包含模式名，也可不包含模式名。同一模式下，触发器名必须是唯一的。触发器名和表名必须在同一模式下</p></li><li><p><strong>表名</strong> - 触发器只能定义在基本表，不能定义在视图上。当基本表的数据发生变化时，将激活定义在该表上相应触发事件的触发器</p></li><li><p><strong>触发事件</strong> - INSERT，DELETE或UPDATE，也可以是这几个事件的组合</p></li><li><p><strong>UPDATE OF 触发列</strong> - 即进一步指明修改哪些列时激活触发器</p></li><li><p><strong>AFTER/BEFORE是触发的时机</strong></p><ul><li><p>AFTER表示在触发事件的操作执行之后激活触发器</p></li><li><p>BEFORE表示在触发事件的操作执行之前激活触发器</p></li></ul></li></ul><h4 id=触发器类型><a class=anchor href=#触发器类型>#</a> 触发器类型</h4><p>行级触发器(FOR EACH ROW)和语句级触发器(FOR EACH STATEMENT)。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 在上例建立TEACHER时，表上创建一个AFTER UPDATE触发器，触发事件是UPDATE语句 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">UPDATE</span> TEACHER <span class="token keyword">SET</span> Deptno <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">假设表TEACHER有1000行，</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">如果是语句级触发器，那么执行完该语句后，触发动作只发生一次。</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">如果是行级触发器，触发动作将执行1000次。</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">*/</span></pre></td></tr></table></figure><h4 id=触发条件><a class=anchor href=#触发条件>#</a> 触发条件</h4><p>触发器被激活时，只有当触发条件为真时触发动作体才执行；否则触发动作体不执行。</p><p>如果省略WHEN触发条件，则触发动作体在触发器激活后立即执行。</p><h4 id=触发动作体><a class=anchor href=#触发动作体>#</a> 触发动作体</h4><p>触发动作体可以是一个匿名PL/SQL过程块，也可以是对已创建存储过程的调用。</p><p>如果是行级触发器，用户都可以在过程体中使用NEW和OLD引用事件之后的新值和事件之前的旧值。</p><p>如果是语句级触发器，则不能在触发动作体中使用NEW或OLD进行引用。</p><p>如果触发动作体执行失败，激活触发器的事件就会终止执行，触发器的目标表或触发器可能影响的其他对象不发生任何变化。</p><p>不同的RDBMS产品触发器语法各不相同。</p><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 当对表SC的Grade属性进行修改时，若分数增加了10%则将此次操作记录到下面表中 */</span></pre></td></tr><tr><td data-num=2></td><td><pre>SC_U<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">,</span>Oldgrade<span class="token punctuation">,</span>Newgrad<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/* 其中Oldgrade是修改前的分数，newgrade是修改后的分数 */</span></pre></td></tr></table></figure><h4 id=设计触发器><a class=anchor href=#设计触发器>#</a> 设计触发器</h4><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> SC_T</pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">AFTER</span> <span class="token keyword">UPDATE</span> <span class="token keyword">OF</span> Grade <span class="token keyword">ON</span> SC</pre></td></tr><tr><td data-num=3></td><td><pre>REFERENCING</pre></td></tr><tr><td data-num=4></td><td><pre>OLD <span class="token keyword">row</span> <span class="token keyword">AS</span> OldTuple<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>NEW <span class="token keyword">row</span> <span class="token keyword">AS</span> NewTuple</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">FOR EACH ROW</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">WHEN</span><span class="token punctuation">(</span>NewTuple<span class="token punctuation">.</span>Grade <span class="token operator">>=</span> <span class="token number">1.1</span> <span class="token operator">*</span> OldTuple<span class="token punctuation">.</span>Grade<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SC_U<span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">,</span>OldGrade<span class="token punctuation">,</span>NewGrade<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">VALUES</span><span class="token punctuation">(</span>OldTuple<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>OldTuple<span class="token punctuation">.</span>Cno<span class="token punctuation">,</span>OldTuple<span class="token punctuation">.</span>Grade<span class="token punctuation">,</span>NewTuple<span class="token punctuation">.</span>Grade<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight sql"><figcaption data-lang=SQL></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/* 将每次对表Student的插入操作所增加的学生个数记录到表StudentInsertLog中 */</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> Student_Count</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> Student</pre></td></tr><tr><td data-num=4></td><td><pre>REFERENCING</pre></td></tr><tr><td data-num=5></td><td><pre>NEW <span class="token keyword">TABLE</span> <span class="token keyword">AS</span> DELTA</pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">FOR</span> EACH STATEMENT</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> StudentInsertLog<span class="token punctuation">(</span>Numbers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> DELTA<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/* </span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">定义BEFORE行级触发器，为教师表Teacher定义完整性，</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">教授工资不得低于4000元，如果低于4000元，自动改为4000元</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> Insert_Or_Update_Sal</pre></td></tr><tr><td data-num=15></td><td><pre>BEFORE <span class="token keyword">INSERT</span> <span class="token operator">OR</span> <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> Teacher</pre></td></tr><tr><td data-num=16></td><td><pre>BEFERENCING NEW <span class="token keyword">row</span> <span class="token keyword">AS</span> newTuple</pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">FOR EACH ROW</span> <span class="token comment">/* 行级触发器 */</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">BEGIN</span> <span class="token comment">/* 定义触发动作体，是PL/SQL过程块 */</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">IF</span><span class="token punctuation">(</span>new<span class="token punctuation">.</span>Job <span class="token operator">=</span> <span class="token string">'教授'</span><span class="token punctuation">)</span> <span class="token operator">AND</span><span class="token punctuation">(</span>new<span class="token punctuation">.</span>Sal <span class="token operator">&lt;</span> <span class="token number">4000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">THEN</span> new<span class="token punctuation">.</span>Sal:<span class="token operator">=</span><span class="token number">4000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">END</span>:</pre></td></tr></table></figure><h4 id=激活触发器><a class=anchor href=#激活触发器>#</a> 激活触发器</h4><p>触发器的执行，是由触发事件激活的，并由数据库服务器自动执行。</p><p>一个数据表上可能定义了多个触发器，遵循如下的执行顺序</p><ul><li><p>执行该表上的BEFORE触发器</p></li><li><p>激活触发器的SQL语句</p></li><li><p>执行该表上的AFTER触发器</p></li></ul><h4 id=删除触发器><a class=anchor href=#删除触发器>#</a> 删除触发器</h4><p>删除触发器的SQL语法</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>DROP TRIGGER 触发器名 ON　表名</pre></td></tr></table></figure><p>触发器必须是一个已经创建的触发器，并且只能由具有相应权限的用户删除。</p><h2 id=ormobject-relational-mapping思想><a class=anchor href=#ormobject-relational-mapping思想>#</a> !ORM(Object-Relational Mapping)思想</h2><p>ORM(对象关系映射)是一种编程思想和技术，用于在关系型数据库和面向对象编程语言之间建立映射关系，从而实现数据的持久化。ORM的目标是通过将数据库中的表映射到编程语言中的对象，使开发者能够通过面向对象的方式操作数据库，而不必直接使用SQL查询语言。</p><p><strong>主要特点和原则</strong></p><ul><li><p><strong>对象和表的映射</strong> - ORM将数据库中的表映射为编程语言中的对象，每个对象对应数据库中的一行记录。这使得开发者可以使用面向对象的思维方式来处理数据</p></li><li><p><strong>属性和字段的映射</strong> - 对象的属性映射到表中的字段，这样就可以通过对象的属性来访问和修改数据库中的数据。例如，一个名为<code>User</code>的对象可能有<code>id</code>、<code>username</code>、<code>email</code>等属性，分别对应数据库表中的列</p></li><li><p><strong>关系映射</strong> - ORM能够处理对象之间的关系，包括一对一、一对多和多对多等关系。这使得开发者可以通过对象的关系来进行数据库查询和操作，而不必直接处理复杂的关系型数据库操作</p></li><li><p><strong>数据操作的抽象层</strong> - ORM提供了一个抽象层，使开发者能够使用面向对象的语法进行数据库操作，而不必关心具体的数据库实现细节。这提高了代码的可维护性和可移植性</p></li><li><p><strong>自动化的数据库操作</strong> - ORM通常提供自动化的数据库操作，包括数据的CRUD(创建、读取、更新、删除)操作。开发者不必手动编写SQL语句，而是通过调用对象的方法来实现数据库操作</p></li><li><p><strong>性能优化</strong> - ORM框架通常会提供一些性能优化的机制，例如缓存、延迟加载等，以提高应用程序对数据库的访问效率</p></li><li><p><strong>跨数据库支持</strong> - 由于ORM将数据库操作抽象化，因此应用程序更容易实现对不同数据库系统的支持，而不必修改大量的代码</p></li></ul><p>常见的ORM框架包括Hibernate(Java)、Django ORM(Python)、Entity Framework(.NET)、Rails ActiveRecord(Ruby)等。这些框架都遵循上述的ORM思想，但具体实现和语法可能有所不同。</p><div class=tags><a href=/tags/database/ rel=tag><i class="ic i-tag"></i> 数据库</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span> <span class=text>更新于</span> <time title="修改时间：2025-09-19 22:24:59" itemprop=dateModified datetime=2025-09-19T22:24:59+08:00>2025-09-19</time></span><span class=item data-path=/computer-science/programming/database/sql/ title=阅读次数><span class=icon><i class="ic i-eye"></i></span> <span class=text>阅读次数</span><span class=waline-pageview-count></span> <span class=text>次</span></span></div><div id=copyright><ul><li class=author><strong>本文作者：</strong> ReverseSacle <i class="ic i-at"><em>@</em></i>逆转天平</li><li class=link><strong>本文链接：</strong> <a href=https://www.reversesacle.com/computer-science/programming/database/sql/ title=关系数据库标准语言SQL>https://www.reversesacle.com/computer-science/programming/database/sql/</a></li><li class=license><strong>版权声明：</strong> 本站所有文章除特别声明外，均采用 <span class=exturl data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class=post-nav><div class="item left"><a href=/computer-science/programming/database/theory/ itemprop=url rel=prev data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg3.webp title=数据库基础理论><span class=type>上一篇</span><span class=category><i class="ic i-flag"></i> 数据库</span><h3>数据库基础理论</h3></a></div><div class="item right"><a href=/computer-science/programming/database/programming/ itemprop=url rel=next data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg19.webp title=数据库编程基础><span class=type>下一篇</span><span class=category><i class="ic i-flag"></i> 数据库</span><h3>数据库编程基础</h3></a></div></div><div class=wrap id=comments><div id=waline-comment></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=文章目录><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A6%82%E8%BF%B0><span class=toc-number>1.</span> <span class=toc-text>概述</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#sql%E5%9F%BA%E7%A1%80%E6%A6%82%E8%BF%B0><span class=toc-number>2.</span> <span class=toc-text>!SQL基础概述</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5><span class=toc-number>2.1.</span> <span class=toc-text>基本概念</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#sql%E7%9A%84%E7%89%B9%E7%82%B9><span class=toc-number>2.2.</span> <span class=toc-text>SQL的特点</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%93%8D%E4%BD%9C><span class=toc-number>2.3.</span> <span class=toc-text>核心功能操作</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#sql%E5%88%86%E7%B1%BB><span class=toc-number>2.4.</span> <span class=toc-text>SQL分类</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#sql%E8%AF%AD%E6%B3%95><span class=toc-number>2.5.</span> <span class=toc-text>SQL语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%9A%E4%B9%89><span class=toc-number>3.</span> <span class=toc-text>数据的定义</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B><span class=toc-number>4.</span> <span class=toc-text>数据类型</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%BC%8F><span class=toc-number>5.</span> <span class=toc-text>定义模式</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%9A%E4%B9%89%E5%9F%BA%E6%9C%AC%E8%A1%A8table><span class=toc-number>6.</span> <span class=toc-text>!定义基本表(TABLE)</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%BA%A6%E6%9D%9Fconstraint><span class=toc-number>7.</span> <span class=toc-text>约束(CONSTRAINT)</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A8%A1%E5%BC%8F%E4%B8%8E%E8%A1%A8><span class=toc-number>8.</span> <span class=toc-text>!模式与表</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%A1%A8><span class=toc-number>8.1.</span> <span class=toc-text>创建基本表</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BF%AE%E6%94%B9%E5%9F%BA%E6%9C%AC%E8%A1%A8><span class=toc-number>8.2.</span> <span class=toc-text>修改基本表</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%A0%E9%99%A4%E5%9F%BA%E6%9C%AC%E8%A1%A8><span class=toc-number>8.3.</span> <span class=toc-text>删除基本表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%B4%A2%E5%BC%95index><span class=toc-number>9.</span> <span class=toc-text>!索引(INDEX)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95><span class=toc-number>9.1.</span> <span class=toc-text>建立索引</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95><span class=toc-number>9.2.</span> <span class=toc-text>删除索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8><span class=toc-number>10.</span> <span class=toc-text>数据字典</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2><span class=toc-number>11.</span> <span class=toc-text>!数据查询</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2><span class=toc-number>11.1.</span> <span class=toc-text>单表查询</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E9%80%89%E6%8B%A9%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8B%A5%E5%B9%B2%E5%88%97><span class=toc-number>11.1.1.</span> <span class=toc-text>选择表中的若干列</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E9%80%89%E6%8B%A9%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8B%A5%E5%B9%B2%E5%85%83%E7%BB%84%E8%A1%8C><span class=toc-number>11.1.2.</span> <span class=toc-text>选择表中的若干元组(行)</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%9F%A5%E8%AF%A2%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6%E7%9A%84%E5%85%83%E7%BB%84><span class=toc-number>11.1.3.</span> <span class=toc-text>查询满足条件的元组</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%A4%9A%E9%87%8D%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2><span class=toc-number>11.1.4.</span> <span class=toc-text>多重条件查询</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#order-by%E5%AD%90%E5%8F%A5><span class=toc-number>11.1.5.</span> <span class=toc-text>ORDER BY子句</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0><span class=toc-number>11.1.6.</span> <span class=toc-text>聚集函数</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#group-by%E5%AD%90%E5%8F%A5><span class=toc-number>11.1.7.</span> <span class=toc-text>GROUP BY子句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2><span class=toc-number>11.2.</span> <span class=toc-text>连接查询</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E7%AD%89%E5%80%BC%E4%B8%8E%E9%9D%9E%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2><span class=toc-number>11.2.1.</span> <span class=toc-text>等值与非等值连接查询</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%87%AA%E8%BA%AB%E8%BF%9E%E6%8E%A5><span class=toc-number>11.2.2.</span> <span class=toc-text>自身连接</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%A4%96%E8%BF%9E%E6%8E%A5><span class=toc-number>11.2.3.</span> <span class=toc-text>外连接</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5><span class=toc-number>11.2.4.</span> <span class=toc-text>多表连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2><span class=toc-number>11.3.</span> <span class=toc-text>嵌套查询</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%B8%A6%E6%9C%89in%E8%B0%93%E8%AF%8D%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2><span class=toc-number>11.3.1.</span> <span class=toc-text>带有IN谓词的子查询</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%B8%A6%E6%9C%89%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2><span class=toc-number>11.3.2.</span> <span class=toc-text>带有比较运算符的子查询</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%B8%A6%E6%9C%89anysome%E6%88%96all%E8%B0%93%E8%AF%8D%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2><span class=toc-number>11.3.3.</span> <span class=toc-text>带有ANY(SOME)或ALL谓词的子查询</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%B8%A6%E6%9C%89exists%E8%B0%93%E8%AF%8D%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2><span class=toc-number>11.3.4.</span> <span class=toc-text>带有EXISTS谓词的子查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%9B%86%E5%90%88%E6%9F%A5%E8%AF%A2><span class=toc-number>11.4.</span> <span class=toc-text>集合查询</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%B9%B6%E6%93%8D%E4%BD%9Cunion%E7%9B%B8%E5%BD%93%E4%BA%8Eor><span class=toc-number>11.4.1.</span> <span class=toc-text>!并操作UNION(相当于OR)</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E4%BA%A4%E6%93%8D%E4%BD%9Cintersect%E7%9B%B8%E5%BD%93%E4%BA%8Eand><span class=toc-number>11.4.2.</span> <span class=toc-text>交操作INTERSECT(相当于AND)</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%B7%AE%E6%93%8D%E4%BD%9Cexcept><span class=toc-number>11.4.3.</span> <span class=toc-text>差操作EXCEPT</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%BA%E4%BA%8E%E6%B4%BE%E7%94%9F%E8%A1%A8%E7%9A%84%E6%9F%A5%E8%AF%A2><span class=toc-number>11.5.</span> <span class=toc-text>基于派生表的查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0><span class=toc-number>12.</span> <span class=toc-text>!数据更新</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE><span class=toc-number>12.1.</span> <span class=toc-text>插入数据</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%8F%92%E5%85%A5%E5%85%83%E7%BB%84><span class=toc-number>12.1.1.</span> <span class=toc-text>插入元组</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%8F%92%E5%85%A5%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C><span class=toc-number>12.1.2.</span> <span class=toc-text>插入子查询结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE><span class=toc-number>12.2.</span> <span class=toc-text>修改数据</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE><span class=toc-number>12.3.</span> <span class=toc-text>删除数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%A9%BA%E5%80%BC%E7%9A%84%E5%A4%84%E7%90%86><span class=toc-number>13.</span> <span class=toc-text>空值的处理</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%A9%BA%E5%80%BC%E7%9A%84%E4%BA%A7%E7%94%9F><span class=toc-number>13.1.</span> <span class=toc-text>空值的产生</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%A9%BA%E5%80%BC%E7%9A%84%E5%88%A4%E6%96%AD><span class=toc-number>13.2.</span> <span class=toc-text>空值的判断</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%A9%BA%E5%80%BC%E7%9A%84%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6><span class=toc-number>13.3.</span> <span class=toc-text>空值的约束条件</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%A9%BA%E5%80%BC%E7%9A%84%E7%AE%97%E6%9C%AF%E6%AF%94%E8%BE%83%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97><span class=toc-number>13.4.</span> <span class=toc-text>空值的算术&#x2F;比较&#x2F;逻辑运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BEview><span class=toc-number>14.</span> <span class=toc-text>定义视图(VIEW)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A6%82%E8%BF%B0-2><span class=toc-number>14.1.</span> <span class=toc-text>!概述</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%BB%BA%E7%AB%8B%E8%A7%86%E5%9B%BE><span class=toc-number>14.2.</span> <span class=toc-text>!建立视图</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE><span class=toc-number>14.3.</span> <span class=toc-text>删除视图</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%A7%86%E5%9B%BE%E6%9F%A5%E8%AF%A2><span class=toc-number>14.4.</span> <span class=toc-text>视图查询</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#rdbms%E5%AE%9E%E7%8E%B0%E8%A7%86%E5%9B%BE%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%96%B9%E6%B3%95-%E8%A7%86%E5%9B%BE%E6%B6%88%E8%A7%A3%E6%B3%95><span class=toc-number>14.4.1.</span> <span class=toc-text>RDBMS实现视图查询的方法 - 视图消解法</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%A7%86%E5%9B%BE%E6%B6%88%E8%A7%A3%E6%B3%95%E7%9A%84%E5%B1%80%E9%99%90><span class=toc-number>14.4.2.</span> <span class=toc-text>视图消解法的局限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%A7%86%E5%9B%BE%E6%9B%B4%E6%96%B0><span class=toc-number>14.5.</span> <span class=toc-text>视图更新</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BD%9C%E7%94%A8><span class=toc-number>14.6.</span> <span class=toc-text>!视图的作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B><span class=toc-number>15.</span> <span class=toc-text>!存储过程</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%B8%B8%E6%A0%87cursor><span class=toc-number>16.</span> <span class=toc-text>!游标(cursor)</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%B0%E5%BA%93%E5%AE%89%E5%85%A8%E6%80%A7><span class=toc-number>17.</span> <span class=toc-text>数库安全性</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%8D%E5%AE%89%E5%85%A8%E5%9B%A0%E7%B4%A0><span class=toc-number>17.1.</span> <span class=toc-text>数据库的不安全因素</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8%E6%80%A7%E6%8E%A7%E5%88%B6><span class=toc-number>17.2.</span> <span class=toc-text>数据库安全性控制</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%8E%88%E6%9D%83%E6%8E%88%E4%BA%88%E4%B8%8E%E5%9B%9E%E6%94%B6><span class=toc-number>17.3.</span> <span class=toc-text>授权(授予与回收)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%9D%83%E9%99%90><span class=toc-number>17.4.</span> <span class=toc-text>创建数据库模式的权限</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A7%92%E8%89%B2><span class=toc-number>17.5.</span> <span class=toc-text>数据库角色</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%A7%86%E5%9B%BE%E6%9C%BA%E5%88%B6><span class=toc-number>17.6.</span> <span class=toc-text>视图机制</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%A1%E8%AE%A1audit><span class=toc-number>17.7.</span> <span class=toc-text>审计(Audit)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86><span class=toc-number>17.8.</span> <span class=toc-text>数据加密</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%AD%98%E5%82%A8%E5%8A%A0%E5%AF%86><span class=toc-number>17.8.1.</span> <span class=toc-text>存储加密</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E4%BC%A0%E8%BE%93%E5%8A%A0%E5%AF%86><span class=toc-number>17.8.2.</span> <span class=toc-text>传输加密</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%8F%AF%E4%BF%A1%E4%BC%A0%E8%BE%93><span class=toc-number>17.8.3.</span> <span class=toc-text>数据库管理系统可信传输</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%85%B6%E4%BB%96%E5%AE%89%E5%85%A8%E6%80%A7%E4%BF%9D%E6%8A%A4><span class=toc-number>17.9.</span> <span class=toc-text>其他安全性保护</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%8C%E6%95%B4%E6%80%A7><span class=toc-number>18.</span> <span class=toc-text>数据库完整性</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8%E5%AE%8C%E6%95%B4%E6%80%A7%E6%96%B9%E9%9D%A2%E5%BA%94%E5%85%B7%E5%A4%87%E7%9A%84%E5%8A%9F%E8%83%BD><span class=toc-number>18.1.</span> <span class=toc-text>!数据库在完整性方面应具备的功能</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%9E%E4%BD%93%E5%AE%8C%E6%95%B4%E6%80%A7%E5%AE%9A%E4%B9%89><span class=toc-number>18.2.</span> <span class=toc-text>实体完整性定义</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7><span class=toc-number>18.3.</span> <span class=toc-text>参照完整性</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7><span class=toc-number>18.4.</span> <span class=toc-text>用户定义的完整性</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%B1%9E%E6%80%A7%E4%B8%8A%E7%9A%84%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6><span class=toc-number>18.5.</span> <span class=toc-text>属性上的约束条件</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%85%83%E7%BB%84%E4%B8%8A%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6><span class=toc-number>18.6.</span> <span class=toc-text>元组上约束条件</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F%E5%91%BD%E5%90%8D%E5%AD%90%E5%8F%A5><span class=toc-number>18.7.</span> <span class=toc-text>完整性约束命名子句</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BF%AE%E6%94%B9%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E9%99%90%E5%88%B6><span class=toc-number>18.8.</span> <span class=toc-text>修改表中的完整性限制</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%9F%E4%B8%AD%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E9%99%90%E5%88%B6><span class=toc-number>18.9.</span> <span class=toc-text>域中的完整性限制</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%9B%E5%BB%BA%E6%96%AD%E8%A8%80%E7%9A%84%E8%AF%AD%E5%8F%A5%E6%A0%BC%E5%BC%8F><span class=toc-number>18.10.</span> <span class=toc-text>创建断言的语句格式</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%A7%A6%E5%8F%91%E5%99%A8trigger><span class=toc-number>18.11.</span> <span class=toc-text>!触发器(Trigger)</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%AE%9A%E4%B9%89%E8%A7%A6%E5%8F%91%E5%99%A8><span class=toc-number>18.11.1.</span> <span class=toc-text>定义触发器</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%B1%BB%E5%9E%8B><span class=toc-number>18.11.2.</span> <span class=toc-text>触发器类型</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6><span class=toc-number>18.11.3.</span> <span class=toc-text>触发条件</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%A7%A6%E5%8F%91%E5%8A%A8%E4%BD%9C%E4%BD%93><span class=toc-number>18.11.4.</span> <span class=toc-text>触发动作体</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%AE%BE%E8%AE%A1%E8%A7%A6%E5%8F%91%E5%99%A8><span class=toc-number>18.11.5.</span> <span class=toc-text>设计触发器</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%BF%80%E6%B4%BB%E8%A7%A6%E5%8F%91%E5%99%A8><span class=toc-number>18.11.6.</span> <span class=toc-text>激活触发器</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8><span class=toc-number>18.11.7.</span> <span class=toc-text>删除触发器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#ormobject-relational-mapping%E6%80%9D%E6%83%B3><span class=toc-number>19.</span> <span class=toc-text>!ORM(Object-Relational Mapping)思想</span></a></li></ol></div><div class="related panel pjax" data-title=系列文章><ul><li><a href=/computer-science/programming/database/theory/ rel=bookmark title=数据库基础理论>数据库基础理论</a></li><li class=active><a href=/computer-science/programming/database/sql/ rel=bookmark title=关系数据库标准语言SQL>关系数据库标准语言SQL</a></li><li><a href=/computer-science/programming/database/programming/ rel=bookmark title=数据库编程基础>数据库编程基础</a></li><li><a href=/computer-science/programming/database/mysql/mspart1/ rel=bookmark title=MySQL数据库基础-第一部分>MySQL数据库基础-第一部分</a></li><li><a href=/computer-science/programming/database/mysql/mspart2/ rel=bookmark title=MySQL数据库基础-第二部分>MySQL数据库基础-第二部分</a></li></ul></div><div class="overview panel" data-title=站点概览><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img class=image itemprop=image alt=ReverseSacle data-src=/images/avatar.webp><p class=name itemprop=name>ReverseSacle</p><div class=description itemprop=description>知识书库 & 学习点滴</div></div><nav class=state><div class="item posts"><a href=/archives/ ><span class=count>186</span> <span class=name>文章</span></a></div><div class="item categories"><a href=/categories/ ><span class=count>52</span> <span class=name>分类</span></a></div><div class="item tags"><a href=/tags/ ><span class=count>18</span> <span class=name>标签</span></a></div></nav><div class=social><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JldmVyc2VTYWNsZQ==" title=https:&#x2F;&#x2F;github.com&#x2F;ReverseSacle><i class="ic i-github"></i></span><span class="exturl item email" data-url="bWFpbHRvOnByaXZhdGVAcmV2ZXJzZXNhY2xlLmNvbQ==" title=mailto:private@reversesacle.com><i class="ic i-envelope"></i></span></div><ul class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i> 首页</a></li><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-feather"></i> 文章</a><ul class=submenu><li class=item><a href=/archives/ rel=section><i class="ic i-list-alt"></i> 归档</a></li><li class=item><a href=/categories/ rel=section><i class="ic i-th"></i> 分类</a></li><li class=item><a href=/tags/ rel=section><i class="ic i-tags"></i> 标签</a></li></ul></li><li class=item><a href=/about/ rel=section><i class="ic i-user"></i> 关于</a></li><li class=item><a href=/friend-links/ rel=section><i class="ic i-heart"></i> 友链</a></li></ul></div></div></div><ul id=quick><li class="prev pjax"><a href=/computer-science/programming/database/theory/ rel=prev title=上一篇><i class="ic i-chevron-left"></i></a></li><li class=up><i class="ic i-arrow-up"></i></li><li class=down><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href=/computer-science/programming/database/programming/ rel=next title=下一篇><i class="ic i-chevron-right"></i></a></li><li class=percent></li></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>随机文章</h2><ul><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/graph/ title="分类于 图">图</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/graph/trick/ title=图相关技巧>图相关技巧</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/seqlist/ title="分类于 顺序表">顺序表</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/seqlist/trick/ title=顺序表基础技巧>顺序表基础技巧</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/seqlist/ title="分类于 顺序表">顺序表</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/seqlist/duplicates/ title=顺序表-重复项>顺序表-重复项</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/binary-tree/ title="分类于 二叉树">二叉树</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/binary-tree/trick/ title=二叉树基础技巧>二叉树基础技巧</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/web/ title="分类于 web">web</a></div><span><a href=/computer-science/programming/web/nginx/ title=Nginx基础>Nginx基础</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/network-programming/ title="分类于 网络编程">网络编程</a></div><span><a href=/computer-science/programming/network-programming/Linux-basic/ title="Linux基础(CentOS 7)">Linux基础(CentOS 7)</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/database/ title="分类于 数据库">数据库</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/database/mysql/ title="分类于 MySQL">MySQL</a></div><span><a href=/computer-science/programming/database/mysql/mspart2/ title=MySQL数据库基础-第二部分>MySQL数据库基础-第二部分</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/network-programming/ title="分类于 网络编程">网络编程</a></div><span><a href=/computer-science/programming/network-programming/gdb-debugging-tool/ title=GDB调试工具>GDB调试工具</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/algorithm/ title="分类于 算法">算法</a></div><span><a href=/computer-science/programming/algorithm/math/sieve-of-eratosthenes/ title=埃拉托斯特尼筛法>埃拉托斯特尼筛法</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/shoka-theme/ title="分类于 Shoka主题">Shoka主题</a></div><span><a href=/computer-science/shoka-theme/another/ title=额外添加配置>额外添加配置</a></span></li></ul></div><div><h2>最新评论</h2><ul id=waline-recent></ul></div></div><div class=status><div class=copyright>&copy; 2021 – <span itemprop=copyrightYear>2025</span><span class=with-love><i class="ic i-sakura rotate"></i></span> <span class=author itemprop=copyrightHolder>ReverseSacle @ ReverseSacle-Blog</span></div><div class=count><i class="ic i-clock" aria-hidden=true></i> <span id=time align=center>载入时间中...<script defer>var now=new Date;function createtime(){var n=new Date("2021-11-16 22:30:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("time").innerHTML="已经过 "+dnum+" 天 "+hnum+" 小时 "+mnum+" 分 "+snum+" 秒 "}setInterval("createtime()",250)</script></span><span class=post-meta-item-icon>|&nbsp<i class="ic i-chart-area"></i></span> <span title=站点总字数>2.1m 字</span> <span class=post-meta-item-icon>|&nbsp<i class="ic i-coffee"></i></span> <span title=站点阅读时长>40:40</span></div></div></div></footer></div><script data-config>var LOCAL={path:"computer-science/programming/database/sql/",favicon:{show:"ReverseSacle-Blog",hide:"ReverseSacle-Blog"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},waline:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src=https://polyfill.alicdn.com/v3/polyfill.min.js></script><script src=https://cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1.16.0/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js></script><script src=/js/app.js></script></body></html>