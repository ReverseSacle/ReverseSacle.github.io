<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#222><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/ico sizes=48x48 href=/images/favicon.ico><link rel=alternate type=application/rss+xml title=逆转天平 href=https://www.reversesacle.com/rss.xml><link rel=alternate type=application/atom+xml title=逆转天平 href=https://www.reversesacle.com/atom.xml><link rel=alternate type=application/json title=逆转天平 href=https://www.reversesacle.com/feed.json><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=/css/app.css><meta name=description content=网络编程><link rel=canonical href=https://www.reversesacle.com/computer-science/programming/network-programming/http/ ><title>HTTP网络通信基础 - 网络编程 - 编程 - 计算机科学 | ReverseSacle-Blog</title><meta name=generator content="Hexo 6.3.0"></head><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=dotloader><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">HTTP网络通信基础</h1><div class=meta><span class=item title="创建时间：2023-09-06 23:23:35"><span class=icon><i class="ic i-calendar"></i></span> <span class=text>发表于</span> <time itemprop="dateCreated datePublished" datetime=2023-09-06T23:23:35+08:00>2023-09-06</time></span><span class=item title=本文字数><span class=icon><i class="ic i-pen"></i></span> <span class=text>本文字数</span> <span>19k</span> <span class=text>字</span></span><span class=item title=阅读时长><span class=icon><i class="ic i-clock"></i></span> <span class=text>阅读时长</span> <span>22 分钟</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div class=lines role=navigation aria-label=切换导航栏><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>ReverseSacle-Blog</a></li></ul><ul class=right><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id=imgs class=pjax><ul><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg3.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg21.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg6.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg5.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg11.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg10.webp></li></ul></div></header><div id=waves><svg class=waves xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewBox="0 24 150 28" preserveAspectRatio=none shape-rendering=auto><defs><path id=gentle-wave d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352z"/></defs><g class=parallax><use xlink:href=#gentle-wave x=48 y=0 /><use xlink:href=#gentle-wave x=48 y=3 /><use xlink:href=#gentle-wave x=48 y=5 /><use xlink:href=#gentle-wave x=48 y=7 /></g></svg></div><main><div class=inner><div id=main class=pjax><div class="article wrap"><div class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i> <span><a href=/ >首页</a></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/ itemprop=item rel=index title="分类于 计算机科学"><span itemprop=name>计算机科学</span></a><meta itemprop=position content=1></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/ itemprop=item rel=index title="分类于 编程"><span itemprop=name>编程</span></a><meta itemprop=position content=2></span><i class="ic i-angle-right"></i> <span class=current itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/network-programming/ itemprop=item rel=index title="分类于 网络编程"><span itemprop=name>网络编程</span></a><meta itemprop=position content=3></span></div><article itemscope itemtype=http://schema.org/Article class="post block" lang=zh-CN><link itemprop=mainEntityOfPage href=https://www.reversesacle.com/computer-science/programming/network-programming/http/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.webp><meta itemprop=name content=ReverseSacle><meta itemprop=description content="所见即所得，所思即所行, 知识书库 & 学习点滴"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=逆转天平></span><div class="body md" itemprop=articleBody><h2 id=概述><a class=anchor href=#概述>#</a> 概述</h2><p>实现一个http服务器项目，服务器启动后监听80端口的tcp连接，当用户通过任意一款浏览器访问http服务器时，http服务器会查找用户访问的html页面是否存在，如果存在则通过http协议响应客户端的请求并把页面返回给浏览器，浏览器显示html页面；如果页面不存在，则按照http协议的规定，通知浏览器此页面不存在。</p><h2 id=httphttps><a class=anchor href=#httphttps>#</a> HTTP/HTTPS</h2><p><strong>HTTP(超文本传输协议)</strong></p><ul><li>HTTP是一种用于传输超媒体文档(例如HTML)的应用层协议。它构建在TCP/IP协议之上，主要用于Web浏览器和服务器之间的通信</li><li>HTTP工作在客户端-服务器架构上。用户的Web浏览器(客户端)会发起请求到服务器，服务器处理请求并返回响应</li><li>HTTP定义了一系列的请求方法，常见的包括GET、POST、PUT、DELETE等</li></ul><p><strong>HTTP请求方法</strong></p><table><thead><tr><th style=text-align:left>方法</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left><strong>GET</strong></td><td style=text-align:left>请求指定的页面信息，并返回实体主体。用于获取资源而不会影响资源状态</td></tr><tr><td style=text-align:left><strong>POST</strong></td><td style=text-align:left>向指定资源提交数据进行处理请求(例如提交表单或者上传文件)。数据包含在请求体中。POST请求可能会导致新的资源的建立或已有资源的修改</td></tr><tr><td style=text-align:left><strong>PUT</strong></td><td style=text-align:left>从客户端向服务器传送的数据取代指定的文档的内容</td></tr><tr><td style=text-align:left><strong>DELETE</strong></td><td style=text-align:left>请求服务器删除指定的页面</td></tr><tr><td style=text-align:left><strong>HEAD</strong></td><td style=text-align:left>类似于GET方法，但服务器将不返回实体的主体部分，用于获取报头</td></tr><tr><td style=text-align:left><strong>OPTIONS</strong></td><td style=text-align:left>允许客户端查看服务器的性能</td></tr><tr><td style=text-align:left><strong>PATCH</strong></td><td style=text-align:left>对资源进行部分修改</td></tr><tr><td style=text-align:left><strong>CONNECT</strong></td><td style=text-align:left>通常用于SSL加密服务器的通信以及代理服务器</td></tr><tr><td style=text-align:left><strong>TRACE</strong></td><td style=text-align:left>回显服务器收到的请求，主要用于测试或诊断</td></tr></tbody></table><details class=info><summary>URI和URL的区别是什么？</summary><div><ul><li>URI(Uniform Resource Identifier) - 是统一资源标志符，可以唯一标识一个资源</li><li>URL(Uniform Resource Locator) - 是统一资源定位符，可以提供该资源的路径。它是一种具体的 URI，即 URL 可以用来标识一个资源，而且还指明了如何 locate 这个资源</li></ul><p>URI 的作用像身份证号一样，URL 的作用更像家庭住址一样。URL 是一种具体的 URI，它不仅唯一标识资源，而且还提供了定位该资源的信息。</p></div></details><details class=info><summary>GET和POST的区别？</summary><div><p>GET和POST是HTTP协议中两种常用的请求方法，它们在不同的场景和目的下有不同的特点和用法。一般来说，可以从以下几个方面来区分二者(重点搞清两者在语义上的区别即可)</p><ul><li><p>语义(主要区别) - GET通常用于获取或查询资源，而POST通常用于创建或修改资源</p></li><li><p>幂等 - GET请求是幂等的，即多次重复执行不会改变资源的状态，而POST请求是不幂等的，即每次执行可能会产生不同的结果或影响资源的状态</p></li><li><p>格式 - GET请求的参数通常放在URL中，形成查询字符串(querystring)，而POST请求的参数通常放在请求体(body)中，可以有多种编码格式，如 application/x-www-form-urlencoded、multipart/form-data、application/json 等。GET请求的URL长度受到浏览器和服务器的限制，而POST请求的body大小则没有明确的限制。不过，实际上GET请求也可以用body传输数据，只是并不推荐这样做，因为这样可能会导致一些兼容性或者语义上的问题</p></li><li><p>缓存 - 由于GET请求是幂等的，它可以被浏览器或其他中间节点(如代理、网关)缓存起来，以提高性能和效率。而POST请求则不适合被缓存，因为它可能有副作用，每次执行可能需要实时的响应</p></li><li><p>安全性 - GET请求和POST请求如果使用HTTP协议的话，那都不安全，因为HTTP协议本身是明文传输的，必须使用HTTPS协议来加密传输数据。另外，GET请求相比POST请求更容易泄露敏感数据，因为GET请求的参数通常放在URL中</p></li></ul><p>再次提示，重点搞清两者在语义上的区别即可，实际使用过程中，也是通过语义来区分使用GET还是POST。不过，也有一些项目所有的请求都用POST，这个并不是固定的，项目组达成共识即可。</p></div></details><details class=info><summary>常见的HTTP方法有哪些？</summary><div><ul><li><code>GET</code> - 用于请求访问已经被统一资源标识符URI识别的资源，可以通过URL传参给服务器</li><li><code>POST</code> - 用于传输信息给服务器，主要功能与<code>GET</code>方法类似，但一般推荐使用<code>POST</code></li><li><code>PUT</code> - 传输文件，报文主题中包含文件内容，保存到对应URI位置</li><li><code>HEAD</code> - 获得报文首部，与<code>GET</code>方法类似，只是不返回报文主体，一般用于验证URI是否有效</li><li><code>DELETE</code> - 删除文件，与<code>PUT</code>方法相反，删除对应URI位置的文件</li><li><code>OPTIONS</code> - 查询相应URI支持的HTTP方法</li></ul><p><span class=exturl data-url="aHR0cHM6Ly9qYXZhZ3VpZGUuY24vY3MtYmFzaWNzL25ldHdvcmsvbmV0d29yay1hdHRhY2stbWVhbnMuaHRtbA==">网络攻击常见手段总结</span></p></div></details><h2 id=http客户端请求报文><a class=anchor href=#http客户端请求报文>#</a> http客户端请求报文</h2><p>客户端发送一个HTTP请求到服务器的请求消息包括以下四个部分</p><ul><li>请求行(request line)</li><li>请求头部(header)</li><li>空行</li><li>请求数据</li></ul><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>请求方法 | 空格 | URL | 空格 | 协议版本 | 回车符 | 换行符		-【请求行】</pre></td></tr><tr><td data-num=2></td><td><pre>字段名 | : | 值 | 回车符 | 换行符		—|</pre></td></tr><tr><td data-num=3></td><td><pre>.............................	    |【请求头】</pre></td></tr><tr><td data-num=4></td><td><pre>字段名 | : | 值 | 回车符 | 换行符		-|</pre></td></tr><tr><td data-num=5></td><td><pre>回车符 | 换行符</pre></td></tr><tr><td data-num=6></td><td><pre>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx	-【请求数据】</pre></td></tr></table></figure><figure class="highlight tex"><figcaption data-lang=TeX><span>例子</span></figcaption><table><tr><td data-num=1></td><td><pre>GET /qiniu.html HTTP/1.1	-【拿 qiniu.html HTTP1.1版本】</pre></td></tr><tr><td data-num=2></td><td><pre>Accept: text/html, application/xhtml+xml, image/jxr, */*	-【可接收的文件类型】</pre></td></tr><tr><td data-num=3></td><td><pre>Accept-Language: zh-CN		-【可接收的文件语言类型】</pre></td></tr><tr><td data-num=4></td><td><pre>Accept-Encoding: gzip, deflate	-【接收时做压缩处理的类型】</pre></td></tr><tr><td data-num=5></td><td><pre>Host: 192.168.0.107		-【主机名，用于作验证】</pre></td></tr><tr><td data-num=6></td><td><pre>Connection: Keep-Alive	-【连接要求，该状态为持续连接】</pre></td></tr><tr><td data-num=7></td><td><pre>User-Agent: Mozilla/5.0(Windows NT 10.0: WOW64; Trident/7.0;rv:11.0) like </pre></td></tr><tr><td data-num=8></td><td><pre>Gecko Core/1.70.3766.400 QQBrowser/10.6.4163.400	-【用户代理，用来指定浏览器版本】</pre></td></tr></table></figure><p><strong>HTTP Header中常见的字段</strong></p><table><thead><tr><th style=text-align:left>请求头字段名</th><th style=text-align:left>说明</th><th style=text-align:left>示例</th></tr></thead><tbody><tr><td style=text-align:left>Accept</td><td style=text-align:left>能够接受的回应内容类型(Content-Types)</td><td style=text-align:left>Accept: text/plain</td></tr><tr><td style=text-align:left>Accept-Charset</td><td style=text-align:left>能够接受的字符集</td><td style=text-align:left>Accept-Charset: utf-8</td></tr><tr><td style=text-align:left>Accept-Datetime</td><td style=text-align:left>能够接受的按照时间来表示的版本</td><td style=text-align:left>Accept-Datetime: Thu, 31 May 2007 20:35:00 GMT</td></tr><tr><td style=text-align:left>Accept-Encoding</td><td style=text-align:left>能够接受的编码方式列表。参考HTTP压缩</td><td style=text-align:left>Accept-Encoding: gzip, deflate</td></tr><tr><td style=text-align:left>Accept-Language</td><td style=text-align:left>能够接受的回应内容的自然语言列表</td><td style=text-align:left>Accept-Language: en-US</td></tr><tr><td style=text-align:left>Authorization</td><td style=text-align:left>用于超文本传输协议的认证的认证信息</td><td style=text-align:left>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td style=text-align:left>Cache-Control</td><td style=text-align:left>用来指定在这次的请求/响应链中的所有缓存机制都必须遵守的指令</td><td style=text-align:left>Cache-Control: no-cache</td></tr><tr><td style=text-align:left>Connection</td><td style=text-align:left>该浏览器想要优先使用的连接类型</td><td style=text-align:left>Connection: keep-alive Connection: Upgrade</td></tr><tr><td style=text-align:left>Content-Length</td><td style=text-align:left>以八位字节数组 (8位的字节)表示的请求体的长度</td><td style=text-align:left>Content-Length: 348</td></tr><tr><td style=text-align:left>Content-MD5</td><td style=text-align:left>请求体的内容的二进制MD5散列值，以Base64编码的结果</td><td style=text-align:left>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</td></tr><tr><td style=text-align:left>Content-Type</td><td style=text-align:left>请求体的多媒体类型(用于POST和PUT请求中)</td><td style=text-align:left>Content-Type: application/x-www-form-urlencoded</td></tr><tr><td style=text-align:left>Cookie</td><td style=text-align:left>之前由服务器通过 Set- Cookie(下文详述)发送的一个 超文本传输协议 Cookie</td><td style=text-align:left>Cookie: $Version=1; Skin=new;</td></tr><tr><td style=text-align:left>Date</td><td style=text-align:left>发送该消息的日期和时间(按照RFC 7231中定义的&quot;超文本传输协议日期&quot;格式来发送)</td><td style=text-align:left>Date: Tue, 15 Nov 1994 08:12:31 GMT</td></tr><tr><td style=text-align:left>Expect</td><td style=text-align:left>表明客户端要求服务器做出特定的行为</td><td style=text-align:left>Expect: 100-continue</td></tr><tr><td style=text-align:left>From</td><td style=text-align:left>发起此请求的用户的邮件地址</td><td style=text-align:left>From: <code>user@example.com</code></td></tr><tr><td style=text-align:left>Host</td><td style=text-align:left>服务器的域名(用于虚拟主机 )，以及服务器所监听的传输控制协议端口号。如果所请求的端口是对应的服务的标准端口，则端口号可被省略</td><td style=text-align:left>Host: <code>en.wikipedia.org:80</code></td></tr><tr><td style=text-align:left>If-Match</td><td style=text-align:left>仅当客户端提供的实体与服务器上对应的实体相匹配时，才进行对应的操作。主要作用时，用作像 PUT 这样的方法中，仅当从用户上次更新某个资源以来，该资源未被修改的情况下，才更新该资源</td><td style=text-align:left>If-Modified-Since: Sat, 29 Oct 1994 19:43:31 GMT</td></tr><tr><td style=text-align:left>If-None-Match</td><td style=text-align:left>允许在对应的内容未被修改的情况下返回 304 未修改(304 Not Modified)</td><td style=text-align:left>If-None-Match: “737060cd8c284d8af7ad3082f209582d”</td></tr><tr><td style=text-align:left>If-Range</td><td style=text-align:left>如果该实体未被修改过，则向我发送我所缺少的那一个或多个部分；否则，发送整个新的实体</td><td style=text-align:left>If-Range: “737060cd8c284d8af7ad3082f209582d”</td></tr><tr><td style=text-align:left>If-Unmodified-Since</td><td style=text-align:left>仅当该实体自某个特定时间已来未被修改的情况下，才发送回应</td><td style=text-align:left>If-Unmodified-Since: Sat, 29 Oct 1994 19:43:31 GMT</td></tr><tr><td style=text-align:left>Max-Forwards</td><td style=text-align:left>限制该消息可被代理及网关转发的次数</td><td style=text-align:left>Max-Forwards: 10</td></tr><tr><td style=text-align:left>Origin</td><td style=text-align:left>发起一个针对 跨来源资源共享 的请求</td><td style=text-align:left>Origin: <code>http://www.example-social-network.com</code></td></tr><tr><td style=text-align:left>Pragma</td><td style=text-align:left>与具体的实现相关，这些字段可能在请求/回应链中的任何时候产生多种效果</td><td style=text-align:left>Pragma: no-cache</td></tr><tr><td style=text-align:left>Proxy-Authorization</td><td style=text-align:left>用来向代理进行认证的认证信息</td><td style=text-align:left>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td style=text-align:left>Range</td><td style=text-align:left>仅请求某个实体的一部分。字节偏移以 0 开始。参见字节服务</td><td style=text-align:left>Range: bytes=500-999</td></tr><tr><td style=text-align:left>Referer</td><td style=text-align:left>表示浏览器所访问的前一个页面，正是那个页面上的某个链接将浏览器带到了当前所请求的这个页面</td><td style=text-align:left>Referer: <code>http://en.wikipedia.org/wiki/Main_Page</code></td></tr><tr><td style=text-align:left>TE</td><td style=text-align:left>浏览器预期接受的传输编码方式- 可使用回应协议头 Transfer-Encoding 字段中的值</td><td style=text-align:left>TE: trailers, deflate</td></tr><tr><td style=text-align:left>Upgrade</td><td style=text-align:left>要求服务器升级到另一个协议</td><td style=text-align:left>Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</td></tr><tr><td style=text-align:left>User-Agent</td><td style=text-align:left>浏览器的浏览器身份标识字符串</td><td style=text-align:left>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:12.0) Gecko/20100101 Firefox/21.0</td></tr><tr><td style=text-align:left>Via</td><td style=text-align:left>向服务器告知，这个请求是由哪些代理发出的</td><td style=text-align:left>Via: 1.0 fred, 1.1 <span class=exturl data-url=aHR0cDovL2V4YW1wbGUuY29t>example.com</span> (Apache/1.1)</td></tr><tr><td style=text-align:left>Warning</td><td style=text-align:left>一个一般性的警告，告知，在实体内容体中可能存在错误</td><td style=text-align:left>Warning: 199 Miscellaneous warning</td></tr></tbody></table><h2 id=http服务器响应报文><a class=anchor href=#http服务器响应报文>#</a> http服务器响应报文</h2><p>服务器响应客户端的HTTP响应由四个部分组成</p><ul><li>状态行</li><li>消息报头</li><li>空行</li><li>响应正文</li></ul><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>协议版本 | 空格 | 响应代码 | 空格 | 代号描述 | 回车符 | 换行符	-【状态行】</pre></td></tr><tr><td data-num=2></td><td><pre>字段名 | : | 值 | 回车符 | 换行符      —|</pre></td></tr><tr><td data-num=3></td><td><pre>.............................        |【消息报头】</pre></td></tr><tr><td data-num=4></td><td><pre>字段名 | : | 值 | 回车符 | 换行符      -|</pre></td></tr><tr><td data-num=5></td><td><pre>回车符 | 换行符</pre></td></tr><tr><td data-num=6></td><td><pre>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx	-【响应正文】</pre></td></tr></table></figure><figure class="highlight tex"><figcaption data-lang=TeX><span>例子</span></figcaption><table><tr><td data-num=1></td><td><pre>HTTP/1.0 200 OK		-【HTTP1.0版本 200状态码 对状态码的描述】</pre></td></tr><tr><td data-num=2></td><td><pre>Server: Martin Server</pre></td></tr><tr><td data-num=3></td><td><pre>Content-Type: text/html</pre></td></tr><tr><td data-num=4></td><td><pre>Connection: Close</pre></td></tr><tr><td data-num=5></td><td><pre>Content-Length: 548</pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>&lt;html></pre></td></tr><tr><td data-num=8></td><td><pre>...............</pre></td></tr><tr><td data-num=9></td><td><pre>&lt;/html></pre></td></tr></table></figure><p>HTTP状态码用于描述HTTP请求的结果，比如2xx就代表请求被成功处理。</p><table><thead><tr><th style=text-align:left></th><th style=text-align:left>响应状态码(响应代码)</th><th style=text-align:left>状态码描述(代号描述)</th></tr></thead><tbody><tr><td style=text-align:left>服务器上存在请求的内容，并可以响应给客户端</td><td style=text-align:left>200</td><td style=text-align:left>OK</td></tr><tr><td style=text-align:left>客户端的请求有异常，方法有问题</td><td style=text-align:left>501</td><td style=text-align:left>Method Not Implemented</td></tr><tr><td style=text-align:left>服务器收到请求后，因为服务器的问题无法响应</td><td style=text-align:left>500</td><td style=text-align:left>Internal Server Error</td></tr><tr><td style=text-align:left>请求的内容不存在</td><td style=text-align:left>404</td><td style=text-align:left>NOT FOUND</td></tr><tr><td style=text-align:left>客户端发送的请求格式有问题</td><td style=text-align:left>400</td><td style=text-align:left>BAD REQUEST</td></tr></tbody></table><h2 id=http-10与http-11的差别><a class=anchor href=#http-10与http-11的差别>#</a> HTTP 1.0与HTTP 1.1的差别</h2><h3 id=响应状态码><a class=anchor href=#响应状态码>#</a> 响应状态码</h3><p><code>HTTP/1.0</code>仅定义了16种状态码。<code>HTTP/1.1</code>中新加入了大量的状态码，光是错误响应状态码就新增了24种。例如</p><ul><li><code>100 (Continue)</code> - 在请求大资源前的预热请求</li><li><code>206 (Partial Content)</code> - 范围请求的标识码</li><li><code>409 (Conflict)</code> - 请求与当前资源的规定冲突</li><li><code>410 (Gone)</code> - 资源已被永久转移，而且没有任何已知的转发地址</li></ul><h3 id=缓存处理><a class=anchor href=#缓存处理>#</a> 缓存处理</h3><p>缓存技术通过避免用户与源服务器的频繁交互，节约了大量的网络带宽，降低了用户接收信息的延迟。</p><p><ins><strong>HTTP/1.0</strong></ins></p><p><code>HTTP/1.0</code>提供的缓存机制非常简单。服务器端使用<code>Expires</code>标签来标志(时间)一个响应体，在<code>Expires</code>标志时间内的请求，都会获得该响应体缓存。服务器端在初次返回给客户端的响应体中，有一个<code>Last-Modified</code>标签，该标签标记了被请求资源在服务器端的最后一次修改。在请求头中，使用<code>If-Modified-Since</code>标签，该标签标志一个时间，意为客户端向服务器进行问询：该时间之后，需请求的资源是否有被修改过？，通常情况下，请求头中的<code>If-Modified-Since</code>的值即为上一次获得该资源时，响应体中的<code>Last-Modified</code>的值。</p><p>如果服务器接收到了请求头，并判断<code>If-Modified-Since</code>时间后，资源确实没有修改过，则返回给客户端一个<code>304 not modified</code>响应头，表示<code>缓冲可用，从浏览器中获取</code>。</p><p>如果服务器判断<code>If-Modified-Since</code>时间后，资源被修改过，则返回给客户端一个<code>200 OK</code>的响应体，并附带全新的资源内容，表示<code>请求文件已经修改过，发送了一份新的</code>。</p><p><ins><strong>HTTP/1.1</strong></ins></p><p><code>HTTP/1.1</code>的缓存机制在<code>HTTP/1.0</code>的基础上，大大增加了灵活性和扩展性。基本工作原理和<code>HTTP/1.0</code>保持不变，而是增加了更多细致的特性。其中，请求头中最常见的特性就是<code>Cache-Control</code>。</p><h3 id=连接方式><a class=anchor href=#连接方式>#</a> 连接方式</h3><p><code>HTTP/1.0</code>默认使用短连接 ，即客户端和服务器每进行一次HTTP操作，就建立一次连接，任务结束就中断连接。当客户端浏览器访问的某个HTML或其他类型的Web页中包含有其他的Web资源(如JavaScript 文件、图像文件、CSS文件等)，每遇到这样一个Web资源，浏览器就会重新建立一个TCP连接，这样就会导致有大量的握手报文和挥手报文占用带宽。</p><p>为了解决<code>HTTP/1.0</code>存在的资源浪费的问题，<code>HTTP/1.1</code>优化为默认长连接模式 。采用长连接模式的请求报文会通知服务端：请求连接，并且连接成功建立后，请不要关闭。因此，该TCP连接将持续保持连接状态，为后续的客户端-服务端的数据交互服务。也就是说在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，客户端再次访问这个服务器时，会继续使用这一条已经建立的连接。</p><p>如果TCP连接一直保持的话也是对资源的浪费，因此，一些服务器软件(如 Apache)还会支持超时时间的时间。在超时时间之内没有新的请求达到，TCP连接才会被关闭。</p><p><code>HTTP/1.0</code>仍提供了长连接选项，即在请求头中加入<code>Connection: Keep-alive</code>。同样的，在<code>HTTP/1.1</code>中，如果不希望使用长连接选项，也可以在请求头中加入<code>Connection: close</code>。</p><p>HTTP协议的长连接和短连接，实质上是TCP协议的长连接和短连接。</p><p>实现长连接需要客户端和服务端都支持长连接。</p><h3 id=host头处理><a class=anchor href=#host头处理>#</a> Host头处理</h3><p>域名系统(DNS)允许多个主机名绑定到同一个 IP 地址上，但是 HTTP/1.0 并没有考虑这个问题，假设我们有一个资源URL是<code>http://example1.org/home.html，HTTP/1.0</code>的请求报文中，请求的将会是<code>GET /home.html HTTP/1.0</code>，并且不会加入主机名。这样的报文送到服务器端，服务器是理解不了客户端想请求的真正网址。因此，<code>HTTP/1.1</code>在请求头中加入了<code>Host</code>字段。加入<code>Host</code>字段的报文头部将会是</p><figure class="highlight tex"><figcaption data-lang=TeX></figcaption><table><tr><td data-num=1></td><td><pre>GET /home.html HTTP/1.1</pre></td></tr><tr><td data-num=2></td><td><pre>Host: example1.org</pre></td></tr></table></figure><p>这样，服务器端就可以确定客户端想要请求的真正的网址了。</p><h3 id=带宽优化><a class=anchor href=#带宽优化>#</a> 带宽优化</h3><p><ins><strong>范围请求</strong></ins></p><p><code>HTTP/1.1</code>引入了范围请求(range request)机制，以避免带宽的浪费。当客户端想请求一个文件的一部分，或者需要继续下载一个已经下载了部分但被终止的文件，<code>HTTP/1.1</code>可以在请求中加入<code>Range</code>头部，以请求(并只能请求字节型数据)数据的一部分。服务器端可以忽略<code>Range</code>头部，也可以返回若干<code>Range</code>响应。</p><p>如果一个响应包含部分数据的话，那么将带有<code>206 (Partial Content)</code>状态码。该状态码的意义在于避免了<code>HTTP/1.0</code>代理缓存错误地把该响应认为是一个完整的数据响应，从而把他当作为一个请求的响应缓存。</p><p>在范围响应中，<code>Content-Range</code>头部标志指示出了该数据块的偏移量和数据块的长度。</p><p><ins><strong>状态码 100</strong></ins></p><p><code>HTTP/1.1</code>中新加入了状态码<code>100</code>。该状态码的使用场景为，存在某些较大的文件请求，服务器可能不愿意响应这种请求，此时状态码<code>100</code>可以作为指示请求是否会被正常响应。</p><p>然而在<code>HTTP/1.0</code>中，并没有<code>100 (Continue)</code>状态码，要想触发这一机制，可以发送一个<code>Expect</code>头部，其中包含一个<code>100-continue</code>的值。</p><p><ins><strong>压缩</strong></ins></p><p>许多格式的数据在传输时都会做预压缩处理。数据的压缩可以大幅优化带宽的利用。然而，<code>HTTP/1.0</code>对数据压缩的选项提供的不多，不支持压缩细节的选择，也无法区分端到端(end-to-end)压缩或者是逐跳(hop-by-hop)压缩。</p><p><code>HTTP/1.1</code>则对内容编码(content-codings)和传输编码(transfer-codings)做了区分。内容编码总是端到端的，传输编码总是逐跳的。</p><p><code>HTTP/1.0</code>包含了<code>Content-Encoding</code>头部，对消息进行端到端编码。<code>HTTP/1.1</code>加入了<code>Transfer-Encoding</code>头部，可以对消息进行逐跳传输编码。<code>HTTP/1.1</code>还加入了<code>Accept-Encoding</code>头部，是客户端用来指示他能处理什么样的内容编码。</p><h2 id=http状态码><a class=anchor href=#http状态码>#</a> HTTP状态码</h2><h3 id=成功状态码2xx><a class=anchor href=#成功状态码2xx>#</a> 成功状态码(2xx)</h3><ul><li><p><strong>200 OK</strong> - 请求被成功处理。比如我们发送一个查询用户数据的HTTP请求到服务端，服务端正确返回了用户数据。这个是我们平时最常见的一个HTTP状态码</p></li><li><p><strong>201 Created</strong> - 请求被成功处理并且在服务端创建了一个新的资源。比如我们通过POST请求创建一个新的用户</p></li><li><p><strong>202 Accepted</strong> - 服务端已经接收到了请求，但是还未处理</p></li><li><p><strong>204 No Content</strong> - 服务端已经成功处理了请求，但是没有返回任何内容</p></li></ul><h3 id=重定向状态码3xx><a class=anchor href=#重定向状态码3xx>#</a> 重定向状态码(3xx)</h3><ul><li><strong>301 Moved Permanently</strong> - 资源被永久重定向了。比如网站的网址更换了</li><li><strong>302 Found</strong> - 资源被临时重定向了。比如网站的某些资源被暂时转移到另外一个网址</li></ul><h3 id=客户端错误状态码4xx><a class=anchor href=#客户端错误状态码4xx>#</a> 客户端错误状态码(4xx)</h3><ul><li><p><strong>400 Bad Request</strong> - 发送的HTTP请求存在问题。比如请求参数不合法、请求方法错误</p></li><li><p><strong>401 Unauthorized</strong> - 未认证却请求需要认证之后才能访问的资源</p></li><li><p><strong>403 Forbidden</strong> - 直接拒绝HTTP请求，不处理。一般用来针对非法请求</p></li><li><p><strong>404 Not Found</strong> - 请求的资源未在服务端找到。比如请求某个用户的信息，服务端并没有找到指定的用户</p></li><li><p><strong>409 Conflict</strong> - 表示请求的资源与服务端当前的状态存在冲突，请求无法被处理</p></li></ul><h3 id=服务端错误状态码5xx><a class=anchor href=#服务端错误状态码5xx>#</a> 服务端错误状态码(5xx)</h3><ul><li><p><strong>500 Internal Server Error</strong> - 服务端出问题了(通常是服务端出Bug了)。比如服务端处理请求的时候突然抛出异常，但是异常并未在服务端被正确处理</p></li><li><p><strong>502 Bad Gateway</strong> - 我们的网关将请求转发到服务端，但是服务端返回的却是一个错误的响应</p></li></ul><h2 id=http服务器><a class=anchor href=#http服务器>#</a> HTTP服务器</h2><h3 id=头文件><a class=anchor href=#头文件>#</a> 头文件</h3><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;netdb.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u16</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u32</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEBUG</span></span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">int</span> <span class="token function">socketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token keyword">void</span> <span class="token function">httpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=基础socket通信源码><a class=anchor href=#基础socket通信源码>#</a> 基础socket通信源码</h3><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">int</span> <span class="token function">socketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">int</span> server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socketConstruct: server_fd = socket() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>   <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>   <span class="token keyword">int</span> opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>   u32 len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>   <span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=22></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socketConstruct: bind failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>      <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=29></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socketConstruct: listen failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>      <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>   <span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=http请求头部读取源码><a class=anchor href=#http请求头部读取源码>#</a> http请求头部读取源码</h3><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">int</span> <span class="token function">getLine</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>   <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>   <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span>length <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre>         buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre>      <span class="token keyword">else</span></pre></td></tr><tr><td data-num=16></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"getLine: read failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre>         <span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"client close.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre>         index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>         <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> index <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre>   <span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">void</span> <span class="token function">httpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>   <span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>   <span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>   <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>      <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=39></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>         method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>         <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre>      method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>      method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre></pre></td></tr><tr><td data-num=46></td><td><pre>      <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=47></td><td><pre>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"request method: %s\n"</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>      <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=49></td><td><pre></pre></td></tr><tr><td data-num=50></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">_cmp</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span><span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=51></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=52></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=53></td><td><pre>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"method = GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=55></td><td><pre></pre></td></tr><tr><td data-num=56></td><td><pre>         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>         j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=58></td><td><pre>         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=59></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=60></td><td><pre>            url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>            <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre>         url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre></pre></td></tr><tr><td data-num=65></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=66></td><td><pre>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"url: %s\n"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=67></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=68></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=69></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=70></td><td><pre>   <span class="token keyword">do</span></pre></td></tr><tr><td data-num=71></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=72></td><td><pre>      len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>   <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=http请求解析源码><a class=anchor href=#http请求解析源码>#</a> http请求解析源码</h3><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">int</span> <span class="token function">getLine</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>   <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>   <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span>length <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre>         buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre>      <span class="token keyword">else</span></pre></td></tr><tr><td data-num=16></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"getLine: read failed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre>         <span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"client close.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre>         index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>         <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> index <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre>   <span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">void</span> <span class="token function">httpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>   <span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>   <span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>   <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=36></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>      <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=39></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>         method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>         <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre>      method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre></pre></td></tr><tr><td data-num=45></td><td><pre>      <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=46></td><td><pre>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"request method: %s\n"</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=47></td><td><pre>      <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=48></td><td><pre></pre></td></tr><tr><td data-num=49></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">_cmp</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span><span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=50></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=51></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=52></td><td><pre>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"method = GET\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=53></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=54></td><td><pre></pre></td></tr><tr><td data-num=55></td><td><pre>         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=56></td><td><pre>         j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=57></td><td><pre>         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=58></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=59></td><td><pre>            url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>            <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=62></td><td><pre>         url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre></pre></td></tr><tr><td data-num=64></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=65></td><td><pre>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"url: %s\n"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=67></td><td><pre></pre></td></tr><tr><td data-num=68></td><td><pre>         <span class="token keyword">do</span></pre></td></tr><tr><td data-num=69></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=70></td><td><pre>            len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"recv: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=72></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre></pre></td></tr><tr><td data-num=74></td><td><pre>         <span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=75></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=76></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=77></td><td><pre>            <span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=78></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=79></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"search path: %s\n"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=81></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=82></td><td><pre>         <span class="token function">sprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./html_docs/%s"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=83></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=84></td><td><pre>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"path: %s\n"</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=85></td><td><pre>         <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=86></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=87></td><td><pre>      <span class="token keyword">else</span></pre></td></tr><tr><td data-num=88></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=89></td><td><pre>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"warning! could not accept %s method"</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=90></td><td><pre>         <span class="token keyword">do</span></pre></td></tr><tr><td data-num=91></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=92></td><td><pre>            len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=93></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"read: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=95></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=96></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=97></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=http请求响应源码><a class=anchor href=#http请求响应源码>#</a> http请求响应源码</h3><h4 id=stat函数><a class=anchor href=#stat函数>#</a> stat函数</h4><p>用于返回文件的状态信息。</p><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">stat</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token class-name">dev_t</span> st_dev<span class="token punctuation">;</span> <span class="token comment">/* 设备ID */</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token class-name">ino_t</span> st_ino<span class="token punctuation">;</span><span class="token comment">/* inode 编号 */</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token class-name">mode_t</span> st_mode<span class="token punctuation">;</span><span class="token comment">/* 表示当前状态是文件(S_ISREG(st_mode))还是目录(S_ISDIR(st_mode)) */</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token class-name">nlink_t</span> st_nlink<span class="token punctuation">;</span><span class="token comment">/* hard 链接的数量 */</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token class-name">uid_t</span> st_uid<span class="token punctuation">;</span><span class="token comment">/* 用户id */</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token class-name">gid_t</span> st_gid<span class="token punctuation">;</span><span class="token comment">/* 组id */</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token class-name">dev_t</span> st_rdev<span class="token punctuation">;</span><span class="token comment">/* 设备ID(if special file) */</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token class-name">off_t</span> st_size<span class="token punctuation">;</span><span class="token comment">/* 文件总大小 */</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token class-name">blksize_t</span> st_blksize<span class="token punctuation">;</span><span class="token comment">/* blocksize for filesystem I/o */</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token class-name">blkcnt_t</span> st_blocks<span class="token punctuation">;</span><span class="token comment">/* number of 512B blocks allocated */</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token class-name">time_t</span> st_atime<span class="token punctuation">;</span><span class="token comment">/* 文件最后的访问时间 */</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token class-name">time_t</span> st_mtime<span class="token punctuation">;</span><span class="token comment">/* 文件最后的修改时间 */</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token class-name">time_t</span> st_ctime<span class="token punctuation">;</span><span class="token comment">/* 文件状态最后的改变时间 */</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">int</span> <span class="token function">stat</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">stat</span><span class="token operator">*</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">int</span> <span class="token function">fstat</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">stat</span><span class="token operator">*</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token keyword">int</span> <span class="token function">lstat</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">stat</span><span class="token operator">*</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token comment"> * path: 文件路径</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token comment"> * buf: 传入的保存文件状态的指针，用于保存文件的状态</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token comment"> * 返回值- 成功返回0，失败返回-1并设置errno</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><h4 id=404响应><a class=anchor href=#404响应>#</a> 404响应</h4><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">void</span> <span class="token function">response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>   <span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=6></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response404: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=200响应><a class=anchor href=#200响应>#</a> 200响应</h4><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   <span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>   <span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>   <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"header: "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=18></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response200: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>   <span class="token keyword">else</span></pre></td></tr><tr><td data-num=20></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>      <span class="token keyword">char</span> body<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>      FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre></pre></td></tr><tr><td data-num=24></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">fgets</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=25></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=26></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>body<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=27></td><td><pre>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response200: send body error. reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"I/O error when reading"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=32></td><td><pre>      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"End of file reached successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=33></td><td><pre>      <span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>   <span class="token punctuation">&#125;</span>    </pre></td></tr><tr><td data-num=35></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=整合源码><a class=anchor href=#整合源码>#</a> 整合源码</h4><details class=info><summary>http.h</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;ctype.h></span></span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdbool.h></span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;netdb.h></span></span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;errno.h></span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h></span></span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/socket.h></span></span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;arpa/inet.h></span></span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u16</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span></span></span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">u32</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEBUG</span></span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">int</span> <span class="token function">serverSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">void</span> <span class="token function">httpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">void</span> <span class="token function">httpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></div></details><details class=info><summary>http.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> content<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> arg1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"%s%s\n"</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span>arg1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">int</span> <span class="token function">serverSocketConstruct</span><span class="token punctuation">(</span>u16 port<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span>port <span class="token operator">></span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre>   <span class="token keyword">int</span> server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=16></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socketConstruct: server_fd = socket() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>   <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=23></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre>   server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre>   <span class="token keyword">int</span> opt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>   u32 len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre>   <span class="token function">setsockopt</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token operator">&amp;</span>opt<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">bind</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=31></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=32></td><td><pre>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socketConstruct: bind failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>      <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=36></td><td><pre></pre></td></tr><tr><td data-num=37></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">listen</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=38></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socketConstruct: listen failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=40></td><td><pre>      <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=43></td><td><pre></pre></td></tr><tr><td data-num=44></td><td><pre>   <span class="token keyword">return</span> server_fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=46></td><td><pre></pre></td></tr><tr><td data-num=47></td><td><pre><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getLine</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span>u32 size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=49></td><td><pre>   <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>   <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=52></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=53></td><td><pre>      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=55></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=56></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\r'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre>         buf<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=60></td><td><pre>      <span class="token keyword">else</span></pre></td></tr><tr><td data-num=61></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=62></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"getLine: read failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=63></td><td><pre>         <span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"client close.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=64></td><td><pre>         index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>         <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=67></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=68></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token char">'\n'</span> <span class="token operator">==</span> ch <span class="token operator">||</span> index <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> buf<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=69></td><td><pre></pre></td></tr><tr><td data-num=70></td><td><pre>   <span class="token keyword">return</span> index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=71></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=72></td><td><pre></pre></td></tr><tr><td data-num=73></td><td><pre><span class="token keyword">static</span> bool <span class="token function">_cmp</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str1<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=74></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=75></td><td><pre>   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>str1 <span class="token operator">||</span> <span class="token char">'\0'</span> <span class="token operator">!=</span> <span class="token operator">*</span>str2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=76></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=77></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>str1<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">toupper</span><span class="token punctuation">(</span><span class="token operator">*</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=78></td><td><pre>         <span class="token keyword">return</span> false<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=79></td><td><pre>      <span class="token operator">++</span>str1<span class="token punctuation">;</span> <span class="token operator">++</span>str2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=80></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=81></td><td><pre>   <span class="token keyword">return</span> true<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=83></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">response404</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=84></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=85></td><td><pre>   <span class="token keyword">char</span> header<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=86></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>header<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 404 NOT FOUND\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=87></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>header<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=88></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response404: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=89></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=90></td><td><pre></pre></td></tr><tr><td data-num=91></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">response200</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=92></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=93></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=94></td><td><pre></pre></td></tr><tr><td data-num=95></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=96></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=97></td><td><pre>   <span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=98></td><td><pre></pre></td></tr><tr><td data-num=99></td><td><pre>   <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"HTTP/1.0 200 OK\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=100></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Server: Linux\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=101></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Content-Type: text/html\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=102></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token string">"Connection: Close\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=103></td><td><pre>   <span class="token function">snprintf</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">"Content-Length: %ld\r\n\r\n"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=104></td><td><pre>   <span class="token function">strcat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=105></td><td><pre></pre></td></tr><tr><td data-num=106></td><td><pre>   <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"header: "</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=107></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=108></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response200: send reply failed.reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=109></td><td><pre>   <span class="token keyword">else</span></pre></td></tr><tr><td data-num=110></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=111></td><td><pre>      <span class="token keyword">char</span> body<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'\0'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=112></td><td><pre>      FILE<span class="token operator">*</span> resource <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=113></td><td><pre></pre></td></tr><tr><td data-num=114></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> <span class="token function">fgets</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=115></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=116></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>body<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=117></td><td><pre>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"response200: send body error. reason: %s\n"</span><span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=118></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=119></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=120></td><td><pre></pre></td></tr><tr><td data-num=121></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"I/O error when reading"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=122></td><td><pre>      <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"End of file reached successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=123></td><td><pre>      <span class="token function">fclose</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=124></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=125></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=126></td><td><pre></pre></td></tr><tr><td data-num=127></td><td><pre><span class="token keyword">void</span> <span class="token function">httpResponse</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=128></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=129></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=130></td><td><pre></pre></td></tr><tr><td data-num=131></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=132></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=133></td><td><pre>      <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span><span class="token string">"httpResponse %s failed.reason: %s\n"</span><span class="token punctuation">,</span>path<span class="token punctuation">,</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=134></td><td><pre>      <span class="token function">response404</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=135></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=136></td><td><pre>   <span class="token keyword">else</span></pre></td></tr><tr><td data-num=137></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=138></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">S_ISDIR</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>st_mode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token function">strcat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=139></td><td><pre>      <span class="token function">response200</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=140></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=141></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=142></td><td><pre></pre></td></tr><tr><td data-num=143></td><td><pre><span class="token keyword">void</span> <span class="token function">httpAccept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=144></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=145></td><td><pre>   <span class="token keyword">char</span> buf<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=146></td><td><pre>   <span class="token keyword">char</span> method<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=147></td><td><pre>   <span class="token keyword">char</span> url<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=148></td><td><pre>   <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=149></td><td><pre>   <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=150></td><td><pre></pre></td></tr><tr><td data-num=151></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=152></td><td><pre>   <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=153></td><td><pre>      <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=154></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=155></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=156></td><td><pre>         method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=157></td><td><pre>         <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=158></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=159></td><td><pre>      method<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=160></td><td><pre>      <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"request method: "</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=161></td><td><pre></pre></td></tr><tr><td data-num=162></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">_cmp</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span><span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=163></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=164></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"method = GET"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=165></td><td><pre></pre></td></tr><tr><td data-num=166></td><td><pre>         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=167></td><td><pre>         j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=168></td><td><pre>         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isspace</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=169></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=170></td><td><pre>            url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=171></td><td><pre>            <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=172></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=173></td><td><pre>         url<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=174></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"url: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=175></td><td><pre></pre></td></tr><tr><td data-num=176></td><td><pre>         <span class="token keyword">do</span></pre></td></tr><tr><td data-num=177></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=178></td><td><pre>            len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=179></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"recv: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=180></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=181></td><td><pre></pre></td></tr><tr><td data-num=182></td><td><pre>         <span class="token keyword">char</span><span class="token operator">*</span> pos <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=183></td><td><pre>         <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=184></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=185></td><td><pre>            <span class="token operator">*</span>pos <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=186></td><td><pre>            <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"search path: "</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=187></td><td><pre>         <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=188></td><td><pre>         <span class="token function">sprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"./html_docs/%s"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=189></td><td><pre>         <span class="token function">callDebug</span><span class="token punctuation">(</span><span class="token string">"path: "</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=190></td><td><pre></pre></td></tr><tr><td data-num=191></td><td><pre>         <span class="token function">httpResponse</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=192></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=193></td><td><pre>      <span class="token keyword">else</span></pre></td></tr><tr><td data-num=194></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=195></td><td><pre>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"warning! could not accept %s method"</span><span class="token punctuation">,</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=196></td><td><pre>         <span class="token keyword">do</span></pre></td></tr><tr><td data-num=197></td><td><pre>         <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=198></td><td><pre>            len <span class="token operator">=</span> <span class="token function">getLine</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=199></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"read: %s\n"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=200></td><td><pre>         <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=201></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=202></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=203></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><details class=info><summary>httpserver.c</summary><div><figure class="highlight c"><figcaption data-lang=c></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"http.h"</span></span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">int</span> server_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token punctuation">(</span>server_fd <span class="token operator">=</span> <span class="token function">serverSocketConstruct</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>  </pre></td></tr><tr><td data-num=9></td><td><pre>   <span class="token keyword">int</span> accept_fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>   <span class="token keyword">int</span> socklen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>   <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> client_addr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"waiting server connect...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>   accept_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">socklen_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server connected\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre>   <span class="token function">httpAccept</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>  </pre></td></tr><tr><td data-num=19></td><td><pre>   <span class="token function">close</span><span class="token punctuation">(</span>accept_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>   <span class="token function">close</span><span class="token punctuation">(</span>server_fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><div class=tags><a href=/tags/network-programming/ rel=tag><i class="ic i-tag"></i> 网络编程</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span> <span class=text>更新于</span> <time title="修改时间：2024-03-26 14:29:58" itemprop=dateModified datetime=2024-03-26T14:29:58+08:00>2024-03-26</time></span><span class=item data-path=/computer-science/programming/network-programming/http/ title=阅读次数><span class=icon><i class="ic i-eye"></i></span> <span class=text>阅读次数</span><span class=waline-pageview-count></span> <span class=text>次</span></span></div><div id=copyright><ul><li class=author><strong>本文作者：</strong> ReverseSacle <i class="ic i-at"><em>@</em></i>逆转天平</li><li class=link><strong>本文链接：</strong> <a href=https://www.reversesacle.com/computer-science/programming/network-programming/http/ title=HTTP网络通信基础>https://www.reversesacle.com/computer-science/programming/network-programming/http/</a></li><li class=license><strong>版权声明：</strong> 本站所有文章除特别声明外，均采用 <span class=exturl data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class=post-nav><div class="item left"><a href=/computer-science/programming/web/jspart2/ itemprop=url rel=prev data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg8.webp title=JavaScript基础-第二部分><span class=type>上一篇</span><span class=category><i class="ic i-flag"></i> web</span><h3>JavaScript基础-第二部分</h3></a></div><div class="item right"><a href=/computer-science/programming/c-language/c-project/comment-system-part1/ itemprop=url rel=next data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg18.webp title=网站留言评论系统的设计与手动实现-初稿-第一部分><span class=type>下一篇</span><span class=category><i class="ic i-flag"></i> C语言项目</span><h3>网站留言评论系统的设计与手动实现-初稿-第一部分</h3></a></div></div><div class=wrap id=comments><div id=waline-comment></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=文章目录><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A6%82%E8%BF%B0><span class=toc-number>1.</span> <span class=toc-text>概述</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#httphttps><span class=toc-number>2.</span> <span class=toc-text>HTTP&#x2F;HTTPS</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#http%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87><span class=toc-number>3.</span> <span class=toc-text>http客户端请求报文</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#http%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87><span class=toc-number>4.</span> <span class=toc-text>http服务器响应报文</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#http-10%E4%B8%8Ehttp-11%E7%9A%84%E5%B7%AE%E5%88%AB><span class=toc-number>5.</span> <span class=toc-text>HTTP 1.0与HTTP 1.1的差别</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81><span class=toc-number>5.1.</span> <span class=toc-text>响应状态码</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BC%93%E5%AD%98%E5%A4%84%E7%90%86><span class=toc-number>5.2.</span> <span class=toc-text>缓存处理</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F><span class=toc-number>5.3.</span> <span class=toc-text>连接方式</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#host%E5%A4%B4%E5%A4%84%E7%90%86><span class=toc-number>5.4.</span> <span class=toc-text>Host头处理</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%B8%A6%E5%AE%BD%E4%BC%98%E5%8C%96><span class=toc-number>5.5.</span> <span class=toc-text>带宽优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#http%E7%8A%B6%E6%80%81%E7%A0%81><span class=toc-number>6.</span> <span class=toc-text>HTTP状态码</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%88%90%E5%8A%9F%E7%8A%B6%E6%80%81%E7%A0%812xx><span class=toc-number>6.1.</span> <span class=toc-text>成功状态码(2xx)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%87%8D%E5%AE%9A%E5%90%91%E7%8A%B6%E6%80%81%E7%A0%813xx><span class=toc-number>6.2.</span> <span class=toc-text>重定向状态码(3xx)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%94%99%E8%AF%AF%E7%8A%B6%E6%80%81%E7%A0%814xx><span class=toc-number>6.3.</span> <span class=toc-text>客户端错误状态码(4xx)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%94%99%E8%AF%AF%E7%8A%B6%E6%80%81%E7%A0%815xx><span class=toc-number>6.4.</span> <span class=toc-text>服务端错误状态码(5xx)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#http%E6%9C%8D%E5%8A%A1%E5%99%A8><span class=toc-number>7.</span> <span class=toc-text>HTTP服务器</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%A4%B4%E6%96%87%E4%BB%B6><span class=toc-number>7.1.</span> <span class=toc-text>头文件</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%9F%BA%E7%A1%80socket%E9%80%9A%E4%BF%A1%E6%BA%90%E7%A0%81><span class=toc-number>7.2.</span> <span class=toc-text>基础socket通信源码</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#http%E8%AF%B7%E6%B1%82%E5%A4%B4%E9%83%A8%E8%AF%BB%E5%8F%96%E6%BA%90%E7%A0%81><span class=toc-number>7.3.</span> <span class=toc-text>http请求头部读取源码</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#http%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90%E6%BA%90%E7%A0%81><span class=toc-number>7.4.</span> <span class=toc-text>http请求解析源码</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#http%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E6%BA%90%E7%A0%81><span class=toc-number>7.5.</span> <span class=toc-text>http请求响应源码</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#stat%E5%87%BD%E6%95%B0><span class=toc-number>7.5.1.</span> <span class=toc-text>stat函数</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#404%E5%93%8D%E5%BA%94><span class=toc-number>7.5.2.</span> <span class=toc-text>404响应</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#200%E5%93%8D%E5%BA%94><span class=toc-number>7.5.3.</span> <span class=toc-text>200响应</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%95%B4%E5%90%88%E6%BA%90%E7%A0%81><span class=toc-number>7.5.4.</span> <span class=toc-text>整合源码</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title=系列文章><ul><li><a href=/computer-science/programming/network-programming/linux-environment/ rel=bookmark title=虚拟机-Linux环境配置>虚拟机-Linux环境配置</a></li><li><a href=/computer-science/programming/network-programming/Linux-basic/ rel=bookmark title="Linux基础(CentOS 7)">Linux基础(CentOS 7)</a></li><li><a href=/computer-science/programming/network-programming/gcc-compiler/ rel=bookmark title=GCC编译器>GCC编译器</a></li><li><a href=/computer-science/programming/network-programming/gdb-debugging-tool/ rel=bookmark title=GDB调试工具>GDB调试工具</a></li><li><a href=/computer-science/programming/network-programming/make-compiler-tool/ rel=bookmark title=make编译工具>make编译工具</a></li><li><a href=/computer-science/programming/network-programming/clibrary/ rel=bookmark title=C/C++静态库与动态库的制作和使用>C/C++静态库与动态库的制作和使用</a></li><li><a href=/computer-science/programming/network-programming/executable-program/ rel=bookmark title=在C/C++程序中调用可执行程序>在C/C++程序中调用可执行程序</a></li><li><a href=/computer-science/programming/network-programming/signal/ rel=bookmark title=Linux的信号(signal)>Linux的信号(signal)</a></li><li><a href=/computer-science/programming/network-programming/multiprocessing/ rel=bookmark title=Linux多进程>Linux多进程</a></li><li><a href=/computer-science/programming/network-programming/log/ rel=bookmark title=C/C++服务程序的运行日志>C/C++服务程序的运行日志</a></li><li><a href=/computer-science/programming/network-programming/multithreading/ rel=bookmark title=Linux多线程>Linux多线程</a></li><li><a href=/computer-science/programming/network-programming/thread-synchronization/ rel=bookmark title=Linux线程同步>Linux线程同步</a></li><li><a href=/computer-science/programming/network-programming/programming/ rel=bookmark title=C/C++网络编程>C/C++网络编程</a></li><li class=active><a href=/computer-science/programming/network-programming/http/ rel=bookmark title=HTTP网络通信基础>HTTP网络通信基础</a></li><li><a href=/computer-science/programming/network-programming/ubuntu-obs-server/ rel=bookmark title="Ubuntu服务器OBS Studio配置">Ubuntu服务器OBS Studio配置</a></li></ul></div><div class="overview panel" data-title=站点概览><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img class=image itemprop=image alt=ReverseSacle data-src=/images/avatar.webp><p class=name itemprop=name>ReverseSacle</p><div class=description itemprop=description>知识书库 & 学习点滴</div></div><nav class=state><div class="item posts"><a href=/archives/ ><span class=count>186</span> <span class=name>文章</span></a></div><div class="item categories"><a href=/categories/ ><span class=count>52</span> <span class=name>分类</span></a></div><div class="item tags"><a href=/tags/ ><span class=count>18</span> <span class=name>标签</span></a></div></nav><div class=social><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JldmVyc2VTYWNsZQ==" title=https:&#x2F;&#x2F;github.com&#x2F;ReverseSacle><i class="ic i-github"></i></span><span class="exturl item email" data-url="bWFpbHRvOnByaXZhdGVAcmV2ZXJzZXNhY2xlLmNvbQ==" title=mailto:private@reversesacle.com><i class="ic i-envelope"></i></span></div><ul class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i> 首页</a></li><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-feather"></i> 文章</a><ul class=submenu><li class=item><a href=/archives/ rel=section><i class="ic i-list-alt"></i> 归档</a></li><li class=item><a href=/categories/ rel=section><i class="ic i-th"></i> 分类</a></li><li class=item><a href=/tags/ rel=section><i class="ic i-tags"></i> 标签</a></li></ul></li><li class=item><a href=/about/ rel=section><i class="ic i-user"></i> 关于</a></li><li class=item><a href=/friend-links/ rel=section><i class="ic i-heart"></i> 友链</a></li></ul></div></div></div><ul id=quick><li class="prev pjax"><a href=/computer-science/programming/web/jspart2/ rel=prev title=上一篇><i class="ic i-chevron-left"></i></a></li><li class=up><i class="ic i-arrow-up"></i></li><li class=down><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href=/computer-science/programming/c-language/c-project/comment-system-part1/ rel=next title=下一篇><i class="ic i-chevron-right"></i></a></li><li class=percent></li></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>随机文章</h2><ul><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/rust/ title="分类于 Rust">Rust</a></div><span><a href=/computer-science/programming/rust/rust-data-structure/linear-structure/seqlist/ title=Rust-顺序表>Rust-顺序表</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/rust/ title="分类于 Rust">Rust</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/rust/rust-example/ title="分类于 Rust案例">Rust案例</a></div><span><a href=/computer-science/programming/rust/rust-example/web-application/ title=Rust在Linux(CentOS7)虚拟机中的Web基础运用>Rust在Linux(CentOS7)虚拟机中的Web基础运用</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/dynamic-program/ title="分类于 动态规划">动态规划</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/dynamic-program/subset/longest-palindromic-substring/ title=最长回文子串>最长回文子串</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/database/ title="分类于 数据库">数据库</a></div><span><a href=/computer-science/programming/database/theory/ title=数据库基础理论>数据库基础理论</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a></div><span><a href=/computer-science/programming/c-language/c-data-structure/linear-structure/link-queue/ title=C语言-链队列>C语言-链队列</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/dynamic-program/ title="分类于 动态规划">动态规划</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/dynamic-program/pattern/ title=动态规划-模式>动态规划-模式</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/rust/ title="分类于 Rust">Rust</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/rust/rust-basic/ title="分类于 Rust基础">Rust基础</a></div><span><a href=/computer-science/programming/rust/rust-basic/rustpart2/ title=Rust语言-基础-第二部分>Rust语言-基础-第二部分</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/dynamic-program/ title="分类于 动态规划">动态规划</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/dynamic-program/nums/pascals-triangle/ title=帕斯卡三角>帕斯卡三角</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/seqlist/ title="分类于 顺序表">顺序表</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/seqlist/duplicates/ title=顺序表-重复项>顺序表-重复项</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/c-project/ title="分类于 C语言项目">C语言项目</a></div><span><a href=/computer-science/programming/c-language/c-project/comment-system-part2/ title=网站留言评论系统的设计与手动实现-初稿-第二部分>网站留言评论系统的设计与手动实现-初稿-第二部分</a></span></li></ul></div><div><h2>最新评论</h2><ul id=waline-recent></ul></div></div><div class=status><div class=copyright>&copy; 2021 – <span itemprop=copyrightYear>2025</span><span class=with-love><i class="ic i-sakura rotate"></i></span> <span class=author itemprop=copyrightHolder>ReverseSacle @ ReverseSacle-Blog</span></div><div class=count><i class="ic i-clock" aria-hidden=true></i> <span id=time align=center>载入时间中...<script defer>var now=new Date;function createtime(){var n=new Date("2021-11-16 22:30:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("time").innerHTML="已经过 "+dnum+" 天 "+hnum+" 小时 "+mnum+" 分 "+snum+" 秒 "}setInterval("createtime()",250)</script></span><span class=post-meta-item-icon>|&nbsp<i class="ic i-chart-area"></i></span> <span title=站点总字数>2.1m 字</span> <span class=post-meta-item-icon>|&nbsp<i class="ic i-coffee"></i></span> <span title=站点阅读时长>40:40</span></div></div></div></footer></div><script data-config>var LOCAL={path:"computer-science/programming/network-programming/http/",favicon:{show:"ReverseSacle-Blog",hide:"ReverseSacle-Blog"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},waline:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src=https://polyfill.alicdn.com/v3/polyfill.min.js></script><script src=https://cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1.16.0/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js></script><script src=/js/app.js></script></body></html>