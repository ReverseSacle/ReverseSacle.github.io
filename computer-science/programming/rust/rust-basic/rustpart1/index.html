<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#222><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/ico sizes=48x48 href=/images/favicon.ico><link rel=alternate type=application/rss+xml title=逆转天平 href=https://www.reversesacle.com/rss.xml><link rel=alternate type=application/atom+xml title=逆转天平 href=https://www.reversesacle.com/atom.xml><link rel=alternate type=application/json title=逆转天平 href=https://www.reversesacle.com/feed.json><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=/css/app.css><meta name=description content=编程语言><link rel=canonical href=https://www.reversesacle.com/computer-science/programming/rust/rust-basic/rustpart1/ ><title>Rust语言-基础-第一部分 - Rust基础 - Rust - 编程 - 计算机科学 | ReverseSacle-Blog</title><meta name=generator content="Hexo 6.3.0"></head><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=dotloader><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">Rust语言-基础-第一部分</h1><div class=meta><span class=item title="创建时间：2023-10-14 19:48:20"><span class=icon><i class="ic i-calendar"></i></span> <span class=text>发表于</span> <time itemprop="dateCreated datePublished" datetime=2023-10-14T19:48:20+08:00>2023-10-14</time></span><span class=item title=本文字数><span class=icon><i class="ic i-pen"></i></span> <span class=text>本文字数</span> <span>42k</span> <span class=text>字</span></span><span class=item title=阅读时长><span class=icon><i class="ic i-clock"></i></span> <span class=text>阅读时长</span> <span>49 分钟</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div class=lines role=navigation aria-label=切换导航栏><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>ReverseSacle-Blog</a></li></ul><ul class=right><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id=imgs class=pjax><ul><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg6.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg4.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg3.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg5.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg15.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg20.webp></li></ul></div></header><div id=waves><svg class=waves xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewBox="0 24 150 28" preserveAspectRatio=none shape-rendering=auto><defs><path id=gentle-wave d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352z"/></defs><g class=parallax><use xlink:href=#gentle-wave x=48 y=0 /><use xlink:href=#gentle-wave x=48 y=3 /><use xlink:href=#gentle-wave x=48 y=5 /><use xlink:href=#gentle-wave x=48 y=7 /></g></svg></div><main><div class=inner><div id=main class=pjax><div class="article wrap"><div class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i> <span><a href=/ >首页</a></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/ itemprop=item rel=index title="分类于 计算机科学"><span itemprop=name>计算机科学</span></a><meta itemprop=position content=1></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/ itemprop=item rel=index title="分类于 编程"><span itemprop=name>编程</span></a><meta itemprop=position content=2></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/rust/ itemprop=item rel=index title="分类于 Rust"><span itemprop=name>Rust</span></a><meta itemprop=position content=3></span><i class="ic i-angle-right"></i> <span class=current itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/rust/rust-basic/ itemprop=item rel=index title="分类于 Rust基础"><span itemprop=name>Rust基础</span></a><meta itemprop=position content=4></span></div><article itemscope itemtype=http://schema.org/Article class="post block" lang=zh-CN><link itemprop=mainEntityOfPage href=https://www.reversesacle.com/computer-science/programming/rust/rust-basic/rustpart1/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.webp><meta itemprop=name content=ReverseSacle><meta itemprop=description content="所见即所得，所思即所行, 知识书库 & 学习点滴"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=逆转天平></span><div class="body md" itemprop=articleBody><div class="note info no-icon"><p>需要C语言基础，<code>C++</code>基础</p><p>倘若有python基础和JavaScript基础 - (非必要)，有些地方会看着眼熟</p></div><h2 id=概述><a class=anchor href=#概述>#</a> 概述</h2><p>Rust是由Mozilla主导开发的通用、编译型编程语言。设计准则为安全、并发、实用，支持函数式、并发式、过程式以及面向对象的编程风格。</p><p>Rust语言原本是Mozilla员工Graydon Hoare的个人项目，而Mozilla于2009年开始赞助这个项目 ，并且在2010年首次公开。也在同一年，其编译器源代码开始由原本的OCaml语言转移到用Rust语言，进行自我编译工作，称做rustc，并于2011年实际完成。这个可自我编译的编译器在架构上采用了LLVM做为它的后端。</p><h2 id=数据类型><a class=anchor href=#数据类型>#</a> 数据类型</h2><h3 id=概述-2><a class=anchor href=#概述-2>#</a> 概述</h3><p>基本数据类型包括数值类型，字符串，布尔类型，字符类型，单元类型。</p><p>Rust编译器可以根据变量的值和上下文中的使用方式来自动推导出变量的类型，但也存在无法推导的情况，这时候需要手动标记数据类型。</p><h3 id=数值类型><a class=anchor href=#数值类型>#</a> 数值类型</h3><h4 id=整数><a class=anchor href=#整数>#</a> 整数</h4><table><thead><tr><th style=text-align:left>有符号类型</th><th style=text-align:left>无符号类型</th><th style=text-align:left>所占字节个数</th><th style=text-align:left>字节长度</th></tr></thead><tbody><tr><td style=text-align:left>i8</td><td style=text-align:left>u8</td><td style=text-align:left>1个字节</td><td style=text-align:left>8位</td></tr><tr><td style=text-align:left>i16</td><td style=text-align:left>u16</td><td style=text-align:left>2个字节</td><td style=text-align:left>16位</td></tr><tr><td style=text-align:left>i32</td><td style=text-align:left>u32</td><td style=text-align:left>4个字节</td><td style=text-align:left>32位</td></tr><tr><td style=text-align:left>i64</td><td style=text-align:left>u64</td><td style=text-align:left>8个字节</td><td style=text-align:left>64位</td></tr><tr><td style=text-align:left>i128</td><td style=text-align:left>u128</td><td style=text-align:left>16个字节</td><td style=text-align:left>128位</td></tr><tr><td style=text-align:left>isize</td><td style=text-align:left>usize</td><td style=text-align:left>视架构而定</td><td style=text-align:left>视架构而定</td></tr></tbody></table><p><code>isize</code>和<code>usize</code>类型取决于程序运行时所在的计算机CPU类型，若CPU是32位的，则这两个类型是32位的；若CPU是64位，那么它们则是64位。</p><p><strong>无符号数</strong>所表示的数值只能取正数和0，而<strong>有符号数</strong>所表示数值可以取正数、负数还有0。当要强调正负符号时，可以在数字前面带上正号或负号。有符号数以补码形式存储在内存中。</p><p>Rust的整型变量默认使用<code>i32</code>有符号类型，该类型也是性能最好的。</p><h4 id=数字字面量><a class=anchor href=#数字字面量>#</a> 数字字面量</h4><p>十进制(Decimal) - <code>98_222</code></p><p>十六进制(Hexadecimal) - <code>0xff</code></p><p>八进制(Octal) - <code>0o77</code></p><p>二进制(Binary) - <code>0b1111_0000</code></p><p>字节(仅限<code>u8</code>类型) - <code>b'A'</code></p><h4 id=浮点数><a class=anchor href=#浮点数>#</a> 浮点数</h4><table><thead><tr><th style=text-align:left>类型</th><th style=text-align:left>所占字节</th><th style=text-align:left>字节长度</th></tr></thead><tbody><tr><td style=text-align:left>f32</td><td style=text-align:left>4个字节</td><td style=text-align:left>32位</td></tr><tr><td style=text-align:left>f64 - (浮点数数据默认类型)</td><td style=text-align:left>8个字节</td><td style=text-align:left>64位</td></tr></tbody></table><h4 id=nan><a class=anchor href=#nan>#</a> NaN</h4><p>对于数学上未定义的结果，即表示不是一个数(Not a Number)。</p><p>所有跟<code>NaN</code>交互的操作都会返回一个<code>NaN</code>，并且<code>NaN</code>不能进行比较，如需判断可使用<code>is_nan()</code>方法进行判断。</p><h3 id=字符类型-char><a class=anchor href=#字符类型-char>#</a> 字符类型 - char</h3><p>Rust字符不仅仅是<code>ASCII</code>，所有<code>Unicode</code>值都可以作为Rust字符，包括单个的中文，日文，韩文，emoji表情符号等。由于<code>Unicode</code>都是4个字节编码，因此字符类型也是占用4个字节。</p><h3 id=布尔类型-bool><a class=anchor href=#布尔类型-bool>#</a> 布尔类型 - bool</h3><p>布尔类型有两个值：<code>true</code>和<code>false</code>，布尔值占用内存大小为1个字节。 - <code>let a:bool = true;</code></p><h3 id=单元类型-><a class=anchor href=#单元类型->#</a> 单元类型 - ()</h3><p>单元类型就是<code>()</code>，其唯一值也为<code>()</code>。</p><p>没有返回值的函数就会返回一个单元类型，这种类型的函数在Rust中是有单独的定义 - 发散函数(diverge function)，即无法收敛的函数。</p><h2 id=注释><a class=anchor href=#注释>#</a> 注释</h2><h3 id=代码注释><a class=anchor href=#代码注释>#</a> 代码注释</h3><p>单行注释(行注释) - <code>//....</code></p><p>多行注释(块注释) - <code>/*...*/</code>，无法嵌套</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 注释内容</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">/* 注释内容 */</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment"> * 注释内容</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment"> * 注释内容</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><h3 id=文档注释><a class=anchor href=#文档注释>#</a> 文档注释</h3><p>支持<code>Markdown</code>语法，例如<code># Examples</code>的标题，以及代码块高亮。</p><p>文档注释需要位于<code>lib</code>类型的包中，例如<code>src/lib.rs</code>中。</p><p>被注释的对象需要使用<code>pub</code>对外可见(文档注释是给用户看的，内部实现细节不应该被暴露出去)。</p><figure class="highlight rust"><figcaption data-lang=Rust><span>文档行注释</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/// `add_one` 将指定值加1</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">///</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/// # Examples</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">///</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/// ```</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/// let arg = 5;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">/// let answer = my_crate::add_one(arg);</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">///</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/// assert_eq!(6, answer);</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">/// ```</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">add_one</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    x <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight rust"><figcaption data-lang=Rust><span>文档块注释</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/** `add_two` 将指定值加2</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment"></span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment"></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">```</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">let arg = 5;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">let answer = my_crate::add_two(arg);</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment"></span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">assert_eq!(7, answer);</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">```</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">*/</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">add_two</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    x <span class="token operator">+</span> <span class="token number">2</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>如何查看文档</strong> - 使用<code>cargo doc</code>可直接生成<code>HTML</code>文件，文件位于<code>target/doc</code>目录下。</p><h2 id=变量与常量><a class=anchor href=#变量与常量>#</a> 变量与常量</h2><h3 id=变量基本命令规范><a class=anchor href=#变量基本命令规范>#</a> 变量基本命令规范</h3><p>通常，对于<code>type-level</code>的构造，Rust倾向于使用<strong>驼峰命名法</strong>，而对于<code>value-level</code>的构造使用<strong>蛇形命名法</strong>。</p><ul><li><p><strong>驼峰命名法</strong> - 复合词的缩略形式被认为是一个单独的词语，只对首字母进行大写(例如，使用<code>Uuid</code>而不是<s>UUID</s>；<code>Usize</code>而不是<s>USize</s>；<code>Stdin</code>而不是<s>StdIn</s>)</p></li><li><p><strong>蛇形命名法</strong> - 缩略词用全小写(例如，<code>is_xid_start</code>)。<strong>蛇形命名法</strong>(包括全大写的<code>SCREAMING_SNAKE_CASE</code>)，除了最后一部分，其它部分的词语都不能由单个字母组成(例如，<code>btree_map</code>而不是<s>b_tree_map</s>，<code>PI_2</code>而不是<s>PI2</s>)</p></li></ul><p>Rust的<strong>包名</strong>不应该使用<code>-rs</code>或者<code>-rust</code>作为后缀，因为每一个包都是Rust写的，因此这种多余的注释是没有任何意义的。</p><p>Rust的<strong>关键字</strong>被保留给Rust语言使用，不能被用作变量或函数的名称。</p><h3 id=变量可变性><a class=anchor href=#变量可变性>#</a> 变量可变性</h3><p>Rust的变量在默认情况下是<strong>不可变的</strong>，可以通过<code>mut</code>关键字让变量变为<strong>可变的</strong>。当变量绑定值后，就不能再被修改了。</p><h3 id=变量绑定与解构><a class=anchor href=#变量绑定与解构>#</a> 变量绑定与解构</h3><p><font size=3><ins><strong>绑定</strong></ins></font></p><p>变量使用<code>let</code>关键字声明 - <code>let a = 10</code>。变量绑定不支同时为多个变量声明(例如，<code>let mut p1 = 0, p2 = 0;</code>❌)。与其他编程语言不同，这里的赋值操作在Rust中称为绑定，如上例子可描述为将值10绑定到变量a，这个过程称为变量绑定。由于Rust的所有权系统的存在，才有了这个变量绑定的概念。</p><p><font size=3><ins><strong>使用下划线开头忽略未使用的变量</strong></ins></font></p><p>如果创建了一个变量却不在任何地方使用它，Rust通常会报一个警告，希望告诉Rust不要警告未使用的变量，为此可以用下划线作为变量名的开头 - <code>let _a = 10</code></p><p><font size=3><ins><strong>解构</strong></ins></font></p><p><code>let</code>表达式不仅仅用于变量的绑定，还能进行复杂变量的解构。例如从一个相对复杂的变量中匹配出该变量的一部分内容 - <code>let (a,mut b):(bool,bool) = (true,false);</code></p><p><font size=3><ins><strong>解构式赋值</strong></ins></font></p><p>可以在赋值语句的左式中使用元组、切片和结构体模式。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Struct</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    e<span class="token punctuation">:</span> <span class="token keyword">i32</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">let</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token comment">// _ 代表匹配一个值，但是不关心具体的值是什么，因此没有使用一个变量名而是使用了 _</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token punctuation">[</span>c<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> _<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token class-name">Struct</span> <span class="token punctuation">&#123;</span> e<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token class-name">Struct</span> <span class="token punctuation">&#123;</span> e<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=变量作用域><a class=anchor href=#变量作用域>#</a> 变量作用域</h3><p>变量作用域是一个变量在程序中有效的范围。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token punctuation">&#123;</span>                      <span class="token comment">// s在这里无效，它尚未声明</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>   <span class="token comment">// 从此处起，s是有效的</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token comment">// 使用 s</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span>                      <span class="token comment">// 此作用域已结束，s不再有效</span></pre></td></tr></table></figure><p>就作用域来说，Rust语言跟其他编程语言没有区别。</p><h3 id=变量遮蔽shadowing><a class=anchor href=#变量遮蔽shadowing>#</a> 变量遮蔽(shadowing)</h3><p>Rust允许声明相同的变量名，在后面声明的变量会遮蔽掉前面声明的变量。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token comment">// 在main函数的作用域内对之前的x进行遮蔽</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token comment">// 在当前的花括号作用域内，对之前的x进行遮蔽</span></pre></td></tr><tr><td data-num=9></td><td><pre>        <span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x in the inner scope is: &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x is: &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"> * 首先将数值5绑定到x，然后通过重复使用`let x =`来遮蔽之前的x，</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment"> * 并取原来的值加上1，所以x的值变成了6。</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment"> * 第三个let语句同样遮蔽前面的x，取之前的值并乘上2，&#123;&#125;里面得到的x最终值为12。</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment"> * 由于&#123;&#125;里面x的作用域是&#123;&#125;内，最后的println!宏中所指的x是当前作用域的，因此</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment"> * 最后输出为6。</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><p>第二个<code>let</code>生成了完全不同的新变量，两个变量只是恰好拥有同样的名称，这个过程涉及一次内存对象的再分配 。这和<code>mut</code>变量的使用是不同的，<code>mut</code>声明的变量可以修改同一个内存地址上的值，并不会发生内存对象的再分配。</p><h3 id=常量constant><a class=anchor href=#常量constant>#</a> 常量(constant)</h3><p>常量与不可变变量一样，常量也是绑定到一个常量名并且是不允许更改的值，但是常量和变量之间存在一些差异</p><ul><li>常量不允许使用<code>mut</code>关键字 - 常量不仅仅默认不可变，而且<strong>自始至终不可变</strong>，因为常量在编译完成后就确定了它的值</li><li>常量使用<code>const</code>关键字而不是<code>let</code> 关键字来声明，并且值的类型<strong>必须</strong>标注 - <code>const MAX_POINTS: u32 = 100_000;</code></li></ul><p>常量可以在任意作用域内声明，包括全局作用域。在声明的作用域内，常量在程序运行的整个过程中都有效，在实际使用中，最好将程序中用到的硬编码都声明为常量。</p><h2 id=运算符><a class=anchor href=#运算符>#</a> 运算符</h2><p>与C语言一样，但没有自增与自减运算符，支持逗号表达式(let语句除外)。</p><p><strong>逻辑运算符</strong></p><ul><li><code>&amp;</code> - 按位与</li><li><code>|</code> - 按位或</li><li><code>^</code> - 按位异或</li><li><code>!</code> - 按位非(取反) - 把二进制位中的0和1相互取反，即0变为1，1变为0</li></ul><p><strong>移位运算符</strong></p><ul><li><code>&lt;&lt;</code> - 左移运算符</li><li><code>&gt;&gt;</code> - 右移运算符</li></ul><h2 id=语句statement与表达式expression><a class=anchor href=#语句statement与表达式expression>#</a> 语句(statement)与表达式(expression)</h2><p>Rust的函数体是由一系列语句组成，最后由一个表达式来返回值。语句会执行一些操作但是<strong>不会返回一个值</strong>，而表达式会在求值后会<strong>返回一个值</strong>。</p><p><font size=3><ins><strong>语句</strong></ins></font></p><p>完成了一个具体的操作，但是并没有返回值，它就是语句。</p><p><code>let</code>是语句，因此不能将<code>let</code>语句赋值给其它值。</p><p><font size=3><ins><strong>表达式</strong></ins></font></p><p>表达式会进行求值，可以成为语句的一部分。调用一个函数是表达式，因为会返回一个值；调用宏也是表达式；用花括号包裹最终返回一个值的语句块也是表达式。总之，能返回值，它就是表达式。</p><p>表达式如果不返回任何值，会隐式地返回一个单元类型<code>()</code>。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 例子1</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    x <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment"> * 它的最后一行是表达式，</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"> * 返回了`x + 1`的值，注意`x + 1`不能以分号结尾，</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment"> * 否则就会从表达式变成语句。</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">// 例子2</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">add_with_extra</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> </pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token keyword">let</span> x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 语句</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token keyword">let</span> y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 语句</span></pre></td></tr><tr><td data-num=17></td><td><pre>    x <span class="token operator">+</span> y <span class="token comment">// 表达式</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=关键字><a class=anchor href=#关键字>#</a> 关键字</h2><p>关键字不能被用作标识符，除了原生标识符。</p><p>原生标识符(Raw identifiers)允许使用通常不能使用的关键字，其带有<code>r#</code>前缀。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 无法使用关键字作标识符</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">match</span><span class="token punctuation">(</span>needle<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> haystack<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    haystack<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>needle<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">// 使用原生标识符</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">r</span>#<span class="token keyword">match</span><span class="token punctuation">(</span>needle<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> haystack<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    haystack<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>needle<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>r#<span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"foobar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>Rust中正在使用的关键字</strong></ins></font></p><table><thead><tr><th style=text-align:left>loop</th><th style=text-align:left>for</th><th style=text-align:left>while</th><th style=text-align:left>in</th><th style=text-align:left>fn</th><th style=text-align:left>break</th><th style=text-align:left>continue</th><th style=text-align:left>if</th><th style=text-align:left>else</th></tr></thead><tbody><tr><td style=text-align:left>true</td><td style=text-align:left>false</td><td style=text-align:left>let</td><td style=text-align:left>use</td><td style=text-align:left>type</td><td style=text-align:left>match</td><td style=text-align:left>return</td><td style=text-align:left>mut</td><td style=text-align:left>pub</td></tr><tr><td style=text-align:left>const</td><td style=text-align:left>continue</td><td style=text-align:left>enum</td><td style=text-align:left>struct</td><td style=text-align:left>Self</td><td style=text-align:left>self</td><td style=text-align:left>mod</td><td style=text-align:left>super</td><td style=text-align:left>static</td></tr><tr><td style=text-align:left>move</td><td style=text-align:left>mode</td><td style=text-align:left>dyn</td><td style=text-align:left>crate</td><td style=text-align:left>unsafe</td><td style=text-align:left>impl</td><td style=text-align:left>trait</td><td style=text-align:left>extern</td><td style=text-align:left>as</td></tr></tbody></table><p><font size=3><ins><strong>Rust中保留作将来使用的关键字</strong></ins></font></p><table><thead><tr><th style=text-align:left>abstract</th><th style=text-align:left>async</th><th style=text-align:left>await</th><th style=text-align:left>become</th><th style=text-align:left>box</th><th style=text-align:left>do</th><th style=text-align:left>final</th><th style=text-align:left>macro</th></tr></thead><tbody><tr><td style=text-align:left>override</td><td style=text-align:left>priv</td><td style=text-align:left>try</td><td style=text-align:left>typeof</td><td style=text-align:left>unsized</td><td style=text-align:left>virtual</td><td style=text-align:left>yield</td><td style=text-align:left></td></tr></tbody></table><h2 id=使用as关键字的类型转换><a class=anchor href=#使用as关键字的类型转换>#</a> 使用as关键字的类型转换</h2><p>Rust是类型安全的语言，在Rust中做类型转换不是一件简单的事。</p><p>Rust中内置了一些基本类型之间的转换，可以使用<code>as</code>关键字来完成一个类型到另一个类型的转换，最常用于将原始类型转换为其他原始类型，但是它也可以完成诸如将指针转换为地址、地址转换为指针以及将指针转换为其他指针等功能。</p><p>每个类型能表达的数据范围不同，如果把范围较大的类型转换成较小的类型会造成错误，通常都是把范围较小的类型转换成较大的类型。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> b<span class="token punctuation">:</span> <span class="token keyword">u16</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    </pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">if</span> a <span class="token operator">&lt;</span> <span class="token punctuation">(</span>b <span class="token keyword">as</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Ten is less than one hundred."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=分支和循环><a class=anchor href=#分支和循环>#</a> 分支和循环</h2><h3 id=if-else分支语句><a class=anchor href=#if-else分支语句>#</a> if-else分支语句</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 分支语句基本形式</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">if</span> condition <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token comment">// A...</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token comment">// B...</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">// `if`语句块是表达式</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">let</span> condition <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token keyword">if</span> condition <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>        <span class="token number">5</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>        <span class="token number">6</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// 用于变量，需确保返回值类型唯一</span></pre></td></tr><tr><td data-num=17></td><td><pre></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The value of number is: &#123;&#125;"</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token comment">// else if的多分支条件</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is divisible by 4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is divisible by 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is divisible by 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=33></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number is not divisible by 4, 3, or 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=序列range><a class=anchor href=#序列range>#</a> 序列(Range)</h3><p>Rust提供了一个用来生成连续的数值的方式。例如，<code>1..5</code>会生成从1到4的连续数字，不包含5；<code>1..=5</code>会生成从1到5的连续数字并包含5，常常用于循环中。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">5</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>序列只允许用于具有<strong>连续性</strong>的数字或字符类型，同时编译器在编译期可以检查该序列是否为空，字符和数字值是Rust中仅有的可以用于判断是否为空的类型。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token char">'a'</span><span class="token punctuation">..=</span><span class="token char">'z'</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=for循环><a class=anchor href=#for循环>#</a> for循环</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">5</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"> * for 元素 in 集合 &#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment"> * 	 // 使用元素.....</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment"> * &#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">// 如果想在循环中获取元素的索引，可使用enumerate()</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token comment">// `iter()`方法把`a`数组变成一个迭代器</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"第&#123;&#125;个元素是&#123;&#125;"</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token comment">// 想用for循环控制某个过程执行10次，但是又不想单独声明一个变量来控制这个流程</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=25></td><td><pre>  <span class="token comment">// ...</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token comment"> * 用`_`来替代i用于for循环中，在Rust中`_`的含义是忽略该值或者类型的意思，</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token comment"> * 如果不使用`_`，编译器会报一个变量未使用的的警告。</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=31></td><td><pre></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token comment">// 使用continue关键字可以跳过当前当次的循环</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">4</span> </pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=36></td><td><pre>     <span class="token keyword">continue</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=38></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=40></td><td><pre></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token comment">// 使用break关键字可以直接跳出当前整个循环</span></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">4</span> </pre></td></tr><tr><td data-num=43></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=44></td><td><pre>     <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=45></td><td><pre>         <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>     <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre>     <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><details class=info><summary>for循环语句中关于引用的问题</summary><div><p>使用<code>for</code>时，往往是使用集合的引用形式，除非不想在后面的代码中继续使用该集合(比如这里使用了<code>container</code>的引用。如果不使用引用的话，所有权会被转移(move)到<code>for</code>语句块中，后面就无法再使用这个集合了)。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 使用引用</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token operator">&amp;</span>container <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>  <span class="token comment">// ...</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">// 如果想在循环中修改元素，可以使用mut关键字</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> collection <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>  <span class="token comment">// ...</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div></details><h3 id=while循环><a class=anchor href=#while循环>#</a> while循环</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">while</span> n <span class="token operator">&lt;=</span> <span class="token number">5</span>  </pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;!"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"我出来了！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=loop循环><a class=anchor href=#loop循环>#</a> loop循环</h3><p>loop循环为无条件循环，适用于所有循环场景，是一个简单的无限循环，可以在内部实现逻辑通过<code>break</code>关键字来控制循环何时结束。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">loop</span> </pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token keyword">if</span> n <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num=9></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>        n <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"我出来了！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=break关键字><a class=anchor href=#break关键字>#</a> break关键字</h3><p>break关键字可以单独使用，也可以带一个返回值。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>        counter <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token keyword">if</span> counter <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>            <span class="token keyword">break</span> counter <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The result is &#123;&#125;"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=数组><a class=anchor href=#数组>#</a> 数组</h2><p>数组是Rust的基本类型，是长度固定的<code>array</code>。</p><p>数组<code>array</code>是存储在栈上，索引下标是从0开始的。</p><p><strong>数组的三要素</strong></p><ul><li>长度固定</li><li>元素必须有相同的类型</li><li>元素依次呈线性排列</li></ul><p>当尝试使用索引访问元素时，Rust将检查指定的索引是否小于数组长度。如果索引大于或等于数组长度，Rust会出现<code>panic</code>，这种检查只在运行时进行。</p><h3 id=数组的创建><a class=anchor href=#数组的创建>#</a> 数组的创建</h3><p>在Rust中，数组必须在声明时就进行初始化。数组的长度在声明时必须是常量表达式，不能是变量或动态值。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 基本创建方法</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">// [类型; 长度]</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 为数组声明类型并初始化</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">/** </span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment"> * 数组类型是通过方括号语法声明，</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment"> * i32是元素类型，分号后面的数字5是数组长度。</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 某个值重复出现N次的数组，5个3</span></pre></td></tr></table></figure><h3 id=数组切片><a class=anchor href=#数组切片>#</a> 数组切片</h3><p><strong>切片</strong>(slice)允许引用集合中部分连续的元素序列，而不是引用整个集合。</p><p>创建切片的语法 - 使用方括号包裹的一个序列 - <code>[开始索引..终止索引]</code>。</p><ul><li><strong>开始索引</strong>是切片中第一个元素的索引位置</li><li><strong>终止索引</strong>是最后一个元素后面的索引位置</li></ul><p>数组切片是一个<code>左闭右开的区间</code>，即包括开始索引位置的数据，不包括终止索引位置的数据。</p><p>在切片数据结构内部会保存开始的位置和切片的长度，其中长度是通过<strong>终止索引位置减去开始索引位置</strong>的方式计算得来的。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">let</span> slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 数组切片`slice`的类型是&amp;[i32]</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>切片的特点</strong></p><ul><li>切片的长度并不是固定的，可以与数组不同，取决于使用时指定的起始和结束位置</li><li>创建切片的代价非常小，因为切片只是针对底层数组的一个引用</li><li>切片类型<code>[T]</code>拥有不固定的大小，而切片引用类型<code>&amp;[T]</code>具有固定的大小，因为Rust很多时候都需要固定大小数据类型，因此<code>&amp;[T]</code>更有用</li></ul><h2 id=字符串><a class=anchor href=#字符串>#</a> 字符串</h2><p>字符串是由字符组成的连续集合，但Rust中的字符是Unicode类型，因此每个字符占据4个字节内存空间，但在字符串中不一样，字符串是UTF-8编码，即字符串中的字符所占的字节数是变化的<code>(1 ~ 4)</code>个字节，这有助于大幅降低字符串所占用的内存空间。</p><p>字符串使用双引号<code>&quot;&quot;</code>而不是单引号<code>''</code>，单引号是给单个字符类型(<code>char</code>)使用的。</p><h3 id=字符串切片><a class=anchor href=#字符串切片>#</a> 字符串切片</h3><p>字符串切片的类型标识 - <code>&amp;str</code></p><p>对于<code>let world = &amp;s[6..11];</code>来说，<code>world</code>是一个切片，该切片的指针指向<code>s</code>的第7个字节(索引从0开始, 6是第7个字节)，且该切片的长度是5个字节。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">let</span> len <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取字符串长度</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">// 在使用Rust的`..`range序列语法时，如果想从索引0开始，可以使用如下的方式</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">// 使切片包含String的最后一个字节</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">..</span>len<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">// 截取整个String的切片</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span>len<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment">// 声明一个函数，输入为String类型，返回值为它的切片 </span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">first_word</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">str</span></pre></td></tr></table></figure><p>在对字符串使用切片语法时，切片的索引必须落在字符之间的边界位置，也就是UTF-8字符的边界。</p><p>Rust在语言级别，只有一种字符串类型 - <code>str</code>，通常是以引用类型出现 - <code>&amp;str</code>，即字符串切片。虽然语言级别只有<code>str</code>类型，但是在标准库里还有使用最广的<code>String</code>类型。</p><p><code>str</code>类型是硬编码进可执行文件，无法被修改。但<code>String</code>是一个可增长、可改变且具有所有权的UTF-8编码字符串。当Rust用户提到字符串时，往往指的就是<code>String</code>类型和<code>&amp;str</code>字符串切片类型，两者都是UTF-8编码。</p><p><font size=3><ins><strong>字符串字面量是切片</strong></ins></font></p><p>字符串字面值是不可变的，例如<code>let s =&quot;hello&quot;</code>，<code>s</code>是被硬编码进程序里的字符串值(类型为<code>&amp;str</code>)。该切片指向了程序可执行文件中的某个点，字符串字面量是不可变的原因是<code>&amp;str</code>是一个不可变引用。</p><h3 id=字符串string类型索引><a class=anchor href=#字符串string类型索引>#</a> 字符串(String类型)索引</h3><p>在Rust中使用索引的方式访问字符串的某个字符或子串都会报错。</p><p>字符串底层的数据存储格式实际上是<code>[u8]</code>，一个字节数组。</p><p>对于<code>let hello = String::from(&quot;Hola&quot;);</code>这行代码，<code>Hola</code>的长度是4个字节，因为<code>&quot;Hola&quot;</code>中的每个字母在UTF-8编码中仅占用1个字节。但对于类似<code>let hello = String::from(&quot;冲国人&quot;);</code>的代码，大部分常用汉字在UTF-8编码中的长度是3个字节，这种情况下对<code>hello</code>进行索引，访问<code>&amp;hello[0]</code>是没有任何意义的，因为这样取不到<code>冲</code>这个字符，而是取到了这个字符里三个字节中的第一个字节。</p><p>Rust提供了不同的字符串展现方式，无需去管字符串从人类语言角度看长什么样。</p><p>对于索引操作，总是期望它的性能表现是O(1)，然而对于<code>String</code>类型来说，无法保证这一点，因为Rust可能需要从0开始去遍历字符串来定位合法的字符，这也是导致Rust不允许去索引字符串的原因之一。</p><h3 id=字符串相关操作><a class=anchor href=#字符串相关操作>#</a> 字符串相关操作</h3><h4 id=追加push><a class=anchor href=#追加push>#</a> 追加(push)</h4><p><code>push()</code>方法 - 在字符串尾部追加字符</p><p><code>push_str()</code>方法 - 在字符串尾部追加字符串字面量</p><p>这两个方法都是在原有的字符串上追加，并不会返回新的字符串。由于字符串追加操作要修改原来的字符串，该字符串必须是可变的，即字符串变量必须有<code>mut</code>关键字修饰。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"追加字符串 push_str() -> &#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"追加字符 push() -> &#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=插入insert><a class=anchor href=#插入insert>#</a> 插入(Insert)</h4><p><code>insert()</code>方法 - 插入单个字符</p><p><code>insert_str()</code>方法 - 插入字符串字面量</p><p>这两个方法都需要传入两个参数，第一个参数是字符(串)插入位置的索引，第二个参数是要插入的字符(串)。索引从0开始计数，如果索引越界则会发生错误。由于字符串插入操作需要修改原来的字符串，该字符串必须是可变的，即字符串变量必须有<code>mut</code>关键字修饰。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello rust!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"插入字符 insert() -> &#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">insert_str</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">" I like"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"插入字符串 insert_str() -> &#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=替换replace><a class=anchor href=#替换replace>#</a> 替换(Replace)</h4><p>把字符串中的某个字符串替换成其它的字符串，与替换有关的方法有三个。</p><p><font size=3><ins><strong>replace()方法</strong></ins></font></p><p>适用于<code>String</code>和<code>&amp;str</code>类型。接收两个参数，第一个参数是要被替换的字符串，第二个参数是新的字符串，该方法会替换所有匹配到的字符串，返回一个新的字符串。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> string_replace <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I like rust. Learning rust is my favorite!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> new_string_replace <span class="token operator">=</span> string_replace<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">,</span> <span class="token string">"RUST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>new_string_replace<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>replacen()方法</strong></ins></font></p><p>适用于<code>String</code>和<code>&amp;str</code>类型。接收三个参数，前两个参数与<code>replace()</code>方法一样，第三个参数则表示替换的个数，返回一个新的字符串。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> string_replace <span class="token operator">=</span> <span class="token string">"I like rust. Learning rust is my favorite!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> new_string_replacen <span class="token operator">=</span> string_replace<span class="token punctuation">.</span><span class="token function">replacen</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">,</span> <span class="token string">"RUST"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>new_string_replacen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>replace_range()方法</strong></ins></font></p><p>仅适用于<code>String</code>类型。接收两个参数，第一个参数是要替换字符串的范围序列(Range)，第二个参数是新的字符串。该方法是直接操作原来的字符串，不会返回新的字符串，需要使用<code>mut</code>关键字修饰。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_replace_range <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I like rust!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    string_replace_range<span class="token punctuation">.</span><span class="token function">replace_range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">..</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">"R"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_replace_range<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=删除delete><a class=anchor href=#删除delete>#</a> 删除(Delete)</h4><p>与字符串删除相关的方法有4个，这四个方法仅适用于<code>String</code>类型，都需要使用<code>mut</code>关键字修饰。</p><p><font size=3><ins><strong>pop()方法</strong></ins></font></p><p>删除并返回字符串的最后一个字符。该方法是直接操作原来的字符串，其返回值是一个<code>Option</code>类型，如果字符串为空，则返回<code>None</code>。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_pop <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust pop 中文!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> p1 <span class="token operator">=</span> string_pop<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> string_pop<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_pop<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>remove()方法</strong></ins></font></p><p>删除并返回字符串中指定位置的字符。该方法是直接操作原来的字符串，其返回值是删除位置的字符串。只接收一个参数，表示该字符起始索引位置。该方法是按照字节来处理字符串的，如果参数所给的位置不是合法的字符边界，则会发生错误。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_remove <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"测试remove方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=5></td><td><pre>        <span class="token string">"string_remove 占 &#123;&#125; 个字节"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>        <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of_val</span><span class="token punctuation">(</span>string_remove<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token comment">// 删除第一个汉字</span></pre></td></tr><tr><td data-num=9></td><td><pre>    string_remove<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token comment">// 下面代码会发生错误</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token comment">// string_remove.remove(1);</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token comment">// 直接删除第二个汉字</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token comment">// string_remove.remove(3);</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_remove<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>truncate()方法</strong></ins></font></p><p>删除字符串中从指定位置开始到结尾的全部字符。该方法是直接操作原来的字符串，无返回值。该方法是按照字节来处理字符串的，如果参数所给的位置不是合法的字符边界，则会发生错误。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_truncate <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"测试truncate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    string_truncate<span class="token punctuation">.</span><span class="token function">truncate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_truncate<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>clear()方法</strong></ins></font></p><p>清空字符串。该方法是直接操作原来的字符串，调用后，删除字符串中的所有字符，相当于<code>truncate()</code>方法参数为0的时候。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_clear <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"string clear"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    string_clear<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_clear<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=连接concatenate><a class=anchor href=#连接concatenate>#</a> 连接(Concatenate)</h4><p><font size=3><ins><strong>使用<code>+</code>或者<code>+=</code>连接字符串</strong></ins></font></p><p>要求右边的参数必须为字符串的切片引用(<code>&amp;str</code>)类型。</p><p>当调用<code>+</code>的操作符时，相当于调用了<code>std::string</code>标准库中的<code>add()</code>方法，这里<code>add()</code>方法的第二个参数是一个引用的类型，因此，在使用<code>+</code>时， 必须传递切片引用类型，而不能直接传递<code>String</code>类型。<code>+</code>会返回一个新的字符串，所以变量声明可以不需要<code>mut</code>关键字修饰。</p><p>add方法的定义 - <code>fn add(self, s: &amp;str) -&gt; String</code></p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> string_append <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> string_rust <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token comment">// &amp;string_rust会自动解引用为&amp;str</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">let</span> result <span class="token operator">=</span> string_append <span class="token operator">+</span> <span class="token operator">&amp;</span>string_rust<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> result <span class="token operator">=</span> result <span class="token operator">+</span> <span class="token string">"!"</span><span class="token punctuation">;</span><span class="token comment">// `result + "!"` 中的 `result` 是不可变的</span></pre></td></tr><tr><td data-num=8></td><td><pre>    result <span class="token operator">+=</span> <span class="token string">"!!!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"连接字符串 + -> &#123;&#125;"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>使用<code>format!</code>宏连接字符串</strong></ins></font></p><p>这种方式适用于<code>String</code>和<code>&amp;str</code>。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; &#123;&#125;!"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=大小写转换><a class=anchor href=#大小写转换>#</a> 大小写转换</h4><p><code>.to_lowercase()</code> - 将字符串中字母转为小写</p><p><code>.to_uppercase()</code> - 将字符串中字母转为大写</p><p>返回一个新的字符串(String类型)。</p><h3 id=字符串遍历><a class=anchor href=#字符串遍历>#</a> 字符串遍历</h3><p>对UTF-8默认格式的字符串，以Unicode字符的方式来遍历字符串 - <code>chars()</code>方法</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"冲国人"</span><span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>返回字符串的底层字节数组表现形式 - <code>bytes()</code>方法</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token string">"冲国人"</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=字符串相关方法><a class=anchor href=#字符串相关方法>#</a> 字符串相关方法</h3><p><code>trim()</code>方法</p><p>用于移除字符串的首尾空白字符，包括空格、制表符和换行符等。不会修改原始字符串，而是返回一个新的字符串。</p><p><code>parse::&lt;数据类型&gt;()</code>方法</p><p>用于将字符串解析成对应的数据类型 - <code>pos.trim().parse::&lt;usize&gt;().unwrap()</code></p><h3 id=转义字符><a class=anchor href=#转义字符>#</a> 转义字符</h3><p>通过转义的方式<code>\</code>输出ASCII和Unicode字符。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=2></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token comment">// 通过`\`与字符的十六进制表示，转义输出一个字符</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> byte_escape <span class="token operator">=</span> <span class="token string">"I'm writing \x52\x75\x73\x74!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"What are you doing\x3F (\\x3F means ?) &#123;&#125;"</span><span class="token punctuation">,</span> byte_escape<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token comment">// `\u`可以输出一个unicode字符</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">let</span> unicode_codepoint <span class="token operator">=</span> <span class="token string">"\u&#123;211D&#125;"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token keyword">let</span> character_name <span class="token operator">=</span> <span class="token string">"\"DOUBLE-STRUCK CAPITAL R\""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=12></td><td><pre>        <span class="token string">"Unicode character &#123;&#125; (U+211D) is called &#123;&#125;"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>        unicode_codepoint<span class="token punctuation">,</span> character_name</pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">     * 换行了也会保持之前的字符串格式</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment">     * 使用`\`忽略换行符</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment">    **/</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token keyword">let</span> long_string <span class="token operator">=</span> <span class="token string">"String literals</span></pre></td></tr><tr><td data-num=21></td><td><pre>                        can span multiple lines.</pre></td></tr><tr><td data-num=22></td><td><pre>                        The linebreak and indentation here ->\</pre></td></tr><tr><td data-num=23></td><td><pre>                        &lt;- can be escaped too!"<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> long_string<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token comment">// 在某些情况下，希望保持字符串的原样，不要转义</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"hello \\x52\\x75\\x73\\x74"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token keyword">let</span> raw_str <span class="token operator">=</span> <span class="token string">r"Escapes don't work here: \x3F \u&#123;211D&#125;"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> raw_str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token comment">// 如果字符串包含双引号，可以在开头和结尾加`#`</span></pre></td></tr><tr><td data-num=36></td><td><pre>    <span class="token keyword">let</span> quotes <span class="token operator">=</span> <span class="token string">r#"And then I said: "There is no escape!""#</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> quotes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token comment">// 如果还是有歧义，可以继续增加`#`，没有限制</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token keyword">let</span> longer_delimiter <span class="token operator">=</span> <span class="token string">r###"A string with "# in it. And even "##!"###</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> longer_delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=ascii码字符类型判断方法><a class=anchor href=#ascii码字符类型判断方法>#</a> ASCII码字符类型判断方法</h3><table><thead><tr><th>字符方法</th><th>描述</th></tr></thead><tbody><tr><td>.is_ascii_digit()</td><td>检查字符是否是ASCII字符中的数字字符('0' ~ '9')</td></tr><tr><td>.is_ascii_uppercase()</td><td>检查字符是否是ASCII字符中的大写字母('A' ~ 'Z')</td></tr><tr><td>.is_ascii_lowercase()</td><td>检查字符是否是ASCII字符中的小写字母('a' ~ 'z')</td></tr><tr><td>.is_ascii_alphabetic()</td><td>检查字符是否是ASCII字符中的字母</td></tr><tr><td>.is_ascii_alphanumeric()</td><td>检查字符是否是 ASCII 字符中的字母或数字</td></tr><tr><td>.is_ascii_control()</td><td>检查字符是否是ASCII控制字符(换行，制表符，回车符)</td></tr><tr><td>.is_ascii_whitespace()</td><td>检查字符是否是ASCII空白字符</td></tr></tbody></table><h2 id=所有权><a class=anchor href=#所有权>#</a> 所有权</h2><p>Rust通过所有权来管理内存，编译器在编译时会根据一系列规则进行检查，这种检查只发生在编译期，因此在程序运行时，不会有任何性能上的损失。结构体等结构中的成员字段也具有所有权。</p><h3 id=所有权与堆栈><a class=anchor href=#所有权与堆栈>#</a> 所有权与堆栈</h3><p>当在代码中调用一个函数时，传递给函数的参数(包括可能指向堆上数据的<strong>指针</strong>和函数的<strong>局部变量</strong>)依次被压入栈中，当函数调用结束时，这些值将被从栈中按照相反的顺序依次移除。</p><p>因为堆上的数据是缺乏组织的，因此跟踪这些数据何时分配和释放是非常重要的，否则堆上的数据将产生内存泄漏，会导致这些数据将永远无法被回收，但在Rust中，由所有权系统提供了强大保障。</p><h3 id=所有权规则><a class=anchor href=#所有权规则>#</a> 所有权规则</h3><p>Rust中的每一个值都被一个变量所拥有，该变量被称为值的所有者。</p><p>一个值同时只能被一个变量所拥有，或者说一个值只能拥有一个所有者。</p><p>当所有者(变量)离开作用域范围时，这个值将被丢弃(drop)。</p><h2 id=引用与借用borrowing><a class=anchor href=#引用与借用borrowing>#</a> 引用与借用(Borrowing)</h2><p>Rust通过<strong>借用</strong>这个概念来表示使用某个变量的指针或者引用，而获取变量的引用的这个过程被称之为借用。</p><p><strong>规则</strong></p><ul><li>在给定作用域内，可以有多个不可变引用与零个可变引用，或只能有一个可变引用和零个不可变引用。</li><li>在给定作用域内，不可变引用与可变引用不能同时存在</li><li>变量默认是不可变的，如果需要修改数据，必须使用<code>mut</code>关键字来声明可变变量。在可变变量上创建可变引用是唯一的方式来修改不可变数据。</li></ul><p>Rust中不允许创建引用的引用。</p><h3 id=常规引用><a class=anchor href=#常规引用>#</a> 常规引用</h3><p>常规引用是一个指针类型，指向了对象存储的内存地址。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 创建一个i32值的引用y，然后使用解引用运算符来解出y所使用的值</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 不允许比较整数与引用，因为它们是不同的类型</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">*</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 使用`*`号来解引用</span></pre></td></tr><tr><td data-num=8></td><td><pre>    </pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> b <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> a<span class="token punctuation">;</span><span class="token comment">// 可变借用</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token operator">*</span>b <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span><span class="token comment">// 通过解引用获取a的内存空间来修改该空间的值</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=不可变引用><a class=anchor href=#不可变引用>#</a> 不可变引用</h3><p>引用指向的值默认也是不可变的。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// s1的引用作为参数传递给calculate_length函数，而不是把s1的所有权转移给该函数</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token function">calculate_length</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The length of '&#123;&#125;' is &#123;&#125;."</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">// 函数calculate_length使用&amp;来表明参数s的类型是一个引用</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">calculate_length</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">usize</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">/** </span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment"> * 这里&amp;符号就是引用，它允许使用值，但是不获取所有权。</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment"> * 通过&amp;s1语法创建了一个指向s1的引用，但是并不拥有它。正因为并不拥有这个值，</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"> * 当引用离开作用域后，其指向的值也不会被丢弃。</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><h3 id=可变引用><a class=anchor href=#可变引用>#</a> 可变引用</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment"> * 声明s是可变类型，再创建一个可变的引用`&amp;mut s`</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment"> * 和接受可变引用参数`some_string: &amp;mut String`的函数</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token function">change</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">change</span><span class="token punctuation">(</span>some_string<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    some_string<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">", world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>(<strong>编译器<code>borrow checker</code>特性之一</strong>)<strong>可变引用同时只能存在一个</strong>，同一作用域，特定数据只能有一个可变引用。这种限制的好处就是使Rust在编译期就避免数据竞争，数据竞争可由以下行为造成</p><ul><li>两个或更多的指针同时访问同一数据</li><li>至少有一个指针被用来写入数据</li><li>没有同步数据访问的机制</li></ul><p><font size=3><ins><strong>可变引用与不可变引用不能同时存在</strong></ins></font></p><p>可通过手动添加大括号<code>&#123;&#125;</code>来限制变量的作用域。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span> <span class="token comment">// r1在这里离开了作用域，所以完全可以创建一个新的引用</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=悬垂引用dangling-references><a class=anchor href=#悬垂引用dangling-references>#</a> 悬垂引用(Dangling References)</h3><p>悬垂引用也叫做悬垂指针，意思是指针指向某个值后，这个值被释放掉了，但指针仍然存在，指针指向的内存可能不存在任何值或已被其它变量重新使用。</p><p>在Rust中，编译器可以确保引用永远也不会变成悬垂状态，当获取数据的引用后，编译器可以确保数据不会在引用结束前被释放，当想要释放数据时，必须先停止其引用的使用。</p><h3 id=详细解读><a class=anchor href=#详细解读>#</a> 详细解读</h3><p><code>&amp;</code> → 引用，相当C语言的一级指针，用于指向变量的内存空间，可理解为指针变量的传值操作</p><p><code>&amp;mut</code> → 可变引用，相当于C语言的二级指针，用于修改一级指针指向的内存，可理解为指针变量的传址操作</p><p>在Rust中，参数传址(pass by reference)操作是通过使用引用来实现的。</p><h2 id=string类型与str类型的转换><a class=anchor href=#string类型与str类型的转换>#</a> String类型与&amp;str类型的转换</h2><p>通过取引用或使用<code>.as_str()</code>的方式将<code>String</code>类型转为<code>&amp;str</code>类型。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token function">say_hello</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token function">say_hello</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token function">say_hello</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">say_hello</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>从<code>&amp;str</code>类型生成<code>String</code>类型</p><ul><li><code>String::from(&quot;hello,world&quot;)</code></li><li><code>&quot;hello,world&quot;.to_string()</code></li></ul><h2 id=格式化输出><a class=anchor href=#格式化输出>#</a> 格式化输出</h2><p>与C语言常用的<code>%d</code>，<code>%s</code>不同，Rust选择了<code>&#123;&#125;</code>作为格式化占位符，与 <code>&#123;&#125;</code> 类似，<code>&#123;:?&#125;</code> 也是占位符。当需要调试时使用<code>&#123;:?&#125;</code>，剩下的场景选择<code>&#123;&#125;</code>即可。</p><ul><li><code>&#123;&#125;</code> - 适用于实现了<code>std::fmt::Display</code>特征的类型，用来以更优雅、更友好的方式格式化文本</li><li><code>&#123;:?&#125;</code> - 适用于实现了<code>std::fmt::Debug</code>特征的类型，用于调试场景</li></ul><h3 id=标准输出><a class=anchor href=#标准输出>#</a> 标准输出</h3><p><code>print!</code> - 将格式化文本输出到标准输出，不带换行符</p><p><code>println!</code> - 将格式化文本输出到标准输出并在行的末尾添加换行符</p><p><code>format!</code> - 将格式化文本输出到<code>String</code>字符串</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, world"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;, world"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;\n"</span><span class="token punctuation">,</span> <span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=标准错误输出><a class=anchor href=#标准错误输出>#</a> 标准错误输出</h3><p><code>eprint!</code> - 将格式化文本输出到标准错误输出，不带换行符</p><p><code>eprintln!</code> - 将格式化文本输出到标准错误输出，并在行的末尾添加换行符</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"Error: Could not complete task"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=位置参数形式><a class=anchor href=#位置参数形式>#</a> 位置参数形式</h3><p>除了按照依次顺序使用值去替换占位符之外，还能让指定位置的参数去替换某个占位符。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =>"12"</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;1&#125;&#123;0&#125;"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =>"21"</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token comment">// => Alice, this is Bob. Bob, this is Alice</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125;, this is &#123;1&#125;. &#123;1&#125;, this is &#123;0&#125;"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;1&#125;&#123;&#125;&#123;0&#125;&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => 2112</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=具体名称参数形式><a class=anchor href=#具体名称参数形式>#</a> 具体名称参数形式</h3><p>为参数指定名称，带名称的参数必须放在不带名称参数的后面。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;argument&#125;"</span><span class="token punctuation">,</span> argument <span class="token operator">=</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => "test"</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;name&#125; &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => "2 1"</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;a&#125; &#123;c&#125; &#123;b&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token char">'b'</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => "a 3 b"</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=格式化参数形式><a class=anchor href=#格式化参数形式>#</a> 格式化参数形式</h3><p>输出浮点数的小数点后两位。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token number">3.1415926</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token comment">// Display => 3.14</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:.2&#125;"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token comment">// Debug => 3.14</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:.2?&#125;"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=捕获环境中的值><a class=anchor href=#捕获环境中的值>#</a> 捕获环境中的值</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">get_person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">get_person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello, &#123;person&#125;!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">// 将环境中的值用于格式化参数</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">let</span> <span class="token punctuation">(</span>width<span class="token punctuation">,</span> precision<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">get_format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> score<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token function">get_scores</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;name&#125;: &#123;score:width$.precision$&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=函数><a class=anchor href=#函数>#</a> 函数</h2><p>以自定义的<code>add函数</code>为例</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>j<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    i <span class="token operator">+</span> j</pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment"> * fn - Keyword(函数声明关键字)</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment"> * add - Identifier(函数名)</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment"> * (i: i32,j: i32) - Parameters(参数列表)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"> * i,j - Identifier(参数名)</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment"> * i32 - Type(参数类型)</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment"> * () - Thin arrow to indicate(参数指示区域)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment"> * -> - return(返回指示符)</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment"> * 最后的i32 - Return Type(返回类型)</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><p>函数名使用的是蛇形命名法(snake case) - <code>fn add_two() -&gt; &#123;&#125;</code></p><p>Rust是强类型语言，需要为每一个函数参数都标识出它的具体类型。</p><p>函数的位置可以随便放，只要有定义即可。函数的返回值就是函数体最后一条表达式的返回值，当最后一行代码是值或表达式时可不写分号。</p><p>函数的参数没有默认值这一概念。</p><p>在Rust中，不能在同一作用域内定义多个同名的函数，无论它们的参数类型是否不同，因为函数名本身不足以区分它们。</p><p><font size=3><ins><strong>特殊返回类型</strong></ins></font></p><p>无返回值 - <code>()</code></p><ul><li><p>单元类型<code>()</code>是一个零长度的元组。无作用，但可用来表达一个函数没有返回值</p></li><li><p>函数没有返回值时就会返回一个 <code>()</code></p></li><li><p>通过<code>;</code>结尾的表达式返回一个 <code>()</code></p></li></ul><p>永不返回的发散函数 - <code>!</code></p><ul><li><p>当用<code>!</code>作函数返回类型的时候，表示该函数永不返回(diverge function)，不会返回任何值，包括<code>()</code></p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 这种语法往往用做会导致程序崩溃的函数</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">dead_end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>  <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"你已经到了穷途末路，崩溃吧！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">forever</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>  <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token comment">//...</span></pre></td></tr><tr><td data-num=9></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ul><p><font size=3><ins><strong>使用return关键字提前返回</strong></ins></font></p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 在没有返回值的函数中使用</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">==</span> a <span class="token operator">+</span> b<span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> temp <span class="token operator">=</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    b <span class="token operator">=</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    a <span class="token operator">=</span> b</pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=复合类型><a class=anchor href=#复合类型>#</a> 复合类型</h2><p><strong>字符串</strong>和<strong>数组</strong>也是复合类型。</p><h3 id=元组><a class=anchor href=#元组>#</a> 元组</h3><p>元组由多种类型组合而成，长度是固定的，元素的顺序也是固定的，索引从0开始。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 创建一个元组</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> tup<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">// 用`.`来访问元组</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">let</span> five_hundred <span class="token operator">=</span> x<span class="token number">.0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">let</span> six_point_four <span class="token operator">=</span> x<span class="token number">.1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token keyword">let</span> one <span class="token operator">=</span> x<span class="token number">.2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>参数元组(parameter tuple)</strong></ins></font></p><p>用于将多个参数打包到一个元组中，以便作为函数的单个参数传递。参数元组使您能够将多个值捆绑在一起，以方便传递和组织函数的输入参数。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">process_person_info</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token comment">// 在这里处理传递的个人信息</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Name: &#123;&#125;"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Age: &#123;&#125;"</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">let</span> person_info <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token function">process_person_info</span><span class="token punctuation">(</span>person_info<span class="token number">.0</span><span class="token punctuation">,</span> person_info<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=结构体><a class=anchor href=#结构体>#</a> 结构体</h3><h4 id=基本结构体><a class=anchor href=#基本结构体>#</a> 基本结构体</h4><p>结构体由多种类型组合而成，与元组不同的是，结构体可以为内部的每个字段命名。</p><p>使用<code>.</code>操作符访问成员，Rust中没有<code>-&gt;</code>操作符。</p><p><strong>结构体的构成</strong></p><ul><li><code>struct</code>关键字</li><li>结构体<code>名称</code></li><li>有名字的结构体<code>字段</code></li></ul><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    active<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>    username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>    sign_in_count<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>结构体声明时末尾没有分号。</p><p>初始化实例时，<strong>每个字段</strong>都需要进行初始化。</p><p>初始化时的字段顺序<strong>不需要</strong>和结构体定义时的顺序一致。</p><p>必须要将结构体实例声明为可变的，才能修改其中的字段，Rust不支持将某个结构体的某个字段标记为可变。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">let</span> <span class="token keyword">mut</span> user1 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someone@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>    username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someusername123"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>    active<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>    sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>user1<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"anotheremail@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">// 通过函数简化结构体的创建</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">build_user</span><span class="token punctuation">(</span>email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>        email<span class="token punctuation">:</span> email<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>        username<span class="token punctuation">:</span> username<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>        active<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>        sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment">// 当函数参数和结构体字段同名时，可以直接使用缩略的方式进行初始化</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">build_user</span><span class="token punctuation">(</span>email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>        email<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=24></td><td><pre>        username<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=25></td><td><pre>        active<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=26></td><td><pre>        sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token comment">// 根据已有的结构体实例，创建新的结构体实例</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token keyword">let</span> user2 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=32></td><td><pre>    active<span class="token punctuation">:</span> user1<span class="token punctuation">.</span>active<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=33></td><td><pre>    username<span class="token punctuation">:</span> user1<span class="token punctuation">.</span>username<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=34></td><td><pre>    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"another@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=35></td><td><pre>    sign_in_count<span class="token punctuation">:</span> user1<span class="token punctuation">.</span>sign_in_count<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token comment">// 根据已有的结构体实例，使用结构体更新语法</span></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token keyword">let</span> user2 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"another@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token punctuation">..</span>user1</pre></td></tr><tr><td data-num=42></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=43></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=44></td><td><pre><span class="token comment"> * `..`语法表明凡是没有显式声明的字段，全部从`user1`中自动获取。</span></pre></td></tr><tr><td data-num=45></td><td><pre><span class="token comment"> * 需要注意的是`..user1`必须在结构体的尾部使用。</span></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><h4 id=元组结构体tuple-struct><a class=anchor href=#元组结构体tuple-struct>#</a> 元组结构体(Tuple Struct)</h4><p>结构体必须要有名称，但是结构体的字段可以没有名称，这种结构体长得很像元组，因此被称为元组结构体。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Color</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">let</span> black <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">let</span> origin <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>当想要一个整体名称，但是又不关心里面字段的名称时将非常有用。例如上面的<code>Point</code>元组结构体，3D点是<code>(x, y, z)</code>形式的坐标点，因此无需再为内部的字段逐一命名为，<code>x</code>, <code>y</code>, <code>z</code>。</p><h4 id=单元结构体unit-like-struct><a class=anchor href=#单元结构体unit-like-struct>#</a> 单元结构体(Unit-like Struct)</h4><p>没有任何字段和属性。当定义一个类型，但不关心该类型的内容，只关心它的行为时，即可使用<code>单元结构体</code>。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">AlwaysEqual</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">let</span> subject <span class="token operator">=</span> <span class="token class-name">AlwaysEqual</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">// 不关心AlwaysEqual的字段数据，只关心它的行为，因此将它声明为单元结构体，然后再为它实现某个特征</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">SomeTrait</span> <span class="token keyword">for</span> <span class="token class-name">AlwaysEqual</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=枚举enumenumeration><a class=anchor href=#枚举enumenumeration>#</a> 枚举(enum/enumeration)</h3><p>枚举允许通过列举可能的成员来定义一个<strong>枚举类型</strong>。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 扑克牌花色</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">PokerSuit</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>  <span class="token class-name">Clubs</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>  <span class="token class-name">Spades</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>  <span class="token class-name">Diamonds</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>  <span class="token class-name">Hearts</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>枚举声明时末尾没有分号。</p><p>枚举是一个类型，它包含所有可能的枚举成员，而枚举值是该类型中的具体某个成员的实例。</p><p>可通过<code>::</code>操作符来访问枚举下的具体成员。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 创建PokerSuit枚举类型的两个成员实例</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">let</span> heart <span class="token operator">=</span> <span class="token class-name">PokerSuit</span><span class="token punctuation">::</span><span class="token class-name">Hearts</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">let</span> diamond <span class="token operator">=</span> <span class="token class-name">PokerSuit</span><span class="token punctuation">::</span><span class="token class-name">Diamonds</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id=模式匹配><a class=anchor href=#模式匹配>#</a> 模式匹配</h2><p>模式匹配 - 将模式与<code>target</code>进行匹配</p><h3 id=match表达式匹配><a class=anchor href=#match表达式匹配>#</a> match(表达式)匹配</h3><p><font size=3><ins><strong>通用形式</strong></ins></font></p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">match</span> target <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    模式<span class="token number">1</span> <span class="token operator">=></span> 表达式<span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>    模式<span class="token number">2</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>        语句<span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>        语句<span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>        表达式<span class="token number">2</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=8></td><td><pre>    _ <span class="token operator">=></span> 表达式<span class="token number">3</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>match表达式跟C语言中的<code>switch</code>语句非常像，<code>_</code>类似于switch中的default。</p><p>match表达式中的一个分支有两个部分，<strong>一个模式和针对该模式的处理代码</strong>。</p><p>match表达式中的每个分支都必须是一个表达式，不同分支之间使用逗号分隔，且所有分支的表达式最终返回值的类型必须相同。如果分支有多行处理代码，那么需要用<code>&#123;&#125;</code>包裹，同时最后一行代码需要是一个表达式。</p><p>match表达式的匹配必须要穷举出所有可能，可用<code>_</code>来代表未列出的所有可能的模式。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 例子1</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">Direction</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token class-name">East</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token class-name">West</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token class-name">North</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token class-name">South</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">let</span> dire <span class="token operator">=</span> <span class="token class-name">Direction</span><span class="token punctuation">::</span><span class="token class-name">South</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token comment">/** </span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">     * 这里匹配dire对应的枚举类型，在match表达式中用三个匹配分支</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">     * 来完全覆盖枚举变量Direction的所有成员类型。</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">    **/</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token keyword">match</span> dire <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>        <span class="token class-name">Direction</span><span class="token punctuation">::</span><span class="token class-name">East</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"East"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>        <span class="token class-name">Direction</span><span class="token punctuation">::</span><span class="token class-name">North</span> <span class="token operator">|</span> <span class="token class-name">Direction</span><span class="token punctuation">::</span><span class="token class-name">South</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"South or North"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=20></td><td><pre>        _ <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"West"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment"> * X | Y，类似逻辑运算符或，</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment"> * 代表该分支可以匹配 X 也可以匹配 Y，只要满足一个即可。</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token comment">// 例子2</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">Coin</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token class-name">Penny</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token class-name">Nickel</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token class-name">Dime</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token class-name">Quarter</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=35></td><td><pre></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">value_in_cents</span><span class="token punctuation">(</span>coin<span class="token punctuation">:</span> <span class="token class-name">Coin</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u8</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token comment">/** </span></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token comment">     * 第一个分支的模式是Coin::Penny，</span></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token comment">     * 其后的`=>`运算符将模式和将要运行的代码分开。</span></pre></td></tr><tr><td data-num=40></td><td><pre><span class="token comment">    **/</span></pre></td></tr><tr><td data-num=41></td><td><pre>    <span class="token keyword">match</span> coin <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=42></td><td><pre>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Penny</span> <span class="token operator">=></span>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=43></td><td><pre>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Lucky penny!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>            <span class="token number">1</span></pre></td></tr><tr><td data-num=45></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=46></td><td><pre>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Nickel</span> <span class="token operator">=></span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=47></td><td><pre>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Dime</span> <span class="token operator">=></span> <span class="token number">10</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=48></td><td><pre>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Quarter</span> <span class="token operator">=></span> <span class="token number">25</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=49></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=50></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=51></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=52></td><td><pre><span class="token comment"> * 当match表达式执行时，它将目标值coin按顺序依次与每一个分支的模式相比较，</span></pre></td></tr><tr><td data-num=53></td><td><pre><span class="token comment"> * 如果模式匹配了这个值，那么模式之后的代码将被执行。</span></pre></td></tr><tr><td data-num=54></td><td><pre><span class="token comment"> * 如果模式并不匹配这个值，将继续执行下一个分支。</span></pre></td></tr><tr><td data-num=55></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=56></td><td><pre></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token comment">// 例子3</span></pre></td></tr><tr><td data-num=58></td><td><pre><span class="token keyword">let</span> some_u8_value <span class="token operator">=</span> <span class="token number">0u8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token keyword">match</span> some_u8_value <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=60></td><td><pre>    <span class="token number">1</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=61></td><td><pre>    <span class="token number">3</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=62></td><td><pre>    <span class="token number">5</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"five"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=63></td><td><pre>    <span class="token number">7</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"seven"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=64></td><td><pre>    _ <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=65></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=66></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=67></td><td><pre><span class="token comment"> * 通过将`_`放置于其他分支后，`_`将会匹配所有遗漏的值。</span></pre></td></tr><tr><td data-num=68></td><td><pre><span class="token comment"> * ()表示返回单元类型与所有分支返回值的类型相同，</span></pre></td></tr><tr><td data-num=69></td><td><pre><span class="token comment"> * 当匹配到`_`后，什么也不会发生。</span></pre></td></tr><tr><td data-num=70></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><p><code>match</code>本身是一个表达式，可以用于变量的赋值。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">IpAddr</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>   <span class="token class-name">Ipv4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>   <span class="token class-name">Ipv6</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">let</span> ip1 <span class="token operator">=</span> <span class="token class-name">IpAddr</span><span class="token punctuation">::</span><span class="token class-name">Ipv6</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">let</span> ip_str <span class="token operator">=</span> <span class="token keyword">match</span> ip1 <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>        <span class="token class-name">IpAddr</span><span class="token punctuation">::</span><span class="token class-name">Ipv4</span> <span class="token operator">=></span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>        _ <span class="token operator">=></span> <span class="token string">"::1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> ip_str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>模式匹配的另外一个重要功能是从模式中取出绑定的值。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token attribute attr-name">#[derive(Debug)]</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">UsState</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token class-name">Alabama</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token class-name">Alaska</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token comment">// --snip--</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">Coin</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token class-name">Penny</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token class-name">Nickel</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token class-name">Dime</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token class-name">Quarter</span><span class="token punctuation">(</span><span class="token class-name">UsState</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 25美分硬币</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"> * 在匹配Coin::Quarter(state)模式时，</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment"> * 把它内部存储的值绑定到了state变量上，</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment"> * 因此state变量就是对应的UsState枚举类型。</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">value_in_cents</span><span class="token punctuation">(</span>coin<span class="token punctuation">:</span> <span class="token class-name">Coin</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u8</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token keyword">match</span> coin <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=22></td><td><pre>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Penny</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=23></td><td><pre>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Nickel</span> <span class="token operator">=></span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=24></td><td><pre>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Dime</span> <span class="token operator">=></span> <span class="token number">10</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=25></td><td><pre>        <span class="token class-name">Coin</span><span class="token punctuation">::</span><span class="token class-name">Quarter</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=26></td><td><pre>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"State quarter from &#123;:?&#125;!"</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=27></td><td><pre>            <span class="token number">25</span></pre></td></tr><tr><td data-num=28></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=if-let表达式匹配><a class=anchor href=#if-let表达式匹配>#</a> if-let(表达式)匹配</h3><p>适用于<strong>只有一个模式</strong>的值需要被处理，其它值直接忽略的场景。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// match表达式写法</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">3u8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">match</span> v <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>    _ <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">// if-let表达式写法</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> v <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"three: &#123;&#125;"</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>注意点</strong></ins></font></p><p>无论是<code>match</code>还是<code>if let</code>，这里都是一个新的代码块，而且这里的绑定相当于新变量，如果使用了同名变量则会发生变量遮蔽。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 注意案例1</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>   <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"在匹配前，age是&#123;:?&#125;"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>   <span class="token keyword">match</span> age <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>       <span class="token class-name">Some</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">=></span>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"匹配出来的age是&#123;&#125;"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>       _ <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"在匹配后，age是&#123;:?&#125;"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">// 注意案例2</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>   <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"在匹配前，age是&#123;:?&#125;"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>   <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">=</span> age <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>       <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"匹配出来的age是&#123;&#125;"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"在匹配后，age是&#123;:?&#125;"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token comment"> * 运行结果：</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment"> * 在匹配前，age是Some(30)</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment"> * 匹配出来的age是30</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token comment"> * 在匹配后，age是Some(30)</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><h3 id=option枚举解构><a class=anchor href=#option枚举解构>#</a> Option枚举解构</h3><p>使用<code>Option&lt;T&gt;</code>，是为了从<code>Some</code>中取出其内部的<code>T</code>值以及处理没有值的情况。</p><p>Option枚举的判断方法有<code>is_none()</code>和<code>is_some()</code>。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment"> * 获取一个Option&lt;i32>，</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment"> * 如果其中含有一个值，将其加一；</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"> * 如果其中没有值，则函数返回None值。</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">plus_one</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">match</span> x <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token class-name">None</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>        <span class="token class-name">Some</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Some</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">let</span> five <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token keyword">let</span> six <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>five<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">let</span> none <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span><span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=ref关键字><a class=anchor href=#ref关键字>#</a> ref关键字</h3><p>用于模式匹配和变量绑定，它的主要作用是用来创建引用。</p><p><code>ref</code> → 相当于C语言的一级指针和Rust的<code>&amp;</code></p><p><code>ref mut</code> → 相当于C语言的二级指针和Rust的<code>&amp;mut</code></p><p><font size=3><ins><strong>模式匹配中的引用创建</strong></ins></font></p><p><code>ref</code>关键字可以在模式匹配中创建变量的引用，而不是将值的所有权转移给新变量。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">let</span> reference <span class="token operator">=</span> <span class="token operator">&amp;</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">match</span> reference <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token operator">&amp;</span><span class="token keyword">ref</span> x <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>        <span class="token comment">// x 是 value 的引用，而不是 value 本身</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x is a reference to &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><font size=3><ins><strong>函数参数中的引用创建</strong></ins></font></p><p><code>ref</code>也可以用于函数参数列表中，允许函数接受变量的引用，而不是获取它的所有权。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">print_value</span><span class="token punctuation">(</span>reference<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Value: &#123;&#125;"</span><span class="token punctuation">,</span> reference<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token function">print_value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id=方法method><a class=anchor href=#方法method>#</a> 方法(Method)</h2><p>在Rust中，方法的概念与其他语言没什么差别，往往和对象成对出现。</p><p>Rust的方法往往跟结构体、枚举、特征(Trait)一起使用。</p><h3 id=定义方法><a class=anchor href=#定义方法>#</a> 定义方法</h3><p>Rust使用<code>impl</code>(implementation)来定义方法，对象的定义和方法的定义是分离的，还允许为一个结构体定义多个<code>impl</code>块。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 例子1</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Circle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>    radius<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Circle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token comment">// new是Circle的关联函数，因为它的第一个参数不是self，且new并不是关键字</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token comment">// 这种方法往往用于初始化当前结构体的实例</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Circle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>        <span class="token class-name">Circle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>            x<span class="token punctuation">:</span> x<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>            y<span class="token punctuation">:</span> y<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>            radius<span class="token punctuation">:</span> radius<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token comment">// Circle的方法，&amp;self表示借用当前的Circle结构体</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>        <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token namespace">consts<span class="token punctuation">::</span></span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>radius <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>radius<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment">// 例子2</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token comment">// 定义了一个Rectangle结构体，并且在其上定义了一个area方法，用于计算该矩形的面积</span></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token attribute attr-name">#[derive(Debug)]</span></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=30></td><td><pre>    height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=35></td><td><pre>        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height</pre></td></tr><tr><td data-num=36></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=43></td><td><pre>        <span class="token string">"The area of the rectangle is &#123;&#125; square pixels."</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=44></td><td><pre>        rect1<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=45></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=47></td><td><pre></pre></td></tr><tr><td data-num=48></td><td><pre><span class="token comment">// 带多个参数的方法</span></pre></td></tr><tr><td data-num=49></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=50></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=51></td><td><pre>        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height</pre></td></tr><tr><td data-num=52></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=53></td><td><pre></pre></td></tr><tr><td data-num=54></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Rectangle</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=55></td><td><pre>        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">></span> other<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height <span class="token operator">></span> other<span class="token punctuation">.</span>height</pre></td></tr><tr><td data-num=56></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=57></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=58></td><td><pre></pre></td></tr><tr><td data-num=59></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=60></td><td><pre>    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=61></td><td><pre>    <span class="token keyword">let</span> rect2 <span class="token operator">=</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">40</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>    <span class="token keyword">let</span> rect3 <span class="token operator">=</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">45</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=63></td><td><pre></pre></td></tr><tr><td data-num=64></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Can rect1 hold rect2? &#123;&#125;"</span><span class="token punctuation">,</span> rect1<span class="token punctuation">.</span><span class="token function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rect2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=65></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Can rect1 hold rect3? &#123;&#125;"</span><span class="token punctuation">,</span> rect1<span class="token punctuation">.</span><span class="token function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rect3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=selfselfmut-self><a class=anchor href=#selfselfmut-self>#</a> self/&amp;self/&amp;mut self</h3><p><code>&amp;self</code>其实是<code>self: &amp;Self</code>的简写(注意大小写)。</p><p>在一个<code>impl</code>块内，</p><ul><li><code>Self</code> - 指代被实现方法的<strong>结构体类型</strong></li><li><code>self</code> - 指代此类型的<strong>实例</strong></li></ul><p><code>self</code>依然有所有权的概念</p><ul><li><code>self</code> - 表示实例的所有权转移到该方法中，这种形式用的较少</li><li><code>&amp;self</code> - 表示该方法对实例的不可变借用</li><li><code>&amp;mut self</code> - 表示可变借用</li></ul><p>使用方法代替函数的好处</p><ul><li>不用在函数签名中重复书写<code>self</code>对应的类型</li><li>代码的组织性和内聚性更强，方便代码维护和阅读</li></ul><h3 id=方法名与结构体字段名相同><a class=anchor href=#方法名与结构体字段名相同>#</a> 方法名与结构体字段名相同</h3><p>在Rust中，允许方法名跟结构体的字段名相同。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">width</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">></span> <span class="token number">0</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>        width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token keyword">if</span> rect1<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The rectangle has a nonzero width; it is &#123;&#125;"</span><span class="token punctuation">,</span> rect1<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment"> * 当使用rect1.width()时，Rust知道调用的是它的方法，</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment"> * 如果使用 rect1.width，则是访问它的字段。</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><p>Rust并没有一个与<code>-&gt;</code>等效的运算符，但Rust有一个叫<strong>自动引用和解引用</strong>的功能。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment"> * 当使用object.something()调用方法时，</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment"> * Rust会自动为object添加&amp;、&amp;mut或*以便使object与方法签名匹配</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">// 例如，下面的代码是等价的</span></pre></td></tr><tr><td data-num=7></td><td><pre>p1<span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 自动引用</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这种自动引用的行为之所以有效，是因为方法有一个明确的接收者(<code>self</code>类型)。在给出接收者和方法名的前提下，Rust可以明确地计算出方法是仅仅读取(<code>&amp;self</code>)，做出修改(<code>&amp;mut self</code>)或者是获取所有权(<code>self</code>)。</p><h3 id=关联函数><a class=anchor href=#关联函数>#</a> 关联函数</h3><p>定义在<code>impl</code>中且没有<code>self</code>参数的函数被称之为<strong>关联函数</strong>。由于没有<code>self</code>，不能用<code>f.read()</code>这种形式来调用，因此它是一个函数而不是方法，但它又在<code>impl</code>中，与结构体紧密关联，因此称为关联函数。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token comment">// Rust中有一个约定俗成的规则，使用`new`来作为构造器的名称</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>w<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> h<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>        <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">:</span> w<span class="token punctuation">,</span> height<span class="token punctuation">:</span> h <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">// 因为是函数，所以不能用`.`的方式来访问函数，需要用`::`来调用</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">let</span> sq <span class="token operator">=</span> <span class="token class-name">Rectangle</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=为枚举实现方法><a class=anchor href=#为枚举实现方法>#</a> 为枚举实现方法</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token attribute attr-name">#![allow(unused)]</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">Message</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token class-name">Quit</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token class-name">Move</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token class-name">Write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token class-name">ChangeColor</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Message</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">call</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>        <span class="token comment">// 在这里定义方法体</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token class-name">Write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    m<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=泛型generics><a class=anchor href=#泛型generics>#</a> 泛型(Generics)</h2><p>在编程的时候，我们经常利用多态。多态就是好比坦克的炮管，既可以发射普通弹药，也可以发射制导炮弹(导弹)，也可以发射贫铀穿甲弹，甚至发射子母弹，没有必要为每一种炮弹都在坦克上分别安装一个专用炮管，即使生产商愿意，炮手也不愿意，累死人啊。所以在编程开发中，我们也需要这样“通用的炮管”，这个“通用的炮管”就是多态。</p><p>实际上，泛型就是一种多态，主要目的是提供编程的便利，减少代码的臃肿。</p><p>使用泛型参数，有一个先决条件，必需在使用前对其进行声明。</p><h3 id=函数中使用泛型><a class=anchor href=#函数中使用泛型>#</a> 函数中使用泛型</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 例子1，缺少条件状态</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">T</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"add i8: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2i8</span><span class="token punctuation">,</span> <span class="token number">3i8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"add i32: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"add f64: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">,</span> <span class="token number">1.23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>上面代码的<code>T</code>就是<strong>泛型参数</strong>，泛型参数的名称可以任意起，出于惯例都用<code>T</code>(<code>T</code>是<code>type</code>的首字母)来作为首选，这个名称越短越好，除非需要表达含义。</p><p><code>T</code>可以是任何类型，但不是所有的类型都能进行比较。根据编译器的建议，倘若需要比较，需要给<code>T</code>添加一个类型约束，即使用<code>std::cmp::PartialOrd</code>特征(Trait)对<code>T</code>进行限制，对于该特征的目的，这里可以理解为让类型实现可比较的功能。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 例子1中需添加`std::ops::Add&lt;Output = T>`约束</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">T</span><span class="token operator">>></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token class-name">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">T</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=结构体中使用泛型><a class=anchor href=#结构体中使用泛型>#</a> 结构体中使用泛型</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 此处的x和y是相同的类型</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>    y<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">let</span> integer <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token keyword">let</span> float <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">// 使用多个泛型类型来表示不同数据类型</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span><span class="token class-name">U</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>    y<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">&#123;</span>x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token punctuation">:</span><span class="token number">1.1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=枚举中使用泛型><a class=anchor href=#枚举中使用泛型>#</a> 枚举中使用泛型</h3><h4 id=option枚举><a class=anchor href=#option枚举>#</a> Option枚举</h4><p>用于处理空值。</p><p>在其它编程语言中，往往都有一个 <code>null</code> 关键字，该关键字用于表明一个变量当前的值为空(不是零值，例如整型的零值是0)，也就是不存在值。而Rust使用 <code>Option</code> 枚举变量来表述这种结果。</p><p>Option枚举包含两个成员</p><ul><li><code>Some(T)</code> - 表示含有值</li><li><code>None</code> - 表示没有值</li></ul><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token class-name">None</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>其中<code>T</code>是泛型参数，<code>Some(T)</code>表示该枚举成员的数据类型是<code>T</code>，即<code>Some</code>可以包含任何类型的数据。</p><p>Option枚举被包含在prelude(Rust标准库，不需要将其显式引入作用域)中，它的成员<code>Some</code>和<code>None</code>无需使用<code>Option::</code>前缀即可直接使用。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">let</span> some_number <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">let</span> some_string <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">"a string"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment"> * 如果使用None而不是Some，需要向Rust指明Option&lt;T>中T是什么类型的，</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment"> * 因为编译器只通过None值无法推断出Some成员保存值的类型。</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">let</span> absent_number<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">None</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>Option枚举中没有实现Copy特征，基本上只能通过声明初始化这种形式使用，无法绑定到一个已声明的变量上，通过通过借用的形式使用。</p><p><font size=3><ins><strong>相关方法</strong></ins></font></p><p><strong>take()方法</strong></p><p>用于从<code>Option</code>中提取值并将<code>Option</code>置为<code>None</code>，而不会触发所有权的移动或复制，因此不必担心所有权问题。这个方法接受一个可变引用<code>&amp;mut self</code>，因为它要修改<code>self</code>，并返回一个新的<code>Option</code>包装的值<code>Option&lt;T&gt;</code>，其中<code>T</code>是<code>Option</code>原来包含的值的类型。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> maybe_number<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token comment">// 使用 take 方法提取值</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">let</span> number <span class="token operator">=</span> maybe_number<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token comment">// maybe_number 现在是 None</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token comment">// number 包含提取的值，类型为 Option&lt;i32>，值为 Some(42)</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"maybe_number: &#123;:?&#125;"</span><span class="token punctuation">,</span> maybe_number<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: "maybe_number: None"</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number: &#123;:?&#125;"</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: "number: Some(42)"</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>is_some()方法</strong></p><p>用于检查<code>Option</code>是否包含一个具体的值。它返回一个布尔值，如果<code>Option</code>是<code>Some</code>则返回<code>true</code>，否则返回<code>false</code>。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">let</span> some_value<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">let</span> none_value<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">None</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    </pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">if</span> some_value<span class="token punctuation">.</span><span class="token function">is_some</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"some_value contains a value: &#123;:?&#125;"</span><span class="token punctuation">,</span> some_value<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"some_value is None"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    </pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">if</span> none_value<span class="token punctuation">.</span><span class="token function">is_some</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"none_value contains a value: &#123;:?&#125;"</span><span class="token punctuation">,</span> none_value<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"none_value is None"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>is_none()方法</strong></p><p>用于检查<code>Option</code>是否包含一个具体的值。它返回一个布尔值，如果<code>Option</code>是<code>None</code>则返回<code>true</code>，否则返回<code>false</code>。</p><h4 id=result枚举><a class=anchor href=#result枚举>#</a> Result枚举</h4><p>与<code>Option</code>枚举一样，主要用于函数返回值，但<code>Result</code>枚举关注的主要是值的正确性。</p><p>如果函数正常运行，则最后返回一个<code>Ok(T)</code>，<code>T</code>是函数具体的返回值类型，如果函数异常运行，则返回一个 <code>Err(E)</code>，<code>E</code>是错误类型。</p><p>判断方法</p><ul><li><p><code>.is_err()</code></p></li><li><p><code>.is_ok()</code></p></li></ul><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">E</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>例如打开一个文件，如果成功打开文件，则返回<code>Ok(std::fs::File)</code>，因此<code>T</code>对应的是<code>std::fs::File</code>类型；而当打开文件时出现问题时，返回<code>Err(std::io::Error)</code>，<code>E</code>对应的就是<code>std::io::Error</code>类型。</p><h3 id=方法中使用泛型><a class=anchor href=#方法中使用泛型>#</a> 方法中使用泛型</h3><p>使用泛型参数前，依然需要提前声明 - <code>impl&lt;T&gt;</code></p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>    y<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">x</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token class-name">T</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>x</pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p.x = &#123;&#125;"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里的<code>Point&lt;T&gt;</code>不再是泛型声明，而是一个完整的结构体类型，因为定义的结构体就是<code>Point&lt;T&gt;</code>而不再是<code>Point</code>。</p><p>除了结构体中的泛型参数，还能在该结构体的方法中定义额外的泛型参数，相当于泛型函数。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>    y<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">mixup</span><span class="token operator">&lt;</span><span class="token class-name">V</span><span class="token punctuation">,</span> <span class="token class-name">W</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">V</span><span class="token punctuation">,</span> <span class="token class-name">W</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">W</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>            x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=10></td><td><pre>            y<span class="token punctuation">:</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10.4</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token char">'c'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token keyword">let</span> p3 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">mixup</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p3.x = &#123;&#125;, p3.y = &#123;&#125;"</span><span class="token punctuation">,</span> p3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p3<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>T,U</code>是定义在结构体<code>Point</code>上的泛型参数，<code>V,W</code>是单独定义在方法<code>mixup</code>上的泛型参数，它们并不冲突。可以理解为 - 一个是结构体泛型，一个是函数泛型。</p><h3 id=为具体的泛型类型实现方法><a class=anchor href=#为具体的泛型类型实现方法>#</a> 为具体的泛型类型实现方法</h3><p>针对特定的泛型类型实现某个特定的方法。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_from_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f32</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>        <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>Point&lt;f32&gt;</code>类型会有一个方法<code>distance_from_origin</code>，而其他<code>T</code>不是<code>f32</code>类型的<code>Point&lt;T&gt;</code>实例则没有定义此方法。</p><h3 id=const泛型><a class=anchor href=#const泛型>#</a> const泛型</h3><p>const泛型是针对值的泛型。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 可以用于处理数组长度</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">display_array</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token operator">></span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">;</span> <span class="token class-name">N</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token function">display_array</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token function">display_array</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">// 结构体中常量泛型参数的声明</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Container</span><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token class-name">N</span><span class="token punctuation">:</span><span class="token keyword">usize</span><span class="token operator">></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span><span class="token class-name">N</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token comment">// ....</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment">// 方法中中常量泛型参数的声明</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token operator">></span> <span class="token class-name">Container</span><span class="token operator">&lt;</span><span class="token class-name">N</span><span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token comment">// 函数中常量泛型参数的声明</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">initial</span><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token class-name">N</span><span class="token punctuation">:</span><span class="token keyword">usize</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token operator">&lt;</span><span class="token class-name">N</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>N</code>就是const泛型，定义的语法是<code>const N: usize</code>，表示const泛型<code>N</code>，它基于的值类型是<code>usize</code>。</p><h2 id=特征trait><a class=anchor href=#特征trait>#</a> 特征(Trait)</h2><p>用于不同对象的同一行为封装，即Rust中的特征<code>trait</code>概念，特征跟接口很类似。</p><p>例如，<code>#[derive(Debug)]</code>会在定义的类型(<code>struct</code>)上自动派生<code>Debug</code>特征，接着就可以使用<code>println!(&quot;&#123;:?&#125;&quot;, x)</code>打印这个类型了。</p><p>特征定义了一组可以被共享的行为，只要实现了特征，就能使用这组行为。</p><h3 id=定义特征><a class=anchor href=#定义特征>#</a> 定义特征</h3><p>定义特征就是把一些方法组合在一起，目的是定义一个实现某些目标所必需的行为的集合。</p><p>例如，现在有文章<code>Post</code>和微博<code>Weibo</code>两种内容载体，想要使相应的内容进行总结，也就是无论是文章内容，还是微博内容，都可以在某个时间点进行总结，那么总结这个行为就是共享的。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 例子1</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Summary</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token comment">// 只定义行为，而不定义行为具体内容</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Summary</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token comment">// 定义具有默认实现的方法，</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token comment">// 其它类型无需再实现该方法，可以选择重载该方法</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>        <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"(Read more...)"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">// 例子2</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment">// 嵌套调用</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Summary</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize_author</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"(Read more from &#123;&#125;...)"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">summarize_author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token keyword">for</span> <span class="token class-name">Weibo</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize_author</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=27></td><td><pre>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"@&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>username<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"1 new weibo: &#123;&#125;"</span><span class="token punctuation">,</span> weibo<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token comment">/** </span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token comment"> * weibo.summarize()会先调用Summary特征默认实现的summarize方法，</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token comment"> * 通过该方法进而调用Weibo为Summary实现的summarize_author方法，</span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token comment"> * 最终输出：1 new weibo: (Read more from @horse_ebooks...)</span></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><p>使用<code>trait</code>关键字来声明一个特征，<code>Summary</code>是特征名，大括号中定义了该特征的所有方法。</p><h3 id=为特定类型实现特征><a class=anchor href=#为特定类型实现特征>#</a> 为特定类型实现特征</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Summary</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Post</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">pub</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token comment">// 标题</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">pub</span> author<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token comment">// 作者</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">pub</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token comment">// 内容</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token keyword">for</span> <span class="token class-name">Post</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"文章&#123;&#125;, 作者是&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>author<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Weibo</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token keyword">pub</span> username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token keyword">pub</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token keyword">for</span> <span class="token class-name">Weibo</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=24></td><td><pre>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;发表了微博&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=27></td><td><pre></pre></td></tr><tr><td data-num=28></td><td><pre><span class="token comment">// 在类型上调用特征的方法</span></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token keyword">let</span> post <span class="token operator">=</span> <span class="token class-name">Post</span><span class="token punctuation">&#123;</span>title<span class="token punctuation">:</span> <span class="token string">"Rust语言简介"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>author<span class="token punctuation">:</span> <span class="token string">"Sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">"Rust棒极了!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token keyword">let</span> weibo <span class="token operator">=</span> <span class="token class-name">Weibo</span><span class="token punctuation">&#123;</span>username<span class="token punctuation">:</span> <span class="token string">"sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>content<span class="token punctuation">:</span> <span class="token string">"好像微博没Tweet好用"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=32></td><td><pre></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>post<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>weibo<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>impl Summary for Post</code>读作为<code>Post</code>类型实现<code>Summary</code>特征，然后在<code>impl</code>的花括号中实现该特征的具体方法。此处的<code>Summary</code>被定义成<code>pub</code>公开的，如果他人想要使用此处的<code>Summary</code>特征，则可以引入到他们的包中，然后再进行实现。</p><p>关于特征实现与定义的位置，有一条非常重要的原则，即<strong>如果想要为类型A实现特征T，那么A或者T至少有一个是在当前作用域中定义的</strong>。例如可以为上面的<code>Post</code>类型实现标准库中的<code>Display</code>特征，因为<code>Post</code>类型定义在当前的作用域中；也可以在当前包中为<code>String</code>类型实现<code>Summary</code>特征，因为<code>Summary</code>定义在当前作用域中；但是无法在当前作用域中为<code>String</code>类型实现<code>Display</code>特征，因为它们俩都定义在标准库中，所在的位置不在当前作用域。该规则被称为<strong>孤儿规则</strong>，可以确保其它人编写的代码不会破坏你的代码。</p><h3 id=特征作为函数参数><a class=anchor href=#特征作为函数参数>#</a> 特征作为函数参数</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Breaking news! &#123;&#125;"</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>impl Summary</code>意思是实现了<code>Summary</code>特征的参数，实际上是一个语法糖。</p><h3 id=特征作为函数返回值><a class=anchor href=#特征作为函数返回值>#</a> 特征作为函数返回值</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">returns_summarizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token class-name">Weibo</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>        username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=4></td><td><pre>        content<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num=5></td><td><pre>            <span class="token string">"m1 max太厉害了，电脑再也不会卡"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre>        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这种<code>impl Trait</code>形式的返回值，在返回的真实类型非常复杂的情况下非常有用，当不知道该怎么声明时，此时就可以用<code>impl Trait</code>的方式简单返回。但是这种返回值方式有一个很大的限制，即只能有一个具体的类型。</p><h3 id=特征约束trait-bound><a class=anchor href=#特征约束trait-bound>#</a> 特征约束(trait bound)</h3><h4 id=单约束><a class=anchor href=#单约束>#</a> 单约束</h4><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 单个参数约束</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Summary</span><span class="token operator">></span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Breaking news! &#123;&#125;"</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">// 多个参数约束</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">,</span> item2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment"> * 泛型类型T说明了item1和item2必须拥有同样的类型，</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment"> * 同时`T: Summary`说明了T必须实现Summary特征。</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Summary</span><span class="token operator">></span><span class="token punctuation">(</span>item1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">,</span> item2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>此处的<code>T: Summary</code>被称为特征约束。</p><h4 id=多重约束><a class=anchor href=#多重约束>#</a> 多重约束</h4><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token operator">+</span> <span class="token class-name">Display</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Summary</span> <span class="token operator">+</span> <span class="token class-name">Display</span><span class="token operator">></span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=where约束><a class=anchor href=#where约束>#</a> Where约束</h4><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 多重约束写法</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">some_function</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span> <span class="token operator">+</span> <span class="token class-name">Clone</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span> <span class="token operator">+</span> <span class="token class-name">Debug</span><span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">,</span> u<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">// Where约束写法</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">some_function</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">,</span> u<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span> <span class="token operator">+</span> <span class="token class-name">Clone</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=7></td><td><pre>      <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span> <span class="token operator">+</span> <span class="token class-name">Debug</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token comment">//....</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=特征约束用于方法定义><a class=anchor href=#特征约束用于方法定义>#</a> 特征约束用于方法定义</h4><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Pair</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=5></td><td><pre>    y<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token class-name">Pair</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>        <span class="token keyword">Self</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>            x<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=12></td><td><pre>            y<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">// 指定类型加指定特征的条件下实现方法</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span> <span class="token operator">+</span> <span class="token class-name">PartialOrd</span><span class="token operator">></span> <span class="token class-name">Pair</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">cmp_display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">>=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The largest member is x = &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The largest member is y = &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>并不是所有的<code>Pair&lt;T&gt;</code>结构体对象都可以拥有<code>cmp_display</code>方法，只有<code>T</code>同时实现了<code>Display + PartialOrd</code>的<code>Pair&lt;T&gt;</code>才可以拥有此方法。</p><h4 id=特征约束用于特征定义><a class=anchor href=#特征约束用于特征定义>#</a> 特征约束用于特征定义</h4><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">/** </span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment"> * 有条件地实现特征，</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment"> * 对任何实现了Display特征的类型调用</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"> * 由ToString定义的to_string方法。</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span><span class="token operator">></span> <span class="token class-name">ToString</span> <span class="token keyword">for</span> <span class="token class-name">T</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token comment">// --snip--</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id=关联类型><a class=anchor href=#关联类型>#</a> 关联类型</h3><p>关联类型和关联函数并没有任何交集。</p><p>关联类型是在特征定义的语句块中，申明一个自定义类型，这样就可以在特征的方法签名中使用该类型。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Iterator</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Item</span><span class="token operator">></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment"> * 标准库中的迭代器特征Iterator，</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"> * 有一个Item关联类型，用于替代遍历的值的类型。</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment"> * 同时，next方法也返回了一个Item类型，不过使用Option枚举进行了包裹，</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment"> * 假如迭代器中的值是i32类型，那么调用next方法就将获取一个Option&lt;i32>的值。</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">/**********************************************************/</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"> * `Self`用来指代当前调用者的具体类型，</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment"> * 那么`Self::Item`就用来指代该类型实现中定义的Item类型。</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Iterator</span> <span class="token keyword">for</span> <span class="token class-name">Counter</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token keyword">u32</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Item</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>        <span class="token comment">// --snip--</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token class-name">Counter</span><span class="token punctuation">&#123;</span><span class="token punctuation">..</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=29></td><td><pre>    c<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=30></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token comment"> * 为Counter类型实现了Iterator特征，</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token comment"> * 变量c是特征Iterator的实例，也是next方法的调用者。 </span></pre></td></tr><tr><td data-num=34></td><td><pre><span class="token comment"> * 对于next方法而言，Self是调用者c的具体类型(Counter)，</span></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token comment"> * 而Self::Item是Counter中定义的Item类型(u32)。</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><p>不用泛型是为了代码的可读性，当使用泛型之后，需要在所有地方都写<code>Iterator&lt;Item&gt;</code>，而使用了关联类型，只需要写<code>Iterator</code>，当类型定义复杂时，可以极大的增加可读性。</p><h3 id=默认泛型类型参数><a class=anchor href=#默认泛型类型参数>#</a> 默认泛型类型参数</h3><p>当使用泛型类型参数时，可以为其指定一个默认的具体类型，例如标准库中的<code>std::ops::Add</code>特征</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 例子1</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">trait</span> <span class="token type-definition class-name">Add</span><span class="token operator">&lt;</span><span class="token constant">RHS</span><span class="token operator">=</span><span class="token keyword">Self</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> rhs<span class="token punctuation">:</span> <span class="token constant">RHS</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Output</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"> * 它有一个泛型参数RHS，但是与以往的用法不同是这里给RHS一个默认值，</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment"> * 也就是当用户不指定RHS时，默认使用两个同样类型的值进行相加，</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment"> * 然后返回一个关联类型Output。</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">// 例子2</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment"> * 为Point结构体提供`+`运算符的能力，这就是运算符重载，</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"> * 不过Rust并不支持创建自定义运算符，也无法为所有运算符进行重载，</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment"> * 目前只有定义在std::ops中的运算符才能进行重载。</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=24></td><td><pre>    y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Add</span> <span class="token keyword">for</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=29></td><td><pre></pre></td></tr><tr><td data-num=30></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token class-name">Point</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=31></td><td><pre>        <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=32></td><td><pre>            x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">+</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=33></td><td><pre>            y<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">+</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=34></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=37></td><td><pre></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span> <span class="token operator">+</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=40></td><td><pre>               <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=41></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>跟<code>+</code>对应的特征是<code>std::ops::Add</code>，它的定义为<code>trait Add&lt;RHS=Self&gt;</code>。但是上面的例子中并没有为<code>Point</code>实现<code>Add&lt;RHS&gt;</code>特征，而是实现了<code>Add</code>特征(没有默认泛型类型参数)，这意味着使用了<code>RHS</code>的默认类型，也就是<code>Self</code>。换句话说，这里定义的是两个相同的<code>Point</code>类型相加，因此无需指定<code>RHS</code>。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 创建两个不同类型的相加</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Add</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Millimeters</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Meters</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">Add</span><span class="token operator">&lt;</span><span class="token class-name">Meters</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Millimeters</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">Millimeters</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token class-name">Meters</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Millimeters</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>        <span class="token class-name">Millimeters</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">+</span> <span class="token punctuation">(</span>other<span class="token number">.0</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment"> * 进行Millimeters + Meters两种数据类型的`+`操作，</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"> * 此时不能再使用默认的RHS，否则就会变成Millimeters + Millimeters的形式。</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment"> * 使用Add&lt;Meters>可以将RHS指定为Meters，</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment"> * 那么fn add(self, rhs: RHS)自然地变成了Millimeters和Meters的相加。</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><p><strong>默认类型参数主要用于两个方面</strong></p><ul><li><p>减少实现的样板代码</p></li><li><p>扩展类型但是无需大幅修改现有的代码</p></li></ul><h2 id=错误捕获与处理><a class=anchor href=#错误捕获与处理>#</a> 错误捕获与处理</h2><h3 id=panic不可恢复错误><a class=anchor href=#panic不可恢复错误>#</a> panic(不可恢复错误)</h3><p>Rust的<code>panic</code>是一种运行时错误的处理机制，表示程序发生了无法恢复的错误。当程序出现无法处理的错误时，Rust会引发一个panic，程序会立即停止执行并打印错误消息。</p><p><font size=3><ins><strong>被动触发</strong></ins></font></p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre>    v<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">// 数组越界</span></pre></td></tr></table></figure><p><font size=3><ins><strong>主动调用</strong></ins></font></p><p>Rust提供了<code>panic!</code>宏，当调用执行该宏时，程序会打印出一个错误信息并展开报错点往前的函数调用堆栈，最后退出程序。只有当不知道该如何处理时，才去调用<code>panic!</code>宏。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"crash and burn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=可恢复错误><a class=anchor href=#可恢复错误>#</a> 可恢复错误</h3><p>一种温和的错误处理方式 - <code>Result&lt;T, E&gt;</code>，Result枚举被定义在<code>std::result</code>中，由于很常用的原因就被包含在了<code>prelude</code>中，无需手动引入(<code>std::result::Result</code>)。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"> * 打开文件后的Result&lt;T, E>类型进行匹配取值，</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment"> * 如果是成功，则将Ok(file)中存放的的文件句柄file赋值给f，</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment"> * 如果失败，则将Err(error)中存放的错误信息error使用panic抛出来，进而结束程序。</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">match</span> f <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=12></td><td><pre>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=></span> file<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>        <span class="token class-name">Err</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=14></td><td><pre>            <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Problem opening the file: &#123;:?&#125;"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=15></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>此处的<code>File::open</code>的返回类型为<code>Result&lt;std::fs::File,std::io::Error&gt;</code>，该形式类似<code>Result&lt;T,E&gt;</code>，只不过<code>T</code>被替换成了具体的类型<code>std::fs::File</code>，是一个文件句柄类型，<code>E</code>被替换成<code>std::io::Error</code>，是一个 IO 错误类型。</p><p><font size=3><ins><strong>对返回的错误进行处理</strong></ins></font></p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">ErrorKind</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">match</span> f <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=></span> file<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=9></td><td><pre>        <span class="token class-name">Err</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> error<span class="token punctuation">.</span><span class="token function">kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>            <span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span> <span class="token operator">=></span> <span class="token keyword">match</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=11></td><td><pre>                <span class="token class-name">Ok</span><span class="token punctuation">(</span>fc<span class="token punctuation">)</span> <span class="token operator">=></span> fc<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=12></td><td><pre>                <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Problem creating the file: &#123;:?&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=14></td><td><pre>            other_error <span class="token operator">=></span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">"Problem opening the file: &#123;:?&#125;"</span><span class="token punctuation">,</span> other_error<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=15></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment"> * 如果是文件不存在错误ErrorKind::NotFound，就创建文件，</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment"> * 这里创建文件File::create也是返回Result，</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token comment"> * 因此继续用match表达式对其结果进行处理，创建成功，</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token comment"> * 将新的文件句柄赋值给 f，</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token comment"> * 如果失败，则直接panic。</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment">**/</span></pre></td></tr></table></figure><h3 id=unwrap与expect><a class=anchor href=#unwrap与expect>#</a> unwrap与expect</h3><p>不想使用 <code>match</code> 去匹配 <code>Result&lt;T, E&gt;</code> 以获取其中的 <code>T</code> 值，可使用</p><ul><li><code>unwrap</code> - 返回成功，就将<code>Ok(T)</code>中的值取出来，如果失败，就直接<code>panic</code></li><li><code>expect</code> - 返回成功，就将<code>Ok(T)</code>中的值取出来，遇到错误直接<code>panic</code>并可自定义错误提示信息</li></ul><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">let</span> f2 <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Failed to open hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id=传播错误><a class=anchor href=#传播错误>#</a> 传播错误</h3><p>错误处理往往不是哪里调用出错就在哪里处理，实际应用中，大概率会把错误层层上传然后交给调用链的上游函数进行处理，即错误传播。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Read</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">read_username_from_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token comment">// 打开文件，f是`Result&lt;文件句柄,io::Error>`</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> f <span class="token operator">=</span> <span class="token keyword">match</span> f <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>        <span class="token comment">// 打开文件成功，将file句柄赋值给f</span></pre></td></tr><tr><td data-num=10></td><td><pre>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=></span> file<span class="token punctuation">,</span></pre></td></tr><tr><td data-num=11></td><td><pre>        <span class="token comment">// 打开文件失败，将错误返回(向上传播)</span></pre></td></tr><tr><td data-num=12></td><td><pre>        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token comment">// 创建动态字符串s</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token comment">// 从f文件句柄读取数据并写入s中</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token keyword">match</span> f<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>        <span class="token comment">// 读取成功，返回Ok封装的字符串</span></pre></td></tr><tr><td data-num=19></td><td><pre>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=20></td><td><pre>        <span class="token comment">// 将错误向上传播</span></pre></td></tr><tr><td data-num=21></td><td><pre>        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>函数将<code>io::Error</code>的错误往上进行传播，该函数的调用者最终会对<code>Result&lt;String,io::Error&gt;</code>进行再处理。</p><h3 id=宏><a class=anchor href=#宏>#</a> ?宏</h3><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Read</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">// 等价于之前的match表达式的实现方式</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">read_username_from_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    f<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">/** </span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment"> * 代码中File::open报错时返回的错误是std::io::Error类型，</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment"> * 但是open_file函数返回的错误类型是std::error::Error的特征对象</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">**/</span></pre></td></tr><tr><td data-num=16></td><td><pre></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">// 链式调用</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">read_username_from_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>?</code>宏可以自动进行类型提升(转换)。</p><h4 id=用于option枚举><a class=anchor href=#用于option枚举>#</a> 用于Option枚举</h4><p>用于<code>Option</code>枚举的传播，通过<code>?</code>宏，错误时返回<code>None</code>。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token class-name">None</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">first</span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   <span class="token keyword">let</span> v <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>   <span class="token class-name">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id=注意事项><a class=anchor href=#注意事项>#</a> 注意事项</h4><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">// 错误案例</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">first</span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>   arr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这段代码无法通过编译，<code>?</code>操作符需要一个变量来承载正确的值。</p><p>这个函数只会返回<code>Some(&amp;i32)</code>或者<code>None</code>，只有错误值能直接返回，正确值不行。如果数组中存在第0号元素，那么函数第二行使用<code>?</code>后的返回类型为<code>&amp;i32</code>而不是<code>Some(&amp;i32)</code>，因此 <code>?</code> 只能用于以下两种形式</p><ul><li><code>let v = xxx()?;</code></li><li><code>xxx()?.yyy()?;</code></li></ul><h4 id=带返回值的main函数><a class=anchor href=#带返回值的main函数>#</a> 带返回值的main函数</h4><p><code>main</code>函数的返回是<code>()</code>，因此无法满足需求，但Rust还支持另外一种形式的<code>main</code>函数。</p><figure class="highlight rust"><figcaption data-lang=Rust></figcaption><table><tr><td data-num=1></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>关于<code>Box&lt;dyn Error&gt;</code>特征对象，因为<code>std::error:Error</code>是Rust中抽象层次最高的错误，其它标准库中的错误都实现了该特征，因此可以用该特征对象代表一切错误，就算<code>main</code>函数中调用任何标准库函数发生错误，都可以通过<code>Box&lt;dyn Error&gt;</code>这个特征对象进行返回。</p><div class=tags><a href=/tags/programming-language/ rel=tag><i class="ic i-tag"></i> 编程语言</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span> <span class=text>更新于</span> <time title="修改时间：2024-02-07 10:41:27" itemprop=dateModified datetime=2024-02-07T10:41:27+08:00>2024-02-07</time></span><span class=item data-path=/computer-science/programming/rust/rust-basic/rustpart1/ title=阅读次数><span class=icon><i class="ic i-eye"></i></span> <span class=text>阅读次数</span><span class=waline-pageview-count></span> <span class=text>次</span></span></div><div id=copyright><ul><li class=author><strong>本文作者：</strong> ReverseSacle <i class="ic i-at"><em>@</em></i>逆转天平</li><li class=link><strong>本文链接：</strong> <a href=https://www.reversesacle.com/computer-science/programming/rust/rust-basic/rustpart1/ title=Rust语言-基础-第一部分>https://www.reversesacle.com/computer-science/programming/rust/rust-basic/rustpart1/</a></li><li class=license><strong>版权声明：</strong> 本站所有文章除特别声明外，均采用 <span class=exturl data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class=post-nav><div class="item left"><a href=/computer-science/computer-basic/composition/ccppart4/ itemprop=url rel=prev data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg18.webp title=计算机组成原理-CSAPP-第四部分><span class=type>上一篇</span><span class=category><i class="ic i-flag"></i> 计算机组成原理</span><h3>计算机组成原理-CSAPP-第四部分</h3></a></div><div class="item right"><a href=/computer-science/programming/rust/rust-basic/rustpart2/ itemprop=url rel=next data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg4.webp title=Rust语言-基础-第二部分><span class=type>下一篇</span><span class=category><i class="ic i-flag"></i> Rust基础</span><h3>Rust语言-基础-第二部分</h3></a></div></div><div class=wrap id=comments><div id=waline-comment></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=文章目录><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A6%82%E8%BF%B0><span class=toc-number>1.</span> <span class=toc-text>概述</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B><span class=toc-number>2.</span> <span class=toc-text>数据类型</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A6%82%E8%BF%B0-2><span class=toc-number>2.1.</span> <span class=toc-text>概述</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B><span class=toc-number>2.2.</span> <span class=toc-text>数值类型</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%95%B4%E6%95%B0><span class=toc-number>2.2.1.</span> <span class=toc-text>整数</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%95%B0%E5%AD%97%E5%AD%97%E9%9D%A2%E9%87%8F><span class=toc-number>2.2.2.</span> <span class=toc-text>数字字面量</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%B5%AE%E7%82%B9%E6%95%B0><span class=toc-number>2.2.3.</span> <span class=toc-text>浮点数</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#nan><span class=toc-number>2.2.4.</span> <span class=toc-text>NaN</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B-char><span class=toc-number>2.3.</span> <span class=toc-text>字符类型 - char</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%B8%83%E5%B0%94%E7%B1%BB%E5%9E%8B-bool><span class=toc-number>2.4.</span> <span class=toc-text>布尔类型 - bool</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8D%95%E5%85%83%E7%B1%BB%E5%9E%8B-><span class=toc-number>2.5.</span> <span class=toc-text>单元类型 - ()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%B3%A8%E9%87%8A><span class=toc-number>3.</span> <span class=toc-text>注释</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BB%A3%E7%A0%81%E6%B3%A8%E9%87%8A><span class=toc-number>3.1.</span> <span class=toc-text>代码注释</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%96%87%E6%A1%A3%E6%B3%A8%E9%87%8A><span class=toc-number>3.2.</span> <span class=toc-text>文档注释</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8F%98%E9%87%8F%E4%B8%8E%E5%B8%B8%E9%87%8F><span class=toc-number>4.</span> <span class=toc-text>变量与常量</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%98%E9%87%8F%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E8%A7%84%E8%8C%83><span class=toc-number>4.1.</span> <span class=toc-text>变量基本命令规范</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%98%E9%87%8F%E5%8F%AF%E5%8F%98%E6%80%A7><span class=toc-number>4.2.</span> <span class=toc-text>变量可变性</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%98%E9%87%8F%E7%BB%91%E5%AE%9A%E4%B8%8E%E8%A7%A3%E6%9E%84><span class=toc-number>4.3.</span> <span class=toc-text>变量绑定与解构</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F><span class=toc-number>4.4.</span> <span class=toc-text>变量作用域</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%98%E9%87%8F%E9%81%AE%E8%94%BDshadowing><span class=toc-number>4.5.</span> <span class=toc-text>变量遮蔽(shadowing)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%B8%B8%E9%87%8Fconstant><span class=toc-number>4.6.</span> <span class=toc-text>常量(constant)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%BF%90%E7%AE%97%E7%AC%A6><span class=toc-number>5.</span> <span class=toc-text>运算符</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%AF%AD%E5%8F%A5statement%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8Fexpression><span class=toc-number>6.</span> <span class=toc-text>语句(statement)与表达式(expression)</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%85%B3%E9%94%AE%E5%AD%97><span class=toc-number>7.</span> <span class=toc-text>关键字</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%BD%BF%E7%94%A8as%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2><span class=toc-number>8.</span> <span class=toc-text>使用as关键字的类型转换</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%88%86%E6%94%AF%E5%92%8C%E5%BE%AA%E7%8E%AF><span class=toc-number>9.</span> <span class=toc-text>分支和循环</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#if-else%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5><span class=toc-number>9.1.</span> <span class=toc-text>if-else分支语句</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%BA%8F%E5%88%97range><span class=toc-number>9.2.</span> <span class=toc-text>序列(Range)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#for%E5%BE%AA%E7%8E%AF><span class=toc-number>9.3.</span> <span class=toc-text>for循环</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#while%E5%BE%AA%E7%8E%AF><span class=toc-number>9.4.</span> <span class=toc-text>while循环</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#loop%E5%BE%AA%E7%8E%AF><span class=toc-number>9.5.</span> <span class=toc-text>loop循环</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#break%E5%85%B3%E9%94%AE%E5%AD%97><span class=toc-number>9.6.</span> <span class=toc-text>break关键字</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%95%B0%E7%BB%84><span class=toc-number>10.</span> <span class=toc-text>数组</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%95%B0%E7%BB%84%E7%9A%84%E5%88%9B%E5%BB%BA><span class=toc-number>10.1.</span> <span class=toc-text>数组的创建</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87><span class=toc-number>10.2.</span> <span class=toc-text>数组切片</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AD%97%E7%AC%A6%E4%B8%B2><span class=toc-number>11.</span> <span class=toc-text>字符串</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%87%E7%89%87><span class=toc-number>11.1.</span> <span class=toc-text>字符串切片</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AD%97%E7%AC%A6%E4%B8%B2string%E7%B1%BB%E5%9E%8B%E7%B4%A2%E5%BC%95><span class=toc-number>11.2.</span> <span class=toc-text>字符串(String类型)索引</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C><span class=toc-number>11.3.</span> <span class=toc-text>字符串相关操作</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%BF%BD%E5%8A%A0push><span class=toc-number>11.3.1.</span> <span class=toc-text>追加(push)</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%8F%92%E5%85%A5insert><span class=toc-number>11.3.2.</span> <span class=toc-text>插入(Insert)</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%9B%BF%E6%8D%A2replace><span class=toc-number>11.3.3.</span> <span class=toc-text>替换(Replace)</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%88%A0%E9%99%A4delete><span class=toc-number>11.3.4.</span> <span class=toc-text>删除(Delete)</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E8%BF%9E%E6%8E%A5concatenate><span class=toc-number>11.3.5.</span> <span class=toc-text>连接(Concatenate)</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2><span class=toc-number>11.3.6.</span> <span class=toc-text>大小写转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%81%8D%E5%8E%86><span class=toc-number>11.4.</span> <span class=toc-text>字符串遍历</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95><span class=toc-number>11.5.</span> <span class=toc-text>字符串相关方法</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6><span class=toc-number>11.6.</span> <span class=toc-text>转义字符</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#ascii%E7%A0%81%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95><span class=toc-number>11.7.</span> <span class=toc-text>ASCII码字符类型判断方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%89%80%E6%9C%89%E6%9D%83><span class=toc-number>12.</span> <span class=toc-text>所有权</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%89%80%E6%9C%89%E6%9D%83%E4%B8%8E%E5%A0%86%E6%A0%88><span class=toc-number>12.1.</span> <span class=toc-text>所有权与堆栈</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%89%80%E6%9C%89%E6%9D%83%E8%A7%84%E5%88%99><span class=toc-number>12.2.</span> <span class=toc-text>所有权规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%BC%95%E7%94%A8%E4%B8%8E%E5%80%9F%E7%94%A8borrowing><span class=toc-number>13.</span> <span class=toc-text>引用与借用(Borrowing)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%B8%B8%E8%A7%84%E5%BC%95%E7%94%A8><span class=toc-number>13.1.</span> <span class=toc-text>常规引用</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%BC%95%E7%94%A8><span class=toc-number>13.2.</span> <span class=toc-text>不可变引用</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%AF%E5%8F%98%E5%BC%95%E7%94%A8><span class=toc-number>13.3.</span> <span class=toc-text>可变引用</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%82%AC%E5%9E%82%E5%BC%95%E7%94%A8dangling-references><span class=toc-number>13.4.</span> <span class=toc-text>悬垂引用(Dangling References)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%AF%A6%E7%BB%86%E8%A7%A3%E8%AF%BB><span class=toc-number>13.5.</span> <span class=toc-text>详细解读</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#string%E7%B1%BB%E5%9E%8B%E4%B8%8Estr%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%BD%AC%E6%8D%A2><span class=toc-number>14.</span> <span class=toc-text>String类型与&amp;str类型的转换</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA><span class=toc-number>15.</span> <span class=toc-text>格式化输出</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A0%87%E5%87%86%E8%BE%93%E5%87%BA><span class=toc-number>15.1.</span> <span class=toc-text>标准输出</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A0%87%E5%87%86%E9%94%99%E8%AF%AF%E8%BE%93%E5%87%BA><span class=toc-number>15.2.</span> <span class=toc-text>标准错误输出</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BD%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%BD%A2%E5%BC%8F><span class=toc-number>15.3.</span> <span class=toc-text>位置参数形式</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%85%B7%E4%BD%93%E5%90%8D%E7%A7%B0%E5%8F%82%E6%95%B0%E5%BD%A2%E5%BC%8F><span class=toc-number>15.4.</span> <span class=toc-text>具体名称参数形式</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%8F%82%E6%95%B0%E5%BD%A2%E5%BC%8F><span class=toc-number>15.5.</span> <span class=toc-text>格式化参数形式</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%8D%95%E8%8E%B7%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%80%BC><span class=toc-number>15.6.</span> <span class=toc-text>捕获环境中的值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%87%BD%E6%95%B0><span class=toc-number>16.</span> <span class=toc-text>函数</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B><span class=toc-number>17.</span> <span class=toc-text>复合类型</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%85%83%E7%BB%84><span class=toc-number>17.1.</span> <span class=toc-text>元组</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BB%93%E6%9E%84%E4%BD%93><span class=toc-number>17.2.</span> <span class=toc-text>结构体</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E4%BD%93><span class=toc-number>17.2.1.</span> <span class=toc-text>基本结构体</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%85%83%E7%BB%84%E7%BB%93%E6%9E%84%E4%BD%93tuple-struct><span class=toc-number>17.2.2.</span> <span class=toc-text>元组结构体(Tuple Struct)</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%8D%95%E5%85%83%E7%BB%93%E6%9E%84%E4%BD%93unit-like-struct><span class=toc-number>17.2.3.</span> <span class=toc-text>单元结构体(Unit-like Struct)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%9E%9A%E4%B8%BEenumenumeration><span class=toc-number>17.3.</span> <span class=toc-text>枚举(enum&#x2F;enumeration)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D><span class=toc-number>18.</span> <span class=toc-text>模式匹配</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#match%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D><span class=toc-number>18.1.</span> <span class=toc-text>match(表达式)匹配</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#if-let%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D><span class=toc-number>18.2.</span> <span class=toc-text>if-let(表达式)匹配</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#option%E6%9E%9A%E4%B8%BE%E8%A7%A3%E6%9E%84><span class=toc-number>18.3.</span> <span class=toc-text>Option枚举解构</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#ref%E5%85%B3%E9%94%AE%E5%AD%97><span class=toc-number>18.4.</span> <span class=toc-text>ref关键字</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%96%B9%E6%B3%95method><span class=toc-number>19.</span> <span class=toc-text>方法(Method)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95><span class=toc-number>19.1.</span> <span class=toc-text>定义方法</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#selfselfmut-self><span class=toc-number>19.2.</span> <span class=toc-text>self&#x2F;&amp;self&#x2F;&amp;mut self</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%96%B9%E6%B3%95%E5%90%8D%E4%B8%8E%E7%BB%93%E6%9E%84%E4%BD%93%E5%AD%97%E6%AE%B5%E5%90%8D%E7%9B%B8%E5%90%8C><span class=toc-number>19.3.</span> <span class=toc-text>方法名与结构体字段名相同</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%85%B3%E8%81%94%E5%87%BD%E6%95%B0><span class=toc-number>19.4.</span> <span class=toc-text>关联函数</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%BA%E6%9E%9A%E4%B8%BE%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95><span class=toc-number>19.5.</span> <span class=toc-text>为枚举实现方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%B3%9B%E5%9E%8Bgenerics><span class=toc-number>20.</span> <span class=toc-text>泛型(Generics)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%87%BD%E6%95%B0%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%B3%9B%E5%9E%8B><span class=toc-number>20.1.</span> <span class=toc-text>函数中使用泛型</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%B3%9B%E5%9E%8B><span class=toc-number>20.2.</span> <span class=toc-text>结构体中使用泛型</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%9E%9A%E4%B8%BE%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%B3%9B%E5%9E%8B><span class=toc-number>20.3.</span> <span class=toc-text>枚举中使用泛型</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#option%E6%9E%9A%E4%B8%BE><span class=toc-number>20.3.1.</span> <span class=toc-text>Option枚举</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#result%E6%9E%9A%E4%B8%BE><span class=toc-number>20.3.2.</span> <span class=toc-text>Result枚举</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%96%B9%E6%B3%95%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%B3%9B%E5%9E%8B><span class=toc-number>20.4.</span> <span class=toc-text>方法中使用泛型</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%BA%E5%85%B7%E4%BD%93%E7%9A%84%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%9E%8B%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95><span class=toc-number>20.5.</span> <span class=toc-text>为具体的泛型类型实现方法</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#const%E6%B3%9B%E5%9E%8B><span class=toc-number>20.6.</span> <span class=toc-text>const泛型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%89%B9%E5%BE%81trait><span class=toc-number>21.</span> <span class=toc-text>特征(Trait)</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%9A%E4%B9%89%E7%89%B9%E5%BE%81><span class=toc-number>21.1.</span> <span class=toc-text>定义特征</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%B8%BA%E7%89%B9%E5%AE%9A%E7%B1%BB%E5%9E%8B%E5%AE%9E%E7%8E%B0%E7%89%B9%E5%BE%81><span class=toc-number>21.2.</span> <span class=toc-text>为特定类型实现特征</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%89%B9%E5%BE%81%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0><span class=toc-number>21.3.</span> <span class=toc-text>特征作为函数参数</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%89%B9%E5%BE%81%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC><span class=toc-number>21.4.</span> <span class=toc-text>特征作为函数返回值</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%89%B9%E5%BE%81%E7%BA%A6%E6%9D%9Ftrait-bound><span class=toc-number>21.5.</span> <span class=toc-text>特征约束(trait bound)</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%8D%95%E7%BA%A6%E6%9D%9F><span class=toc-number>21.5.1.</span> <span class=toc-text>单约束</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%A4%9A%E9%87%8D%E7%BA%A6%E6%9D%9F><span class=toc-number>21.5.2.</span> <span class=toc-text>多重约束</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#where%E7%BA%A6%E6%9D%9F><span class=toc-number>21.5.3.</span> <span class=toc-text>Where约束</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E7%89%B9%E5%BE%81%E7%BA%A6%E6%9D%9F%E7%94%A8%E4%BA%8E%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89><span class=toc-number>21.5.4.</span> <span class=toc-text>特征约束用于方法定义</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E7%89%B9%E5%BE%81%E7%BA%A6%E6%9D%9F%E7%94%A8%E4%BA%8E%E7%89%B9%E5%BE%81%E5%AE%9A%E4%B9%89><span class=toc-number>21.5.5.</span> <span class=toc-text>特征约束用于特征定义</span></a></li></ol></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%85%B3%E8%81%94%E7%B1%BB%E5%9E%8B><span class=toc-number>21.6.</span> <span class=toc-text>关联类型</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%BB%98%E8%AE%A4%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0><span class=toc-number>21.7.</span> <span class=toc-text>默认泛型类型参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%94%99%E8%AF%AF%E6%8D%95%E8%8E%B7%E4%B8%8E%E5%A4%84%E7%90%86><span class=toc-number>22.</span> <span class=toc-text>错误捕获与处理</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#panic%E4%B8%8D%E5%8F%AF%E6%81%A2%E5%A4%8D%E9%94%99%E8%AF%AF><span class=toc-number>22.1.</span> <span class=toc-text>panic(不可恢复错误)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8F%AF%E6%81%A2%E5%A4%8D%E9%94%99%E8%AF%AF><span class=toc-number>22.2.</span> <span class=toc-text>可恢复错误</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#unwrap%E4%B8%8Eexpect><span class=toc-number>22.3.</span> <span class=toc-text>unwrap与expect</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BC%A0%E6%92%AD%E9%94%99%E8%AF%AF><span class=toc-number>22.4.</span> <span class=toc-text>传播错误</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%8F><span class=toc-number>22.5.</span> <span class=toc-text>?宏</span></a><ol class=toc-child><li class="toc-item toc-level-4"><a class=toc-link href=#%E7%94%A8%E4%BA%8Eoption%E6%9E%9A%E4%B8%BE><span class=toc-number>22.5.1.</span> <span class=toc-text>用于Option枚举</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9><span class=toc-number>22.5.2.</span> <span class=toc-text>注意事项</span></a></li><li class="toc-item toc-level-4"><a class=toc-link href=#%E5%B8%A6%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84main%E5%87%BD%E6%95%B0><span class=toc-number>22.5.3.</span> <span class=toc-text>带返回值的main函数</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title=系列文章><ul><li class=active><a href=/computer-science/programming/rust/rust-basic/rustpart1/ rel=bookmark title=Rust语言-基础-第一部分>Rust语言-基础-第一部分</a></li><li><a href=/computer-science/programming/rust/rust-basic/rustpart2/ rel=bookmark title=Rust语言-基础-第二部分>Rust语言-基础-第二部分</a></li><li><a href=/computer-science/programming/rust/rust-basic/rustpart3/ rel=bookmark title=Rust语言-基础-第三部分>Rust语言-基础-第三部分</a></li></ul></div><div class="overview panel" data-title=站点概览><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img class=image itemprop=image alt=ReverseSacle data-src=/images/avatar.webp><p class=name itemprop=name>ReverseSacle</p><div class=description itemprop=description>知识书库 & 学习点滴</div></div><nav class=state><div class="item posts"><a href=/archives/ ><span class=count>186</span> <span class=name>文章</span></a></div><div class="item categories"><a href=/categories/ ><span class=count>52</span> <span class=name>分类</span></a></div><div class="item tags"><a href=/tags/ ><span class=count>18</span> <span class=name>标签</span></a></div></nav><div class=social><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JldmVyc2VTYWNsZQ==" title=https:&#x2F;&#x2F;github.com&#x2F;ReverseSacle><i class="ic i-github"></i></span><span class="exturl item email" data-url="bWFpbHRvOnByaXZhdGVAcmV2ZXJzZXNhY2xlLmNvbQ==" title=mailto:private@reversesacle.com><i class="ic i-envelope"></i></span></div><ul class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i> 首页</a></li><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-feather"></i> 文章</a><ul class=submenu><li class=item><a href=/archives/ rel=section><i class="ic i-list-alt"></i> 归档</a></li><li class=item><a href=/categories/ rel=section><i class="ic i-th"></i> 分类</a></li><li class=item><a href=/tags/ rel=section><i class="ic i-tags"></i> 标签</a></li></ul></li><li class=item><a href=/about/ rel=section><i class="ic i-user"></i> 关于</a></li><li class=item><a href=/friend-links/ rel=section><i class="ic i-heart"></i> 友链</a></li></ul></div></div></div><ul id=quick><li class="prev pjax"><a href=/computer-science/computer-basic/composition/ccppart4/ rel=prev title=上一篇><i class="ic i-chevron-left"></i></a></li><li class=up><i class="ic i-arrow-up"></i></li><li class=down><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href=/computer-science/programming/rust/rust-basic/rustpart2/ rel=next title=下一篇><i class="ic i-chevron-right"></i></a></li><li class=percent></li></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>随机文章</h2><ul><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/c-data-structure/ title="分类于 C语言数据结构">C语言数据结构</a></div><span><a href=/computer-science/programming/c-language/c-data-structure/seqstring/ title=结构串之字符存储>结构串之字符存储</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/stack/ title="分类于 栈">栈</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/stack/derivatives/ title=栈问题派生>栈问题派生</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/seqlist/ title="分类于 顺序表">顺序表</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/seqlist/sort/ title=顺序表-序列重组>顺序表-序列重组</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/web/ title="分类于 web">web</a></div><span><a href=/computer-science/programming/web/hcpart2/ title=HTML与CSS基础知识-第二部分>HTML与CSS基础知识-第二部分</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/c-algorithm/ title="分类于 C版算法">C版算法</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/dynamic-program/ title=动态规划&#x2F;状态转移>动态规划/状态转移</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/database/ title="分类于 数据库">数据库</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/database/mysql/ title="分类于 MySQL">MySQL</a></div><span><a href=/computer-science/programming/database/mysql/mspart1/ title=MySQL数据库基础-第一部分>MySQL数据库基础-第一部分</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/algorithm/ title="分类于 算法">算法</a></div><span><a href=/computer-science/programming/algorithm/pattern-search/knuth%E2%80%93morris%E2%80%93pratt/ title=Knuth–Morris–Pratt(KMP)>Knuth–Morris–Pratt(KMP)</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/simulation/ title="分类于 模拟">模拟</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/simulation/design/ title=模拟-自定义>模拟-自定义</a></span></li><li class=item><div class=breadcrumb><a href=/categories/potpourri/ title="分类于 百味">百味</a><i class="ic i-angle-right"></i> <a href=/categories/potpourri/foreign-language/ title="分类于 外语">外语</a></div><span><a href=/potpourri/foreign-language/advanced-learning/ title=英语进阶学习材料>英语进阶学习材料</a></span></li><li class=item><div class=breadcrumb><a href=/categories/general-science-and-technology/ title="分类于 通用科学技术">通用科学技术</a><i class="ic i-angle-right"></i> <a href=/categories/general-science-and-technology/pc/ title="分类于 通用技术之PC端">通用技术之PC端</a><i class="ic i-angle-right"></i> <a href=/categories/general-science-and-technology/pc/external-device/ title="分类于 外接设备">外接设备</a></div><span><a href=/general-science-and-technology/pc/external-device/lenovo-external-display/ title=解决联想外接显示屏问题>解决联想外接显示屏问题</a></span></li></ul></div><div><h2>最新评论</h2><ul id=waline-recent></ul></div></div><div class=status><div class=copyright>&copy; 2021 – <span itemprop=copyrightYear>2025</span><span class=with-love><i class="ic i-sakura rotate"></i></span> <span class=author itemprop=copyrightHolder>ReverseSacle @ ReverseSacle-Blog</span></div><div class=count><i class="ic i-clock" aria-hidden=true></i> <span id=time align=center>载入时间中...<script defer>var now=new Date;function createtime(){var n=new Date("2021-11-16 22:30:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("time").innerHTML="已经过 "+dnum+" 天 "+hnum+" 小时 "+mnum+" 分 "+snum+" 秒 "}setInterval("createtime()",250)</script></span><span class=post-meta-item-icon>|&nbsp<i class="ic i-chart-area"></i></span> <span title=站点总字数>2.1m 字</span> <span class=post-meta-item-icon>|&nbsp<i class="ic i-coffee"></i></span> <span title=站点阅读时长>40:40</span></div></div></div></footer></div><script data-config>var LOCAL={path:"computer-science/programming/rust/rust-basic/rustpart1/",favicon:{show:"ReverseSacle-Blog",hide:"ReverseSacle-Blog"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},waline:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src=https://polyfill.alicdn.com/v3/polyfill.min.js></script><script src=https://cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1.16.0/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js></script><script src=/js/app.js></script></body></html>