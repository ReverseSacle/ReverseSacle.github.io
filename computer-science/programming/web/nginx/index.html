<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content=#222><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/ico sizes=48x48 href=/images/favicon.ico><link rel=alternate type=application/rss+xml title=逆转天平 href=https://www.reversesacle.com/rss.xml><link rel=alternate type=application/atom+xml title=逆转天平 href=https://www.reversesacle.com/atom.xml><link rel=alternate type=application/json title=逆转天平 href=https://www.reversesacle.com/feed.json><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=/css/app.css><meta name=description content=web><link rel=canonical href=https://www.reversesacle.com/computer-science/programming/web/nginx/ ><title>Nginx基础 - web - 编程 - 计算机科学 | ReverseSacle-Blog</title><meta name=generator content="Hexo 6.3.0"></head><body itemscope itemtype=http://schema.org/WebPage><div id=loading><div class=dotloader><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div><div class=dot></div></div></div><div id=container><header id=header itemscope itemtype=http://schema.org/WPHeader><div class=inner><div id=brand><div class=pjax><h1 itemprop="name headline">Nginx基础</h1><div class=meta><span class=item title="创建时间：2023-09-29 14:35:27"><span class=icon><i class="ic i-calendar"></i></span> <span class=text>发表于</span> <time itemprop="dateCreated datePublished" datetime=2023-09-29T14:35:27+08:00>2023-09-29</time></span><span class=item title=本文字数><span class=icon><i class="ic i-pen"></i></span> <span class=text>本文字数</span> <span>14k</span> <span class=text>字</span></span><span class=item title=阅读时长><span class=icon><i class="ic i-clock"></i></span> <span class=text>阅读时长</span> <span>16 分钟</span></span></div></div></div><nav id=nav><div class=inner><div class=toggle><div class=lines role=navigation aria-label=切换导航栏><span class=line></span><span class=line></span><span class=line></span></div></div><ul class=menu><li class="item title"><a href=/ rel=start>ReverseSacle-Blog</a></li></ul><ul class=right><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id=imgs class=pjax><ul><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg20.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg13.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg11.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg6.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg5.webp></li><li class=item data-background-image=https://resa-imgs.oss-accelerate.aliyuncs.com/img/acg3.webp></li></ul></div></header><div id=waves><svg class=waves xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewBox="0 24 150 28" preserveAspectRatio=none shape-rendering=auto><defs><path id=gentle-wave d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352z"/></defs><g class=parallax><use xlink:href=#gentle-wave x=48 y=0 /><use xlink:href=#gentle-wave x=48 y=3 /><use xlink:href=#gentle-wave x=48 y=5 /><use xlink:href=#gentle-wave x=48 y=7 /></g></svg></div><main><div class=inner><div id=main class=pjax><div class="article wrap"><div class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><i class="ic i-home"></i> <span><a href=/ >首页</a></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/ itemprop=item rel=index title="分类于 计算机科学"><span itemprop=name>计算机科学</span></a><meta itemprop=position content=1></span><i class="ic i-angle-right"></i> <span itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/ itemprop=item rel=index title="分类于 编程"><span itemprop=name>编程</span></a><meta itemprop=position content=2></span><i class="ic i-angle-right"></i> <span class=current itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/categories/computer-science/programming/web/ itemprop=item rel=index title="分类于 web"><span itemprop=name>web</span></a><meta itemprop=position content=3></span></div><article itemscope itemtype=http://schema.org/Article class="post block" lang=zh-CN><link itemprop=mainEntityOfPage href=https://www.reversesacle.com/computer-science/programming/web/nginx/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.webp><meta itemprop=name content=ReverseSacle><meta itemprop=description content="所见即所得，所思即所行, 知识书库 & 学习点滴"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content=逆转天平></span><div class="body md" itemprop=articleBody><div class="note info no-icon"><p>默认环境：Linux(CentOS 7)</p></div><h2 id=概述><a class=anchor href=#概述>#</a> 概述</h2><p>Nginx是一个完全由C语言编写，高安全，高性能的HTTP，反向代理的，配置灵活的web服务器，同时也提供了IMAP/POP3/SMTP服务。</p><p>其特点是占内存少，并发能力强。</p><p>其安装过程简单，配置文件简洁(支持perl语法)，Bug少，几乎可以做到一直不间断运行，甚至在不间断运行的情况下还能进行软件版本的升级。</p><h2 id=安装命令><a class=anchor href=#安装命令>#</a> 安装命令</h2><p><strong>安装依赖</strong></p><p>CentOS下使用yum安装时往往找不到rpm的情况，官方的<code>rpm repository</code>提供的rpm包也不够丰富，EPEL恰恰可以解决这两方面的问题。</p><p><code>yum -y install epel-release</code> - 安装<code>epel-release</code>软件包(用于安装和配置<code>Extra Packages for Enterprise Linux(EPEL)</code>存储库)</p><p><code>yum -y install pcre pcre-devel</code> - 安装PCRE库(用于解析正则表达式)</p><p><code>yum -y install openssl openssl-devel</code> - SSL安全加密的Socket协议层(用于HTTP安全传输的HTTPS)</p><p><strong>Nginx安装</strong></p><p><code>yum -y install nginx</code></p><h2 id=防火墙前提配置><a class=anchor href=#防火墙前提配置>#</a> 防火墙前提配置</h2><p><strong>虚拟机环境下</strong></p><p>需关闭防火墙 - <code>systemctl stop firewalld</code></p><p><strong>云服务器环境下</strong></p><p>查看防火墙的状态 - <code>firewall-cmd --state</code></p><p>假如防火墙处于开启状态，执行以下命令</p><ul><li><p>开放80端口 - <code>firewall-cmd --permanent --zone=public --add-service=http</code></p></li><li><p>关闭80端口 - <code>firewall-cmd --permanent --zone=public --remove-service=http</code></p></li><li><p>开放443端口 - <code>firewall-cmd --permanent --zone=public --add-service=https</code></p></li><li><p>关闭443端口 - <code>firewall-cmd --permanent --zone=public --remove-service=https</code></p></li><li><p>重启防火墙 - <code>firewall-cmd --reload</code></p></li></ul><p><code>systemctl status nginx</code> - 查看nginx服务当前状态</p><h2 id=nginx相关命令><a class=anchor href=#nginx相关命令>#</a> Nginx相关命令</h2><p><code>nginx -s [signal]</code>，signal可选值有</p><ul><li>quit - 自然停止</li><li>stop - 立即停止</li><li>reload - 重新配置文件</li><li>reopen - 重新打开日志文件</li></ul><p><code>nginx -V</code> - 查看Nginx的安装目录、编译参数、配置文件，日志文件的位置等信息</p><p><code>nginx -t</code> - 快速定位自定义配置文件位置</p><h2 id=配置文件结构内容概述><a class=anchor href=#配置文件结构内容概述>#</a> 配置文件结构内容概述</h2><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">#location用来匹配浏览器中输入的URL，`/`表示根目录</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token directive"><span class="token keyword">location</span> /</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span><span class="token comment">#指定要搜索的根目录文件夹，是一个相对路径(相对于Nginx安装目录)</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">#全局块，全局属性的配置</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token directive"><span class="token keyword">user</span> nginx</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span><span class="token comment">#指定worker进行的数量，设置为auto时会自动根据CPU内核来设置</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/error.log</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token directive"><span class="token keyword">pid</span> /run/nginx.pid</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">#events块，用于服务器和客户端之间网络连接的一些配置</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token directive"><span class="token keyword">events</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span><span class="token comment">#指定每个worker进程可以同时接收几个网络连接</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">#http块，nginx修改最频繁的部分</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">#可以包含多个server块，也叫虚拟主机</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token directive"><span class="token keyword">http</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token comment">#include指令还可以包含其他的配置文件</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token comment">#将mime.types文件包含进来</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token directive"><span class="token keyword">include</span> mime.types</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    </pre></td></tr><tr><td data-num=19></td><td><pre>    <span class="token comment">#...............</span></pre></td></tr><tr><td data-num=20></td><td><pre>    </pre></td></tr><tr><td data-num=21></td><td><pre>    <span class="token comment">#把servers目录下的所有配置文件都包含进来，</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token comment">#这样就可以可把每个虚拟主机的配置都放到一个单独的文件里面</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token directive"><span class="token keyword">include</span> servers/*</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=反向代理与负载均衡概述><a class=anchor href=#反向代理与负载均衡概述>#</a> 反向代理与负载均衡概述</h2><p>一般来说，正向代理即代理客户端(例如虚拟专用网络)，反向代理即代理服务端。</p><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">http</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token comment">#反向代理的配置</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token comment">#upstream后面的名字是随意取的，里面是需要被代理的服务器的配置</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token comment">#默认以轮询的方式来代理的</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token directive"><span class="token keyword">upstream</span> backend</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=6></td><td><pre>        <span class="token comment">#可以使用ip_hash负载均衡策略</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token comment">#会根据客户端的ip地址来进行哈希，</span></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token comment">#同一个客户端的请求会被分配到同一个服务器上，可解决session相关问题</span></pre></td></tr><tr><td data-num=9></td><td><pre>        <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>        </pre></td></tr><tr><td data-num=11></td><td><pre>        <span class="token comment">#可以使用权重weight来调整负载均衡的策略</span></pre></td></tr><tr><td data-num=12></td><td><pre>        <span class="token comment">#权重越大被分配到的请求次数也就越多</span></pre></td></tr><tr><td data-num=13></td><td><pre>        <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8000 weight=3</span><span class="token punctuation">;</span><span class="token comment">#让其权重是后面剩下的3倍</span></pre></td></tr><tr><td data-num=14></td><td><pre>        <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8001</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=16></td><td><pre>    </pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=18></td><td><pre>        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre>        <span class="token comment">#让所有以`/app`开头的请求都被代理到上面的upstream中</span></pre></td></tr><tr><td data-num=20></td><td><pre>        <span class="token directive"><span class="token keyword">location</span> /app</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=21></td><td><pre>            <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span><span class="token comment">#backend是upstream中自定义的名称</span></pre></td></tr><tr><td data-num=22></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=https配置><a class=anchor href=#https配置>#</a> HTTPS配置</h2><p><code>HTTP + SSL = HTTPS</code></p><h3 id=自签名证书非认证证书><a class=anchor href=#自签名证书非认证证书>#</a> 自签名证书(非认证证书)</h3><p>使用openssl命令生成一个自签名的证书。</p><p>使用<code>-reqexts</code>参数来指定一个配置文件，该配置文件包含了<code>Subject Alternative Name</code>扩展的定义</p><p><code>vi san.cnf</code></p><figure class="highlight tex"><figcaption data-lang=TeX><span>san.cnf</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token punctuation">[</span>req<span class="token punctuation">]</span></pre></td></tr><tr><td data-num=2></td><td><pre>req_extensions = v3_req</pre></td></tr><tr><td data-num=3></td><td><pre>distinguished_name = req_distinguished_name</pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">[</span>v3_req<span class="token punctuation">]</span></pre></td></tr><tr><td data-num=6></td><td><pre>subjectAltName = @alt_names</pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token punctuation">[</span>req_distinguished_name<span class="token punctuation">]</span></pre></td></tr><tr><td data-num=9></td><td><pre>countryName = Country Name</pre></td></tr><tr><td data-num=10></td><td><pre>countryName_default = SI</pre></td></tr><tr><td data-num=11></td><td><pre>stateOrProvinceName = Province Name</pre></td></tr><tr><td data-num=12></td><td><pre>stateOrProvinceName_default = Ljubljana</pre></td></tr><tr><td data-num=13></td><td><pre>localityName = Locality Name</pre></td></tr><tr><td data-num=14></td><td><pre>localityName_default = Ljubljana</pre></td></tr><tr><td data-num=15></td><td><pre>organizationName = Organization Name</pre></td></tr><tr><td data-num=16></td><td><pre>organizationName_default = Security</pre></td></tr><tr><td data-num=17></td><td><pre>commonName = Common Name</pre></td></tr><tr><td data-num=18></td><td><pre>commonName_max = 64</pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token punctuation">[</span>alt_names<span class="token punctuation">]</span></pre></td></tr><tr><td data-num=21></td><td><pre>DNS.1 = example.top</pre></td></tr><tr><td data-num=22></td><td><pre>DNS.2 = example2.top</pre></td></tr></table></figure><p>使用命令</p><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre>openssl req <span class="token parameter variable">-newkey</span> rsa:4096 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num=2></td><td><pre>            <span class="token parameter variable">-x509</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num=3></td><td><pre>            <span class="token parameter variable">-sha256</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num=4></td><td><pre>            <span class="token parameter variable">-days</span> <span class="token number">3650</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num=5></td><td><pre>            <span class="token parameter variable">-nodes</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num=6></td><td><pre>            <span class="token parameter variable">-out</span> example.crt <span class="token punctuation">\</span></pre></td></tr><tr><td data-num=7></td><td><pre>            <span class="token parameter variable">-keyout</span> example.key <span class="token punctuation">\</span></pre></td></tr><tr><td data-num=8></td><td><pre>            <span class="token parameter variable">-subj</span> <span class="token string">"/C=SI/ST=Ljubljana/L=Ljubljana/O=Security/OU=IT Department/CN=www.example.com"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num=9></td><td><pre>            <span class="token parameter variable">-reqexts</span> v3_req <span class="token punctuation">\</span></pre></td></tr><tr><td data-num=10></td><td><pre>            <span class="token parameter variable">-config</span> san.cnf</pre></td></tr></table></figure><ul><li><code>openssl req</code> - 这个命令用于生成证书请求(CSR)和自签名证书</li><li><code>-newkey rsa:4096</code> - 指定生成一个新的RSA密钥对，密钥长度为4096位</li><li><code>-x509</code> - 表示生成自签名的X.509证书，而不是生成证书请求</li><li><code>-sha256</code> - 使用SHA-256算法进行摘要</li><li><code>-days 3650</code> - 指定证书的有效期为3650天，即10年</li><li><code>-nodes</code> - 生成的私钥不加密，不需要输入密码</li><li><code>-out example.crt</code> - 指定输出的证书文件名为<code>example.crt</code>，这是生成的自签名证书</li><li><code>-keyout example.key</code> - 指定输出的私钥文件名为<code>example.key</code>，这是生成的私钥文件</li><li><code>-subj &quot;/C=SI/ST=Ljubljana/L=Ljubljana/O=Security/OU=IT Department/CN=www.example.com&quot;</code> - 指定了证书的主题信息。在这个命令中<ul><li><code>C</code> - 国家代码(Country)，这里是斯洛文尼亚(Slovenia)</li><li><code>ST</code> - 州或省(State)，这里是卢布尔雅那(Ljubljana)</li><li><code>L</code> - 城市(Locality)，这里是卢布尔雅那(Ljubljana)</li><li><code>O</code> - 组织(Organization)，这里是安全(Security)</li><li><code>OU</code> - 组织单位(Organizational Unit)，这里是IT部门(IT Department)</li><li><code>CN</code> - 通用名称(Common Name)，这里是<code>www.example.com</code>，表示该证书用于签署<code>www.example.com</code>域名的通信</li></ul></li></ul><h3 id=nginx的https配置><a class=anchor href=#nginx的https配置>#</a> Nginx的HTTPS配置</h3><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span><span class="token comment">#首先，在监听后面加上一个ssl</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token directive"><span class="token keyword">server_name</span> domain.com</span><span class="token punctuation">;</span><span class="token comment">#填写自己的网站域名</span></pre></td></tr><tr><td data-num=4></td><td><pre>    </pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/.../nginx/cacert.pem</span><span class="token punctuation">;</span><span class="token comment">#证书文件名称</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/.../nginx/private.key</span><span class="token punctuation">;</span><span class="token comment">#证书私钥文件名称</span></pre></td></tr><tr><td data-num=7></td><td><pre>    </pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token comment">#ssl验证配置</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">5m</span></span><span class="token punctuation">;</span><span class="token comment">#缓存有效期</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1.2 TLSv1.3</span><span class="token punctuation">;</span><span class="token comment">#安全链接可选的加密协议</span></pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token comment">#配置加密套件/加密算法，写法遵循openssl标准</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_ciphers</span> ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span><span class="token comment">#使用服务端的首选算法</span></pre></td></tr><tr><td data-num=14></td><td><pre>    </pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token comment">#.....................</span></pre></td></tr><tr><td data-num=16></td><td><pre>    </pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token comment">#HTTP重定向HTTPS</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=19></td><td><pre>        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=20></td><td><pre>        <span class="token directive"><span class="token keyword">server_name</span> domain.com</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=21></td><td><pre>        <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span><span class="token comment">#使用301状态跳转</span></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=虚拟主机><a class=anchor href=#虚拟主机>#</a> 虚拟主机</h2><p>虚拟主机可以在一台服务器上部署多个站点。</p><p>Nginx中的虚拟主机就是通过server块来实现的，每个server块就是一个虚拟主机。</p><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">5173</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    </pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token comment">#指定虚拟主机的域名</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token comment">#当访问这个域名的时候，就会被这个server块匹配到</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token comment">#之后会执行这个server块中的配置</span></pre></td></tr><tr><td data-num=7></td><td><pre>    <span class="token directive"><span class="token keyword">server_name</span> xxx.com</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    </pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token directive"><span class="token keyword">location</span> /</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=10></td><td><pre>        <span class="token directive"><span class="token keyword">root</span> xxx</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre>        <span class="token directive"><span class="token keyword">index</span> xxx</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>可将server块单独放到一个新创建<code>.conf</code>文件中，将该文件放到server文件夹中。</p><p>标准做法 - 站点配置应该放到<code>sites-available</code>下面，然后符号链接到<code>sites-enabled</code></p><h2 id=nginx的进程模型><a class=anchor href=#nginx的进程模型>#</a> Nginx的进程模型</h2><p><strong>master进程</strong></p><p>是主进程，用于管理和监控worker进程，会接受外界的信号和指令，还会将一些信号传递给worker进程。</p><p>当worker由于异常退出后，master进程会重新启动新的worker进程继续处理事件。</p><p><strong>worker进程</strong></p><p>是工作进程，可以自定义数量，用于处理事件，服务于master进程</p><h2 id=nginx的web请求机制><a class=anchor href=#nginx的web请求机制>#</a> Nginx的Web请求机制</h2><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token directive"><span class="token keyword">use</span> epoll</span><span class="token punctuation">;</span><span class="token comment">#默认使用I/O复用的epoll模型，可不用写</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=nginxconf配置文件内容结构详解><a class=anchor href=#nginxconf配置文件内容结构详解>#</a> nginx.conf配置文件内容结构详解</h2><ul><li><p>main - 全局配置</p></li><li><p>event - 配置工作模式以及连接数</p></li><li><p>http - http模块相关配置</p><ul><li>server - 虚拟主机配置，可以有多个<ul><li>location - 路由规则，表达式</li><li>upstream - 集群，内网服务器</li></ul></li></ul></li></ul><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">user</span> root</span><span class="token punctuation">;</span><span class="token comment">#指定进程用户</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">#路径地址 - `--error-log-path`</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">#日志级别从低到高 debug info notice warn error crit</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">#error_log logs/error.log;</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">#error_log logs/error.log notice;</span></pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">#路径地址 - `--pid-path`</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">#pid logs/nginx.pid;</span></pre></td></tr></table></figure><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">#mime.types文件 - 里面包含请求传输的内容各种类型</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token directive"><span class="token keyword">use</span> mime.types</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span><span class="token comment">#指定默认传输内容类型</span></pre></td></tr><tr><td data-num=4></td><td><pre></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment">#.........................................................................#</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">#log_format 与 access_log需共同使用</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment">#自定义日志格式</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">#Nginx里面包含了一些自带的参数，可通过$符号使用</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">#log_format main '$remote_addr - $remote_user [$time_local] “$request" '</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment">#				 '$status $body_bytes_sent "$http_referer" '</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">#				 '"$http_user_agent" "$http_x_forwarded_for" ';</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment">#remote_addr - 客户端的ip地址</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">#remote_user - 客户端用户的名称</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">#time_local - 时间</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment">#request - 请求头的内容</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment">#status - 请求的状态</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token comment">#body_bytes_sent - 给客户端发送内容的文件主体，其内容的字节数</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment">#http_referer - 记录用户连接从何处跳转过来的</span></pre></td></tr><tr><td data-num=20></td><td><pre><span class="token comment">#http_user_agent - 用户代理</span></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token comment">#http_x_forwarded_for - 通过代理服务器来记录客户端的ip地址</span></pre></td></tr><tr><td data-num=22></td><td><pre></pre></td></tr><tr><td data-num=23></td><td><pre><span class="token comment">#路径地址 - `--http-log-path`</span></pre></td></tr><tr><td data-num=24></td><td><pre><span class="token comment">#客户端请求的详细信息会记录到该日志文件里</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment">#access_log logs/access.log main;</span></pre></td></tr><tr><td data-num=26></td><td><pre></pre></td></tr><tr><td data-num=27></td><td><pre><span class="token comment">#.........................................................................#</span></pre></td></tr><tr><td data-num=28></td><td><pre></pre></td></tr><tr><td data-num=29></td><td><pre><span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span><span class="token comment">#用于进行文件的高效传输，打开后文件传输性能会提升</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre><span class="token comment">#tcp_nopush需sendfile处于开启状态才会发生作用</span></pre></td></tr><tr><td data-num=32></td><td><pre><span class="token comment">#开启后表示当需发送的数据包累积到一定大小后，才会开始发送</span></pre></td></tr><tr><td data-num=33></td><td><pre><span class="token comment">#tcp_nopush on;</span></pre></td></tr><tr><td data-num=34></td><td><pre></pre></td></tr><tr><td data-num=35></td><td><pre><span class="token directive"><span class="token keyword">keepalive_timeout</span> <span class="token number">10</span></span><span class="token punctuation">;</span><span class="token comment">#经多长时间后客户端连接超时，以秒为单位</span></pre></td></tr><tr><td data-num=36></td><td><pre><span class="token comment">#http是一种无状态的协议，客户端向服务器发送请求后，服务端响应完成后会直接断开连接，</span></pre></td></tr><tr><td data-num=37></td><td><pre><span class="token comment">#如果客户端发送多个请求，每个请求都需独立的建立连接，</span></pre></td></tr><tr><td data-num=38></td><td><pre><span class="token comment">#http有一个keepalive的模式，它会告诉服务器处理完一个请求后可以保持tcp连接,</span></pre></td></tr><tr><td data-num=39></td><td><pre><span class="token comment">#此时，当服务器接收到客户端发送的其他请求时，会利用还没有关闭的tcp连接来继续处理请求，</span></pre></td></tr><tr><td data-num=40></td><td><pre><span class="token comment">#而，不需要再创立一个新连接。</span></pre></td></tr><tr><td data-num=41></td><td><pre></pre></td></tr><tr><td data-num=42></td><td><pre><span class="token comment">#gzip on;#开启gzip压缩</span></pre></td></tr></table></figure><h2 id=nginx日志切割><a class=anchor href=#nginx日志切割>#</a> Nginx日志切割</h2><h3 id=手动切割模式><a class=anchor href=#手动切割模式>#</a> 手动切割模式</h3><p>Nginx日志文件会保持所有对应的日志内容，但随运行时间的延长，日志文件也会越来越大不利于日志分析，因此，需要将日志切割为多个不同的小文件日志，切割规则可以以天数或小时为单位。</p><p>先创建一个shell可执行脚本文件<code>xxx.sh</code>，内容为</p><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment">#日志目前所在路径</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token assign-left variable">LOG_PATH</span><span class="token operator">=</span><span class="token string">"/var/log/nginx/"</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment">#以天来切割的规则</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token assign-left variable">RECORD_TIME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"yesterday"</span> + %Y-%m-%d+%H:%M<span class="token variable">)</span></span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">#nginx进程</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token assign-left variable">PID</span><span class="token operator">=</span>/var/run/nginx/nginx.pid</pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment">#将当前log文件重命名</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token function">mv</span> <span class="token variable">$&#123;LOG_PATH&#125;</span>/access.log <span class="token variable">$&#123;LOG_PATAH&#125;</span>/access.<span class="token variable">$&#123;RECORD_TIME&#125;</span>.log</pre></td></tr><tr><td data-num=10></td><td><pre><span class="token function">mv</span> <span class="token variable">$&#123;LOG_PATH&#125;</span>/error.log <span class="token variable">$&#123;LOG_PATH&#125;</span>/error.<span class="token variable">$&#123;RECORD_TIME&#125;</span>.log</pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment">#由于之前的log文件被重名了，</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment">#需要向Nginx主程序发送信号，用于重新打开日志文件</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token function">kill</span> <span class="token parameter variable">-USR1</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $PID<span class="token variable">`</span></span></pre></td></tr></table></figure><p>为脚本文件添加可执行权限 - <code>chmod +x xxx.sh</code></p><h3 id=定时切割模式><a class=anchor href=#定时切割模式>#</a> 定时切割模式</h3><p>(CentOS 7已默认安装)安装定时任务 - <code>yum -y install crontabs</code></p><p>查看当前定时任务的列表 - <code>crontab -l</code></p><p>编辑定时任务 - <code>crontab -e</code></p><figure class="highlight bash"><figcaption data-lang=bash><span>添加内容为</span></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment"># */1 * * * *，这部分为cron表达式</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token comment"># /usr/.../xxx.sh，这部分为脚本文件的路径</span></pre></td></tr><tr><td data-num=3></td><td><pre>*/1 * * * * /usr/<span class="token punctuation">..</span>./xxx.sh</pre></td></tr></table></figure><p>重启定时任务 - <code>service crond restart</code></p><p><strong>crond常用命令</strong></p><ul><li>启动服务 - <code>service crond start</code></li><li>关闭服务 - <code>server crond stop</code></li><li>重启服务 - <code>service crond restart</code></li><li>重新载入配置 - <code>service crond reload</code></li></ul><p><strong>cron表达式结构</strong></p><p>分为5或6个域，每个域代表一个含义</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center>分</th><th style=text-align:center>时</th><th style=text-align:center>日</th><th style=text-align:center>月</th><th style=text-align:center>星期几</th><th style=text-align:center>年(可选)</th></tr></thead><tbody><tr><td style=text-align:center>取值范围</td><td style=text-align:center>0-59</td><td style=text-align:center>0-23</td><td style=text-align:center>1-31</td><td style=text-align:center>1-12</td><td style=text-align:center>1-7</td><td style=text-align:center>2019/2020/201/....</td></tr></tbody></table><p><strong>常用cron表达式</strong></p><ul><li>每分钟执行一次 - <code>*/1 * * * *</code></li><li>每日凌晨(每天晚上23:59)执行一次 - <code>59 23 * * *</code></li><li>每日凌晨1点执行 - <code>0 1 * * *</code></li></ul><h2 id=静态资源配置案例><a class=anchor href=#静态资源配置案例>#</a> 静态资源配置案例</h2><p>移动到<code>.../nginx/conf</code>目录下</p><p>创建一个<code>xxx.conf</code>文件，开始编辑</p><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span><span class="token comment">#浏览器中需要输入服务器公网ip地址</span></pre></td></tr><tr><td data-num=4></td><td><pre>    </pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token comment">#当请求路径是从`/`开始访问的</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token directive"><span class="token keyword">root</span> home</span><span class="token punctuation">;</span><span class="token comment">#就会与该路径进行拼接，/home，再在该目录下搜索内容</span></pre></td></tr><tr><td data-num=8></td><td><pre>        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    </pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token comment">#采用别名的形式</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token comment">#static为自定义的别名名称，</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token comment">#浏览器请求中包含/static即可，浏览器输入栏中不会显示别名的路径</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token directive"><span class="token keyword">location</span> /static</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=15></td><td><pre>        <span class="token directive"><span class="token keyword">alias</span> /home/test</span><span class="token punctuation">;</span><span class="token comment">#声明别名路径</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=gzip压缩><a class=anchor href=#gzip压缩>#</a> Gzip压缩</h2><p>可以提高传输效率并节约带宽。</p><p>在<code>.../nginx/nginx.conf</code>中添加代码</p><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span><span class="token comment">#开启gzip压缩功能</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment">#限制最小压缩范围</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">1</span></span><span class="token punctuation">;</span><span class="token comment">#小于1字节的文件不会进行压缩</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment">#压缩比例(1~9)</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">3</span></span><span class="token punctuation">;</span><span class="token comment">#压缩比越大CPU占用越多</span></pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">#指定压缩的类型</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id=location路径匹配规则><a class=anchor href=#location路径匹配规则>#</a> location路径匹配规则</h2><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment"># 默认匹配规则，请求路径包含`/`即可</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token directive"><span class="token keyword">root</span> xxx</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=6></td><td><pre></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment"># 精准匹配，只能匹配`/`，请求路径后面不能有其他东西</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token directive"><span class="token keyword">location</span> = /</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token directive"><span class="token keyword">root</span> xxx</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=12></td><td><pre></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment"># 正则表达式匹配，开头需添加`~`</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment">#.................................#</span></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment">#`*`表示不区分大小写</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token directive"><span class="token keyword">location</span> ~* \.(GIF|PNG)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token directive"><span class="token keyword">root</span> xxx</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=20></td><td><pre></pre></td></tr><tr><td data-num=21></td><td><pre><span class="token comment"># `^`表示非，以某个字符路径开头请求</span></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token directive"><span class="token keyword">location</span> ^~ \.(GIF|PNG)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token directive"><span class="token keyword">root</span> xxx</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token directive"><span class="token keyword">index</span> index.html index.htm</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=26></td><td><pre><span class="token comment">#................................#</span></pre></td></tr></table></figure><h2 id=域名解析绑定><a class=anchor href=#域名解析绑定>#</a> 域名解析绑定</h2><p>云服务器平台，需在域名服务商处的DNS配置处添加A记录，A记录的值就为云服务器的ip地址。</p><p>Linux系统下的hosts文件 - <code>/etc/hosts</code>，设置后优先走hosts文件中的指定配置</p><figure class="highlight tex"><figcaption data-lang=TeX><span>host文件</span></figcaption><table><tr><td data-num=1></td><td><pre>xxx.xxx.xxx.xxx 域名</pre></td></tr></table></figure><h2 id=nginx中的跨域跨源问题><a class=anchor href=#nginx中的跨域跨源问题>#</a> Nginx中的跨域(跨源)问题</h2><p>跨域问题只存在于浏览器中。</p><p>跨域是指在浏览器中进行的请求访问的目标域名、协议或端口与当前页面所在的域名、协议或端口不一致的情况。</p><p>当打开网址，其中有一些Ajax(异步)请求网址1，当还有一个Ajax(异步)请求网址2时，网址2的请求会被拒绝。</p><p>当源站点(<code>www.xxx1.com</code>)与目标站点(<code>www.xxx2.com</code>)，两个站点域名不一样时就会产生跨域问题。</p><p>跨域(W3C标准)指从一个域名的网页里发起请求到另外一个域名中获取资源，由于浏览器的安全考虑，会拒绝跨站点的访问，这就是上面例子中的Ajax请求被拒绝的原因了。</p><p><strong>CORS跨域资源共享(Cross-Origin Resource Sharing)</strong></p><p>允许浏览器在当前域名里面用JavaScript的Ajax向不同域名发起异步请求，并从不同的域名里面获取资源。</p><p>Nginx中不支持通配符子域(例如 <code>https://*.example.com</code>)，添加CORS头信息时，<code>Access-Control-Allow-Origin</code>头的值应当包括协议(如<code>http</code>或<code>https</code>)以及域名，这是因为跨域请求需要指定完整的来源，包括协议、域名和端口(如果有的话)。</p><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token comment">#.................................................#</span></pre></td></tr><tr><td data-num=3></td><td><pre>    </pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token comment"># 允许跨域请求的域，*表示所有</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> *</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token comment"># add_header 'Access-Control-Allow-Origin' https://www.example.com;</span></pre></td></tr><tr><td data-num=7></td><td><pre>    </pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token comment"># 允许带上cookie请求</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=10></td><td><pre>    </pre></td></tr><tr><td data-num=11></td><td><pre>    <span class="token comment"># 允许请求的方法</span></pre></td></tr><tr><td data-num=12></td><td><pre>    <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> *</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token comment"># add_header 'Access-Control-Allow-Methods' GET;</span></pre></td></tr><tr><td data-num=14></td><td><pre>    </pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token comment"># 允许请求的header</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Headers'</span> *</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token comment">#.................................................#</span></pre></td></tr><tr><td data-num=18></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=静态资源的防盗链><a class=anchor href=#静态资源的防盗链>#</a> 静态资源的防盗链</h2><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=2></td><td><pre>    <span class="token comment">#....................................#</span></pre></td></tr><tr><td data-num=3></td><td><pre>    <span class="token comment"># 对源站站点进行验证</span></pre></td></tr><tr><td data-num=4></td><td><pre>    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>        <span class="token directive"><span class="token keyword">valid_referers</span> *.xxx.com</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>        <span class="token comment"># 非法引入进入下方判断，注意括号两边要用空格</span></pre></td></tr><tr><td data-num=7></td><td><pre>        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">&#123;</span> <span class="token directive"><span class="token keyword">return</span> <span class="token number">404</span></span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=9></td><td><pre>    <span class="token comment">#....................................#</span></pre></td></tr></table></figure><h2 id=nginx的模块化体系><a class=anchor href=#nginx的模块化体系>#</a> Nginx的模块化体系</h2><p><strong>nginx core</strong></p><p>核心内容，主要是实现了底层的通信协议，也为其他一些模块和Nginx进程等内容提供了运行时的环境，为其他模块提供环境的同时并协调各个模块。</p><p>其分离了<code>http</code>和<code>mail</code>两个重要的模块，其他组成的模块</p><ul><li><code>event module</code> - 事件模块(例如使用了epoll)</li><li><code>phase handler</code> - 处理客户端的请求并响应相应的内容</li><li><code>output filter</code> - <code>phase handler</code>处理完后会经过该模块，会过滤掉一部分的内容后将处理后的内容返回</li><li><code>upstream</code> - 反向代理模块，会把请求转发到真正的服务器地址并相应相应的内容</li><li><code>load balancer</code> - 负载均衡器，与<code>upstream</code>相关，实现负载均衡的一些配置，包含负载均衡的算法</li><li><code>extend module</code> - 继承模块，用于实现第三方的模块</li></ul><p><span class=exturl data-url=aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMUE5NHkxZjdzdT90PTE3Ny4wJmFtcDtwPTIz>Nginx的模块化体系详解</span></p><h2 id=jsdelivr的反向代理-案例><a class=anchor href=#jsdelivr的反向代理-案例>#</a> Jsdelivr的反向代理-案例</h2><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment">################ 缓存文件配置 ################</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token directive"><span class="token keyword">proxy_cache_path</span> path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time] [max_size=size]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment"># path - 为缓存文件存放路径</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"># levels - 为缓存文件目录的层次结构，levels=2:2表示两级目录都使用2位 16进制数命名</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token comment"># use_temp_path - 表示临时文件是否直接存放于缓存目录中，如果该值为off，则临时文件将直接放在缓存目录中；反之，则需要用proxy_temp_path设置一个目录。为了减少不必要的拷贝，建议设为off</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment"># keys_zone - 表示在共享内存中设置的存储区域名称和大小。该存储区用来存放缓存的key字符串，keys_zone=jsdelivr:50m表示该区域的名称为jsdelivr，大小为50m，这样nginx可以快速判断一个request是否命中缓存，1m可以存储8000个key，10m可以存储80000个key</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token comment"># inactive - 表示未被访问文件在缓存中保留时间</span></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"># max_size - 为最大缓存空间，如果不指定，会使用掉所有磁盘空间。当达到配额后，会删除最少使用的cache文件</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment">################ 缓存文件配置 ################</span></pre></td></tr></table></figure><figure class="highlight nginx"><figcaption data-lang=nginx></figcaption><table><tr><td data-num=1></td><td><pre><span class="token directive"><span class="token keyword">proxy_cache_path</span> /var/www/jsdelivr.cache levels=2:2 use_temp_path=off keys_zone=jsdelivr:50m inactive=180d max_size=500m</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=2></td><td><pre></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token directive"><span class="token keyword">server</span></span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=5></td><td><pre>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=6></td><td><pre>    <span class="token directive"><span class="token keyword">server_name</span> xxx.proxy_url.com</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=7></td><td><pre>   </pre></td></tr><tr><td data-num=8></td><td><pre>    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=10></td><td><pre></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token directive"><span class="token keyword">server</span></span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=13></td><td><pre>    <span class="token comment"># 监听HTTPS端口</span></pre></td></tr><tr><td data-num=14></td><td><pre>    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=15></td><td><pre>    <span class="token comment"># 被用作代理的域名</span></pre></td></tr><tr><td data-num=16></td><td><pre>    <span class="token directive"><span class="token keyword">server_name</span> xxx.proxy_url.com</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=17></td><td><pre>    <span class="token comment"># 可访问的域名白名单</span></pre></td></tr><tr><td data-num=18></td><td><pre>    <span class="token directive"><span class="token keyword">valid_referers</span> localhost *.example.com</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num=19></td><td><pre></pre></td></tr><tr><td data-num=20></td><td><pre>    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">&#123;</span> <span class="token directive"><span class="token keyword">return</span> <span class="token number">444</span></span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre>    <span class="token comment"># 拒绝SSL/TLS握手请求, Nginx将立即关闭连接</span></pre></td></tr><tr><td data-num=23></td><td><pre>    <span class="token comment"># 有可能会导致SEC_ERROR_UNKNOEWN_ISSUER错误</span></pre></td></tr><tr><td data-num=24></td><td><pre>    <span class="token comment"># ssl_reject_handshake on;</span></pre></td></tr><tr><td data-num=25></td><td><pre>    </pre></td></tr><tr><td data-num=26></td><td><pre>    <span class="token comment"># ssl certificate(ssl 证书)</span></pre></td></tr><tr><td data-num=27></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/nginx/certificate/cert.pem</span><span class="token punctuation">;</span> <span class="token comment"># 证书</span></pre></td></tr><tr><td data-num=28></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/nginx/certificate/privkey.pem</span><span class="token punctuation">;</span> <span class="token comment"># 证书私钥</span></pre></td></tr><tr><td data-num=29></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_trusted_certificate</span> /etc/nginx/certificate/chain.pem</span><span class="token punctuation">;</span> <span class="token comment"># 证书链</span></pre></td></tr><tr><td data-num=30></td><td><pre></pre></td></tr><tr><td data-num=31></td><td><pre>    <span class="token comment"># ssl connect setting(ssl 连接设置)</span></pre></td></tr><tr><td data-num=32></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_session_cache</span>    shared:SSL:1m</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=33></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_session_timeout</span>  <span class="token number">5m</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=34></td><td><pre>    <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1.2 TLSv1.3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=35></td><td><pre>    <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=36></td><td><pre>    <span class="token directive"><span class="token keyword">fastcgi_param</span>   HTTPS               <span class="token boolean">on</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=37></td><td><pre>    <span class="token directive"><span class="token keyword">fastcgi_param</span>   HTTP_SCHEME         https</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=38></td><td><pre></pre></td></tr><tr><td data-num=39></td><td><pre>    <span class="token directive"><span class="token keyword">location</span> /</span></pre></td></tr><tr><td data-num=40></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num=41></td><td><pre>        <span class="token comment">################请求转发################</span></pre></td></tr><tr><td data-num=42></td><td><pre>        <span class="token comment"># 将请求转发到https://cdn.jsdelivr.net</span></pre></td></tr><tr><td data-num=43></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_pass</span> https://cdn.jsdelivr.net</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=44></td><td><pre>       	<span class="token comment"># 采用https，需要使用SNI指明主机名</span></pre></td></tr><tr><td data-num=45></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_ssl_server_name</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=46></td><td><pre>        <span class="token comment"># 设置请求头主机名</span></pre></td></tr><tr><td data-num=47></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host cdn.jsdelivr.net</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=48></td><td><pre>        <span class="token comment"># 记录代理信息</span></pre></td></tr><tr><td data-num=49></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=50></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=51></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_set_header</span> REMOTE-HOST <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=52></td><td><pre>        <span class="token comment"># 设置HTTP协议，并建立长连接</span></pre></td></tr><tr><td data-num=53></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=54></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">""</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=55></td><td><pre>        <span class="token comment">################请求转发################</span></pre></td></tr><tr><td data-num=56></td><td><pre>        </pre></td></tr><tr><td data-num=57></td><td><pre>        <span class="token comment">################服务端缓存设置################</span></pre></td></tr><tr><td data-num=58></td><td><pre>        <span class="token comment"># X-Cache表明请求是否命中缓存</span></pre></td></tr><tr><td data-num=59></td><td><pre>        <span class="token directive"><span class="token keyword">add_header</span> X-Cache <span class="token variable">$upstream_cache_status</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=60></td><td><pre>        <span class="token comment"># 禁用源站的cookie和浏览器缓存设置</span></pre></td></tr><tr><td data-num=61></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_ignore_headers</span> Set-Cookie Cache-Control expires</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=62></td><td><pre>        <span class="token comment"># 设置缓存的key_zone名称，必须与proxy_cache_path中的设置一致</span></pre></td></tr><tr><td data-num=63></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_cache</span> jsdelivr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=64></td><td><pre>        <span class="token comment"># 设置缓存的key名称</span></pre></td></tr><tr><td data-num=65></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_cache_key</span> <span class="token variable">$host</span><span class="token variable">$uri</span><span class="token variable">$is_args</span><span class="token variable">$args</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=66></td><td><pre>        <span class="token comment"># 设置缓存的条件，只缓存状态码200的请求，缓存时限为180天</span></pre></td></tr><tr><td data-num=67></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span>  <span class="token number">180d</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=68></td><td><pre>        <span class="token comment">################服务端缓存设置################</span></pre></td></tr><tr><td data-num=69></td><td><pre>        </pre></td></tr><tr><td data-num=70></td><td><pre>        <span class="token comment">################CORS(跨域)设置################</span></pre></td></tr><tr><td data-num=71></td><td><pre>        <span class="token comment"># 禁用源站的Access-Control-Allow-Origin请求头</span></pre></td></tr><tr><td data-num=72></td><td><pre>        <span class="token directive"><span class="token keyword">proxy_hide_header</span> Access-Control-Allow-Origin</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=73></td><td><pre>        <span class="token directive"><span class="token keyword">add_header</span> Access-Control-Allow-Origin *</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=74></td><td><pre>        </pre></td></tr><tr><td data-num=75></td><td><pre>        <span class="token comment"># 自定义Access-Control-Allow-Origin请求头，注意包含协议和域名</span></pre></td></tr><tr><td data-num=76></td><td><pre>        <span class="token comment"># add_header Access-Control-Allow-Origin "https://blog.example.com";</span></pre></td></tr><tr><td data-num=77></td><td><pre>        <span class="token comment">################CORS(跨域)设置################</span></pre></td></tr><tr><td data-num=78></td><td><pre>        </pre></td></tr><tr><td data-num=79></td><td><pre>        <span class="token comment">################客户端缓存设置################</span></pre></td></tr><tr><td data-num=80></td><td><pre>        <span class="token comment"># 设置缓存的失效日期为180天</span></pre></td></tr><tr><td data-num=81></td><td><pre>        <span class="token directive"><span class="token keyword">expires</span> <span class="token number">180d</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num=82></td><td><pre>        <span class="token comment">################客户端缓存设置################</span></pre></td></tr><tr><td data-num=83></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num=84></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id=利用lets-encrypt申请ssl证书><a class=anchor href=#利用lets-encrypt申请ssl证书>#</a> 利用Let's Encrypt申请SSL证书</h2><p>移除 - <code>yum -y remove certbot</code></p><p>安装 - <code>yum -y install certbot</code></p><p>为域名申请证书 - <code>certbot certonly --standalone -d aaa.example.com -d www.example.com</code></p><p>删除证书 - <code>certbot delete</code></p><p>更新当前所有已申请的证书 - 需开启80端口，既HTTP</p><ul><li><p>临时开启HTTP端口 - <code>firewall-cmd --zone=public --add-port=8080/tcp --permanent</code></p></li><li><p>关闭临时HTTP端口 - <code>firewall-cmd --zone=public --remove-port=8080/tcp --permanent</code></p></li><li><p><code>certbot renew --dry-run</code></p></li></ul><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment"># 文件名certbot-renew</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token number">15</span> <span class="token number">2</span> * */2 * certbot renew --pre-hook <span class="token string">"systemctl stop nginx"</span> --post-hook <span class="token string">"systemctl start nginx"</span></pre></td></tr><tr><td data-num=3></td><td><pre><span class="token comment"># --pre-hook 这个参数表示执行更新操作之前要做的事情</span></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"># --post-hook 这个参数表示执行更新操作完成后要做的事情</span></pre></td></tr><tr><td data-num=5></td><td><pre></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token comment"># 启动crontab任务</span></pre></td></tr><tr><td data-num=7></td><td><pre><span class="token function">crontab</span> certbot-auto-renew</pre></td></tr><tr><td data-num=8></td><td><pre></pre></td></tr><tr><td data-num=9></td><td><pre><span class="token comment"># 查看当前的crontab任务</span></pre></td></tr><tr><td data-num=10></td><td><pre><span class="token function">crontab</span> <span class="token parameter variable">-l</span></pre></td></tr><tr><td data-num=11></td><td><pre></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment"># 删除所有crontab任务</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token function">crontab</span> <span class="token parameter variable">-r</span></pre></td></tr><tr><td data-num=14></td><td><pre></pre></td></tr><tr><td data-num=15></td><td><pre><span class="token comment"># 停止特定crontab任务</span></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token function">crontab</span> <span class="token parameter variable">-e</span></pre></td></tr><tr><td data-num=17></td><td><pre><span class="token comment"># 通过#号注释不要的任务</span></pre></td></tr></table></figure><p>生成的证书目录 - <code>/etc/letsencrypt/live/</code></p><h2 id=利用acmesh申请ssl证书><a class=anchor href=#利用acmesh申请ssl证书>#</a> 利用acme.sh申请SSL证书</h2><p>acme.sh会自动更新证书</p><figure class="highlight bash"><figcaption data-lang=bash></figcaption><table><tr><td data-num=1></td><td><pre><span class="token comment"># 安装</span></pre></td></tr><tr><td data-num=2></td><td><pre><span class="token function">curl</span> https://get.acme.sh <span class="token operator">|</span> <span class="token function">sh</span> <span class="token parameter variable">-s</span> <span class="token assign-left variable">email</span><span class="token operator">=</span>my@example.com</pre></td></tr><tr><td data-num=3></td><td><pre></pre></td></tr><tr><td data-num=4></td><td><pre><span class="token comment"># 环境配置</span></pre></td></tr><tr><td data-num=5></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$HOME</span>/.acme.sh:<span class="token environment constant">$PATH</span>"</span></pre></td></tr><tr><td data-num=6></td><td><pre><span class="token builtin class-name">source</span> ~/.bashrc</pre></td></tr><tr><td data-num=7></td><td><pre></pre></td></tr><tr><td data-num=8></td><td><pre><span class="token comment"># 申请证书</span></pre></td></tr><tr><td data-num=9></td><td><pre>acme.sh <span class="token parameter variable">--issue</span> <span class="token parameter variable">--standalone</span> <span class="token parameter variable">-d</span> example.com <span class="token parameter variable">-d</span> www.example.com</pre></td></tr><tr><td data-num=10></td><td><pre><span class="token comment"># 证书申请后的位置</span></pre></td></tr><tr><td data-num=11></td><td><pre><span class="token comment"># Your cert is in: /root/.acme.sh/xxx.exampe.com_ecc/xxx.exampe.com.cer</span></pre></td></tr><tr><td data-num=12></td><td><pre><span class="token comment"># Your cert key is in: /root/.acme.sh/xxx.exampe.com_ecc/xxx.exampe.com.key</span></pre></td></tr><tr><td data-num=13></td><td><pre><span class="token comment"># The intermediate CA cert is in: /root/.acme.sh/xxx.exampe.com_ecc/ca.cer</span></pre></td></tr><tr><td data-num=14></td><td><pre><span class="token comment"># And the full chain certs is there: /root/.acme.sh/xxx.exampe.com_ecc/fullchain.cer</span></pre></td></tr><tr><td data-num=15></td><td><pre></pre></td></tr><tr><td data-num=16></td><td><pre><span class="token comment"># 检查证书状态</span></pre></td></tr><tr><td data-num=17></td><td><pre>acme.sh <span class="token parameter variable">--list</span></pre></td></tr><tr><td data-num=18></td><td><pre></pre></td></tr><tr><td data-num=19></td><td><pre><span class="token comment"># 更新证书</span></pre></td></tr><tr><td data-num=20></td><td><pre>acme.sh <span class="token parameter variable">--renew</span> <span class="token parameter variable">-d</span> example.com <span class="token parameter variable">-d</span> www.example.com</pre></td></tr><tr><td data-num=21></td><td><pre></pre></td></tr><tr><td data-num=22></td><td><pre><span class="token comment"># 设置证书定时更新</span></pre></td></tr><tr><td data-num=23></td><td><pre>acme.sh --install-cronjob</pre></td></tr><tr><td data-num=24></td><td><pre></pre></td></tr><tr><td data-num=25></td><td><pre><span class="token comment"># 删除证书</span></pre></td></tr><tr><td data-num=26></td><td><pre>acme.sh <span class="token parameter variable">--remove</span> <span class="token parameter variable">-d</span> example.com</pre></td></tr></table></figure><div class=tags><a href=/tags/web/ rel=tag><i class="ic i-tag"></i> web</a></div></div><footer><div class=meta><span class=item><span class=icon><i class="ic i-calendar-check"></i></span> <span class=text>更新于</span> <time title="修改时间：2025-01-09 17:37:10" itemprop=dateModified datetime=2025-01-09T17:37:10+08:00>2025-01-09</time></span><span class=item data-path=/computer-science/programming/web/nginx/ title=阅读次数><span class=icon><i class="ic i-eye"></i></span> <span class=text>阅读次数</span><span class=waline-pageview-count></span> <span class=text>次</span></span></div><div id=copyright><ul><li class=author><strong>本文作者：</strong> ReverseSacle <i class="ic i-at"><em>@</em></i>逆转天平</li><li class=link><strong>本文链接：</strong> <a href=https://www.reversesacle.com/computer-science/programming/web/nginx/ title=Nginx基础>https://www.reversesacle.com/computer-science/programming/web/nginx/</a></li><li class=license><strong>版权声明：</strong> 本站所有文章除特别声明外，均采用 <span class=exturl data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class=post-nav><div class="item left"><a href=/computer-science/programming/reverse-engineering/cheatengine/ itemprop=url rel=prev data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg21.webp title=CheatEngine基础><span class=type>上一篇</span><span class=category><i class="ic i-flag"></i> 逆向工程</span><h3>CheatEngine基础</h3></a></div><div class="item right"><a href=/computer-science/computer-basic/composition/ccppart1/ itemprop=url rel=next data-background-image=https:&#x2F;&#x2F;resa-imgs.oss-accelerate.aliyuncs.com&#x2F;img&#x2F;acg15.webp title=计算机组成原理-CSAPP-第一部分><span class=type>下一篇</span><span class=category><i class="ic i-flag"></i> 计算机组成原理</span><h3>计算机组成原理-CSAPP-第一部分</h3></a></div></div><div class=wrap id=comments><div id=waline-comment></div></div></div><div id=sidebar><div class=inner><div class=panels><div class=inner><div class="contents panel pjax" data-title=文章目录><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%A6%82%E8%BF%B0><span class=toc-number>1.</span> <span class=toc-text>概述</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4><span class=toc-number>2.</span> <span class=toc-text>安装命令</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%98%B2%E7%81%AB%E5%A2%99%E5%89%8D%E6%8F%90%E9%85%8D%E7%BD%AE><span class=toc-number>3.</span> <span class=toc-text>防火墙前提配置</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#nginx%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4><span class=toc-number>4.</span> <span class=toc-text>Nginx相关命令</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E5%86%85%E5%AE%B9%E6%A6%82%E8%BF%B0><span class=toc-number>5.</span> <span class=toc-text>配置文件结构内容概述</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%A6%82%E8%BF%B0><span class=toc-number>6.</span> <span class=toc-text>反向代理与负载均衡概述</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#https%E9%85%8D%E7%BD%AE><span class=toc-number>7.</span> <span class=toc-text>HTTPS配置</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6%E9%9D%9E%E8%AE%A4%E8%AF%81%E8%AF%81%E4%B9%A6><span class=toc-number>7.1.</span> <span class=toc-text>自签名证书(非认证证书)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#nginx%E7%9A%84https%E9%85%8D%E7%BD%AE><span class=toc-number>7.2.</span> <span class=toc-text>Nginx的HTTPS配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA><span class=toc-number>8.</span> <span class=toc-text>虚拟主机</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#nginx%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B><span class=toc-number>9.</span> <span class=toc-text>Nginx的进程模型</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#nginx%E7%9A%84web%E8%AF%B7%E6%B1%82%E6%9C%BA%E5%88%B6><span class=toc-number>10.</span> <span class=toc-text>Nginx的Web请求机制</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#nginxconf%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3><span class=toc-number>11.</span> <span class=toc-text>nginx.conf配置文件内容结构详解</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#nginx%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2><span class=toc-number>12.</span> <span class=toc-text>Nginx日志切割</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%89%8B%E5%8A%A8%E5%88%87%E5%89%B2%E6%A8%A1%E5%BC%8F><span class=toc-number>12.1.</span> <span class=toc-text>手动切割模式</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%9A%E6%97%B6%E5%88%87%E5%89%B2%E6%A8%A1%E5%BC%8F><span class=toc-number>12.2.</span> <span class=toc-text>定时切割模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B><span class=toc-number>13.</span> <span class=toc-text>静态资源配置案例</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#gzip%E5%8E%8B%E7%BC%A9><span class=toc-number>14.</span> <span class=toc-text>Gzip压缩</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#location%E8%B7%AF%E5%BE%84%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99><span class=toc-number>15.</span> <span class=toc-text>location路径匹配规则</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%BB%91%E5%AE%9A><span class=toc-number>16.</span> <span class=toc-text>域名解析绑定</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#nginx%E4%B8%AD%E7%9A%84%E8%B7%A8%E5%9F%9F%E8%B7%A8%E6%BA%90%E9%97%AE%E9%A2%98><span class=toc-number>17.</span> <span class=toc-text>Nginx中的跨域(跨源)问题</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E9%98%B2%E7%9B%97%E9%93%BE><span class=toc-number>18.</span> <span class=toc-text>静态资源的防盗链</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#nginx%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E4%BD%93%E7%B3%BB><span class=toc-number>19.</span> <span class=toc-text>Nginx的模块化体系</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#jsdelivr%E7%9A%84%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-%E6%A1%88%E4%BE%8B><span class=toc-number>20.</span> <span class=toc-text>Jsdelivr的反向代理-案例</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%88%A9%E7%94%A8lets-encrypt%E7%94%B3%E8%AF%B7ssl%E8%AF%81%E4%B9%A6><span class=toc-number>21.</span> <span class=toc-text>利用Let&#39;s Encrypt申请SSL证书</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%88%A9%E7%94%A8acmesh%E7%94%B3%E8%AF%B7ssl%E8%AF%81%E4%B9%A6><span class=toc-number>22.</span> <span class=toc-text>利用acme.sh申请SSL证书</span></a></li></ol></div><div class="related panel pjax" data-title=系列文章><ul><li><a href=/computer-science/programming/web/hcpart1/ rel=bookmark title=HTML与CSS基础知识-第一部分>HTML与CSS基础知识-第一部分</a></li><li><a href=/computer-science/programming/web/hcpart2/ rel=bookmark title=HTML与CSS基础知识-第二部分>HTML与CSS基础知识-第二部分</a></li><li><a href=/computer-science/programming/web/jspart1/ rel=bookmark title=JavaScript基础-第一部分>JavaScript基础-第一部分</a></li><li><a href=/computer-science/programming/web/jspart2/ rel=bookmark title=JavaScript基础-第二部分>JavaScript基础-第二部分</a></li><li class=active><a href=/computer-science/programming/web/nginx/ rel=bookmark title=Nginx基础>Nginx基础</a></li><li><a href=/computer-science/programming/web/json/ rel=bookmark title=轻量级的数据交换格式JSON>轻量级的数据交换格式JSON</a></li><li><a href=/computer-science/programming/web/anti-scraping-vs-countermeasures/ rel=bookmark title=防爬虫与反防爬虫知识聚合>防爬虫与反防爬虫知识聚合</a></li><li><a href=/computer-science/programming/web/react-basic/ rel=bookmark title=React框架基础>React框架基础</a></li></ul></div><div class="overview panel" data-title=站点概览><div class=author itemprop=author itemscope itemtype=http://schema.org/Person><img class=image itemprop=image alt=ReverseSacle data-src=/images/avatar.webp><p class=name itemprop=name>ReverseSacle</p><div class=description itemprop=description>知识书库 & 学习点滴</div></div><nav class=state><div class="item posts"><a href=/archives/ ><span class=count>186</span> <span class=name>文章</span></a></div><div class="item categories"><a href=/categories/ ><span class=count>52</span> <span class=name>分类</span></a></div><div class="item tags"><a href=/tags/ ><span class=count>18</span> <span class=name>标签</span></a></div></nav><div class=social><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1JldmVyc2VTYWNsZQ==" title=https:&#x2F;&#x2F;github.com&#x2F;ReverseSacle><i class="ic i-github"></i></span><span class="exturl item email" data-url="bWFpbHRvOnByaXZhdGVAcmV2ZXJzZXNhY2xlLmNvbQ==" title=mailto:private@reversesacle.com><i class="ic i-envelope"></i></span></div><ul class=menu><li class=item><a href=/ rel=section><i class="ic i-home"></i> 首页</a></li><li class="item dropdown"><a href=javascript:void(0);><i class="ic i-feather"></i> 文章</a><ul class=submenu><li class=item><a href=/archives/ rel=section><i class="ic i-list-alt"></i> 归档</a></li><li class=item><a href=/categories/ rel=section><i class="ic i-th"></i> 分类</a></li><li class=item><a href=/tags/ rel=section><i class="ic i-tags"></i> 标签</a></li></ul></li><li class=item><a href=/about/ rel=section><i class="ic i-user"></i> 关于</a></li><li class=item><a href=/friend-links/ rel=section><i class="ic i-heart"></i> 友链</a></li></ul></div></div></div><ul id=quick><li class="prev pjax"><a href=/computer-science/programming/reverse-engineering/cheatengine/ rel=prev title=上一篇><i class="ic i-chevron-left"></i></a></li><li class=up><i class="ic i-arrow-up"></i></li><li class=down><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href=/computer-science/computer-basic/composition/ccppart1/ rel=next title=下一篇><i class="ic i-chevron-right"></i></a></li><li class=percent></li></ul></div></div><div class=dimmer></div></div></main><footer id=footer><div class=inner><div class=widgets><div class="rpost pjax"><h2>随机文章</h2><ul><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/graph/ title="分类于 图">图</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/graph/trick/ title=图相关技巧>图相关技巧</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/reverse-engineering/ title="分类于 逆向工程">逆向工程</a></div><span><a href=/computer-science/programming/reverse-engineering/packet-sniffing/ title="Fiddler Everywhere与Charles抓包">Fiddler Everywhere与Charles抓包</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/two-pointer/ title="分类于 双指针">双指针</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/two-pointer/search/ title=双指针-查找>双指针-查找</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a></div><span><a href=/computer-science/programming/c-language/c-data-structure/nonlinear-structure/graph/ title=C语言-图>C语言-图</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/seqlist/ title="分类于 顺序表">顺序表</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/seqlist/pattern/ title=顺序表-模式>顺序表-模式</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/seqlist/ title="分类于 顺序表">顺序表</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/seqlist/search/ title=顺序表-查找>顺序表-查找</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/dynamic-program/ title="分类于 动态规划">动态规划</a></div><span><a href=/computer-science/programming/c-language/c-algorithm/dynamic-program/pattern/ title=动态规划-模式>动态规划-模式</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/database/ title="分类于 数据库">数据库</a></div><span><a href=/computer-science/programming/database/theory/ title=数据库基础理论>数据库基础理论</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/rust/ title="分类于 Rust">Rust</a></div><span><a href=/computer-science/programming/rust/rust-data-structure/linear-structure/seqqueue/ title=Rust-顺序队列>Rust-顺序队列</a></span></li><li class=item><div class=breadcrumb><a href=/categories/computer-science/ title="分类于 计算机科学">计算机科学</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/ title="分类于 编程">编程</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/ title="分类于 C语言">C语言</a><i class="ic i-angle-right"></i> <a href=/categories/computer-science/programming/c-language/c-project/ title="分类于 C语言项目">C语言项目</a></div><span><a href=/computer-science/programming/c-language/c-project/comment-system-part1/ title=网站留言评论系统的设计与手动实现-初稿-第一部分>网站留言评论系统的设计与手动实现-初稿-第一部分</a></span></li></ul></div><div><h2>最新评论</h2><ul id=waline-recent></ul></div></div><div class=status><div class=copyright>&copy; 2021 – <span itemprop=copyrightYear>2025</span><span class=with-love><i class="ic i-sakura rotate"></i></span> <span class=author itemprop=copyrightHolder>ReverseSacle @ ReverseSacle-Blog</span></div><div class=count><i class="ic i-clock" aria-hidden=true></i> <span id=time align=center>载入时间中...<script defer>var now=new Date;function createtime(){var n=new Date("2021-11-16 22:30:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("time").innerHTML="已经过 "+dnum+" 天 "+hnum+" 小时 "+mnum+" 分 "+snum+" 秒 "}setInterval("createtime()",250)</script></span><span class=post-meta-item-icon>|&nbsp<i class="ic i-chart-area"></i></span> <span title=站点总字数>2.1m 字</span> <span class=post-meta-item-icon>|&nbsp<i class="ic i-coffee"></i></span> <span title=站点阅读时长>40:40</span></div></div></div></footer></div><script data-config>var LOCAL={path:"computer-science/programming/web/nginx/",favicon:{show:"ReverseSacle-Blog",hide:"ReverseSacle-Blog"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},waline:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src=https://polyfill.alicdn.com/v3/polyfill.min.js></script><script src=https://cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1.16.0/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js></script><script src=/js/app.js></script></body></html>